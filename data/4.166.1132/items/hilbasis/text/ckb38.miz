environ
vocabularies NUMBERS,FINSEQ_1,FUNCT_1,RELAT_1,XBOOLE_0,TARSKI,ORDINAL4,NAT_1,XXREAL_0,ARYTM_3,PRE_POLY,CARD_1,FUNCOP_1,PARTFUN1,SUBSET_1,ARYTM_1,FUNCT_4,ORDINAL1,PBOOLE,FINSET_1,ORDERS_1,VECTSP_1,ZFMISC_1,ALGSTR_0,POLYNOM2,GROUP_1,POLYNOM1,SUPINF_2,RLVECT_1,ALGSEQ_1,LATTICES,POLYNOM3,STRUCT_0,CARD_3,CARD_FIL,QUOFIELD,MSSUBFAM,IDEAL_1,PRELAMB,MCART_1,BINOP_1,FUNCT_2,HILBASIS;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,PBOOLE,RELAT_1,FINSET_1,FUNCT_1,PARTFUN1,CARD_1,NUMBERS,XCMPLX_0,XXREAL_0,NAT_1,RELSET_1,FUNCT_2,FUNCOP_1,FINSEQ_1,FUNCT_4,BINOP_1,XXREAL_2,MCART_1,FINSEQOP,FINSEQ_2,FUNCT_7,PRE_POLY,DOMAIN_1,STRUCT_0,ALGSTR_0,RLVECT_1,VFUNCT_1,BHSP_1,GROUP_1,VECTSP_1,NORMSP_1,POLYNOM1,POLYNOM2,POLYNOM3,ALGSEQ_1,NAT_D,IDEAL_1,TOPS_2,GRCAT_1,ORDINAL1,WSIERP_1,ORDERS_1,GROUP_6,QUOFIELD,RECDEF_1,MATRLIN,CKB6,CKB9,CKB14,CKB21,CKB23,CKB36;
definitions TARSKI,IDEAL_1,GRCAT_1,GROUP_6,FUNCOP_1,POLYNOM3,CARD_1,STRUCT_0,CKB6,CKB9,CKB14,CKB21,CKB23,CKB36;
theorems TARSKI,ZFMISC_1,RLVECT_1,FUNCT_1,FUNCT_2,POLYNOM1,NAT_1,AXIOMS,FVSUM_1,FINSEQ_1,FINSEQ_2,FINSEQ_3,POLYNOM3,FUNCOP_1,ALGSEQ_1,INT_1,FUNCT_7,IDEAL_1,POLYNOM4,GRCAT_1,QUOFIELD,FUNCT_4,RELAT_1,CARD_1,MATRLIN,CARD_3,ORDINAL1,WAYBEL_1,ORDERS_1,FINSET_1,FINSEQOP,POLYNOM2,TOPS_2,FINSEQ_5,GROUP_1,XBOOLE_0,XBOOLE_1,RLVECT_2,VECTSP_1,XREAL_1,GROUP_6,XXREAL_0,NORMSP_1,PARTFUN1,XXREAL_2,NAT_D,XREAL_0,PRE_POLY,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36;
schemes NAT_1,RECDEF_1,FUNCT_1,FUNCT_2,FINSEQ_2,FUNCT_7;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,FUNCOP_1,FINSET_1,XXREAL_0,XREAL_0,NAT_1,INT_1,CARD_1,MEMBERED,FINSEQ_1,CARD_5,PRE_CIRC,STRUCT_0,VECTSP_1,ALGSTR_1,GR_CY_1,WAYBEL_2,GCD_1,PRE_POLY,POLYNOM1,POLYNOM2,POLYNOM3,IDEAL_1,VALUED_0,ALGSTR_0,XXREAL_2,VFUNCT_1,FUNCT_2,RELSET_1,CKB17,CKB37;
constructors FINSEQOP,RFUNCT_3,NAT_D,REAL_1,WSIERP_1,TOPS_2,ALGSEQ_1,BHSP_1,GRCAT_1,GROUP_6,MATRIX_2,DTCONSTR,TRIANG_1,QUOFIELD,POLYNOM2,POLYNOM3,IDEAL_1,SEQ_1,RECDEF_1,SEQ_4,XXREAL_2,DOMAIN_1,BINARITH,RELSET_1,FUNCT_7,PRE_POLY,MATRLIN,VFUNCT_1,CKB6,CKB9,CKB14,CKB21,CKB23,CKB36;
requirements NUMERALS,REAL,SUBSET,BOOLE,ARITHM;
begin
registration
let R being  Abelian  add-associative  right_zeroed  right_complementable  associative  distributive  well-unital  commutative non trivial doubleLoopStr;
let n being (Element of ( NAT ));
cluster ( upm (n,R) ) ->  multiplicative;
coherence
proof
set P = ( upm (n,R) );
set CR = (the carrier of R);
set PNR = ( Polynom-Ring (n,R) );
set CPNR = (the carrier of PNR);
thus P is  multiplicative
proof
let x9 being (Element of (the carrier of ( Polynom-Ring ( Polynom-Ring (n,R) ) ))),y9 being (Element of (the carrier of ( Polynom-Ring ( Polynom-Ring (n,R) ) )));
reconsider x = x9,y = y9,xy = ( x9 * y9 ) as (Polynomial of PNR) by POLYNOM3:def 10;
reconsider Pxy = ( P . ( x9 * y9 ) ),PxPy = ( ( P . x9 ) * ( P . y9 ) ),Px = ( P . x9 ),Py = ( P . y9 ) as (Polynomial of ( n + 1 ),R) by POLYNOM1:def 10;
A3: xy = ( x *' y ) by POLYNOM3:def 10;
A4: PxPy = ( Px *' Py ) by POLYNOM1:def 10;
now
let b9 being set;
assume b9 in ( Bags ( n + 1 ) );
then reconsider b = b9 as (Element of ( Bags ( n + 1 ) ));
consider r being (FinSequence of CPNR) such that A5: ( len r ) = ( ( b . n ) + 1 ) and A6: ( xy . ( b . n ) ) = ( Sum r ) and A7: (for k being (Element of ( NAT )) holds (k in ( dom r ) implies ( r . k ) = ( ( x . ( k -' 1 ) ) * ( y . ( ( ( b . n ) + 1 ) -' k ) ) ))) by A3,POLYNOM3:def 9;
n < ( n + 1 ) by NAT_1:13;
then reconsider bn = ( b | n ) as (Element of ( Bags n )) by CKB3:1;
defpred P3[ set,set ]
 means
(for p,q being (Polynomial of n,R) holds (for fcr being (FinSequence of CR) holds (for i being (Element of ( NAT )) holds ((((i = $1 & p = ( x . ( i -' 1 ) )) & q = ( y . ( ( ( b . n ) + 1 ) -' i ) )) & fcr = $2) implies ((( ( p *' q ) . bn ) = ( Sum fcr ) & ( len fcr ) = ( len ( decomp bn ) )) & (for k being (Element of ( NAT )) holds (k in ( dom fcr ) implies (ex b1,b2 being (bag of n) st (( ( decomp bn ) /. k ) = <* b1,b2 *> & ( fcr /. k ) = ( ( p . b1 ) * ( q . b2 ) ))))))))));
reconsider xybn = ( xy . ( b . n ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
consider u being (FinSequence of CR) such that A8: ( PxPy . b ) = ( Sum u ) and A9: ( len u ) = ( len ( decomp b ) ) and A10: (for k being (Element of ( NAT )) holds (k in ( dom u ) implies (ex b1,b2 being (bag of ( n + 1 )) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( u /. k ) = ( ( Px . b1 ) * ( Py . b2 ) ))))) by A4,POLYNOM1:def 9;
A11:now
let e9 being set;
assume e9 in ( dom r );
then reconsider e = e9 as (Element of ( NAT ));
reconsider p = ( x . ( e -' 1 ) ),q = ( y . ( ( ( b . n ) + 1 ) -' e ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
consider fcr being (FinSequence of CR) such that A12: ((( ( p *' q ) . bn ) = ( Sum fcr ) & ( len fcr ) = ( len ( decomp bn ) )) & (for k being (Element of ( NAT )) holds (k in ( dom fcr ) implies (ex b1,b2 being (bag of n) st (( ( decomp bn ) /. k ) = <* b1,b2 *> & ( fcr /. k ) = ( ( p . b1 ) * ( q . b2 ) )))))) by POLYNOM1:def 9;
A13: fcr in ( CR * ) by FINSEQ_1:def 11;
P3[ e,fcr ] by A12;
hence (ex u being set st (u in ( CR * ) & P3[ e9,u ])) by A13;
end;
consider s being (Function of ( dom r ),( CR * )) such that A14: (for e being set holds (e in ( dom r ) implies P3[ e,( s . e ) ])) from FUNCT_2:sch 1(A11);
A15: ( rng s ) c= ( CR * );
A16: ( dom s ) = ( dom r ) by FUNCT_2:def 1;
then (ex n being Nat st ( dom s ) = ( Seg n )) by FINSEQ_1:def 2;
then s is  FinSequence-like by FINSEQ_1:def 2;
then reconsider s as (FinSequence of ( CR * )) by A15,FINSEQ_1:def 4;
consider g being (Function of CPNR,CR) such that A17: (for p being (Polynomial of n,R) holds ( g . p ) = ( p . bn )) and A18: ( xybn . bn ) = ( Sum ( g * r ) ) by A6,CKB35:1;
A19: ( Sum ( g * r ) ) = ( Pxy . b ) by A18,CKB36:def 1;
( ( 0 ) + 1 ) <= ( len r ) by A5,XREAL_1:6;
then A20: 1 in ( dom s ) by A16,FINSEQ_3:25;
A21:now
reconsider p9 = ( x . ( 1 -' 1 ) ),q9 = ( y . ( ( ( b . n ) + 1 ) -' 1 ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
( s /. 1 ) is (FinSequence of CR);
then A22: ( s . 1 ) is (FinSequence of CR) by A20,PARTFUN1:def 6;
(p9 = ( x . ( 1 -' 1 ) ) & q9 = ( y . ( ( ( b . n ) + 1 ) -' 1 ) ));
hence ( len ( s . 1 ) ) <> ( 0 ) by A14,A16,A20,A22;
end;
defpred P1[ set,set ]
 means
(for i,n1 being (Element of ( NAT )) holds (for b1 being (bag of ( n + 1 )) holds ((((n1 = $1 & b1 = ( ( divisors b ) . n1 )) & i in ( dom ( divisors bn ) )) & ( ( divisors bn ) . i ) = ( b1 | n )) implies ((( ( b1 . n ) + 1 ) in ( dom s ) & i in ( dom ( s . ( ( b1 . n ) + 1 ) ) )) & $2 = ( ( Sum ( Card ( s | ( ( ( b1 . n ) + 1 ) -' 1 ) ) ) ) + i )))));
set t = ( FlattenSeq s );
A23:now
let n19 being set;
assume A24: n19 in ( dom u );
then reconsider n1 = n19 as (Element of ( NAT ));
( dom u ) = ( dom ( decomp b ) ) by A9,FINSEQ_3:29
.= ( dom ( divisors b ) ) by PRE_POLY:def 17;
then A25: ( ( divisors b ) . n1 ) in ( rng ( divisors b ) ) by A24,FUNCT_1:def 3;
then reconsider b1 = ( ( divisors b ) . n1 ) as (bag of ( n + 1 ));
A26: b1 divides b by A25,CKB8:1;
then ( b1 . n ) <= ( b . n ) by PRE_POLY:def 11;
then A27: ( ( b1 . n ) + 1 ) <= ( ( b . n ) + 1 ) by XREAL_1:6;
n < ( n + 1 ) by NAT_1:13;
then reconsider b1n = ( b1 | n ) as (Element of ( Bags n )) by CKB3:1;
reconsider p = ( x . ( ( ( b1 . n ) + 1 ) -' 1 ) ),q = ( y . ( ( ( b . n ) + 1 ) -' ( ( b1 . n ) + 1 ) ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
A28: (p = ( x . ( ( ( b1 . n ) + 1 ) -' 1 ) ) & q = ( y . ( ( ( b . n ) + 1 ) -' ( ( b1 . n ) + 1 ) ) ));
b1n divides bn by A26,CKB4:1;
then b1n in ( rng ( divisors bn ) ) by CKB8:1;
then consider i being set such that A29: i in ( dom ( divisors bn ) ) and A30: b1n = ( ( divisors bn ) . i ) by FUNCT_1:def 3;
reconsider i as (Element of ( NAT )) by A29;
set n2 = ( ( Sum ( Card ( s | ( ( ( b1 . n ) + 1 ) -' 1 ) ) ) ) + i );
A31: ( ( b1 . n ) + 1 ) >= ( 1 + ( 0 ) ) by XREAL_1:6;
then A32: ( ( b1 . n ) + 1 ) in ( dom s ) by A5,A16,A27,FINSEQ_3:25;
then ( s . ( ( b1 . n ) + 1 ) ) is (Element of ( CR * )) by A16,FUNCT_2:5;
then ( len ( s . ( ( b1 . n ) + 1 ) ) ) = ( len ( decomp bn ) ) by A14,A16,A32,A28;
then A33: ( dom ( s . ( ( b1 . n ) + 1 ) ) ) = ( dom ( decomp bn ) ) by FINSEQ_3:29
.= ( dom ( divisors bn ) ) by PRE_POLY:def 17;
then A34: n2 in ( dom t ) by A29,A32,PRE_POLY:30;
(for i9,n19 being (Element of ( NAT )) holds (for b19 being (bag of ( n + 1 )) holds ((((n19 = n1 & b19 = ( ( divisors b ) . n19 )) & i9 in ( dom ( divisors bn ) )) & ( ( divisors bn ) . i9 ) = ( b19 | n )) implies ((( ( b19 . n ) + 1 ) in ( dom s ) & i9 in ( dom ( s . ( ( b19 . n ) + 1 ) ) )) & n2 = ( ( Sum ( Card ( s | ( ( ( b19 . n ) + 1 ) -' 1 ) ) ) ) + i9 ))))) by A5,A16,A29,A30,A27,A31,A33,FINSEQ_3:25,FUNCT_1:def 4;
hence (ex n29 being set st (n29 in ( dom t ) & P1[ n19,n29 ])) by A34;
end;
consider p being (Function of ( dom u ),( dom t )) such that A35: (for x being set holds (x in ( dom u ) implies P1[ x,( p . x ) ])) from FUNCT_2:sch 1(A23);
1 in ( dom ( Card s ) ) by A20,CARD_3:def 2;
then ( Sum ( Card s ) ) >= ( ( Card s ) . 1 ) by POLYNOM3:4;
then ( Sum ( Card s ) ) > ( 0 ) by A20,A21,CARD_3:def 2;
then ( len t ) > ( 0 ) by PRE_POLY:27;
then A36: t <> ( {} );
then A37: ( dom p ) = ( dom u ) by FUNCT_2:def 1;
now
let n19 being set,n29 being set;
assume that
A38: n19 in ( dom p )
and
A39: n29 in ( dom p )
and
A40: ( p . n19 ) = ( p . n29 );
( dom p ) = ( dom u ) by A36,FUNCT_2:def 1;
then reconsider n1 = n19,n2 = n29 as (Element of ( NAT )) by A38,A39;
A41: ( dom u ) = ( dom ( decomp b ) ) by A9,FINSEQ_3:29
.= ( dom ( divisors b ) ) by PRE_POLY:def 17;
then A42: ( ( divisors b ) . n1 ) in ( rng ( divisors b ) ) by A38,FUNCT_1:def 3;
then reconsider b1 = ( ( divisors b ) . n1 ) as (bag of ( n + 1 ));
A43: ( ( divisors b ) . n2 ) in ( rng ( divisors b ) ) by A39,A41,FUNCT_1:def 3;
then reconsider b2 = ( ( divisors b ) . n2 ) as (bag of ( n + 1 ));
n < ( n + 1 ) by NAT_1:13;
then reconsider b1n = ( b1 | n ),b2n = ( b2 | n ) as (Element of ( Bags n )) by CKB3:1;
A44: (( ( Card s ) | ( ( ( b1 . n ) + 1 ) -' 1 ) ) = ( Card ( s | ( ( ( b1 . n ) + 1 ) -' 1 ) ) ) & ( ( Card s ) | ( ( ( b2 . n ) + 1 ) -' 1 ) ) = ( Card ( s | ( ( ( b2 . n ) + 1 ) -' 1 ) ) )) by POLYNOM3:16;
b2 divides b by A43,CKB8:1;
then b2n divides bn by CKB4:1;
then b2n in ( rng ( divisors bn ) ) by CKB8:1;
then consider i2 being set such that A45: i2 in ( dom ( divisors bn ) ) and A46: b2n = ( ( divisors bn ) . i2 ) by FUNCT_1:def 3;
reconsider i2 as (Element of ( NAT )) by A45;
A47: (( ( b2 . n ) + 1 ) in ( dom s ) & i2 in ( dom ( s . ( ( b2 . n ) + 1 ) ) )) by A35,A39,A45,A46;
b1 divides b by A42,CKB8:1;
then b1n divides bn by CKB4:1;
then b1n in ( rng ( divisors bn ) ) by CKB8:1;
then consider i1 being set such that A48: i1 in ( dom ( divisors bn ) ) and A49: b1n = ( ( divisors bn ) . i1 ) by FUNCT_1:def 3;
reconsider i1 as (Element of ( NAT )) by A48;
A50: ( p . n1 ) = ( ( Sum ( Card ( s | ( ( ( b1 . n ) + 1 ) -' 1 ) ) ) ) + i1 ) by A35,A38,A48,A49;
A51: ( p . n2 ) = ( ( Sum ( Card ( s | ( ( ( b2 . n ) + 1 ) -' 1 ) ) ) ) + i2 ) by A35,A39,A45,A46;
A52: b2 is (Element of ( Bags ( n + 1 ) )) by PRE_POLY:def 12;
(( ( b1 . n ) + 1 ) in ( dom s ) & i1 in ( dom ( s . ( ( b1 . n ) + 1 ) ) )) by A35,A38,A48,A49;
then A53: (( ( b1 . n ) + 1 ) = ( ( b2 . n ) + 1 ) & i1 = i2) by A40,A50,A47,A51,A44,POLYNOM3:22;
b1 is (Element of ( Bags ( n + 1 ) )) by PRE_POLY:def 12;
then b1 = ( b1n bag_extend ( b1 . n ) ) by CKB6:def 1
.= b2 by A49,A46,A53,A52,CKB6:def 1;
hence n19 = n29 by A38,A39,A41,FUNCT_1:def 4;
end;
then A54: p is  one-to-one by FUNCT_1:def 4;
( dom t ) c= ( rng p )
proof
let n19 being set;
assume A55: n19 in ( dom t );
then reconsider n1 = n19 as (Element of ( NAT ));
consider i being (Element of ( NAT )),j being (Element of ( NAT )) such that A56: i in ( dom s ) and A57: j in ( dom ( s . i ) ) and A58: n1 = ( ( Sum ( Card ( s | ( i -' 1 ) ) ) ) + j ) and ( ( s . i ) . j ) = ( t . n1 ) by A55,PRE_POLY:29;
( s . i ) in ( CR * ) by A16,A56,FUNCT_2:5;
then A59: ( s . i ) is (FinSequence of CR) by FINSEQ_1:def 11;
reconsider bj = ( ( divisors bn ) /. j ) as (bag of n);
set bij = ( bj bag_extend ( i -' 1 ) );
reconsider p9 = ( x . ( i -' 1 ) ),q9 = ( y . ( ( ( b . n ) + 1 ) -' i ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
A60: ( bij . n ) = ( i -' 1 ) by CKB6:def 1;
1 <= i by A56,FINSEQ_3:25;
then A61: ( ( bij . n ) + 1 ) = i by A60,XREAL_1:235;
A62: ( dom u ) = ( dom ( decomp b ) ) by A9,FINSEQ_3:29
.= ( dom ( divisors b ) ) by PRE_POLY:def 17;
(p9 = ( x . ( i -' 1 ) ) & q9 = ( y . ( ( ( b . n ) + 1 ) -' i ) ));
then ( len ( s . i ) ) = ( len ( decomp bn ) ) by A14,A16,A56,A59;
then A63: ( dom ( s . i ) ) = ( dom ( decomp bn ) ) by FINSEQ_3:29
.= ( dom ( divisors bn ) ) by PRE_POLY:def 17;
then A64: bj = ( ( divisors bn ) . j ) by A57,PARTFUN1:def 6;
then bj in ( rng ( divisors bn ) ) by A57,A63,FUNCT_1:def 3;
then A65: bj divides bn by CKB8:1;
now
let k being set;
per cases ;
suppose A66: k in ( n + 1 );

now
per cases ;
suppose A67: k in n;

then A68: ( b . k ) = ( bn . k ) by FUNCT_1:49;
( bij . k ) = ( ( bij | n ) . k ) by A67,FUNCT_1:49
.= ( bj . k ) by CKB6:def 1;
hence ( bij . k ) <= ( b . k ) by A65,A68,PRE_POLY:def 11;
end;
suppose A69: (not k in n);

A70: 1 <= i by A56,FINSEQ_3:25;
i <= ( ( b . n ) + 1 ) by A5,A16,A56,FINSEQ_3:25;
then A71: ( i - 1 ) <= ( ( ( b . n ) + 1 ) - 1 ) by XREAL_1:9;
( n + 1 ) = ( succ n ) by NAT_1:38
.= ( n \/ { n } ) by ORDINAL1:def 1;
then k in { n } by A66,A69,XBOOLE_0:def 3;
then A72: k = n by TARSKI:def 1;
then ( bij . k ) = ( i -' 1 ) by CKB6:def 1;
hence ( bij . k ) <= ( b . k ) by A72,A70,A71,XREAL_1:233;
end;
end;
hence ( bij . k ) <= ( b . k );
end;
suppose A73: (not k in ( n + 1 ));

( dom bij ) = ( n + 1 ) by PARTFUN1:def 2;
hence ( bij . k ) <= ( b . k ) by A73,FUNCT_1:def 2;
end;
end;
then bij divides b by PRE_POLY:def 11;
then bij in ( rng ( divisors b ) ) by CKB8:1;
then consider k being set such that A74: k in ( dom ( divisors b ) ) and A75: bij = ( ( divisors b ) . k ) by FUNCT_1:def 3;
A76: ( dom p ) = ( dom u ) by A36,FUNCT_2:def 1;
( ( divisors bn ) . j ) = ( bij | n ) by A64,CKB6:def 1;
then ( p . k ) = ( ( Sum ( Card ( s | ( ( ( bij . n ) + 1 ) -' 1 ) ) ) ) + j ) by A35,A57,A63,A74,A75,A62;
hence thesis by A58,A74,A76,A62,A61,FUNCT_1:def 3;
end;
then A77: ( rng p ) = ( dom t ) by XBOOLE_0:def 10;
( len ( Sum s ) ) = ( len s ) by MATRLIN:def 6;
then A78: ( dom ( Sum s ) ) = ( dom r ) by A16,FINSEQ_3:29;
A79:now
let k being Nat;
reconsider p = ( x . ( k -' 1 ) ),q = ( y . ( ( ( b . n ) + 1 ) -' k ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
reconsider pq9 = ( p *' q ) as (Element of CPNR) by POLYNOM1:def 10;
assume A80: k in ( dom r );
then reconsider sk = ( s . k ) as (Element of ( CR * )) by FUNCT_2:5;
reconsider sk as (FinSequence of CR);
A81: ( r . k ) = ( ( x . ( k -' 1 ) ) * ( y . ( ( ( b . n ) + 1 ) -' k ) ) ) by A7,A80
.= pq9 by POLYNOM1:def 10;
(( ( Sum s ) /. k ) = ( ( Sum s ) . k ) & ( s /. k ) = ( s . k )) by A16,A78,A80,PARTFUN1:def 6;
hence ( ( Sum s ) . k ) = ( Sum sk ) by A78,A80,MATRLIN:def 6
.= ( ( p *' q ) . bn ) by A14,A80
.= ( g . ( r . k ) ) by A17,A81
.= ( ( g * r ) . k ) by A80,FUNCT_1:13;
end;
A82:now
let n1 being (Element of ( NAT ));
reconsider b19 = ( ( divisors b ) /. n1 ) as (bag of ( n + 1 ));
assume A83: n1 in ( dom u );
then consider b1 being (bag of ( n + 1 )),b2 being (bag of ( n + 1 )) such that A84: ( ( decomp b ) /. n1 ) = <* b1,b2 *> and A85: ( u /. n1 ) = ( ( Px . b1 ) * ( Py . b2 ) ) by A10;
A86: ( dom u ) = ( dom ( decomp b ) ) by A9,FINSEQ_3:29;
then A87: <* b1,b2 *> = <* b19,( b -' b19 ) *> by A83,A84,PRE_POLY:def 17;
then A88: b1 = b19 by FINSEQ_1:77;
reconsider xb1n = ( x . ( b1 . n ) ),yb2n = ( y . ( b2 . n ) ) as (Polynomial of n,R) by POLYNOM1:def 10;
n < ( n + 1 ) by NAT_1:13;
then reconsider b1n = ( b1 | n ),b2n = ( b2 | n ) as (Element of ( Bags n )) by CKB3:1;
A89: ( u . n1 ) = ( ( Px . b1 ) * ( Py . b2 ) ) by A83,A85,PARTFUN1:def 6
.= ( ( xb1n . b1n ) * ( Py . b2 ) ) by CKB36:def 1
.= ( ( xb1n . b1n ) * ( yb2n . b2n ) ) by CKB36:def 1;
A90: b2 = ( b -' b19 ) by A87,FINSEQ_1:77;
A91: n1 in ( dom ( divisors b ) ) by A83,A86,PRE_POLY:def 17;
then A92: b1 = ( ( divisors b ) . n1 ) by A88,PARTFUN1:def 6;
then b1 in ( rng ( divisors b ) ) by A91,FUNCT_1:def 3;
then A93: b1 divides b by CKB8:1;
then b1n divides bn by CKB4:1;
then b1n in ( rng ( divisors bn ) ) by CKB8:1;
then consider i being set such that A94: i in ( dom ( divisors bn ) ) and A95: b1n = ( ( divisors bn ) . i ) by FUNCT_1:def 3;
reconsider i as (Element of ( NAT )) by A94;
A96: ( b1 . n ) <= ( b . n ) by A93,PRE_POLY:def 11;
then ( ( b1 . n ) + 1 ) <= ( ( b . n ) + 1 ) by XREAL_1:6;
then A97: ( ( ( b . n ) + 1 ) -' ( ( b1 . n ) + 1 ) ) = ( ( ( b . n ) + 1 ) - ( ( b1 . n ) + 1 ) ) by XREAL_1:233
.= ( ( ( ( b . n ) - ( b1 . n ) ) + 1 ) - 1 )
.= ( ( b . n ) -' ( b1 . n ) ) by A96,XREAL_1:233
.= ( b2 . n ) by A88,A90,PRE_POLY:def 6;
A98: ( ( ( b1 . n ) + 1 ) -' 1 ) = ( ( ( b1 . n ) + 1 ) - 1 ) by NAT_D:37
.= ( b1 . n );
then A99: xb1n = ( x . ( ( ( b1 . n ) + 1 ) -' 1 ) );
A100: ( ( b1 . n ) + 1 ) in ( dom s ) by A35,A83,A92,A94,A95;
then ( s . ( ( b1 . n ) + 1 ) ) is (Element of ( CR * )) by A16,FUNCT_2:5;
then reconsider sb1n1 = ( s . ( ( b1 . n ) + 1 ) ) as (FinSequence of CR);
A101: i in ( dom ( s . ( ( b1 . n ) + 1 ) ) ) by A35,A83,A92,A94,A95;
then consider B1 being (bag of n),B2 being (bag of n) such that A102: ( ( decomp bn ) /. i ) = <* B1,B2 *> and A103: ( sb1n1 /. i ) = ( ( xb1n . B1 ) * ( yb2n . B2 ) ) by A14,A16,A100,A98,A97;
( p . n1 ) = ( ( Sum ( Card ( s | ( ( ( b1 . n ) + 1 ) -' 1 ) ) ) ) + i ) by A35,A83,A92,A94,A95;
then A104: ( t . ( p . n1 ) ) = ( ( s . ( ( b1 . n ) + 1 ) ) . i ) by A100,A101,PRE_POLY:30;
reconsider B19 = ( ( divisors bn ) /. i ) as (bag of n);
A105: ( dom ( divisors bn ) ) = ( dom ( decomp bn ) ) by PRE_POLY:def 17;
then A106: <* B1,B2 *> = <* B19,( bn -' B19 ) *> by A94,A102,PRE_POLY:def 17;
then A107: B1 = B19 by FINSEQ_1:77;
then A108: B1 = b1n by A94,A95,PARTFUN1:def 6;
yb2n = ( y . ( ( ( b . n ) + 1 ) -' ( ( b1 . n ) + 1 ) ) ) by A97;
then ( len sb1n1 ) = ( len ( decomp bn ) ) by A14,A16,A100,A99;
then A109: ( dom sb1n1 ) = ( dom ( divisors bn ) ) by A105,FINSEQ_3:29;
B2 = ( bn -' B19 ) by A106,FINSEQ_1:77;
then B2 = b2n by A88,A90,A107,A108,CKB5:1;
hence ( u . n1 ) = ( t . ( p . n1 ) ) by A89,A94,A104,A103,A108,A109,PARTFUN1:def 6;
end;
( dom r ) = ( dom ( g * r ) ) by FINSEQ_3:120;
then ( Sum s ) = ( g * r ) by A78,A79,FINSEQ_1:13;
then A110: ( Sum t ) = ( Pxy . b ) by A19,POLYNOM1:14;
A111: ( len u ) = ( card ( dom u ) ) by CARD_1:62
.= ( card (p qua set) ) by A37,CARD_1:62
.= ( card ( dom t ) ) by A54,A77,PRE_POLY:19
.= ( len t ) by CARD_1:62;
then A112: ( dom u ) = ( dom t ) by FINSEQ_3:29;
then p is (Permutation of ( dom u )) by A54,A77,FUNCT_2:57;
hence ( Pxy . b9 ) = ( PxPy . b9 ) by A110,A8,A82,A111,A112,RLVECT_2:6;
end;
hence ( P . ( x9 * y9 ) ) = ( ( P . x9 ) * ( P . y9 ) ) by FUNCT_2:12;
end;

end;
end;
