environ
vocabularies NUMBERS,XBOOLE_0,SUBSET_1,REAL_1,SEQ_1,PROB_1,RPR_1,CARD_1,ARYTM_3,RELAT_1,SEQ_2,FUNCT_1,ARYTM_1,ORDINAL2,XREAL_0,ORDINAL1,XXREAL_0,COMPLEX1,EQREL_1,TARSKI,ZFMISC_1,NAT_1,CARD_3,VALUED_1,PROB_2;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,ORDINAL1,NUMBERS,XREAL_0,COMPLEX1,RELAT_1,REAL_1,FUNCT_1,FUNCT_2,VALUED_1,SEQ_1,SEQ_2,PROB_1,NAT_1,XXREAL_0,CKB3,CKB4,CKB13,CKB14,CKB26,CKB27;
definitions PROB_1,SUBSET_1,CKB4,CKB13,CKB14,CKB26,CKB27;
theorems FUNCT_1,FUNCT_2,SEQ_2,SUBSET_1,PROB_1,NAT_1,TARSKI,XBOOLE_0,XBOOLE_1,XCMPLX_0,XCMPLX_1,COMPLEX1,XREAL_1,ORDINAL1,VALUED_1,VALUED_0,RELAT_1,CKB1,CKB2,CKB4,CKB5,CKB6,CKB7,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37;
schemes FUNCT_1,FUNCT_2,NAT_1;
registrations XBOOLE_0,SUBSET_1,ORDINAL1,RELSET_1,NUMBERS,XXREAL_0,XREAL_0,MEMBERED,VALUED_0,PROB_1,CKB8;
constructors XXREAL_0,REAL_1,NAT_1,COMPLEX1,VALUED_1,SEQ_1,SEQ_2,PROB_1,XXREAL_1,RELSET_1,CKB3,CKB4,CKB13,CKB14,CKB26,CKB27;
requirements REAL,NUMERALS,BOOLE,SUBSET,ARITHM;
begin
reserve n for (Element of ( NAT ));
reserve x for set;
reserve y for set;
reserve r for Real;
reserve r1 for Real;
reserve Omega for non  empty set;
reserve Sigma for (SigmaField of Omega);
reserve A for (Event of Sigma);
reserve B for (Event of Sigma);
reserve C for (Event of Sigma);
reserve ASeq for (SetSequence of Sigma);
reserve BSeq for (SetSequence of Sigma);
reserve P for (Probability of Sigma);
reserve P1 for (Probability of Sigma);
reserve P2 for (Probability of Sigma);
definition
let Omega;
let Sigma;
let P;
let B;
assume A1: ( 0 ) < ( P . B );
func P .|. B -> (Probability of Sigma) means 
:Def7: (for A holds ( it . A ) = ( ( P . ( A /\ B ) ) / ( P . B ) ));
existence
proof
defpred P[ set,set ]
 means
(ex A st (ex r st ((A = $1 & r = $2) & r = ( ( P . ( A /\ B ) ) / ( P . B ) ))));
A2: (for x holds (x in Sigma implies (ex y st (y in ( REAL ) & P[ x,y ]))))
proof
let x;
assume x in Sigma;
then reconsider x as (Event of Sigma);
consider y such that A3: y = ( ( P . ( x /\ B ) ) / ( P . B ) );
take y;
thus thesis by A3;
end;
consider f being (Function of Sigma,( REAL )) such that A4: (for x holds (x in Sigma implies P[ x,( f . x ) ])) from FUNCT_2:sch 1(A2);
A5: (for A holds ( f . A ) = ( ( P . ( A /\ B ) ) / ( P . B ) ))
proof
let A;
(ex C st (ex r1 st ((C = A & r1 = ( f . A )) & r1 = ( ( P . ( C /\ B ) ) / ( P . B ) )))) by A4;
hence thesis;
end;
then A6: ( f . Omega ) = ( ( P . ( ( [#] Sigma ) /\ B ) ) / ( P . B ) )
.= ( ( P . B ) / ( P . B ) ) by XBOOLE_1:28
.= 1 by A1,XCMPLX_1:60;
A7: (for A holds (for C holds (A misses C implies ( f . ( A \/ C ) ) = ( ( f . A ) + ( f . C ) ))))
proof
let A;
let C;
assume A misses C;
then A8: ( A /\ B ) misses ( C /\ B ) by XBOOLE_1:76;
thus ( f . ( A \/ C ) ) = ( ( P . ( ( A \/ C ) /\ B ) ) / ( P . B ) ) by A5
.= ( ( P . ( ( A /\ B ) \/ ( C /\ B ) ) ) / ( P . B ) ) by XBOOLE_1:23
.= ( ( ( P . ( A /\ B ) ) + ( P . ( C /\ B ) ) ) / ( P . B ) ) by A8,PROB_1:def 8
.= ( ( ( P . ( A /\ B ) ) / ( P . B ) ) + ( ( P . ( C /\ B ) ) / ( P . B ) ) ) by XCMPLX_1:62
.= ( ( ( P . ( A /\ B ) ) / ( P . B ) ) + ( f . C ) ) by A5
.= ( ( f . A ) + ( f . C ) ) by A5;
end;
A9: (for A holds ( 0 ) <= ( f . A ))
proof
let A;
( 0 ) <= ( P . ( A /\ B ) ) by PROB_1:def 8;
then ( 0 ) <= ( ( P . ( A /\ B ) ) / ( P . B ) ) by A1;
hence thesis by A5;
end;
(for ASeq holds (ASeq is  non-ascending implies (( f * ASeq ) is  convergent & ( lim ( f * ASeq ) ) = ( f . ( Intersection ASeq ) ))))
proof
let ASeq;
assume that
A10: ASeq is  non-ascending;
consider BSeq such that A11: (for n holds ( BSeq . n ) = ( ( ASeq . n ) /\ B )) by CKB5:1;
A12: ( dom ( f * ASeq ) ) = ( NAT ) by FUNCT_2:def 1;
A13:now
let n being set;
assume A14: n in ( dom ( f * ASeq ) );
then reconsider n1 = n as (Element of ( NAT )) by FUNCT_2:def 1;
thus ( ( f * ASeq ) . n ) = ( f . ( ASeq . n ) ) by A12,A14,FUNCT_2:15
.= ( ( P . ( ( ASeq . n1 ) /\ B ) ) / ( P . B ) ) by A5
.= ( ( P . ( BSeq . n ) ) / ( P . B ) ) by A11
.= ( ( ( P * BSeq ) . n ) / ( P . B ) ) by A12,A14,FUNCT_2:15
.= ( ( ( P . B ) " ) * ( ( P * BSeq ) . n ) ) by XCMPLX_0:def 9;
end;
A15: BSeq is  non-ascending by A10,A11,CKB6:1;
then A16: ( P * BSeq ) is  convergent by PROB_1:def 8;
( dom ( P * BSeq ) ) = ( NAT ) by FUNCT_2:def 1;
then A17: ( f * ASeq ) = ( ( ( P . B ) " ) (#) ( P * BSeq ) ) by A12,A13,VALUED_1:def 5;
hence ( f * ASeq ) is  convergent by A16,SEQ_2:7;
( lim ( P * BSeq ) ) = ( P . ( Intersection BSeq ) ) by A15,PROB_1:def 8;
hence ( lim ( f * ASeq ) ) = ( ( ( P . B ) " ) * ( P . ( @Intersection BSeq ) ) ) by A17,A16,SEQ_2:8
.= ( ( P . ( @Intersection BSeq ) ) / ( P . B ) ) by XCMPLX_0:def 9
.= ( ( P . ( ( @Intersection ASeq ) /\ B ) ) / ( P . B ) ) by A11,CKB7:1
.= ( f . ( Intersection ASeq ) ) by A5;
end;
then reconsider f as (Probability of Sigma) by A9,A6,A7,PROB_1:def 8;
take f;
thus thesis by A5;
end;
uniqueness
proof
let P1;
let P2;
assume that
A18: (for A holds ( P1 . A ) = ( ( P . ( A /\ B ) ) / ( P . B ) ))
and
A19: (for A holds ( P2 . A ) = ( ( P . ( A /\ B ) ) / ( P . B ) ));
now
let A;
thus ( P1 . A ) = ( ( P . ( A /\ B ) ) / ( P . B ) ) by A18
.= ( P2 . A ) by A19;
end;
hence thesis by CKB16:1;
end;
end;
