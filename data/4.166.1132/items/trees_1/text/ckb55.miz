environ
vocabularies NUMBERS,XBOOLE_0,SUBSET_1,FUNCT_1,FINSEQ_1,TARSKI,RELAT_1,NAT_1,ORDINAL4,ARYTM_3,FINSET_1,CARD_1,ARYTM_1,XXREAL_0,ORDINAL1,TREES_1,AMISTD_3,FINSEQ_2;
notations TARSKI,XBOOLE_0,ENUMSET1,SUBSET_1,CARD_1,XCMPLX_0,NAT_1,NUMBERS,ORDINAL1,RELAT_1,FUNCT_1,FINSEQ_1,FINSEQ_2,FUNCT_2,FINSET_1,XXREAL_0,CKB1,CKB2,CKB6,CKB15,CKB24,CKB27,CKB29,CKB41,CKB46,CKB47,CKB50,CKB51,CKB52;
definitions TARSKI,FINSET_1,FUNCT_1,WELLORD2,XBOOLE_0,FUNCOP_1,FINSEQ_2,CKB2,CKB15,CKB24,CKB41,CKB46,CKB47,CKB50,CKB51,CKB52;
theorems TARSKI,NAT_1,FINSEQ_1,FINSET_1,FUNCT_1,CARD_1,RELAT_1,GRFUNC_1,CARD_2,XBOOLE_0,XBOOLE_1,XREAL_1,XXREAL_0,ORDINAL1,ENUMSET1,FINSEQ_2,FINSEQ_3,FUNCOP_1,FUNCT_2,CKB2,CKB3,CKB4,CKB5,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB28,CKB30,CKB31,CKB32,CKB33,CKB36,CKB37,CKB39,CKB40,CKB41,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB50,CKB51,CKB52,CKB53,CKB54;
schemes NAT_1,CLASSES1,XBOOLE_0,FUNCT_2;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FINSET_1,XXREAL_0,XREAL_0,NAT_1,FINSEQ_1,CARD_1,RELSET_1,FINSEQ_2,FUNCOP_1,CKB25,CKB26,CKB34,CKB35,CKB38,CKB42,CKB49;
constructors ENUMSET1,WELLORD2,XXREAL_0,XREAL_0,NAT_1,FINSEQ_1,FINSEQ_2,FUNCOP_1,FUNCT_2,RELSET_1,CKB15,CKB24,CKB29,CKB41,CKB46,CKB47,CKB50,CKB51,CKB52;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve x for set;
reserve y for set;
reserve f for Function;
reserve q for (FinSequence of ( NAT ));
reserve r for (FinSequence of ( NAT ));
reserve T for Tree;
reserve T1 for Tree;
reserve t for (Element of T);
registration
let T being  finite Tree;
let t being (Element of T);
let T1 being  finite Tree;
cluster ( T with-replacement (t,T1) ) ->  finite;
coherence
proof
A1: { s where s is (Element of T): (not t is_a_proper_prefix_of s) } c= T
proof
let x;
assume x in { s where s is (Element of T): (not t is_a_proper_prefix_of s) };
then (ex s being (Element of T) st (x = s & (not t is_a_proper_prefix_of s)));
hence thesis;
end;
T1,{ ( t ^ s ) where s is (Element of T1): s = s } are_equipotent 
proof
defpred P[ set,set ]
 means
(ex q st ($1 = q & $2 = ( t ^ q )));
A2: (x in T1 implies (ex y st P[ x,y ]))
proof
assume x in T1;
then reconsider q = x as (FinSequence of ( NAT )) by CKB28:1;
( t ^ q ) = ( t ^ q );
hence thesis;
end;
consider f such that A3: (( dom f ) = T1 & (for x holds (x in T1 implies P[ x,( f . x ) ]))) from CLASSES1:sch 1(A2);
take f;
thus f is  one-to-one
proof
let x;
let y;
assume that
A4: (x in ( dom f ) & y in ( dom f ))
and
A5: ( f . x ) = ( f . y );
((ex q st (x = q & ( f . x ) = ( t ^ q ))) & (ex r st (y = r & ( f . y ) = ( t ^ r )))) by A3,A4;
hence thesis by A5,FINSEQ_1:33;
end;

thus ( dom f ) = T1 by A3;
thus ( rng f ) c= { ( t ^ s ) where s is (Element of T1): s = s }
proof
let x;
assume x in ( rng f );
then consider y such that A6: y in ( dom f ) and A7: x = ( f . y ) by FUNCT_1:def 3;
consider q such that A8: y = q and A9: ( f . y ) = ( t ^ q ) by A3,A6;
reconsider q as (Element of T1) by A3,A6,A8;
x = ( t ^ q ) by A7,A9;
hence thesis;
end;

let x;
assume x in { ( t ^ s ) where s is (Element of T1): s = s };
then consider s being (Element of T1) such that A10: x = ( t ^ s ) and s = s;
P[ s,( f . s ) ] by A3;
hence thesis by A3,A10,FUNCT_1:def 3;
end;
then { ( t ^ s ) where s is (Element of T1): s = s } is  finite by CARD_1:38;
then ( { v where v is (Element of T): (not t is_a_proper_prefix_of v) } \/ { ( t ^ s ) where s is (Element of T1): s = s } ) is  finite by A1;
hence thesis by CKB53:1;
end;
end;
