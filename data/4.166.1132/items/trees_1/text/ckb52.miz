environ
vocabularies NUMBERS,XBOOLE_0,SUBSET_1,FUNCT_1,FINSEQ_1,TARSKI,RELAT_1,NAT_1,ORDINAL4,ARYTM_3,FINSET_1,CARD_1,ARYTM_1,XXREAL_0,ORDINAL1,TREES_1,AMISTD_3,FINSEQ_2;
notations TARSKI,XBOOLE_0,ENUMSET1,SUBSET_1,CARD_1,XCMPLX_0,NAT_1,NUMBERS,ORDINAL1,RELAT_1,FUNCT_1,FINSEQ_1,FINSEQ_2,FUNCT_2,FINSET_1,XXREAL_0,CKB1,CKB2,CKB6,CKB15,CKB24,CKB27,CKB29,CKB41,CKB46,CKB47,CKB50,CKB51;
definitions TARSKI,FINSET_1,FUNCT_1,WELLORD2,XBOOLE_0,FUNCOP_1,FINSEQ_2,CKB2,CKB15,CKB24,CKB41,CKB46,CKB47,CKB50,CKB51;
theorems TARSKI,NAT_1,FINSEQ_1,FINSET_1,FUNCT_1,CARD_1,RELAT_1,GRFUNC_1,CARD_2,XBOOLE_0,XBOOLE_1,XREAL_1,XXREAL_0,ORDINAL1,ENUMSET1,FINSEQ_2,FINSEQ_3,FUNCOP_1,FUNCT_2,CKB2,CKB3,CKB4,CKB5,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB28,CKB30,CKB31,CKB32,CKB33,CKB36,CKB37,CKB39,CKB40,CKB41,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB50,CKB51;
schemes NAT_1,CLASSES1,XBOOLE_0,FUNCT_2;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FINSET_1,XXREAL_0,XREAL_0,NAT_1,FINSEQ_1,CARD_1,RELSET_1,FINSEQ_2,FUNCOP_1,CKB25,CKB26,CKB34,CKB35,CKB38,CKB42,CKB49;
constructors ENUMSET1,WELLORD2,XXREAL_0,XREAL_0,NAT_1,FINSEQ_1,FINSEQ_2,FUNCOP_1,FUNCT_2,RELSET_1,CKB15,CKB24,CKB29,CKB41,CKB46,CKB47,CKB50,CKB51;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve x for set;
reserve k for (Element of ( NAT ));
reserve n for (Element of ( NAT ));
reserve p for (FinSequence of ( NAT ));
reserve q for (FinSequence of ( NAT ));
reserve r for (FinSequence of ( NAT ));
reserve p1 for FinSequence;
reserve T for Tree;
reserve T1 for Tree;
reserve t for (Element of T);
definition
let T;
let p;
let T1;
assume A1: p in T;
func T with-replacement (p,T1) -> Tree means 
:Def12: (q in it iff ((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r )))));
existence
proof
reconsider p9 = p as (Element of T) by A1;
(not p is_a_proper_prefix_of p9);
then p in { t: (not p is_a_proper_prefix_of t) };
then reconsider X = ( { t: (not p is_a_proper_prefix_of t) } \/ { ( p ^ s ) where s is (Element of T1): s = s } ) as non  empty set;
A2: (x in { t: (not p is_a_proper_prefix_of t) } implies ((x is (FinSequence of ( NAT )) & x in ( ( NAT ) * )) & x in T))
proof
assume x in { t: (not p is_a_proper_prefix_of t) };
then A3: (ex t st (x = t & (not p is_a_proper_prefix_of t)));
hence x is (FinSequence of ( NAT ));
thus thesis by A3,FINSEQ_1:def 11;
end;
X is  Tree-like
proof
thus X c= ( ( NAT ) * )
proof
let x;
assume x in X;
then A4: (x in { t: (not p is_a_proper_prefix_of t) } or x in { ( p ^ s ) where s is (Element of T1): s = s }) by XBOOLE_0:def 3;
now
assume x in { ( p ^ s ) where s is (Element of T1): s = s };
then (ex s being (Element of T1) st (x = ( p ^ s ) & s = s));
hence x is (FinSequence of ( NAT ));
end;
hence thesis by A2,A4,FINSEQ_1:def 11;
end;

thus (for q holds (q in X implies ( ProperPrefixes q ) c= X))
proof
let q;
assume that
A5: q in X;
A6:now
assume q in { t: (not p is_a_proper_prefix_of t) };
then A7: (ex t st (q = t & (not p is_a_proper_prefix_of t)));
then A8: ( ProperPrefixes q ) c= T by CKB24:def 1;
thus ( ProperPrefixes q ) c= X
proof
let x;
assume A9: x in ( ProperPrefixes q );
then consider p1 such that A10: x = p1 and A11: p1 is_a_proper_prefix_of q by CKB15:def 1;
reconsider p1 as (Element of T) by A8,A9,A10;
(not p is_a_proper_prefix_of p1) by A7,A11,XBOOLE_1:56;
then x in { s1 where s1 is (Element of T): (not p is_a_proper_prefix_of s1) } by A10;
hence thesis by XBOOLE_0:def 3;
end;

end;
now
assume q in { ( p ^ s ) where s is (Element of T1): s = s };
then consider s being (Element of T1) such that A12: q = ( p ^ s ) and s = s;
thus ( ProperPrefixes q ) c= X
proof
let x;
assume A13: x in ( ProperPrefixes q );
then reconsider r = x as FinSequence by CKB16:1;
r is_a_proper_prefix_of ( p ^ s ) by A12,A13,CKB17:1;
then r is_a_prefix_of ( p ^ s ) by XBOOLE_0:def 8;
then consider r1 being FinSequence such that A14: ( p ^ s ) = ( r ^ r1 ) by CKB3:1;
A15:now
assume ( len p ) <= ( len r );
then consider r2 being FinSequence such that A16: ( p ^ r2 ) = r by A14,FINSEQ_1:47;
( p ^ s ) = ( p ^ ( r2 ^ r1 ) ) by A14,A16,FINSEQ_1:32;
then s = ( r2 ^ r1 ) by FINSEQ_1:33;
then A17: (( dom r2 ) = ( Seg ( len r2 ) ) & ( s | ( dom r2 ) ) = r2) by FINSEQ_1:21,FINSEQ_1:def 3;
then reconsider r2 as (FinSequence of ( NAT )) by FINSEQ_1:18;
r2 is_a_prefix_of s by A17,CKB2:def 1;
then reconsider r2 as (Element of T1) by CKB30:1;
r = ( p ^ r2 ) by A16;
then r in { ( p ^ v ) where v is (Element of T1): v = v };
hence r in X by XBOOLE_0:def 3;
end;
now
assume ( len r ) <= ( len p );
then (ex r2 being FinSequence st ( r ^ r2 ) = p) by A14,FINSEQ_1:47;
then A18: ( p | ( dom r ) ) = r by FINSEQ_1:21;
A19: ( dom r ) = ( Seg ( len r ) ) by FINSEQ_1:def 3;
then reconsider r3 = r as (FinSequence of ( NAT )) by A18,FINSEQ_1:18;
A20: r3 is_a_prefix_of p by A18,A19,CKB2:def 1;
then A21: (not p is_a_proper_prefix_of r3) by XBOOLE_0:def 8;
reconsider r3 as (Element of T) by A1,A20,CKB30:1;
r3 in { t: (not p is_a_proper_prefix_of t) } by A21;
hence r in X by XBOOLE_0:def 3;
end;
hence thesis by A15;
end;

end;
hence thesis by A5,A6,XBOOLE_0:def 3;
end;

let q;
let k;
let n;
assume that
A22: ( q ^ <* k *> ) in X
and
A23: n <= k;
A24:now
assume ( q ^ <* k *> ) in { t: (not p is_a_proper_prefix_of t) };
then A25: (ex s being (Element of T) st (( q ^ <* k *> ) = s & (not p is_a_proper_prefix_of s)));
then reconsider u = ( q ^ <* n *> ) as (Element of T) by A23,CKB24:def 1;
now
assume p is_a_proper_prefix_of u;
then p is_a_prefix_of q by CKB13:1;
hence contradiction by A25,CKB12:1;
end;
then ( q ^ <* n *> ) in { t: (not p is_a_proper_prefix_of t) };
hence thesis by XBOOLE_0:def 3;
end;
now
assume ( q ^ <* k *> ) in { ( p ^ s ) where s is (Element of T1): s = s };
then consider s being (Element of T1) such that A26: ( q ^ <* k *> ) = ( p ^ s ) and s = s;
A27:now
assume ( len q ) <= ( len p );
then consider r being FinSequence such that A28: ( q ^ r ) = p by A26,FINSEQ_1:47;
( q ^ <* k *> ) = ( q ^ ( r ^ s ) ) by A26,A28,FINSEQ_1:32;
then A29: <* k *> = ( r ^ s ) by FINSEQ_1:33;
A30:now
assume A31: r = <* k *>;
then reconsider s = ( q ^ <* n *> ) as (Element of T) by A1,A23,A28,CKB24:def 1;
now
assume A32: p is_a_proper_prefix_of s;
then A33: p is_a_prefix_of s by XBOOLE_0:def 8;
( len p ) = ( ( len q ) + ( len <* k *> ) ) by A28,A31,FINSEQ_1:22
.= ( ( len q ) + 1 ) by FINSEQ_1:40
.= ( ( len q ) + ( len <* n *> ) ) by FINSEQ_1:40
.= ( len s ) by FINSEQ_1:22;
hence contradiction by A32,A33,CKB4:1;
end;
hence ( q ^ <* n *> ) in { t: (not p is_a_proper_prefix_of t) };
end;
now
assume that
A34: s = <* k *>
and
A35: r = ( {} );
(s = ( ( {} ) ^ s ) & ( {} ) = ( <*> ( NAT ) )) by FINSEQ_1:34;
then ( ( {} ) ^ <* n *> ) in T1 by A23,A34,CKB24:def 1;
then reconsider t = <* n *> as (Element of T1) by FINSEQ_1:34;
( q ^ <* n *> ) = ( p ^ t ) by A28,A35,FINSEQ_1:34;
hence ( q ^ <* n *> ) in { ( p ^ v ) where v is (Element of T1): v = v };
end;
hence thesis by A29,A30,FINSEQ_1:88,XBOOLE_0:def 3;
end;
now
assume ( len p ) <= ( len q );
then consider r being FinSequence such that A36: ( p ^ r ) = q by A26,FINSEQ_1:47;
( p ^ ( r ^ <* k *> ) ) = ( p ^ s ) by A26,A36,FINSEQ_1:32;
then A37: ( r ^ <* k *> ) = s by FINSEQ_1:33;
then (( dom r ) = ( Seg ( len r ) ) & ( s | ( dom r ) ) = r) by FINSEQ_1:21,FINSEQ_1:def 3;
then reconsider r as (FinSequence of ( NAT )) by FINSEQ_1:18;
reconsider t = ( r ^ <* n *> ) as (Element of T1) by A23,A37,CKB24:def 1;
( q ^ <* n *> ) = ( p ^ t ) by A36,FINSEQ_1:32;
then ( q ^ <* n *> ) in { ( p ^ v ) where v is (Element of T1): v = v };
hence thesis by XBOOLE_0:def 3;
end;
hence thesis by A27;
end;
hence thesis by A22,A24,XBOOLE_0:def 3;
end;
then reconsider X as Tree;
take X;
let q;
thus (q in X implies ((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r )))))
proof
assume A38: q in X;
A39:now
assume q in { t: (not p is_a_proper_prefix_of t) };
then (ex s being (Element of T) st (q = s & (not p is_a_proper_prefix_of s)));
hence thesis;
end;
now
assume q in { ( p ^ s ) where s is (Element of T1): s = s };
then (ex s being (Element of T1) st (q = ( p ^ s ) & s = s));
hence (ex r st (r in T1 & q = ( p ^ r )));
end;
hence thesis by A38,A39,XBOOLE_0:def 3;
end;

assume A40: ((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r ))));
A41: ((q in T & (not p is_a_proper_prefix_of q)) implies q in { t: (not p is_a_proper_prefix_of t) });
((ex r st (r in T1 & q = ( p ^ r ))) implies q in { ( p ^ v ) where v is (Element of T1): v = v });
hence thesis by A40,A41,XBOOLE_0:def 3;
end;
uniqueness
proof
let S1 being Tree;
let S2 being Tree;
assume that
A42: (q in S1 iff ((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r )))))
and
A43: (q in S2 iff ((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r )))));
thus S1 c= S2
proof
let x;
assume A44: x in S1;
then reconsider q = x as (FinSequence of ( NAT )) by CKB28:1;
((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r )))) by A42,A44;
hence thesis by A43;
end;

let x;
assume A45: x in S2;
then reconsider q = x as (FinSequence of ( NAT )) by CKB28:1;
((q in T & (not p is_a_proper_prefix_of q)) or (ex r st (r in T1 & q = ( p ^ r )))) by A43,A45;
hence thesis by A42;
end;
end;
