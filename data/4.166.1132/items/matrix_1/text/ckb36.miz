environ
vocabularies NUMBERS,NAT_1,XBOOLE_0,ALGSTR_0,FINSEQ_1,SUBSET_1,RLVECT_1,RELAT_1,CARD_1,FINSEQ_2,TARSKI,STRUCT_0,TREES_1,XXREAL_0,ZFMISC_1,FUNCT_1,QC_LANG1,INCSP_1,SUPINF_2,MESFUNC1,ARYTM_1,ARYTM_3,VECTSP_1,BINOP_1,MATRIX_1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,NAT_1,FUNCT_1,FUNCT_2,FINSEQ_1,FINSEQ_2,STRUCT_0,ALGSTR_0,BINOP_1,FINSEQOP,RLVECT_1,VECTSP_1,XXREAL_0,CKB1,CKB12,CKB15,CKB16,CKB17,CKB18,CKB19,CKB30,CKB32,CKB33;
definitions TARSKI,RLVECT_1,BINOP_1,FINSEQ_2,STRUCT_0,ALGSTR_0,CKB1,CKB15,CKB30,CKB32,CKB33;
theorems FINSEQ_1,FINSEQ_2,FINSEQ_3,TARSKI,FUNCOP_1,FUNCT_1,FUNCT_2,ZFMISC_1,NAT_1,BINOP_1,RLVECT_1,RELAT_1,ORDINAL1,CARD_1,CARD_2,XXREAL_0,CKB1,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB14,CKB15,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34;
schemes FINSEQ_1,BINOP_1,FINSEQ_2,CKB35;
registrations XBOOLE_0,RELAT_1,FUNCT_1,XREAL_0,FINSEQ_1,FINSEQ_2,STRUCT_0,VECTSP_1,ORDINAL1,CARD_1,CKB2,CKB11,CKB13;
constructors BINOP_1,XXREAL_0,FINSEQOP,VECTSP_1,RLVECT_1,RELSET_1,CKB1,CKB15,CKB30,CKB32,CKB33;
requirements NUMERALS,SUBSET,BOOLE,REAL;
begin
reserve x for set;
reserve y for set;
reserve z for set;
reserve i for Nat;
reserve j for Nat;
reserve n for Nat;
reserve m for Nat;
reserve D for non  empty set;
reserve p for (FinSequence of D);
reserve M for (Matrix of D);
scheme MatrixEx { D() -> non  empty set,n,m() -> (Element of ( NAT )),P[set,set,set] } : (ex M being (Matrix of n(),m(),D()) st (for i holds (for j holds ([ i,j ] in ( Indices M ) implies P[ i,j,( M * (i,j) ) ]))))
provided
A1: (for i holds (for j holds ([ i,j ] in [: ( Seg n() ),( Seg m() ) :] implies (ex x being (Element of D()) st P[ i,j,x ]))))
proof
defpred Q[ set,set,set ]
 means
(P[ $1,$2,$3 ] & $3 in D());
A2: (for x holds (for y holds ((x in ( Seg n() ) & y in ( Seg m() )) implies (ex z st (z in D() & Q[ x,y,z ])))))
proof
let x;
let y;
assume that
A3: x in ( Seg n() )
and
A4: y in ( Seg m() );
reconsider y9 = y as (Element of ( NAT )) by A4;
reconsider x9 = x as (Element of ( NAT )) by A3;
[ x9,y9 ] in [: ( Seg n() ),( Seg m() ) :] by A3,A4,ZFMISC_1:87;
then consider z9 being (Element of D()) such that A5: P[ x9,y9,z9 ] by A1;
take z9;
thus thesis by A5;
end;
consider f being (Function of [: ( Seg n() ),( Seg m() ) :],D()) such that A6: (for x holds (for y holds ((x in ( Seg n() ) & y in ( Seg m() )) implies Q[ x,y,( f . (x,y) ) ]))) from BINOP_1:sch 1(A2);
A7: n() >= ( 0 ) by NAT_1:2;
defpred R[ set,set ]
 means
(ex p being FinSequence st (($2 = p & ( len p ) = m()) & (for i holds (i in ( Seg m() ) implies ( p . i ) = ( f . ($1,i) )))));
A8: (for k being Nat holds (k in ( Seg n() ) implies (ex y st R[ k,y ])))
proof
let k being Nat;
assume k in ( Seg n() );
deffunc F(Nat) = ( f . [ k,$1 ] );
consider p being FinSequence such that A9: (( len p ) = m() & (for i being Nat holds (i in ( dom p ) implies ( p . i ) = F(i)))) from FINSEQ_1:sch 2;
take p;
take p;
( dom p ) = ( Seg m() ) by A9,FINSEQ_1:def 3;
hence thesis by A9;
end;
consider M being FinSequence such that A10: ( dom M ) = ( Seg n() ) and A11: (for k being Nat holds (k in ( Seg n() ) implies R[ k,( M . k ) ])) from FINSEQ_1:sch 1(A8);
A12: ( len M ) = n() by A10,FINSEQ_1:def 3;
( rng M ) c= ( D() * )
proof
let x;
assume x in ( rng M );
then consider i being Nat such that A13: i in ( Seg n() ) and A14: ( M . i ) = x by A10,FINSEQ_2:10;
consider p being FinSequence such that A15: ( M . i ) = p and A16: ( len p ) = m() and A17: (for j holds (j in ( Seg m() ) implies ( p . j ) = ( f . (i,j) ))) by A11,A13;
( rng p ) c= D()
proof
let z;
assume z in ( rng p );
then consider k being Nat such that A18: k in ( dom p ) and A19: ( p . k ) = z by FINSEQ_2:10;
A20: k in ( Seg ( len p ) ) by A18,FINSEQ_1:def 3;
then A21: [ i,k ] in [: ( Seg n() ),( Seg m() ) :] by A13,A16,ZFMISC_1:87;
z = ( f . (i,k) ) by A16,A17,A19,A20;
hence thesis by A21,FUNCT_2:5;
end;
then p is (FinSequence of D()) by FINSEQ_1:def 4;
hence thesis by A14,A15,FINSEQ_1:def 11;
end;
then reconsider M as (FinSequence of ( D() * )) by FINSEQ_1:def 4;
(ex n st (for x holds (x in ( rng M ) implies (ex p being (FinSequence of D()) st (x = p & ( len p ) = n)))))
proof
take m();
let x;
assume x in ( rng M );
then consider i being Nat such that A22: i in ( dom M ) and A23: ( M . i ) = x by FINSEQ_2:10;
consider p being FinSequence such that A24: x = p and A25: ( len p ) = m() and A26: (for j holds (j in ( Seg m() ) implies ( p . j ) = ( f . (i,j) ))) by A10,A11,A22,A23;
( rng p ) c= D()
proof
let z;
assume z in ( rng p );
then consider k being Nat such that A27: k in ( dom p ) and A28: ( p . k ) = z by FINSEQ_2:10;
A29: k in ( Seg ( len p ) ) by A27,FINSEQ_1:def 3;
then A30: [ i,k ] in [: ( Seg n() ),( Seg m() ) :] by A10,A22,A25,ZFMISC_1:87;
z = ( f . (i,k) ) by A25,A26,A28,A29;
hence thesis by A30,FUNCT_2:5;
end;
then reconsider p as (FinSequence of D()) by FINSEQ_1:def 4;
take p;
thus thesis by A24,A25;
end;
then reconsider M as (Matrix of D()) by CKB14:1;
(for p being (FinSequence of D()) holds (p in ( rng M ) implies ( len p ) = m()))
proof
let p being (FinSequence of D());
assume p in ( rng M );
then consider i being Nat such that A31: (i in ( dom M ) & ( M . i ) = p) by FINSEQ_2:10;
R[ i,p ] by A10,A11,A31;
hence thesis;
end;
then reconsider M as (Matrix of n(),m(),D()) by A12,CKB15:def 1;
take M;
let i;
let j;
assume A32: [ i,j ] in ( Indices M );
then n() <> ( 0 ) by A10,ZFMISC_1:87;
then A33: n() > ( 0 ) by A7,XXREAL_0:1;
j in ( Seg ( width M ) ) by A32,ZFMISC_1:87;
then A34: j in ( Seg m() ) by A12,A33,CKB31:1;
A35: (ex p being (FinSequence of D()) st (p = ( M . i ) & ( M * (i,j) ) = ( p . j ))) by A32,CKB33:def 1;
A36: i in ( Seg n() ) by A10,A32,ZFMISC_1:87;
then (ex q being FinSequence st ((( M . i ) = q & ( len q ) = m()) & (for j holds (j in ( Seg m() ) implies ( q . j ) = ( f . (i,j) ))))) by A11;
then ( f . (i,j) ) = ( M * (i,j) ) by A35,A34;
hence thesis by A6,A36,A34;
end;
