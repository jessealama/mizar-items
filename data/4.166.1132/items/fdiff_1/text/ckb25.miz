environ
vocabularies NUMBERS,REAL_1,SUBSET_1,RCOMP_1,SEQ_1,PARTFUN1,VALUED_0,SEQ_2,ORDINAL2,CARD_1,ARYTM_3,FUNCT_1,RELAT_1,FUNCOP_1,VALUED_1,FUNCT_2,NAT_1,TARSKI,ARYTM_1,XREAL_0,ORDINAL1,XXREAL_1,XBOOLE_0,XXREAL_0,COMPLEX1,FCONT_1,XXREAL_2,FDIFF_1;
notations TARSKI,XBOOLE_0,SUBSET_1,ORDINAL1,NUMBERS,XCMPLX_0,XREAL_0,COMPLEX1,REAL_1,NAT_1,FUNCT_2,FUNCOP_1,VALUED_0,VALUED_1,SEQ_1,SEQ_2,RELSET_1,PARTFUN1,PARTFUN2,RCOMP_1,FCONT_1,XXREAL_0,CKB2,CKB4,CKB6,CKB7,CKB9,CKB16,CKB17,CKB18,CKB22;
definitions TARSKI,FCONT_1,XBOOLE_0,VALUED_1,RCOMP_1,SUBSET_1,CKB2,CKB4,CKB7,CKB16,CKB17,CKB18,CKB22;
theorems TARSKI,NAT_1,FUNCT_1,ABSVALUE,ZFMISC_1,SEQ_1,SEQ_2,SEQM_3,SEQ_4,PARTFUN1,PARTFUN2,RFUNCT_1,RFUNCT_2,RCOMP_1,FCONT_1,FUNCT_2,RELAT_1,XREAL_0,XBOOLE_0,XBOOLE_1,XCMPLX_0,XCMPLX_1,FUNCOP_1,XREAL_1,COMPLEX1,VALUED_1,VALUED_0,ORDINAL1,CKB1,CKB2,CKB4,CKB7,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23;
schemes SEQ_1;
registrations FUNCT_1,ORDINAL1,RELSET_1,NUMBERS,XXREAL_0,XREAL_0,NAT_1,MEMBERED,RCOMP_1,VALUED_0,VALUED_1,FUNCT_2,FUNCOP_1,SEQ_4,REALSET1,SETFAM_1,RELAT_1,ZFMISC_1,CARD_1,FINSET_1,CKB3,CKB5,CKB8,CKB24;
constructors PARTFUN1,REAL_1,NAT_1,COMPLEX1,SEQ_2,SEQM_3,RCOMP_1,PARTFUN2,RFUNCT_2,FCONT_1,VALUED_1,SEQ_1,REALSET1,FINSET_1,SETFAM_1,RELSET_1,BINOP_2,RVSUM_1,CKB2,CKB4,CKB7,CKB16,CKB17,CKB18,CKB22;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve y for set;
reserve x for Real;
reserve x0 for Real;
reserve g for Real;
reserve r for Real;
reserve s for Real;
reserve p1 for Real;
reserve n for (Element of ( NAT ));
reserve m for (Element of ( NAT ));
reserve k for (Element of ( NAT ));
reserve s1 for Real_Sequence;
reserve f for (PartFunc of ( REAL ),( REAL ));
reserve h for  convergent_to_0 Real_Sequence;
reserve c for  constant Real_Sequence;
reserve R for REST;
reserve L for LINEAR;
theorem
Th20: (for x0 being  real number holds (for N being (Neighbourhood of x0) holds ((f is_differentiable_in x0 & N c= ( dom f )) implies (for h holds (for c holds ((( rng c ) = { x0 } & ( rng ( h + c ) ) c= N) implies (( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent & ( diff (f,x0) ) = ( lim ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) ))))))))
proof
let x0 being  real number;
let N being (Neighbourhood of x0);
assume that
A1: f is_differentiable_in x0
and
A2: N c= ( dom f );
consider N1 being (Neighbourhood of x0) such that N1 c= ( dom f ) and A3: (ex L st (ex R st (for x holds (x in N1 implies ( ( f . x ) - ( f . x0 ) ) = ( ( L . ( x - x0 ) ) + ( R . ( x - x0 ) ) ))))) by A1,CKB16:def 1;
consider N2 being (Neighbourhood of x0) such that A4: N2 c= N and A5: N2 c= N1 by RCOMP_1:17;
A6: N2 c= ( dom f ) by A2,A4,XBOOLE_1:1;
let h;
let c;
assume that
A7: ( rng c ) = { x0 }
and
A8: ( rng ( h + c ) ) c= N;
consider g being  real number such that A9: ( 0 ) < g and A10: N2 = ]. ( x0 - g ),( x0 + g ) .[ by RCOMP_1:def 6;
(( x0 + ( 0 ) ) < ( x0 + g ) & ( x0 - g ) < ( x0 - ( 0 ) )) by A9,XREAL_1:8,XREAL_1:15;
then A11: x0 in N2 by A10;
A12: ( rng c ) c= ( dom f )
proof
let y;
assume y in ( rng c );
then y = x0 by A7,TARSKI:def 1;
then y in N by A4,A11;
hence thesis by A2;
end;
(ex n st (( rng ( c ^\ n ) ) c= N2 & ( rng ( ( h + c ) ^\ n ) ) c= N2))
proof
x0 in ( rng c ) by A7,TARSKI:def 1;
then A13: ( lim c ) = x0 by SEQ_4:25;
A14: h is  convergent by CKB2:def 1;
then A15: ( h + c ) is  convergent by SEQ_2:5;
( lim h ) = ( 0 ) by CKB2:def 1;
then ( lim ( h + c ) ) = ( ( 0 ) + x0 ) by A13,A14,SEQ_2:6
.= x0;
then consider n such that A16: (for m being (Element of ( NAT )) holds (n <= m implies ( abs ( ( ( h + c ) . m ) - x0 ) ) < g)) by A9,A15,SEQ_2:def 7;
take n;
A17: ( rng ( c ^\ n ) ) = { x0 } by A7,VALUED_0:26;
thus ( rng ( c ^\ n ) ) c= N2
proof
let y;
assume y in ( rng ( c ^\ n ) );
hence thesis by A11,A17,TARSKI:def 1;
end;

let y;
assume y in ( rng ( ( h + c ) ^\ n ) );
then consider m such that A18: y = ( ( ( h + c ) ^\ n ) . m ) by FUNCT_2:113;
( n + ( 0 ) ) <= ( n + m ) by XREAL_1:7;
then A19: ( abs ( ( ( h + c ) . ( n + m ) ) - x0 ) ) < g by A16;
then ( ( ( h + c ) . ( m + n ) ) - x0 ) < g by SEQ_2:1;
then ( ( ( ( h + c ) ^\ n ) . m ) - x0 ) < g by NAT_1:def 3;
then A20: ( ( ( h + c ) ^\ n ) . m ) < ( x0 + g ) by XREAL_1:19;
( - g ) < ( ( ( h + c ) . ( m + n ) ) - x0 ) by A19,SEQ_2:1;
then ( - g ) < ( ( ( ( h + c ) ^\ n ) . m ) - x0 ) by NAT_1:def 3;
then ( x0 + ( - g ) ) < ( ( ( h + c ) ^\ n ) . m ) by XREAL_1:20;
hence thesis by A10,A18,A20;
end;
then consider n such that ( rng ( c ^\ n ) ) c= N2 and A21: ( rng ( ( h + c ) ^\ n ) ) c= N2;
consider L,R such that A22: (for x holds (x in N1 implies ( ( f . x ) - ( f . x0 ) ) = ( ( L . ( x - x0 ) ) + ( R . ( x - x0 ) ) ))) by A3;
A23: ( rng ( c ^\ n ) ) c= ( dom f )
proof
let y;
assume A24: y in ( rng ( c ^\ n ) );
( rng ( c ^\ n ) ) = ( rng c ) by VALUED_0:26;
then y = x0 by A7,A24,TARSKI:def 1;
then y in N by A4,A11;
hence thesis by A2;
end;
A25: L is  total by CKB7:def 1;
A26: (( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) is  convergent & ( lim ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) ) = ( L . 1 ))
proof
deffunc F((Element of ( NAT ))) = ( ( L . 1 ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . $1 ) );
consider s1 such that A27: (for k holds ( s1 . k ) = F(k)) from SEQ_1:sch 1;
A28:now
A29: (( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) is  convergent & ( lim ( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) ) = ( 0 )) by CKB4:def 1;
let r being  real number;
assume ( 0 ) < r;
then consider m such that A30: (for k holds (m <= k implies ( abs ( ( ( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) . k ) - ( 0 ) ) ) < r)) by A29,SEQ_2:def 7;
take n1 = m;
let k;
assume that
A31: n1 <= k;
( abs ( ( s1 . k ) - ( L . 1 ) ) ) = ( abs ( ( ( L . 1 ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . k ) ) - ( L . 1 ) ) ) by A27
.= ( abs ( ( ( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) . k ) - ( 0 ) ) );
hence ( abs ( ( s1 . k ) - ( L . 1 ) ) ) < r by A30,A31;
end;
consider s such that A32: (for p1 holds ( L . p1 ) = ( s * p1 )) by CKB7:def 1;
A33: ( L . 1 ) = ( s * 1 ) by A32
.= s;
now
let m;
( h ^\ n ) is  non-zero by CKB2:def 1;
then A34: ( ( h ^\ n ) . m ) <> ( 0 ) by SEQ_1:5;
thus ( ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) . m ) = ( ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) by SEQ_1:8
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) + ( ( R /* ( h ^\ n ) ) . m ) ) * ( ( ( h ^\ n ) " ) . m ) ) by SEQ_1:7
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) + ( ( ( R /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) )
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by SEQ_1:8
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) . m ) " ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by VALUED_1:10
.= ( ( ( L . ( ( h ^\ n ) . m ) ) * ( ( ( h ^\ n ) . m ) " ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by A25,FUNCT_2:115
.= ( ( ( s * ( ( h ^\ n ) . m ) ) * ( ( ( h ^\ n ) . m ) " ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by A32
.= ( ( s * ( ( ( h ^\ n ) . m ) * ( ( ( h ^\ n ) . m ) " ) ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) )
.= ( ( s * 1 ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by A34,XCMPLX_0:def 7
.= ( s1 . m ) by A27,A33;
end;
then A35: ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) = s1 by FUNCT_2:63;
hence ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) is  convergent by A28,SEQ_2:def 6;
hence thesis by A35,A28,SEQ_2:def 7;
end;
A36: ( rng ( ( h + c ) ^\ n ) ) c= ( dom f )
proof
let y;
assume y in ( rng ( ( h + c ) ^\ n ) );
then y in N2 by A21;
then y in N by A4;
hence thesis by A2;
end;
A37: ( rng ( h + c ) ) c= ( dom f )
proof
let y;
assume y in ( rng ( h + c ) );
then y in N by A8;
hence thesis by A2;
end;
A38: (for k holds ( ( f . ( ( ( h + c ) ^\ n ) . k ) ) - ( f . ( ( c ^\ n ) . k ) ) ) = ( ( L . ( ( h ^\ n ) . k ) ) + ( R . ( ( h ^\ n ) . k ) ) ))
proof
let k;
( ( ( h + c ) ^\ n ) . k ) in ( rng ( ( h + c ) ^\ n ) ) by VALUED_0:28;
then A39: ( ( ( h + c ) ^\ n ) . k ) in N2 by A21;
(( ( c ^\ n ) . k ) in ( rng ( c ^\ n ) ) & ( rng ( c ^\ n ) ) = ( rng c )) by VALUED_0:26,VALUED_0:28;
then A40: ( ( c ^\ n ) . k ) = x0 by A7,TARSKI:def 1;
( ( ( ( h + c ) ^\ n ) . k ) - ( ( c ^\ n ) . k ) ) = ( ( ( ( h ^\ n ) + ( c ^\ n ) ) . k ) - ( ( c ^\ n ) . k ) ) by SEQM_3:15
.= ( ( ( ( h ^\ n ) . k ) + ( ( c ^\ n ) . k ) ) - ( ( c ^\ n ) . k ) ) by SEQ_1:7
.= ( ( h ^\ n ) . k );
hence thesis by A22,A5,A39,A40;
end;
A41: R is  total by CKB4:def 1;
now
let k;
thus ( ( ( f /* ( ( h + c ) ^\ n ) ) - ( f /* ( c ^\ n ) ) ) . k ) = ( ( ( f /* ( ( h + c ) ^\ n ) ) . k ) - ( ( f /* ( c ^\ n ) ) . k ) ) by RFUNCT_2:1
.= ( ( f . ( ( ( h + c ) ^\ n ) . k ) ) - ( ( f /* ( c ^\ n ) ) . k ) ) by A36,FUNCT_2:108
.= ( ( f . ( ( ( h + c ) ^\ n ) . k ) ) - ( f . ( ( c ^\ n ) . k ) ) ) by A23,FUNCT_2:108
.= ( ( L . ( ( h ^\ n ) . k ) ) + ( R . ( ( h ^\ n ) . k ) ) ) by A38
.= ( ( ( L /* ( h ^\ n ) ) . k ) + ( R . ( ( h ^\ n ) . k ) ) ) by A25,FUNCT_2:115
.= ( ( ( L /* ( h ^\ n ) ) . k ) + ( ( R /* ( h ^\ n ) ) . k ) ) by A41,FUNCT_2:115
.= ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) . k ) by SEQ_1:7;
end;
then ( ( f /* ( ( h + c ) ^\ n ) ) - ( f /* ( c ^\ n ) ) ) = ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) by FUNCT_2:63;
then A42: ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) = ( ( ( ( f /* ( h + c ) ) ^\ n ) - ( f /* ( c ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) by A37,VALUED_0:27
.= ( ( ( ( f /* ( h + c ) ) ^\ n ) - ( ( f /* c ) ^\ n ) ) (#) ( ( h ^\ n ) " ) ) by A12,VALUED_0:27
.= ( ( ( ( f /* ( h + c ) ) - ( f /* c ) ) ^\ n ) (#) ( ( h ^\ n ) " ) ) by SEQM_3:17
.= ( ( ( ( f /* ( h + c ) ) - ( f /* c ) ) ^\ n ) (#) ( ( h " ) ^\ n ) ) by SEQM_3:18
.= ( ( ( ( f /* ( h + c ) ) - ( f /* c ) ) (#) ( h " ) ) ^\ n ) by SEQM_3:19;
then A43: ( L . 1 ) = ( lim ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) ) by A26,SEQ_4:22;
thus ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent by A26,A42,SEQ_4:21;
(for x holds (x in N2 implies ( ( f . x ) - ( f . x0 ) ) = ( ( L . ( x - x0 ) ) + ( R . ( x - x0 ) ) ))) by A22,A5;
hence thesis by A1,A6,A43,CKB17:def 1;
end;
