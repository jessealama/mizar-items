environ
vocabularies NUMBERS,SUBSET_1,FINSEQ_1,INT_1,RELAT_1,FUNCT_1,ORDINAL4,XBOOLE_0,XXREAL_0,PARTFUN1,GRAPH_1,STRUCT_0,TREES_2,GLIB_000,GRAPH_5,CARD_3,GRAPH_4,NAT_1,ARYTM_3,TARSKI,CARD_1,FINSET_1,FUNCT_4,REAL_1,FUNCT_2,ARYTM_1,GRAPHSP;
notations XCMPLX_0,XXREAL_0,REAL_1,INT_1,TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,FINSEQ_1,SEQ_1,FINSEQ_2,FINSEQ_4,CARD_1,FINSET_1,STRUCT_0,GRAPH_1,PARTFUN1,FUNCT_2,CQC_SIM1,GRAPH_4,GRAPH_5,NAT_D,DOMAIN_1,RVSUM_1,NUMBERS,FUNCT_7,NAT_1,CKB21,CKB22,CKB23,CKB28,CKB29,CKB30,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB44,CKB45,CKB51,CKB54,CKB62,CKB63,CKB64,CKB65,CKB75,CKB83,CKB84,CKB86,CKB93,CKB94;
definitions TARSKI,RVSUM_1,CKB23,CKB30,CKB35,CKB36,CKB37,CKB38,CKB39,CKB44,CKB45,CKB51,CKB54,CKB62,CKB63,CKB64,CKB65,CKB75,CKB83,CKB84,CKB86,CKB93,CKB94;
theorems FUNCT_2,FUNCT_1,PARTFUN1,FINSEQ_1,NAT_1,ZFMISC_1,TARSKI,FINSEQ_3,XBOOLE_0,XBOOLE_1,SUBSET_1,GRAPH_1,FINSEQ_4,CARD_2,INT_1,GRAPH_5,GRAPH_4,FINSEQ_2,ENUMSET1,FUNCT_7,XREAL_1,XXREAL_0,FINSOP_1,ORDINAL1,NAT_D,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB23,CKB24,CKB25,CKB26,CKB27,CKB30,CKB31,CKB32,CKB33,CKB35,CKB36,CKB37,CKB38,CKB39,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB48,CKB49,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67,CKB68,CKB69,CKB70,CKB71,CKB72,CKB73,CKB74,CKB75,CKB76,CKB77,CKB78,CKB79,CKB80,CKB81,CKB82,CKB83,CKB84,CKB85,CKB86,CKB87,CKB88,CKB89,CKB90,CKB91,CKB92,CKB93,CKB94;
schemes NAT_1,GRAPH_5,CLASSES1;
registrations XBOOLE_0,ORDINAL1,RELSET_1,FUNCT_2,FINSET_1,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,FINSEQ_1,GRAPH_1,GRAPH_4,GRAPH_5,VALUED_0,CARD_1,FUNCT_1,CKB47,CKB50;
constructors DOMAIN_1,XXREAL_0,REAL_1,FINSEQ_4,FINSOP_1,NAT_D,FUNCT_7,CQC_SIM1,GRAPH_4,GRAPH_5,SEQ_1,BINOP_2,RVSUM_1,RELSET_1,CKB22,CKB23,CKB28,CKB29,CKB30,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB44,CKB45,CKB51,CKB54,CKB62,CKB63,CKB64,CKB65,CKB75,CKB83,CKB84,CKB86,CKB93,CKB94;
requirements NUMERALS,SUBSET,BOOLE,REAL,ARITHM;
begin
reserve i for (Element of ( NAT ));
reserve j for (Element of ( NAT ));
reserve k for (Element of ( NAT ));
reserve m for (Element of ( NAT ));
reserve n for (Element of ( NAT ));
reserve f for (Element of ( ( REAL ) * ));
reserve h for (Element of ( ( REAL ) * ));
reserve p for (FinSequence of ( NAT ));
reserve G for  finite  oriented Graph;
reserve P for  oriented (Chain of G);
reserve Q for  oriented (Chain of G);
reserve W for (Function of (the carrier' of G),( Real>=0 ));
reserve v1 for (Vertex of G);
reserve v2 for (Vertex of G);
reserve v3 for (Vertex of G);
theorem
Lm15: ((((f is_Input_of_Dijkstra_Alg G,n,W & v1 = 1) & n >= 1) & h = ( ( ( repeat ( ( Relax n ) * ( findmin n ) ) ) . 1 ) . f )) implies (((for v3 holds (for j holds (((v3 <> v1 & v3 = j) & ( h . ( n + j ) ) <> ( - 1 )) implies (ex p st (ex P st (((((p is_simple_vertex_seq_at h,j,n & (for i holds ((1 <= i & i < ( len p )) implies ( p . i ) in ( UsedVx (h,n) )))) & P is_oriented_edge_seq_of p) & P is_shortestpath_of v1,v3,( UsedVx (h,n) ),W) & ( cost (P,W) ) = ( h . ( ( 2 * n ) + j ) )) & ((not v3 in ( UsedVx (h,n) )) implies P islongestInShortestpath ( UsedVx (h,n) ),v1,W))))))) & (for m holds (for j holds ((((( h . ( n + j ) ) = ( - 1 ) & 1 <= j) & j <= n) & m in ( UsedVx (h,n) )) implies ( f . ( ( ( 2 * n ) + ( n * m ) ) + j ) ) = ( - 1 ))))) & (for m holds (m in ( UsedVx (h,n) ) implies ( h . ( n + m ) ) <> ( - 1 )))))
proof
set R = ( Relax n );
set M = ( findmin n );
set f0 = ( ( ( repeat ( R * M ) ) . ( 0 ) ) . f );
set mi = ( ( ( n * n ) + ( 3 * n ) ) + 1 );
assume that
A1: f is_Input_of_Dijkstra_Alg G,n,W
and
A2: v1 = 1
and
A3: n >= 1
and
A4: h = ( ( ( repeat ( ( Relax n ) * ( findmin n ) ) ) . 1 ) . f );
A5: ( len f ) = mi by A1,CKB93:def 1;
set nk = ( n + 1 );
A6: ( ( 2 * n ) + n ) = ( ( 2 + 1 ) * n );
A7: ( f . ( n + 1 ) ) = ( 0 ) by A1,CKB93:def 1;
A8: 1 <= mi by NAT_1:12;
then A9: 1 in ( dom f ) by A5,FINSEQ_3:25;
A10: ((for j holds ((1 <= j & j <= n) implies ( f . j ) = 1)) & (for j holds ((2 <= j & j <= n) implies ( f . ( n + j ) ) = ( - 1 )))) by A1,CKB93:def 1;
then A11: { 1 } = ( UsedVx (h,n) ) by A3,A4,A7,A9,CKB81:1;
h = ( ( ( repeat ( R * M ) ) . ( ( 0 ) + 1 ) ) . f ) by A4;
then h = ( R . ( M . f0 ) ) by CKB33:1;
then A12: h = ( Relax (( M . f0 ),n) ) by CKB65:def 1;
A13: ( Seg n ) = (the carrier of G) by A1,CKB93:def 1;
then reconsider VG = (the carrier of G) as non empty (Subset of ( NAT )) by A3;
set Ak = ( Argmin (( OuterVx (f,n) ),f,n) );
A14: ( dom ( M . f0 ) ) = ( dom f0 ) by CKB57:1
.= ( dom f ) by CKB31:1;
A15: 1 = Ak by A3,A7,A10,A9,CKB81:1;
A16: ( M . f0 ) = ( M . f ) by CKB31:1
.= ( (f,mi) := (1,( - 1 )) ) by A15,CKB54:def 1;
then ( ( M . f0 ) . 1 ) = ( - 1 ) by A9,CKB26:1;
then (not ( M . f0 ) hasBetterPathAt n,1) by CKB63:def 1;
then A17: (not ( M . f0 ) hasBetterPathAt n,( nk -' n )) by NAT_D:34;
A18: nk < mi by A3,CKB90:1;
A19: W is_weight>=0of G by GRAPH_5:def 13;
hereby
set w1 = ( ( 2 * n ) + 1 );
let v3;
let j;
set nj = ( n + j );
assume that
A20: v3 <> v1
and
A21: v3 = j
and
A22: ( h . ( n + j ) ) <> ( - 1 );
set m2 = ( ( 2 * n ) + j );
A23: j in VG by A21;
then A24: 1 <= j by A13,FINSEQ_1:1;
then ( n + 1 ) <= nj by XREAL_1:7;
then A25: n < nj by NAT_1:13;
A26: j <= n by A13,A23,FINSEQ_1:1;
then A27: (1 < m2 & m2 < mi) by A24,CKB89:1;
j > 1 by A2,A20,A21,A24,XXREAL_0:1;
then j >= ( 1 + 1 ) by INT_1:7;
then A28: ( f . nj ) = ( - 1 ) by A1,A26,CKB93:def 1;
A29: nj <= ( 2 * n ) by A24,A26,CKB90:1;
A30: mi in ( dom f ) by A8,A5,FINSEQ_3:25;
then A31: ( ( M . f0 ) /. mi ) = ( ( M . f0 ) . mi ) by A14,PARTFUN1:def 6
.= 1 by A16,A27,A30,CKB24:1;
A32: (1 < w1 & w1 < mi) by A3,CKB89:1;
then w1 in ( dom f ) by A5,FINSEQ_3:25;
then A33: ( ( M . f0 ) /. ( ( 2 * n ) + ( ( M . f0 ) /. mi ) ) ) = ( ( M . f0 ) . w1 ) by A14,A31,PARTFUN1:def 6
.= ( f . w1 ) by A16,A32,CKB25:1
.= ( 0 ) by A1,A3,CKB93:def 1;
A34: m2 <= ( 3 * n ) by A6,A26,XREAL_1:7;
A35: (1 < nj & nj < mi) by A24,A26,CKB90:1;
then A36: nj in ( dom f ) by A5,FINSEQ_3:25;
( ( M . f0 ) . nj ) = ( f . nj ) by A16,A35,CKB25:1;
then A37: ( M . f0 ) hasBetterPathAt n,( nj -' n ) by A14,A12,A22,A29,A36,A25,A28,CKB64:def 1;
( ( 2 * n ) + 1 ) <= m2 by A24,XREAL_1:7;
then A38: ( 2 * n ) < m2 by NAT_1:13;
set m3 = ( ( ( 2 * n ) + ( n * 1 ) ) + j );
reconsider p = <* 1,j *> as (FinSequence of ( NAT ));
A39: ( p . 1 ) = 1 by FINSEQ_1:44;
A40: (1 < m3 & m3 < mi) by A3,A26,CKB91:1;
then m3 in ( dom f ) by A5,FINSEQ_3:25;
then A41: ( ( M . f0 ) /. ( ( ( 2 * n ) + ( n * ( ( M . f0 ) /. mi ) ) ) + j ) ) = ( ( M . f0 ) . m3 ) by A14,A31,PARTFUN1:def 6
.= ( f . m3 ) by A16,A40,CKB25:1
.= ( Weight (v1,v3,W) ) by A1,A2,A21,CKB93:def 1;
A42: ( nj -' n ) = j by NAT_D:34;
then ( ( M . f0 ) /. ( ( ( 2 * n ) + ( n * ( ( M . f0 ) /. mi ) ) ) + j ) ) >= ( 0 ) by A37,CKB63:def 1;
then consider e being set such that A43: e in (the carrier' of G) and A44: e orientedly_joins v1,v3 by A41,CKB41:1;
reconsider pe = <* e *> as  oriented (Chain of G) by A43,CKB5:1;
A45: ( len pe ) = 1 by FINSEQ_1:40;
A46: ( len p ) = 2 by FINSEQ_1:44;
then A47: ( p . ( len p ) ) = j by FINSEQ_1:44;
A48:now
let k being Nat;
assume (1 <= k & k <= ( len pe ));
then A49: k = 1 by A45,XXREAL_0:1;
hence ( (the Source of G) . ( pe . k ) ) = ( (the Source of G) . e ) by FINSEQ_1:40
.= ( p . k ) by A2,A44,A39,A49,GRAPH_4:def 1;
thus ( (the Target of G) . ( pe . k ) ) = ( (the Target of G) . e ) by A49,FINSEQ_1:40
.= ( p . ( k + 1 ) ) by A21,A44,A46,A47,A49,GRAPH_4:def 1;
end;
A50: ( h . nj ) = 1 by A14,A12,A29,A36,A25,A37,A31,CKB64:def 1;
now
let k;
assume that
A51: 1 <= k
and
A52: k < ( len p );
k < ( 1 + 1 ) by A52,FINSEQ_1:44;
then k <= 1 by NAT_1:13;
then k = 1 by A51,XXREAL_0:1;
hence ( p . ( ( len p ) - k ) ) = ( h . ( n + ( p /. ( ( ( len p ) - k ) + 1 ) ) ) ) by A50,A39,A46,A47,FINSEQ_4:15;
end;
then A53: p is_vertex_seq_at h,j,n by A47,CKB83:def 1;
(( m2 -' ( 2 * n ) ) = j & m2 in ( dom ( M . f0 ) )) by A5,A14,A27,FINSEQ_3:25,NAT_D:34;
then A54: ( ( Relax (( M . f0 ),n) ) . m2 ) = ( newpathcost (( M . f0 ),n,( m2 -' ( 2 * n ) )) ) by A42,A37,A34,A38,CKB64:def 1
.= ( ( 0 ) + ( ( M . f0 ) /. ( ( ( 2 * n ) + ( n * ( ( M . f0 ) /. mi ) ) ) + j ) ) ) by A33,NAT_D:34;
take p;
take pe;
p is  one-to-one by A2,A20,A21,FINSEQ_3:94;
hence p is_simple_vertex_seq_at h,j,n by A39,A46,A53,CKB84:def 1;
hereby
let i;
assume that
A55: 1 <= i
and
A56: i < ( len p );
( i + 1 ) <= ( 1 + 1 ) by A46,A56,INT_1:7;
then i <= 1 by XREAL_1:6;
then i = 1 by A55,XXREAL_0:1;
hence ( p . i ) in ( UsedVx (h,n) ) by A11,A39,TARSKI:def 1;
end;
( len p ) = ( ( len pe ) + 1 ) by A45,FINSEQ_1:44;
hence pe is_oriented_edge_seq_of p by A48,CKB86:def 1;
thus pe is_shortestpath_of v1,v3,( UsedVx (h,n) ),W by A2,A11,A43,A44,CKB18:1;
thus ( cost (pe,W) ) = ( W . ( pe . 1 ) ) by A19,A45,CKB4:1,GRAPH_5:46
.= ( W . e ) by FINSEQ_1:40
.= ( h . ( ( 2 * n ) + j ) ) by A12,A41,A54,A43,A44,CKB43:1;
assume (not v3 in ( UsedVx (h,n) ));
(for v2 holds (((v2 in ( UsedVx (h,n) ) & v2 <> v1) & (not (ex Q st (Q is_shortestpath_of v1,v2,( UsedVx (h,n) ),W & ( cost (Q,W) ) <= ( cost (pe,W) ))))) implies contradiction)) by A2,A11,TARSKI:def 1;
hence pe islongestInShortestpath ( UsedVx (h,n) ),v1,W by GRAPH_5:def 19;
end;
A57: ( 2 * n ) < mi by CKB59:1;
A58: ( 2 * 1 ) <= ( 2 * n ) by A3,XREAL_1:64;
1 < nk by A3,CKB90:1;
then A59: nk in ( dom f ) by A5,A18,FINSEQ_3:25;
A60: n < nk by NAT_1:13;
nk <= ( 2 * n ) by A3,CKB90:1;
then A61: ( h . nk ) = ( ( M . f0 ) . nk ) by A14,A12,A60,A59,A17,CKB64:def 1
.= ( f0 . nk ) by A18,A60,CKB55:1
.= ( 0 ) by A7,CKB31:1;
A62: ( n * 1 ) <= ( n * n ) by A3,XREAL_1:64;
hereby
A63: n < mi by CKB59:1;
let m;
let j;
assume that
A64: ( h . ( n + j ) ) = ( - 1 )
and
A65: 1 <= j
and
A66: j <= n
and
A67: m in ( UsedVx (h,n) );
reconsider v2 = j as (Vertex of G) by A13,A65,A66,FINSEQ_1:1;
A68: ( 3 * n ) < mi by CKB59:1;
set m2 = ( ( 2 * n ) + j );
m2 <= ( 3 * n ) by A6,A66,XREAL_1:7;
then A69: m2 < mi by A68,XXREAL_0:2;
( ( 2 * n ) + 1 ) <= m2 by A65,XREAL_1:7;
then ( 2 * n ) < m2 by NAT_1:13;
then 2 < m2 by A58,XXREAL_0:2;
then A70: 1 < m2 by XXREAL_0:2;
j <> 1 by A61,A64;
then A71: ( ( M . f0 ) . j ) = ( f . j ) by A16,A66,A63,CKB25:1
.= 1 by A1,A65,A66,CKB93:def 1;
A72: mi in ( dom f ) by A8,A5,FINSEQ_3:25;
then A73: ( ( M . f0 ) /. mi ) = ( ( M . f0 ) . mi ) by A14,PARTFUN1:def 6
.= 1 by A16,A69,A70,A72,CKB24:1;
set nj = ( n + j );
( 1 + 1 ) <= nj by A3,A65,XREAL_1:7;
then A74: 1 < nj by NAT_1:13;
A75: nj <= ( n + n ) by A66,XREAL_1:7;
then nj < mi by A57,XXREAL_0:2;
then A76: nj in ( dom f ) by A5,A74,FINSEQ_3:25;
( n + 1 ) <= nj by A65,XREAL_1:7;
then A77: n < nj by NAT_1:13;
A78: nj <= ( 2 * n ) by A75;
then A79: (not ( M . f0 ) hasBetterPathAt n,( nj -' n )) by A14,A12,A64,A76,A77,A73,CKB64:def 1;
then (( nj -' n ) = j & ( ( M . f0 ) . nj ) = ( - 1 )) by A14,A12,A64,A78,A76,A77,CKB64:def 1,NAT_D:34;
then A80: (not ( ( M . f0 ) /. ( ( ( 2 * n ) + ( n * ( ( M . f0 ) /. mi ) ) ) + j ) ) >= ( 0 )) by A79,A71,CKB63:def 1;
set m3 = ( ( ( 2 * n ) + ( n * 1 ) ) + j );
m3 = ( ( 2 * n ) + ( ( n * 1 ) + j ) );
then 2 <= m3 by A58,NAT_1:12;
then A81: 1 < m3 by XXREAL_0:2;
j <= ( n * n ) by A62,A66,XXREAL_0:2;
then m3 <= ( ( 3 * n ) + ( n * n ) ) by XREAL_1:7;
then A82: m3 < mi by NAT_1:13;
then m3 in ( dom f ) by A5,A81,FINSEQ_3:25;
then A83: ( ( M . f0 ) /. ( ( ( 2 * n ) + ( n * ( ( M . f0 ) /. mi ) ) ) + j ) ) = ( ( M . f0 ) . m3 ) by A14,A73,PARTFUN1:def 6;
( ( M . f0 ) . m3 ) = ( f . m3 ) by A16,A81,A82,CKB25:1
.= ( Weight (v1,v2,W) ) by A1,A2,CKB93:def 1;
then (not (ex e being set st (e in (the carrier' of G) & e orientedly_joins v1,v2))) by A80,A83,CKB41:1;
then A84: ( Weight (v1,v2,W) ) = ( - 1 ) by CKB39:def 1;
m = 1 by A11,A67,TARSKI:def 1;
hence ( f . ( ( ( 2 * n ) + ( n * m ) ) + j ) ) = ( - 1 ) by A1,A2,A84,CKB93:def 1;
end;
let m;
assume m in ( UsedVx (h,n) );
then m = 1 by A11,TARSKI:def 1;
hence thesis by A61;
end;
