environ
vocabularies MYCIELSK,FINSET_1,DILWORTH,CARD_1,ARYTM_3,ARYTM_1,FUNCT_1,RELAT_1,RELAT_2,YELLOW_0,TARSKI,EQREL_1,CIRCUIT2,SUBSET_1,COMBGRAS,NECKLACE,NEWTON,XREAL_0,XXREAL_0,ORDINAL1,NAT_1,XBOOLE_0,ORDERS_2,STRUCT_0,ZFMISC_1,FUNCT_2,NUMBERS;
notations TARSKI,XBOOLE_0,ZFMISC_1,FINSET_1,CARD_1,SUBSET_1,STRUCT_0,ORDINAL1,ORDERS_2,XCMPLX_0,XXREAL_0,XREAL_0,NAT_1,NAT_D,RELAT_1,RELSET_1,RELAT_2,PARTFUN1,EQREL_1,FUNCT_1,FUNCT_2,NEWTON,YELLOW_0,NECKLACE,DILWORTH,NUMBERS,CKB8,CKB14,CKB19,CKB22,CKB27,CKB55;
definitions STRUCT_0,XREAL_0,TARSKI,XBOOLE_0,RELAT_2,FUNCT_1,DILWORTH,NECKLACE,SUBSET_1,EQREL_1,ORDERS_2,CKB8,CKB14,CKB19,CKB22,CKB27,CKB55;
theorems NEWTON,NAT_1,NAT_D,XREAL_0,XREAL_1,XXREAL_0,ORDINAL1,FUNCT_1,DILWORTH,XBOOLE_0,XBOOLE_1,TARSKI,NECKLACE,PENCIL_1,ZFMISC_1,ORDERS_2,EULER_1,CARD_2,CARD_1,YELLOW_0,RELSET_1,EQREL_1,FUNCT_2,RELAT_1,FINSET_1,FINSEQ_4,RELAT_2,SUBSET_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB11,CKB12,CKB13,CKB14,CKB19,CKB22,CKB27,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB39,CKB40,CKB41,CKB42,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB53,CKB54,CKB55;
schemes RECDEF_1,NAT_1,CLASSES1,PRE_CIRC,FUNCT_1,FUNCT_2,DILWORTH;
registrations SUBSET_1,XBOOLE_0,STRUCT_0,XCMPLX_0,XXREAL_0,XREAL_0,NAT_1,CARD_1,RELSET_1,PARTFUN1,ZFMISC_1,ORDINAL1,EQREL_1,NECKLA_3,RELAT_1,FUNCT_1,FUNCT_2,FINSET_1,DILWORTH,NUMBERS,NEWTON,NECKLACE,YELLOW_0,YELLOW14,ORDERS_2,CKB9,CKB10,CKB15,CKB16,CKB17,CKB18,CKB20,CKB21,CKB23,CKB24,CKB25,CKB26,CKB28,CKB29,CKB38,CKB43,CKB44,CKB51,CKB52;
constructors STRUCT_0,NECKLACE,NECKLA_3,RELSET_1,SETFAM_1,XXREAL_0,NAT_1,NAT_D,FUNCT_2,NEWTON,YELLOW_0,DILWORTH,DOMAIN_1,CKB8,CKB14,CKB19,CKB22,CKB27,CKB55;
requirements SUBSET,BOOLE,NUMERALS,ARITHM,REAL;
begin
theorem
Th31: (for R being  with_finite_chromatic# RelStr holds (for C being  finite (Coloring of R) holds (for c being set holds ((c in C & ( card C ) = ( chromatic# R )) implies (ex v being (Element of R) st (v in c & (for d being (Element of C) holds (d <> c implies (ex w being (Element of R) st (w in ( Adjacent v ) & w in d))))))))))
proof
let R being  with_finite_chromatic# RelStr;
let C being  finite (Coloring of R);
let c being set;
assume that
A1: c in C
and
A2: ( card C ) = ( chromatic# R );
assume A3: (not thesis);
set cR = (the carrier of R);
A4: ( union C ) = cR by EQREL_1:def 4;
reconsider c as (Subset of cR) by A1;
A5: c <> ( {} ) by A1,EQREL_1:def 4;
set Cc = ( C \ { c } );
A6: c in { c } by TARSKI:def 1;
per cases ;
suppose A7: Cc is  empty;

consider v being set such that A8: v in c by A5,XBOOLE_0:def 1;
reconsider v as (Element of R) by A8;
consider d being (Element of C) such that A9: d <> c and (for w being (Element of R) holds (not (w in ( Adjacent v ) & w in d))) by A8,A3;
( 0 ) = ( ( card C ) - ( card { c } ) ) by A1,A7,CARD_1:27,EULER_1:4;
then ( ( 0 ) + 1 ) = ( ( ( card C ) - 1 ) + 1 ) by CARD_1:30;
then consider x being set such that A10: C = { x } by CARD_2:42;
(c = x & d = x) by A1,A10,TARSKI:def 1;
hence thesis by A9;
end;
suppose Cc is non  empty;

then reconsider Cc as non  empty set;
defpred P[ set,set ]
 means
(for vv being (Element of cR) holds ($1 = vv implies (($2 <> c & $2 in C) & (for w being (Element of R) holds (not (w in ( Adjacent vv ) & w in $2))))));
A11: (for e being set holds (e in c implies (ex u being set st P[ e,u ])))
proof
let v being set;
assume that
A12: v in c;
reconsider vv = v as (Element of cR) by A12;
consider d being (Element of C) such that A13: d <> c and A14: (for w being (Element of R) holds (not (w in ( Adjacent vv ) & w in d))) by A12,A3;
take d;
thus thesis by A13,A14,A1;
end;
consider r being Function such that A15: ( dom r ) = c and A16: (for e being set holds (e in c implies P[ e,( r . e ) ])) from CLASSES1:sch 1(A11);
defpred DP[ set ]
 means
(not contradiction);
deffunc DF(set) = ( $1 \/ ( r " { $1 } ) );
reconsider Cc as  finite non  empty set;
set D = { DF(d) where d is (Element of Cc): DP[ d ] };
consider d being set such that A17: d in Cc by XBOOLE_0:def 1;
A18: ( d \/ ( r " { d } ) ) in D by A17;
A19: D c= ( bool cR )
proof
let x being set;
assume x in D;
then consider d being (Element of Cc) such that A20: x = ( d \/ ( r " { d } ) );
A21: ( r " { d } ) c= c by A15,RELAT_1:132;
A22: ( r " { d } ) c= cR by A21,XBOOLE_1:1;
d in C by XBOOLE_0:def 5;
then x c= cR by A20,A22,XBOOLE_1:8;
hence x in ( bool cR );
end;
A23: ( union D ) = cR
proof
thus ( union D ) c= cR
proof
let x being set;
assume x in ( union D );
then consider Y being set such that A24: x in Y and A25: Y in D by TARSKI:def 4;
thus x in cR by A24,A25,A19;
end;

thus cR c= ( union D )
proof
let x being set;
assume A26: x in cR;
then consider d being set such that A27: x in d and A28: d in C by A4,TARSKI:def 4;
reconsider xp1 = x as (Element of cR) by A26;
per cases ;
suppose A29: d = c;

then ( r . xp1 ) <> c by A27,A16;
then A30: (not ( r . xp1 ) in { c }) by TARSKI:def 1;
( r . xp1 ) in C by A27,A29,A16;
then A31: ( r . xp1 ) in Cc by A30,XBOOLE_0:def 5;
( r . xp1 ) in { ( r . xp1 ) } by TARSKI:def 1;
then x in ( r " { ( r . xp1 ) } ) by A27,A29,A15,FUNCT_1:def 7;
then A32: x in ( ( r . xp1 ) \/ ( r " { ( r . xp1 ) } ) ) by XBOOLE_0:def 3;
( ( r . xp1 ) \/ ( r " { ( r . xp1 ) } ) ) in D by A31;
hence x in ( union D ) by A32,TARSKI:def 4;
end;
suppose d <> c;

then (not d in { c }) by TARSKI:def 1;
then d in Cc by A28,XBOOLE_0:def 5;
then A33: ( d \/ ( r " { d } ) ) in D;
x in ( d \/ ( r " { d } ) ) by A27,XBOOLE_0:def 3;
hence x in ( union D ) by A33,TARSKI:def 4;
end;
end;

end;
A34: (for A being (Subset of cR) holds (A in D implies (A <> ( {} ) & (for B being (Subset of cR) holds (B in D implies (A = B or A misses B))))))
proof
let A being (Subset of cR);
assume A in D;
then consider da being (Element of Cc) such that A35: A = ( da \/ ( r " { da } ) );
A36: da in C by XBOOLE_0:def 5;
then da is non  empty by EQREL_1:def 4;
hence A <> ( {} ) by A35;
let B being (Subset of cR);
assume B in D;
then consider db being (Element of Cc) such that A37: B = ( db \/ ( r " { db } ) );
A38: db in C by XBOOLE_0:def 5;
per cases ;
suppose da = db;

hence (A = B or A misses B) by A35,A37;
end;
suppose A39: da <> db;

then A40: da misses db by A36,A38,EQREL_1:def 4;
A41: ( r " { da } ) misses ( r " { db } ) by A39,FUNCT_1:71,ZFMISC_1:11;
assume A <> B;
assume A meets B;
then consider x being set such that A42: x in A and A43: x in B by XBOOLE_0:3;
per cases  by A42,A43,A35,A37,XBOOLE_0:def 3;
suppose (x in da & x in db);

hence contradiction by A40,XBOOLE_0:3;
end;
suppose that A44: x in da
and
A45: x in ( r " { db } );
A46: da <> c by A6,XBOOLE_0:def 5;
( r " { db } ) c= c by A15,RELAT_1:132;
then da meets c by A44,A45,XBOOLE_0:3;
hence contradiction by A46,A36,A1,EQREL_1:def 4;
end;
suppose that A47: x in ( r " { da } )
and
A48: x in db;
A49: db <> c by A6,XBOOLE_0:def 5;
( r " { da } ) c= c by A15,RELAT_1:132;
then db meets c by A47,A48,XBOOLE_0:3;
hence contradiction by A49,A38,A1,EQREL_1:def 4;
end;
suppose (x in ( r " { da } ) & x in ( r " { db } ));

hence contradiction by A41,XBOOLE_0:3;
end;
end;
end;
reconsider D as (a_partition of cR) by A19,A23,A34,EQREL_1:def 4;
now
let x being set;
assume A50: x in D;
then reconsider S = x as (Subset of R);
consider d being (Element of Cc) such that A51: x = ( d \/ ( r " { d } ) ) by A50;
A52: ( r " { d } ) c= c by A15,RELAT_1:132;
A53: d in C by XBOOLE_0:def 5;
A54: d is (StableSet of R) by A53,DILWORTH:def 12;
A55: c is (StableSet of R) by A1,DILWORTH:def 12;
S is  stable
proof
let a being (Element of R);
let b being (Element of R);
assume that
A56: a in S
and
A57: b in S
and
A58: a <> b;
per cases  by A56,A57,A51,XBOOLE_0:def 3;
suppose (a in d & b in d);

hence ((not a <= b) & (not b <= a)) by A54,A58,DILWORTH:def 2;
end;
suppose that A59: a in d
and
A60: b in ( r " { d } );
( r . b ) in { d } by A60,FUNCT_1:def 7;
then ( r . b ) = d by TARSKI:def 1;
then (not a in ( Adjacent b )) by A59,A52,A60,A16;
then ((not a < b) & (not b < a)) by CKB55:def 1;
hence ((not a <= b) & (not b <= a)) by A58,ORDERS_2:def 6;
end;
suppose that A61: a in ( r " { d } )
and
A62: b in d;
( r . a ) in { d } by A61,FUNCT_1:def 7;
then ( r . a ) = d by TARSKI:def 1;
then (not b in ( Adjacent a )) by A62,A52,A61,A16;
then ((not a < b) & (not b < a)) by CKB55:def 1;
hence ((not a <= b) & (not b <= a)) by A58,ORDERS_2:def 6;
end;
suppose (a in ( r " { d } ) & b in ( r " { d } ));

hence ((not a <= b) & (not b <= a)) by A52,A55,A58,DILWORTH:def 2;
end;
end;
hence x is (StableSet of R);
end;
then reconsider D as (Coloring of R) by DILWORTH:def 12;
( card Cc ) = ( ( card C ) - ( card { c } ) ) by A1,EULER_1:4;
then ( ( card Cc ) + 1 ) = ( ( ( card C ) - 1 ) + 1 ) by CARD_1:30;
then A63: ( card Cc ) < ( card C ) by NAT_1:13;
deffunc FS(set) = ( $1 \/ ( r " { $1 } ) );
consider s being Function such that A64: ( dom s ) = Cc and A65: (for x being set holds (x in Cc implies ( s . x ) = FS(x))) from FUNCT_1:sch 3;
A66: ( rng s ) c= D
proof
let y being set;
assume y in ( rng s );
then consider d being set such that A67: d in ( dom s ) and A68: y = ( s . d ) by FUNCT_1:def 3;
y = ( d \/ ( r " { d } ) ) by A64,A65,A67,A68;
hence y in D by A67,A64;
end;
then reconsider s as (Function of Cc,D) by A64,FUNCT_2:2;
A69: s is  one-to-one
proof
let x1 being set;
let x2 being set;
assume that
A70: x1 in ( dom s )
and
A71: x2 in ( dom s )
and
A72: ( s . x1 ) = ( s . x2 );
A73: ( s . x1 ) = ( x1 \/ ( r " { x1 } ) ) by A70,A65;
A74: ( s . x2 ) = ( x2 \/ ( r " { x2 } ) ) by A71,A65;
thus x1 c= x2
proof
let x being set;
assume A75: x in x1;
then A76: x in ( s . x1 ) by A73,XBOOLE_0:def 3;
per cases  by A76,A72,A74,XBOOLE_0:def 3;
suppose x in x2;

hence thesis;
end;
suppose A77: x in ( r " { x2 } );

A78: ( r " { x2 } ) c= ( dom r ) by RELAT_1:132;
A79: x1 in C by A70,XBOOLE_0:def 5;
then reconsider x1 as (Subset of cR);
x1 meets c by A78,A77,A15,A75,XBOOLE_0:3;
then x1 = c by A79,A1,EQREL_1:def 4;
hence thesis by A6,A70,XBOOLE_0:def 5;
end;
end;

thus x2 c= x1
proof
let x being set;
assume A80: x in x2;
then A81: x in ( s . x2 ) by A74,XBOOLE_0:def 3;
per cases  by A81,A72,A73,XBOOLE_0:def 3;
suppose x in x1;

hence thesis;
end;
suppose A82: x in ( r " { x1 } );

A83: ( r " { x1 } ) c= ( dom r ) by RELAT_1:132;
A84: x2 in C by A71,XBOOLE_0:def 5;
then reconsider x2 as (Subset of cR);
x2 meets c by A83,A82,A15,A80,XBOOLE_0:3;
then x2 = c by A84,A1,EQREL_1:def 4;
hence thesis by A6,A71,XBOOLE_0:def 5;
end;
end;

end;
D c= ( rng s )
proof
let x being set;
assume x in D;
then consider d being (Element of Cc) such that A85: x = ( d \/ ( r " { d } ) );
( s . d ) = ( d \/ ( r " { d } ) ) by A65;
hence x in ( rng s ) by A85,A64,FUNCT_1:def 3;
end;
then D = ( rng s ) by A66,XBOOLE_0:def 10;
then s is  onto by FUNCT_2:def 3;
then A86: ( card Cc ) = ( card D ) by A69,A18,EULER_1:11;
then D is  finite;
hence contradiction by A63,A86,A2,CKB19:def 1;
end;
end;
