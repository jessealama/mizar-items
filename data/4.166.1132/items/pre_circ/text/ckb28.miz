environ
vocabularies NUMBERS,FINSET_1,XBOOLE_0,SUBSET_1,TARSKI,FUNCT_1,RELAT_1,FUNCOP_1,FUNCT_4,PBOOLE,FINSEQ_1,CARD_3,PARTFUN1,FUNCT_5,FUNCT_2,ZFMISC_1,FUNCT_6,NAT_1,CARD_1,ARYTM_3,MCART_1,FINSEQ_2,TREES_1,TREES_3,TREES_2,ORDINAL4,TREES_A,XXREAL_0,TREES_4,ARYTM_1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,XCMPLX_0,XREAL_0,MCART_1,CARD_1,RELAT_1,FUNCT_1,FINSET_1,PARTFUN1,FUNCT_2,XXREAL_0,XXREAL_2,BINOP_1,FUNCOP_1,FUNCT_4,FUNCT_7,CARD_3,TREES_2,TREES_1,TREES_3,TREES_4,FUNCT_5,FUNCT_6,PBOOLE,FINSEQ_1,FINSEQ_2,NAT_1;
definitions TARSKI,FUNCOP_1,WELLORD2,FUNCT_1,RELAT_1,PBOOLE,XBOOLE_0,SEQ_4,FINSEQ_2,FINSET_1;
theorems TARSKI,ZFMISC_1,FINSEQ_1,FINSEQ_3,GRFUNC_1,FUNCT_1,FUNCT_2,FUNCT_4,FUNCT_5,TREES_1,TREES_2,TREES_3,TREES_4,NAT_1,RELAT_1,CARD_3,FUNCOP_1,MCART_1,PBOOLE,CARD_2,CARD_1,FUNCT_6,FINSET_1,XBOOLE_0,XBOOLE_1,XCMPLX_1,ORDERS_1,XREAL_1,XXREAL_0,XXREAL_2,XREAL_0,PARTFUN1,FUNCT_7,FINSEQ_2,CKB2,CKB3,CKB9,CKB10,CKB11,CKB14,CKB15,CKB16,CKB19,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27;
schemes DOMAIN_1,PBOOLE,FUNCT_1,FRAENKEL,FINSEQ_1,NAT_1,CKB1,CKB4,CKB12,CKB13;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCOP_1,FINSET_1,XREAL_0,MEMBERED,FINSEQ_1,CARD_3,PBOOLE,TREES_2,TREES_3,XXREAL_2,CARD_1,RELSET_1,TREES_1,CKB5,CKB6,CKB7,CKB8,CKB17,CKB18,CKB20;
constructors WELLORD2,BINOP_1,FUNCT_4,SETWISEO,XXREAL_0,NAT_1,FUNCT_5,CARD_3,SEQ_4,PBOOLE,TREES_4,BINARITH,INT_1,SEQ_1,XXREAL_2,PARTFUN1,RELSET_1,FUNCT_7;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve i for set;
reserve x for set;
reserve y for set;
reserve f for Function;
reserve T for  finite Tree;
reserve T1 for  finite Tree;
reserve t for (Element of T);
reserve p for (Element of T);
reserve t1 for (Element of T1);
theorem
Th22: (for T,T1 being  finite Tree holds (for p being (Element of T) holds ( ( card ( T with-replacement (p,T1) ) ) + ( card ( T | p ) ) ) = ( ( card T ) + ( card T1 ) )))
proof
let T;
let T1;
let p;
defpred P1[ (Element of T) ]
 means
(not p is_a_prefix_of $1);
defpred P2[ (Element of T) ]
 means
p is_a_prefix_of $1;
set A = { t: P1[ t ] };
set B = { t: P2[ t ] };
set C = { ( p ^ t1 ): (not contradiction) };
A1: A is (Subset of T) from DOMAIN_1:sch 7;
A2: B is (Subset of T) from DOMAIN_1:sch 7;
A3: T1,C are_equipotent 
proof
deffunc F((Element of T1)) = ( p ^ $1 );
consider f being Function such that A4: ( dom f ) = T1 and A5: (for n being (Element of T1) holds ( f . n ) = F(n)) from FUNCT_1:sch 4;
take f;
thus f is  one-to-one
proof
let x;
let y;
assume that
A6: (x in ( dom f ) & y in ( dom f ))
and
A7: ( f . x ) = ( f . y );
reconsider m = x,n = y as (Element of T1) by A4,A6;
( p ^ m ) = ( f . n ) by A5,A7
.= ( p ^ n ) by A5;
hence thesis by FINSEQ_1:33;
end;

thus ( dom f ) = T1 by A4;
thus ( rng f ) c= C
proof
let i;
assume i in ( rng f );
then consider n being set such that A8: n in ( dom f ) and A9: i = ( f . n ) by FUNCT_1:def 3;
T1 c= ( ( NAT ) * ) by TREES_1:def 3;
then reconsider n as (Element of ( ( NAT ) * )) by A4,A8;
( f . n ) = ( p ^ n ) by A4,A5,A8;
hence thesis by A4,A8,A9;
end;

let i;
assume i in C;
then consider n being (Element of T1) such that A10: i = ( p ^ n );
i = ( f . n ) by A5,A10;
hence thesis by A4,FUNCT_1:def 3;
end;
reconsider A,B as  finite set by A1,A2;
now
let x;
hereby
assume x in T;
then reconsider t = x as (Element of T);
(p is_a_prefix_of t or (not p is_a_prefix_of t));
hence (x in A or x in B);
end;
assume (x in A or x in B);
hence x in T by A1,A2;
end;
then A11: T = ( A \/ B ) by XBOOLE_0:def 3;
A12: A misses C
proof
assume (not thesis);
then consider x such that A13: x in ( A /\ C ) by XBOOLE_0:4;
x in C by A13,XBOOLE_0:def 4;
then A14: (ex t1 st x = ( p ^ t1 ));
x in A by A13,XBOOLE_0:def 4;
then (ex t st (x = t & (not p is_a_prefix_of t)));
hence contradiction by A14,TREES_1:1;
end;
A15: A misses B
proof
assume (not thesis);
then consider x such that A16: x in ( A /\ B ) by XBOOLE_0:4;
x in B by A16,XBOOLE_0:def 4;
then A17: (ex t st (x = t & p is_a_prefix_of t));
x in A by A16,XBOOLE_0:def 4;
then (ex t st (x = t & (not p is_a_prefix_of t)));
hence contradiction by A17;
end;
A18: ( T with-replacement (p,T1) ) = ( A \/ C ) by CKB21:1;
reconsider C as  finite set by A3,CARD_1:38;
A19: ( card T1 ) = ( card C ) by A3,CARD_1:5;
( T | p ),B are_equipotent  by CKB19:1;
then ( card ( T | p ) ) = ( card B ) by CARD_1:5;
hence ( ( card ( T with-replacement (p,T1) ) ) + ( card ( T | p ) ) ) = ( ( ( card A ) + ( card C ) ) + ( card B ) ) by A18,A12,CARD_2:40
.= ( ( ( card A ) + ( card B ) ) + ( card C ) )
.= ( ( card T ) + ( card T1 ) ) by A11,A15,A19,CARD_2:40;
end;
