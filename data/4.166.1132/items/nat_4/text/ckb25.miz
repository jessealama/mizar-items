environ
vocabularies NUMBERS,XREAL_0,ORDINAL1,CARD_1,XXREAL_0,RELAT_1,ARYTM_3,NAT_1,NEWTON,INT_1,SUBSET_1,ARYTM_1,REALSET1,ABIAN,FINSEQ_1,FINSEQ_2,ORDINAL4,CARD_3,FUNCT_1,INT_2,NAT_3,XBOOLE_0,PRE_POLY,POWER,PEPIN,SQUARE_1,ZFMISC_1,TARSKI,BINOP_2,FINSET_1,MEMBERED,REAL_1,COMPLEX1,PREPOWER;
notations SUBSET_1,XXREAL_0,PREPOWER,TARSKI,XBOOLE_0,ORDINAL1,CARD_1,NUMBERS,XREAL_0,INT_1,ABIAN,SQUARE_1,NEWTON,FINSET_1,PEPIN,NAT_3,RELAT_1,FUNCT_1,FINSEQ_1,RVSUM_1,WSIERP_1,TREES_4,BINOP_2,XXREAL_2,POWER,MEMBERED,INT_2,FINSEQ_2,ZFMISC_1,RECDEF_1,PRE_POLY,REAL_1,NAT_1,NAT_D;
definitions TARSKI,MEMBERED,RVSUM_1,FINSEQ_2,NEWTON,SQUARE_1;
theorems TARSKI,NAT_1,NAT_2,INT_1,FINSEQ_1,CARD_1,XBOOLE_1,CARD_2,FINSET_1,SQUARE_1,EULER_1,EULER_2,PREPOWER,POWER,ABSVALUE,NEWTON,XCMPLX_1,ORDINAL1,XREAL_1,PEPIN,NAT_3,XBOOLE_0,INT_2,ABIAN,FINSEQ_3,RVSUM_1,FUNCT_1,FINSEQ_2,ZFMISC_1,FUNCT_2,FUNCOP_1,PROB_3,INTEGRA5,COMPTRIG,XXREAL_0,NAT_D,VALUED_1,XXREAL_2,PRE_POLY,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24;
schemes NAT_1,FINSEQ_1;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FINSET_1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,FINSEQ_1,FINSEQ_2,RVSUM_1,NEWTON,SEQM_3,NAT_3,VALUED_0,VALUED_1,XXREAL_2,CARD_1,PRE_POLY;
constructors REAL_1,NAT_D,PREPOWER,POWER,WSIERP_1,ABIAN,PEPIN,POLYNOM2,NAT_3,SEQ_1,RECDEF_1,BINOP_2,XXREAL_2,RELSET_1;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
theorem
Th24: (for n,f,c being (Element of ( NAT )) holds ((((( n - 1 ) = ( f * c ) & f > c) & c > ( 0 )) & (for q being (Element of ( NAT )) holds ((q divides f & q is  prime) implies (ex a being (Element of ( NAT )) st (( ( a |^ ( n -' 1 ) ) mod n ) = 1 & ( ( ( a |^ ( ( n -' 1 ) div q ) ) -' 1 ) gcd n ) = 1))))) implies n is  prime))
proof
let n being (Element of ( NAT ));
let f being (Element of ( NAT ));
let c being (Element of ( NAT ));
assume that
A1: ( n - 1 ) = ( f * c )
and
A2: f > c
and
A3: c > ( 0 );
A4: ( ( n - 1 ) + 1 ) > ( ( 0 ) + 1 ) by A1,A2,A3,XREAL_1:6;
assume A5: (for q being (Element of ( NAT )) holds ((q divides f & q is  prime) implies (ex a being (Element of ( NAT )) st (( ( a |^ ( n -' 1 ) ) mod n ) = 1 & ( ( ( a |^ ( ( n -' 1 ) div q ) ) -' 1 ) gcd n ) = 1))));
assume (not n is  prime);
then consider p being (Element of ( NAT )) such that A6: p divides n and A7: 1 < p and A8: ( p * p ) <= n and A9: p is  prime by A4,CKB14:1;
A10: ( p - 1 ) = ( p -' 1 ) by A7,XREAL_1:233;
A11: ( p - 1 ) > ( 1 - 1 ) by A7,XREAL_1:9;
then A12: ( p -' 1 ) > ( 0 ) by A7,XREAL_1:233;
A13: (for q1 being (Element of ( NAT )) holds ((q1 in ( support ( pfexp f ) ) & ( q1 |-count f ) > ( 0 )) implies ( p mod ( q1 |^ ( q1 |-count f ) ) ) = 1))
proof
let q1 being (Element of ( NAT ));
set n1 = ( q1 |-count f );
assume A14: q1 in ( support ( pfexp f ) );
then A15: q1 is  prime by NAT_3:34;
A16: q1 is  prime by A14,NAT_3:34;
then consider a being (Element of ( NAT )) such that A17: ( ( a |^ ( n -' 1 ) ) mod n ) = 1 and A18: ( ( ( a |^ ( ( n -' 1 ) div q1 ) ) -' 1 ) gcd n ) = 1 by A5,A14,NAT_3:36;
assume A19: ( q1 |-count f ) > ( 0 );
A20: (not p divides ( ( a |^ ( ( n -' 1 ) div q1 ) ) -' 1 ))
proof
assume p divides ( ( a |^ ( ( n -' 1 ) div q1 ) ) -' 1 );
then p divides ( n gcd ( ( a |^ ( ( n -' 1 ) div q1 ) ) -' 1 ) ) by A6,NEWTON:50;
hence contradiction by A7,A18,NAT_D:7;
end;
q1 <> 1 by A16,INT_2:def 4;
then ( q1 |^ ( q1 |-count f ) ) divides f by A2,NAT_3:def 7;
then consider d being Nat such that A21: f = ( ( q1 |^ n1 ) * d ) by NAT_D:def 3;
reconsider d as (Element of ( NAT )) by ORDINAL1:def 12;
set k = ( d * c );
A22: k > ( 0 )
proof
assume k <= ( 0 );
then d = ( 0 ) by A3;
hence contradiction by A2,A21;
end;
( n - 1 ) = ( k * ( q1 |^ n1 ) ) by A1,A21;
hence thesis by A6,A9,A19,A17,A22,A15,A20,CKB24:1;
end;
(for q1 being (Element of ( NAT )) holds (q1 is  prime implies ( q1 |-count f ) <= ( q1 |-count ( p -' 1 ) )))
proof
let q1 being (Element of ( NAT ));
assume A23: q1 is  prime;
per cases ;
suppose A24: q1 in ( support ( pfexp f ) );

then ( ( pfexp f ) . q1 ) <> ( 0 ) by PRE_POLY:def 7;
then ( q1 |-count f ) > ( 0 ) by A23,NAT_3:def 8;
then ( p mod ( q1 |^ ( q1 |-count f ) ) ) = 1 by A13,A24;
then A25: ( q1 |-count ( q1 |^ ( q1 |-count f ) ) ) <= ( q1 |-count ( p -' 1 ) ) by A11,A10,A23,NAT_3:30,PEPIN:8;
q1 > 1 by A23,INT_2:def 4;
hence thesis by A25,NAT_3:25;
end;
suppose (not q1 in ( support ( pfexp f ) ));

then ( ( pfexp f ) . q1 ) = ( 0 ) by PRE_POLY:def 7;
hence thesis by A23,NAT_3:def 8;
end;
end;
then (ex n2 being (Element of ( NAT )) st ( p -' 1 ) = ( f * n2 )) by A2,A12,CKB21:1;
then f divides ( p -' 1 ) by NAT_D:def 3;
then f <= ( p -' 1 ) by A12,NAT_D:7;
then ( ( p - 1 ) + 1 ) >= ( f + 1 ) by A10,XREAL_1:6;
then p > f by NAT_1:13;
then A26: ( p ^2 ) > ( f ^2 ) by SQUARE_1:16;
c >= ( ( 0 ) + 1 ) by A3,NAT_1:13;
then A27: ( c + 1 ) >= ( 1 + 1 ) by XREAL_1:6;
f >= ( c + 1 ) by A2,NAT_1:13;
then f >= 2 by A27,XXREAL_0:2;
then ( f - 1 ) >= ( 2 - 1 ) by XREAL_1:9;
then A28: ( n + ( f - 1 ) ) >= ( n + 1 ) by XREAL_1:6;
f >= ( c + 1 ) by A2,NAT_1:13;
then ( f * f ) >= ( f * ( c + 1 ) ) by XREAL_1:64;
then ( p ^2 ) > ( f + ( n - 1 ) ) by A1,A26,XXREAL_0:2;
then ( p ^2 ) >= ( n + 1 ) by A28,XXREAL_0:2;
hence contradiction by A8,NAT_1:13;
end;
