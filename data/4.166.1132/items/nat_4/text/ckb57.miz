environ
vocabularies NUMBERS,XREAL_0,ORDINAL1,CARD_1,XXREAL_0,RELAT_1,ARYTM_3,NAT_1,NEWTON,INT_1,SUBSET_1,ARYTM_1,REALSET1,ABIAN,FINSEQ_1,FINSEQ_2,ORDINAL4,CARD_3,FUNCT_1,INT_2,NAT_3,XBOOLE_0,PRE_POLY,POWER,PEPIN,SQUARE_1,ZFMISC_1,TARSKI,BINOP_2,FINSET_1,MEMBERED,REAL_1,COMPLEX1,PREPOWER;
notations SUBSET_1,XXREAL_0,PREPOWER,TARSKI,XBOOLE_0,ORDINAL1,CARD_1,NUMBERS,XREAL_0,INT_1,ABIAN,SQUARE_1,NEWTON,FINSET_1,PEPIN,NAT_3,RELAT_1,FUNCT_1,FINSEQ_1,RVSUM_1,WSIERP_1,TREES_4,BINOP_2,XXREAL_2,POWER,MEMBERED,INT_2,FINSEQ_2,ZFMISC_1,RECDEF_1,PRE_POLY,REAL_1,NAT_1,NAT_D;
definitions TARSKI,MEMBERED,RVSUM_1,FINSEQ_2,NEWTON,SQUARE_1;
theorems TARSKI,NAT_1,NAT_2,INT_1,FINSEQ_1,CARD_1,XBOOLE_1,CARD_2,FINSET_1,SQUARE_1,EULER_1,EULER_2,PREPOWER,POWER,ABSVALUE,NEWTON,XCMPLX_1,ORDINAL1,XREAL_1,PEPIN,NAT_3,XBOOLE_0,INT_2,ABIAN,FINSEQ_3,RVSUM_1,FUNCT_1,FINSEQ_2,ZFMISC_1,FUNCT_2,FUNCOP_1,PROB_3,INTEGRA5,COMPTRIG,XXREAL_0,NAT_D,VALUED_1,XXREAL_2,PRE_POLY,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56;
schemes NAT_1,FINSEQ_1;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FINSET_1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,FINSEQ_1,FINSEQ_2,RVSUM_1,NEWTON,SEQM_3,NAT_3,VALUED_0,VALUED_1,XXREAL_2,CARD_1,PRE_POLY;
constructors REAL_1,NAT_D,PREPOWER,POWER,WSIERP_1,ABIAN,PEPIN,POLYNOM2,NAT_3,SEQ_1,RECDEF_1,BINOP_2,XXREAL_2,RELSET_1;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
theorem
Lm8: (for n,r being (Element of ( NAT )) holds (for p being Prime holds (for f being (FinSequence of ( REAL )) holds ((((( p |^ r ) <= ( 2 * n ) & ( 2 * n ) < ( p |^ ( r + 1 ) )) & ( len f ) = ( 2 * n )) & (for k being (Element of ( NAT )) holds (k in ( dom f ) implies ( f . k ) = ( [\ ( ( 2 * n ) / ( p |^ k ) ) /] - ( 2 * [\ ( n / ( p |^ k ) ) /] ) )))) implies ( Sum f ) <= r))))
proof
let n being (Element of ( NAT ));
let r being (Element of ( NAT ));
let p being Prime;
let f being (FinSequence of ( REAL ));
set f0 = ( ( r |-> 1 ) ^ ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) );
A1: p > 1 by INT_2:def 4;
assume A2: ( p |^ r ) <= ( 2 * n );
A3: ( 2 * n ) >= r
proof
assume ( 2 * n ) < r;
then ( p to_power ( 2 * n ) ) < ( p to_power r ) by A1,POWER:39;
then ( p |^ ( 2 * n ) ) < ( p to_power r ) by POWER:41;
then ( p |^ ( 2 * n ) ) < ( p |^ r ) by POWER:41;
then ( p |^ ( 2 * n ) ) < ( 2 * n ) by A2,XXREAL_0:2;
hence contradiction by A1,CKB3:1;
end;
assume A4: ( 2 * n ) < ( p |^ ( r + 1 ) );
assume A5: ( len f ) = ( 2 * n );
A6: ( len f0 ) = ( ( len ( r |-> 1 ) ) + ( len ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) ) ) by FINSEQ_1:22
.= ( r + ( len ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) ) ) by CARD_1:def 7
.= ( r + ( ( 2 * n ) -' r ) ) by CARD_1:def 7
.= ( r + ( ( 2 * n ) - r ) ) by A3,XREAL_1:233
.= ( len f ) by A5;
assume A7: (for k being (Element of ( NAT )) holds (k in ( dom f ) implies ( f . k ) = ( [\ ( ( 2 * n ) / ( p |^ k ) ) /] - ( 2 * [\ ( n / ( p |^ k ) ) /] ) )));
A8: (for k being (Element of ( NAT )) holds (k in ( dom f ) implies ( f . k ) <= ( f0 . k )))
proof
let k being (Element of ( NAT ));
assume A9: k in ( dom f );
then A10: ( f . k ) = ( [\ ( ( 2 * n ) / ( p |^ k ) ) /] - ( 2 * [\ ( n / ( p |^ k ) ) /] ) ) by A7;
k in ( Seg ( 2 * n ) ) by A5,A9,FINSEQ_1:def 3;
then A11: k in ( dom f0 ) by A5,A6,FINSEQ_1:def 3;
per cases  by A11,FINSEQ_1:25;
suppose A12: k in ( dom ( r |-> 1 ) );

[\ ( n / ( p |^ k ) ) /] <= ( n / ( p |^ k ) ) by INT_1:def 6;
then ( - [\ ( n / ( p |^ k ) ) /] ) >= ( - ( n / ( p |^ k ) ) ) by XREAL_1:24;
then (( ( ( 2 * n ) / ( p |^ k ) ) - 1 ) < [\ ( ( 2 * n ) / ( p |^ k ) ) /] & ( ( - [\ ( n / ( p |^ k ) ) /] ) * 2 ) >= ( ( - ( n / ( p |^ k ) ) ) * 2 )) by INT_1:def 6,XREAL_1:64;
then ( ( ( ( 2 * n ) / ( p |^ k ) ) - 1 ) + ( 2 * ( - ( n / ( p |^ k ) ) ) ) ) < ( [\ ( ( 2 * n ) / ( p |^ k ) ) /] + ( - ( 2 * [\ ( n / ( p |^ k ) ) /] ) ) ) by XREAL_1:8;
then ( [\ ( ( 2 * n ) / ( p |^ k ) ) /] - ( 2 * [\ ( n / ( p |^ k ) ) /] ) ) > ( ( ( 2 * ( n / ( p |^ k ) ) ) - 1 ) + ( 2 * ( - ( n / ( p |^ k ) ) ) ) ) by XCMPLX_1:74;
then ( f . k ) >= ( ( - 1 ) + 1 ) by A10,INT_1:7;
then A13: ( f . k ) is (Element of ( NAT )) by A10,INT_1:3;
( ( n / ( p |^ k ) ) - 1 ) < [\ ( n / ( p |^ k ) ) /] by INT_1:def 6;
then ( - [\ ( n / ( p |^ k ) ) /] ) < ( - ( ( n / ( p |^ k ) ) - 1 ) ) by XREAL_1:24;
then ([\ ( ( 2 * n ) / ( p |^ k ) ) /] <= ( ( 2 * n ) / ( p |^ k ) ) & ( ( - [\ ( n / ( p |^ k ) ) /] ) * 2 ) < ( ( - ( ( n / ( p |^ k ) ) - 1 ) ) * 2 )) by INT_1:def 6,XREAL_1:68;
then (( ( 2 * n ) / ( p |^ k ) ) = ( 2 * ( n / ( p |^ k ) ) ) & ( ( - ( 2 * [\ ( n / ( p |^ k ) ) /] ) ) + [\ ( ( 2 * n ) / ( p |^ k ) ) /] ) < ( ( 2 * ( ( - ( n / ( p |^ k ) ) ) + 1 ) ) + ( ( 2 * n ) / ( p |^ k ) ) )) by XCMPLX_1:74,XREAL_1:8;
then A14: ( f . k ) < ( 1 + 1 ) by A10;
A15: k in ( Seg r ) by A12,FUNCOP_1:13;
( f0 . k ) = ( ( r |-> 1 ) . k ) by A12,FINSEQ_1:def 7
.= 1 by A15,FUNCOP_1:7;
hence thesis by A13,A14,NAT_1:13;
end;
suppose A16: (ex n0 being Nat st (n0 in ( dom ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) ) & k = ( ( len ( r |-> 1 ) ) + n0 )));

reconsider k1 = k as (Element of ( NAT ));
consider n0 being Nat such that A17: n0 in ( dom ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) ) and A18: k = ( ( len ( r |-> 1 ) ) + n0 ) by A16;
n0 in ( Seg ( ( 2 * n ) -' r ) ) by A17,FUNCOP_1:13;
then 1 <= n0 by FINSEQ_1:1;
then A19: ( 1 + r ) <= ( n0 + r ) by XREAL_1:6;
k = ( r + n0 ) by A18,CARD_1:def 7;
then (( r + 1 ) < k or ( r + 1 ) = k) by A19,XXREAL_0:1;
then ( p to_power ( r + 1 ) ) <= ( p to_power k ) by A1,POWER:39;
then ( p |^ ( r + 1 ) ) <= ( p to_power k ) by POWER:41;
then ( p |^ ( r + 1 ) ) <= ( p |^ k1 ) by POWER:41;
then ( 2 * n ) < ( p |^ k ) by A4,XXREAL_0:2;
then ( ( 2 * n ) / ( p |^ k ) ) < ( ( p |^ k ) / ( p |^ k ) ) by XREAL_1:74;
then A20: ( ( 2 * n ) / ( p |^ k ) ) < 1 by XCMPLX_1:60;
then ( ( ( 2 * n ) / ( p |^ k ) ) / 2 ) < ( 1 / 2 ) by XREAL_1:74;
then ( ( ( 2 * n ) / 2 ) / ( p |^ k ) ) < ( 1 / 2 ) by XCMPLX_1:48;
then ( n / ( p |^ k ) ) < 1 by XXREAL_0:2;
then ( ( n / ( p |^ k ) ) - 1 ) < ( 1 - 1 ) by XREAL_1:9;
then A21: [\ ( n / ( p |^ k ) ) /] = ( 0 ) by INT_1:def 6;
( ( ( 2 * n ) / ( p |^ k ) ) - 1 ) < ( 1 - 1 ) by A20,XREAL_1:9;
hence thesis by A10,A21,INT_1:def 6;
end;
end;
( Sum f0 ) = ( ( Sum ( r |-> 1 ) ) + ( Sum ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) ) ) by RVSUM_1:75
.= ( ( r * 1 ) + ( Sum ( ( ( 2 * n ) -' r ) |-> ( 0 ) ) ) ) by RVSUM_1:80
.= ( r + ( ( ( 2 * n ) -' r ) * ( 0 ) ) ) by RVSUM_1:80
.= r;
hence thesis by A6,A8,INTEGRA5:3;
end;
