environ
vocabularies NUMBERS,ORDINAL1,REAL_1,XBOOLE_0,METRIC_1,PROB_1,XXREAL_2,FUNCT_1,RELAT_1,STRUCT_0,PRE_TOPC,SUBSET_1,FUNCOP_1,XXREAL_0,MEASURE5,SEQ_1,CARD_1,ARYTM_1,ARYTM_3,VALUED_0,TARSKI,ORDINAL2,NAT_1,BHSP_3,COMPLEX1,RELAT_2,RCOMP_1,PCOMPS_1,ZFMISC_1,XREAL_0,REWRITE1,SETFAM_1,SEQ_2,METRIC_6,FRECHET,FINSET_1,VALUED_1,CARD_3,TOPGEN_1,WELLORD1,ORDERS_2,PARTFUN1,WELLFND1,TBSP_1,WAYBEL23,RLVECT_3,COMPL_SP;
notations METRIC_6,RELAT_2,BINOP_1,TOPMETR,CARD_1,FUNCOP_1,CANTOR_1,WELLORD1,COMPLEX1,FINSET_1,SEQ_2,TARSKI,XBOOLE_0,SUBSET_1,ORDINAL1,NUMBERS,ZFMISC_1,XXREAL_0,XREAL_0,REAL_1,SETFAM_1,DOMAIN_1,TOPS_2,FUNCT_1,VALUED_1,NAT_1,VALUED_0,STRUCT_0,PRE_TOPC,COMPTS_1,RELAT_1,SEQ_1,TBSP_1,RELSET_1,PARTFUN1,FUNCT_2,METRIC_1,PCOMPS_1,CARD_3,PROB_1,FRECHET,KURATO_0,KURATO_2,WELLFND1,WAYBEL23,ORDERS_2,TOPGEN_1,CKB1,CKB3,CKB9,CKB10,CKB16,CKB17,CKB23,CKB24,CKB40;
definitions TARSKI,TOPS_2,SUBSET_1,STRUCT_0,TBSP_1,PCOMPS_1,COMPTS_1,METRIC_1,CKB1,CKB3,CKB9,CKB10,CKB16,CKB17,CKB23,CKB24,CKB40;
theorems KURATO_2,NAT_1,FUNCT_2,PCOMPS_1,PCOMPS_2,NAGATA_1,SUBSET_1,METRIC_6,FUNCT_1,METRIC_1,XREAL_0,XCMPLX_1,ABSVALUE,TOPMETR,XBOOLE_1,TARSKI,SETFAM_1,XBOOLE_0,TOPS_1,TOPS_2,PRE_TOPC,CARD_4,ZFMISC_1,BINOP_1,SEQ_2,SEQ_4,SEQ_1,SEQM_3,PARTFUN1,WELLORD1,WELLORD2,TBSP_1,RELAT_1,RELAT_2,YELLOW_9,XREAL_1,XXREAL_0,ORDINAL1,FRECHET2,FRECHET,COMPTS_1,STIRL2_1,CARD_1,HAUSDORF,TOPMETR3,CARD_3,TOPGEN_4,DICKSON,RELSET_2,TOPGEN_1,WELLFND1,WAYBEL23,UNIFORM1,CARD_2,TOPREAL6,FINSET_1,PROB_1,FUNCOP_1,KURATO_0,CKB1,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB15,CKB16,CKB17,CKB18,CKB23,CKB24,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55;
schemes FUNCT_1,WELLFND1,TREES_2,FUNCT_2,NAT_1,FRAENKEL,BINOP_1,SEQ_1;
registrations REALSET1,TOPMETR,PRE_TOPC,PCOMPS_1,NAT_1,TBSP_1,XREAL_0,RELSET_1,SUBSET_1,STRUCT_0,TOPS_1,METRIC_1,HAUSDORF,MEMBERED,XXREAL_0,YELLOW13,CARD_1,XBOOLE_0,VALUED_1,FUNCT_2,NUMBERS,FINSET_1,SEQ_4,WELLFND1,ZFMISC_1,KURATO_0,CKB2,CKB11,CKB12,CKB13,CKB14,CKB19,CKB20,CKB21,CKB22,CKB25,CKB26;
constructors REAL_1,NAT_1,TBSP_1,YELLOW_6,FRECHET,FRECHET2,KURATO_2,COMPLEX1,SEQ_2,TOPS_2,WELLORD1,CARD_3,CANTOR_1,URYSOHN3,METRIC_6,REALSET1,WELLFND1,TOPGEN_4,WAYBEL23,TOPGEN_1,SEQ_1,COMPTS_1,FINSUB_1,TOPS_1,BINOP_2,RVSUM_1,KURATO_0,CKB1,CKB3,CKB9,CKB10,CKB16,CKB17,CKB23,CKB24,CKB40;
requirements REAL,SUBSET,BOOLE,NUMERALS,ARITHM;
begin
reserve x for set;
reserve y for set;
scheme Th39 { X() -> non empty set,P[set,set] } : (ex A being (Subset of X()) st ((for x,y being (Element of X()) holds (((x in A & y in A) & x <> y) implies P[ x,y ])) & (for x being (Element of X()) holds (ex y being (Element of X()) st (y in A & (not P[ x,y ]))))))
provided
A1: (for x,y being (Element of X()) holds (P[ x,y ] iff P[ y,x ]))
and
A2: (for x being (Element of X()) holds (not P[ x,x ]))
proof
set bX = ( bool X() );
consider R being Relation such that A3: R well_orders X() by WELLORD2:17;
( R /\ [: X(),X() :] ) c= [: X(),X() :] by XBOOLE_1:17;
then reconsider R2 = ( R |_2 X() ) as (Relation of X()) by WELLORD1:def 6;
reconsider RS = RelStr (# X(),R2 #) as non empty RelStr;
set cRS = (the carrier of RS);
defpred H[ set,set,set ]
 means
(for p being (Element of X()) holds (for f being (PartFunc of cRS,bX) holds (($1 = p & $2 = f) implies (((for q being (Element of X()) holds (q in ( union ( rng f ) ) implies P[ p,q ])) implies $3 = ( ( union ( rng f ) ) \/ { p } )) & ((ex q being (Element of X()) st (q in ( union ( rng f ) ) & (not P[ p,q ]))) implies $3 = ( union ( rng f ) ))))));
A4: (for x holds (for y holds ((x in cRS & y in ( PFuncs (cRS,bX) )) implies (ex z being set st (z in bX & H[ x,y,z ])))))
proof
let x;
let y;
assume that
A5: x in cRS
and
A6: y in ( PFuncs (cRS,bX) );
reconsider f = y as (PartFunc of cRS,bX) by A6,PARTFUN1:46;
reconsider p = x as (Element of X()) by A5;
per cases ;
suppose A7: (for q being (Element of X()) holds (q in ( union ( rng f ) ) implies P[ p,q ]));

take ( ( union ( rng f ) ) \/ { p } );
thus thesis by A7;
end;
suppose A8: (ex q being (Element of X()) st (q in ( union ( rng f ) ) & (not P[ p,q ])));

take ( union ( rng f ) );
thus thesis by A8;
end;
end;
consider h being (Function of [: cRS,( PFuncs (cRS,bX) ) :],bX) such that A9: (for x holds (for y holds ((x in cRS & y in ( PFuncs (cRS,bX) )) implies H[ x,y,( h . (x,y) ) ]))) from BINOP_1:sch 1(A4);
set IRS = (the InternalRel of RS);
A10: R2 well_orders X() by A3,PCOMPS_2:1;
then R2 is_well_founded_in X() by WELLORD1:def 5;
then A11: RS is  well_founded by WELLFND1:def 2;
then consider f being (Function of cRS,bX) such that A12: f is_recursively_expressed_by h by WELLFND1:11;
defpred S[ set ]
 means
((( f . $1 ) c= ( ( IRS -Seg $1 ) \/ { $1 } ) & ($1 in ( f . $1 ) implies (for r being (Element of X()) holds (r in ( union ( rng ( f | ( IRS -Seg $1 ) ) ) ) implies P[ $1,r ])))) & ((not $1 in ( f . $1 )) implies (ex r being (Element of X()) st (r in ( union ( rng ( f | ( IRS -Seg $1 ) ) ) ) & (not P[ $1,r ])))));
reconsider rngf = ( rng f ) as (Subset of bX);
take A = ( union rngf );
A13: ( field R2 ) = X() by A3,PCOMPS_2:1;
then A14: R2 is  well-ordering by A10,WELLORD1:4;
A15: (for x being (Element of RS) holds ((for y being (Element of RS) holds ((y <> x & [ y,x ] in IRS) implies S[ y ])) implies S[ x ]))
proof
let x being (Element of RS);
assume that
A16: (for y being (Element of RS) holds ((y <> x & [ y,x ] in IRS) implies S[ y ]));
set fIx = ( f | ( IRS -Seg x ) );
A17: ( union ( rng fIx ) ) c= ( IRS -Seg x )
proof
let y being set;
assume y in ( union ( rng fIx ) );
then consider z being set such that A18: y in z and A19: z in ( rng fIx ) by TARSKI:def 4;
consider t being set such that A20: t in ( dom fIx ) and A21: ( fIx . t ) = z by A19,FUNCT_1:def 3;
A22: t in ( IRS -Seg x ) by A20,RELAT_1:57;
reconsider t as (Element of RS) by A20;
A23: { t } c= ( IRS -Seg x ) by A22,ZFMISC_1:31;
A24: [ t,x ] in IRS by A22,WELLORD1:1;
then ( IRS -Seg t ) c= ( IRS -Seg x ) by A13,A14,WELLORD1:29;
then A25: ( ( IRS -Seg t ) \/ { t } ) c= ( IRS -Seg x ) by A23,XBOOLE_1:8;
t <> x by A22,WELLORD1:1;
then A26: ( f . t ) c= ( ( IRS -Seg t ) \/ { t } ) by A16,A24;
( fIx . t ) = ( f . t ) by A20,FUNCT_1:47;
then y in ( ( IRS -Seg t ) \/ { t } ) by A18,A21,A26;
hence thesis by A25;
end;
A27: fIx in ( PFuncs (cRS,bX) ) by PARTFUN1:45;
A28: ( f . x ) = ( h . (x,fIx) ) by A12,WELLFND1:def 5;
per cases ;
suppose A29: (for q being (Element of X()) holds (q in ( union ( rng fIx ) ) implies P[ x,q ]));

then A30: ( f . x ) = ( ( union ( rng fIx ) ) \/ { x } ) by A9,A28,A27;
hence ( f . x ) c= ( ( IRS -Seg x ) \/ { x } ) by A17,XBOOLE_1:9;
thus (x in ( f . x ) implies (for r being (Element of X()) holds (r in ( union ( rng ( f | ( IRS -Seg x ) ) ) ) implies P[ x,r ]))) by A29;
A31: x in { x } by TARSKI:def 1;
assume (not x in ( f . x ));
hence thesis by A30,A31,XBOOLE_0:def 3;
end;
suppose A32: (ex q being (Element of X()) st (q in ( union ( rng fIx ) ) & (not P[ x,q ])));

then A33: ( f . x ) c= ( IRS -Seg x ) by A9,A17,A28,A27;
( IRS -Seg x ) c= ( ( IRS -Seg x ) \/ { x } ) by XBOOLE_1:7;
hence ( f . x ) c= ( ( IRS -Seg x ) \/ { x } ) by A33,XBOOLE_1:1;
thus thesis by A32,A33,WELLORD1:1;
end;
end;
A34: (for x being (Element of RS) holds S[ x ]) from WELLFND1:sch 3(A15,A11);
thus (for x,y being (Element of X()) holds (((x in A & y in A) & x <> y) implies P[ x,y ]))
proof
A35:now
let x being (Element of X());
assume x in A;
then consider y such that A36: x in y and A37: y in ( rng f ) by TARSKI:def 4;
defpred T[ set ]
 means
x in ( f . $1 );
consider z being set such that A38: z in ( dom f ) and A39: ( f . z ) = y by A37,FUNCT_1:def 3;
reconsider z as (Element of RS) by A38;
A40: T[ z ] by A36,A39;
consider p being (Element of RS) such that A41: T[ p ] and A42: (not (ex q being (Element of RS) st ((p <> q & T[ q ]) & [ q,p ] in IRS))) from WELLFND1:sch 2(A40,A11);
p = x
proof
set fIp = ( f | ( IRS -Seg p ) );
A43: fIp in ( PFuncs (cRS,bX) ) by PARTFUN1:45;
A44: ( f . p ) = ( h . (p,fIp) ) by A12,WELLFND1:def 5;
assume A45: p <> x;
now
per cases ;
suppose A46: (for q being (Element of X()) holds (q in ( union ( rng fIp ) ) implies P[ p,q ]));

A47: (not x in { p }) by A45,TARSKI:def 1;
( f . p ) = ( ( union ( rng fIp ) ) \/ { p } ) by A9,A44,A43,A46;
hence x in ( union ( rng fIp ) ) by A41,A47,XBOOLE_0:def 3;
end;
suppose (ex q being (Element of X()) st (q in ( union ( rng fIp ) ) & (not P[ p,q ])));

hence x in ( union ( rng fIp ) ) by A9,A41,A44,A43;
end;
end;
then consider y9 being set such that A48: x in y9 and A49: y9 in ( rng fIp ) by TARSKI:def 4;
consider z9 being set such that A50: z9 in ( dom fIp ) and A51: ( fIp . z9 ) = y9 by A49,FUNCT_1:def 3;
reconsider z9 as (Point of RS) by A50;
A52: z9 in ( IRS -Seg p ) by A50,RELAT_1:57;
then A53: z9 <> p by WELLORD1:1;
A54: [ z9,p ] in IRS by A52,WELLORD1:1;
T[ z9 ] by A48,A50,A51,FUNCT_1:47;
hence thesis by A42,A53,A54;
end;
hence x in ( f . x ) by A41;
end;
A55:now
A56: ( dom f ) = cRS by FUNCT_2:def 1;
let x being (Element of X()),y being (Element of X());
assume that
A57: x in A
and
A58: y in A
and
A59: x <> y
and
A60: [ x,y ] in IRS;
A61: y in ( f . y ) by A35,A58;
set fIy = ( f | ( IRS -Seg y ) );
x in ( IRS -Seg y ) by A59,A60,WELLORD1:1;
then A62: x in ( dom fIy ) by A56,RELAT_1:57;
then A63: ( fIy . x ) in ( rng fIy ) by FUNCT_1:def 3;
A64: ( fIy . x ) = ( f . x ) by A62,FUNCT_1:47;
x in ( f . x ) by A35,A57;
then x in ( union ( rng fIy ) ) by A63,A64,TARSKI:def 4;
then P[ y,x ] by A34,A61;
hence P[ x,y ] by A1;
end;
let x being (Element of X()),y being (Element of X());
assume that
A65: x in A
and
A66: y in A
and
A67: x <> y;
R2 well_orders X() by A3,PCOMPS_2:1;
then R2 is_connected_in X() by WELLORD1:def 5;
then ([ x,y ] in IRS or [ y,x ] in IRS) by A67,RELAT_2:def 6;
then (P[ x,y ] or P[ y,x ]) by A55,A65,A66,A67;
hence thesis by A1;
end;

let x being (Element of X());
per cases ;
suppose A68: x in A;

take x;
thus thesis by A2,A68;
end;
suppose A69: (not x in A);

(not x in ( f . x ))
proof
( dom f ) = cRS by FUNCT_2:def 1;
then A70: ( f . x ) in ( rng f ) by FUNCT_1:def 3;
assume x in ( f . x );
hence thesis by A69,A70,TARSKI:def 4;
end;
then consider r being (Element of X()) such that A71: r in ( union ( rng ( f | ( IRS -Seg x ) ) ) ) and A72: (not P[ x,r ]) by A34;
take r;
( union ( rng ( f | ( IRS -Seg x ) ) ) ) c= A by RELAT_1:70,ZFMISC_1:77;
hence thesis by A71,A72;
end;
end;
