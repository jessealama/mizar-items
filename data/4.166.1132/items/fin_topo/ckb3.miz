environ
vocabularies NUMBERS,FINSEQ_1,ZFMISC_1,SUBSET_1,XXREAL_0,ARYTM_3,PARTFUN1,TARSKI,NAT_1,CARD_1,XBOOLE_0,FINSET_1,FUNCT_1,RELAT_1,ORDINAL1,COMPLEX1,ARYTM_1,STRUCT_0,ORDERS_2,EQREL_1,FUNCOP_1,FUNCT_2,RELAT_2,SETFAM_1,RCOMP_1,FIN_TOPO;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,ORDINAL1,CARD_1,NUMBERS,XCMPLX_0,FINSET_1,SETFAM_1,RELAT_1,EQREL_1,FUNCT_1,PARTFUN1,FUNCT_2,FUNCOP_1,DOMAIN_1,RELSET_1,FINSEQ_1,INT_2,NAT_1,XXREAL_0,STRUCT_0,ORDERS_2;
definitions TARSKI,STRUCT_0,ORDINAL1,XBOOLE_0,SUBSET_1,RELAT_2,ORDERS_2,RELAT_1,FUNCOP_1,SETFAM_1;
theorems NAT_1,TARSKI,FUNCOP_1,SUBSET_1,ZFMISC_1,FINSET_1,INT_1,CARD_1,FINSEQ_4,FUNCT_1,FUNCT_2,FINSEQ_1,ABSVALUE,RELSET_1,XBOOLE_0,XBOOLE_1,MEASURE2,XREAL_1,XXREAL_0,ORDINAL1,RELAT_1,EQREL_1,ORDERS_2,PARTFUN1,CKB1,CKB2;
schemes NAT_1,FINSEQ_2,DOMAIN_1;
registrations XBOOLE_0,SUBSET_1,ORDINAL1,RELSET_1,FUNCOP_1,XXREAL_0,XREAL_0,NAT_1,INT_1,STRUCT_0,FINSET_1,FINSEQ_1;
constructors SETFAM_1,DOMAIN_1,FUNCOP_1,XXREAL_0,REAL_1,NAT_1,INT_2,EQREL_1,FINSEQ_4,ORDERS_2,SEQ_1,RELSET_1;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
scheme MaxFinSeqEx { X() -> non empty set,A,B() -> (Subset of X()),F((Subset of X())) -> (Subset of X()) } : (ex f being (FinSequence of ( bool X() )) st ((((( len f ) > ( 0 ) & ( f /. 1 ) = B()) & (for i being (Element of ( NAT )) holds ((i > ( 0 ) & i < ( len f )) implies ( f /. ( i + 1 ) ) = F(( f /. i ))))) & F(( f /. ( len f ) )) = ( f /. ( len f ) )) & (for i,j being (Element of ( NAT )) holds (((i > ( 0 ) & i < j) & j <= ( len f )) implies (( f /. i ) c= A() & ( f /. i ) c< ( f /. j ))))))
provided
A1: A() is  finite
and
A2: B() c= A()
and
A3: (for A being (Subset of X()) holds (A c= A() implies (A c= F(A) & F(A) c= A())))
proof
deffunc F(Nat,(Subset of X())) = F($2);
consider f being (Function of ( NAT ),( bool X() )) such that A4: ( f . ( 0 ) ) = B() and A5: (for n being Nat holds ( f . ( n + 1 ) ) = F(n,( f . n ))) from NAT_1:sch 12;
defpred P[ Nat ]
 means
( f . $1 ) c= A();
A6:now
let n being (Element of ( NAT ));
assume that
A7: P[ n ];
( f . ( n + 1 ) ) = F(( f . n )) by A5;
hence P[ ( n + 1 ) ] by A3,A7;
end;
A8: P[ ( 0 ) ] by A2,A4;
A9: (for n being (Element of ( NAT )) holds P[ n ]) from NAT_1:sch 1(A8,A6);
A10: (for i being (Element of ( NAT )) holds ( f . i ) c= ( f . ( i + 1 ) ))
proof
let i being (Element of ( NAT ));
(( f . ( i + 1 ) ) = F(( f . i )) & ( f . i ) c= A()) by A5,A9;
hence thesis by A3;
end;
A11: ( dom f ) = ( NAT ) by FUNCT_2:def 1;
A12: ( rng f ) is  c=-linear
proof
let B being set,C being set;
assume B in ( rng f );
then consider i being set such that A13: i in ( NAT ) and A14: B = ( f . i ) by A11,FUNCT_1:def 3;
reconsider i as (Element of ( NAT )) by A13;
assume C in ( rng f );
then consider j being set such that A15: j in ( NAT ) and A16: C = ( f . j ) by A11,FUNCT_1:def 3;
reconsider j as (Element of ( NAT )) by A15;
(i <= j or j <= i);
hence (B c= C or C c= B) by A10,A14,A16,MEASURE2:18;
end;
A17: ( rng f ) c= ( bool A() )
proof
let x being set;
assume x in ( rng f );
then x in ( f .: ( NAT ) ) by FUNCT_2:37;
then (ex k being (Element of ( NAT )) st (k in ( NAT ) & ( f . k ) = x)) by FUNCT_2:65;
then x c= A() by A9;
hence thesis;
end;
( rng f ) <> ( {} ) by A4,A11,FUNCT_1:def 3;
then consider m being set such that A18: m in ( rng f ) and A19: (for C being set holds (C in ( rng f ) implies C c= m)) by A1,A17,A12,FINSET_1:12;
deffunc G(Nat) = ( f . ( abs ( $1 - 1 ) ) );
defpred P[ set ]
 means
($1 in ( NAT ) & ( f . $1 ) = m);
m in ( f .: ( NAT ) ) by A18,FUNCT_2:37;
then (ex k being (Element of ( NAT )) st P[ k ]) by FUNCT_2:65;
then A20: (ex k being Nat st P[ k ]);
consider k being Nat such that A21: P[ k ] and A22: (for n being Nat holds (P[ n ] implies k <= n)) from NAT_1:sch 5(A20);
consider z being (FinSequence of ( bool X() )) such that A23: ( len z ) = ( k + 1 ) and A24: (for j being Nat holds (j in ( dom z ) implies ( z . j ) = G(j))) from FINSEQ_2:sch 1;
A25: ( ( 0 ) + 1 ) <= ( len z ) by A23,NAT_1:13;
then A26: 1 in ( Seg ( k + 1 ) ) by A23,FINSEQ_1:1;
take z;
thus ( 0 ) < ( len z ) by A23;
A27: ( dom z ) = ( Seg ( k + 1 ) ) by A23,FINSEQ_1:def 3;
thus ( z /. 1 ) = ( z . 1 ) by A25,FINSEQ_4:15
.= ( f . ( abs ( 1 - 1 ) ) ) by A24,A27,A26
.= B() by A4,ABSVALUE:2;
thus A28: (for i being (Element of ( NAT )) holds ((i > ( 0 ) & i < ( len z )) implies ( z /. ( i + 1 ) ) = F(( z /. i ))))
proof
let i being (Element of ( NAT ));
assume that
A29: i > ( 0 )
and
A30: i < ( len z );
A31: (( ( 0 ) + 1 ) < ( i + 1 ) & ( i + 1 ) <= ( k + 1 )) by A23,A29,A30,NAT_1:13,XREAL_1:6;
then A32: ( i + 1 ) in ( Seg ( k + 1 ) ) by FINSEQ_1:1;
A33: ( ( 0 ) + 1 ) <= i by A29,NAT_1:13;
then i in ( Seg ( k + 1 ) ) by A23,A30,FINSEQ_1:1;
then A34: (( z . i ) = ( f . ( abs ( i - 1 ) ) ) & i in ( dom z )) by A24,A27;
( 1 - 1 ) <= ( i - 1 ) by A33,XREAL_1:9;
then A35: ( 0 ) <= ( ( i - 1 ) * 1 );
thus ( z /. ( i + 1 ) ) = ( z . ( i + 1 ) ) by A23,A31,FINSEQ_4:15
.= ( f . ( abs ( ( i + 1 ) - 1 ) ) ) by A24,A27,A32
.= ( f . ( abs ( ( i - 1 ) + 1 ) ) )
.= ( f . ( ( abs ( i - 1 ) ) + ( abs 1 ) ) ) by A35,ABSVALUE:11
.= ( f . ( ( abs ( i - 1 ) ) + 1 ) ) by ABSVALUE:def 1
.= F(( f . ( abs ( i - 1 ) ) )) by A5
.= F(( z /. i )) by A34,PARTFUN1:def 6;
end;

thus F(( z /. ( len z ) )) = ( z /. ( len z ) )
proof
( k + 1 ) in ( NAT );
then ( k + 1 ) in ( dom f ) by FUNCT_2:def 1;
then ( f . ( k + 1 ) ) in ( rng f ) by FUNCT_1:def 3;
then A36: ( f . ( k + 1 ) ) c= ( f . k ) by A19,A21;
reconsider k9 = k as (Element of ( NAT )) by ORDINAL1:def 12;
k in ( NAT ) by ORDINAL1:def 12;
then A37: ( f . k ) c= ( f . ( k + 1 ) ) by A10;
(( len z ) = ( 0 ) or ( len z ) in ( Seg ( len z ) )) by FINSEQ_1:3;
then A38: ( len z ) in ( dom z ) by A23,FINSEQ_1:def 3;
A39: ( z . ( len z ) ) = ( f . ( abs ( ( k + 1 ) - 1 ) ) ) by A23,A24,A27,FINSEQ_1:3
.= ( f . k ) by ABSVALUE:def 1;
hence F(( z /. ( len z ) )) = F(( f . k9 )) by A38,PARTFUN1:def 6
.= ( f . ( k + 1 ) ) by A5
.= ( z . ( len z ) ) by A37,A36,A39,XBOOLE_0:def 10
.= ( z /. ( len z ) ) by A38,PARTFUN1:def 6;
end;

let i being (Element of ( NAT )),j being (Element of ( NAT ));
assume that
A40: ( 0 ) < i
and
A41: i < j
and
A42: j <= ( len z );
A43: ( ( 0 ) + 1 ) <= i by A40,NAT_1:13;
then reconsider l = ( i - 1 ) as (Element of ( NAT )) by INT_1:5;
A44: i <= ( len z ) by A41,A42,XXREAL_0:2;
then A45: i in ( Seg ( k + 1 ) ) by A23,A43,FINSEQ_1:1;
A46: ( z /. i ) = ( z . i ) by A43,A44,FINSEQ_4:15
.= ( f . ( abs ( i - 1 ) ) ) by A24,A27,A45
.= ( f . l ) by ABSVALUE:def 1;
hence ( z /. i ) c= A() by A9;
A47: (for i being (Element of ( NAT )) holds ((1 <= i & i < ( len z )) implies ( z /. i ) c= ( z /. ( i + 1 ) )))
proof
let i being (Element of ( NAT ));
assume that
A48: 1 <= i
and
A49: i < ( len z );
A50: i in ( Seg ( k + 1 ) ) by A23,A48,A49,FINSEQ_1:1;
A51: ( 1 - 1 ) <= ( i - 1 ) by A48,XREAL_1:9;
then A52: ( i - 1 ) is (Element of ( NAT )) by INT_1:3;
A53: (1 <= ( i + 1 ) & ( i + 1 ) <= ( len z )) by A48,A49,NAT_1:13;
then A54: ( i + 1 ) in ( Seg ( k + 1 ) ) by A23,FINSEQ_1:1;
A55: ( z /. ( i + 1 ) ) = ( z . ( i + 1 ) ) by A53,FINSEQ_4:15
.= ( f . ( abs ( ( i + 1 ) - 1 ) ) ) by A24,A27,A54
.= ( f . ( ( i - 1 ) + 1 ) ) by ABSVALUE:def 1;
( z /. i ) = ( z . i ) by A48,A49,FINSEQ_4:15
.= ( f . ( abs ( i - 1 ) ) ) by A24,A27,A50
.= ( f . ( i - 1 ) ) by A51,ABSVALUE:def 1;
hence thesis by A10,A55,A52;
end;
hence ( z /. i ) c= ( z /. j ) by A41,A42,A43,CKB1:1;
defpred P[ (Element of ( NAT )) ]
 means
(( i + $1 ) <= ( len z ) implies ( z /. i ) = ( z /. ( i + $1 ) ));
A56: (i <= ( i + 1 ) & ( i + 1 ) <= j) by A41,NAT_1:13;
( k + 1 ) in ( Seg ( k + 1 ) ) by FINSEQ_1:4;
then A57: ( k + 1 ) in ( dom z ) by A23,FINSEQ_1:def 3;
A58: i < ( len z ) by A41,A42,XXREAL_0:2;
assume ( z /. i ) = ( z /. j );
then A59: ( z /. i ) = ( z /. ( i + 1 ) ) by A42,A43,A47,A56,CKB2:1
.= F(( z /. i )) by A28,A40,A58;
A60:now
let n being (Element of ( NAT ));
assume that
A61: P[ n ];
thus P[ ( n + 1 ) ]
proof
assume ( i + ( n + 1 ) ) <= ( len z );
then ( ( i + n ) + 1 ) <= ( len z );
then ( i + n ) < ( len z ) by NAT_1:13;
hence ( z /. i ) = ( z /. ( ( i + n ) + 1 ) ) by A28,A40,A59,A61
.= ( z /. ( i + ( n + 1 ) ) );
end;

end;
consider n0 being Nat such that A62: ( i + n0 ) = ( len z ) by A41,A42,NAT_1:10,XXREAL_0:2;
reconsider n0 as (Element of ( NAT )) by ORDINAL1:def 12;
A63: ( i + n0 ) = ( len z ) by A62;
A64: P[ ( 0 ) ];
(for n being (Element of ( NAT )) holds P[ n ]) from NAT_1:sch 1(A64,A60);
then ( f . l ) = ( z /. ( k + 1 ) ) by A23,A46,A63
.= ( z . ( k + 1 ) ) by A57,PARTFUN1:def 6
.= ( f . ( abs ( ( k + 1 ) - 1 ) ) ) by A24,A27,FINSEQ_1:4
.= m by A21,ABSVALUE:def 1;
then k <= l by A22;
then ( len z ) <= ( l + 1 ) by A23,XREAL_1:6;
hence contradiction by A41,A42,XXREAL_0:2;
end;
