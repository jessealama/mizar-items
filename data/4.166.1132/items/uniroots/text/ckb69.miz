environ
vocabularies NUMBERS,SUBSET_1,XBOOLE_0,XXREAL_0,CARD_1,ARYTM_3,NAT_1,FINSEQ_1,RELAT_1,FUNCT_1,TARSKI,COMPLFLD,COMPLEX1,PARTFUN1,CARD_3,STRUCT_0,REAL_1,ORDINAL4,FINSET_1,UPROOTS,ARYTM_1,POLYNOM2,AFINSQ_1,GROUP_1,INT_1,HAHNBAN1,SQUARE_1,POWER,SIN_COS,BINOP_1,ALGSTR_0,FINSEQ_2,MOD_2,VECTSP_1,VECTSP_2,REALSET1,ZFMISC_1,SUPINF_2,COMPTRIG,RAT_1,PREPOWER,XREAL_0,ORDINAL1,NEWTON,XCMPLX_0,INT_2,BINOP_2,GROUP_2,POLYNOM1,POLYNOM3,FUNCT_4,ALGSEQ_1,VALUED_0,POLYNOM5,SGRAPH1,PRE_POLY,GRAPH_2,MESFUNC1,UNIROOTS;
notations TARSKI,XBOOLE_0,SUBSET_1,REALSET1,CARD_1,NUMBERS,XREAL_0,ZFMISC_1,XXREAL_0,COMPLEX1,REAL_1,SQUARE_1,INT_1,INT_2,NAT_1,NAT_D,PREPOWER,POWER,BINOP_1,RELAT_1,FUNCT_1,PARTFUN1,FUNCT_2,FINSEQ_1,RAT_1,DOMAIN_1,FINSET_1,BINOP_2,STRUCT_0,ALGSTR_0,VECTSP_2,VECTSP_1,GROUP_4,RVSUM_1,ALGSEQ_1,COMPLFLD,HAHNBAN1,POLYNOM3,POLYNOM4,POLYNOM5,COMPTRIG,GROUP_2,NEWTON,GROUP_1,MOD_2,GRAPH_2,ORDINAL1,PRE_POLY,FVSUM_1,UPROOTS,SIN_COS,FUNCT_7,FINSEQ_2,CKB21,CKB29,CKB48,CKB50,CKB63;
definitions TARSKI,GROUP_1,XBOOLE_0,BINOP_1,REALSET1,SQUARE_1,HAHNBAN1,POLYNOM3,FINSEQ_2,COMPLEX1,GROUP_4,ALGSTR_0,STRUCT_0,CKB21,CKB29,CKB48,CKB50,CKB63;
theorems GROUP_1,CARD_1,FINSEQ_1,ZFMISC_1,NAT_1,FUNCT_1,FUNCT_2,RELAT_1,TARSKI,XBOOLE_0,XBOOLE_1,VECTSP_1,PREPOWER,COMPTRIG,COMPLFLD,BINOP_1,XCMPLX_1,COMPLEX1,HAHNBAN1,SIN_COS,POWER,SIN_COS2,POLYNOM5,INT_1,COMPLEX2,XCMPLX_0,XREAL_0,SQUARE_1,RVSUM_1,FVSUM_1,FINSEQ_3,FINSEQ_2,FINSEQ_4,POLYNOM4,INT_2,WSIERP_1,NAT_2,PEPIN,POLYNOM3,COMPUT_1,NORMSP_1,FUNCT_7,ALGSEQ_1,RLVECT_1,NEWTON,POLYNOM2,MATRIX_3,VECTSP_2,MOD_2,CARD_2,GRAPH_2,FINSEQ_5,UPROOTS,GROUP_2,BINOP_2,XREAL_1,XXREAL_0,GROUP_4,FUNCOP_1,ORDINAL1,FINSOP_1,NAT_D,PARTFUN1,PRE_POLY,CKB1,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB21,CKB22,CKB23,CKB24,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67,CKB68;
schemes NAT_1,FUNCT_2,FINSEQ_1,INT_1,RECDEF_1,CKB2;
registrations RELAT_1,FUNCT_1,FINSET_1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,NAT_1,INT_1,BINOP_2,CARD_1,MEMBERED,FINSEQ_1,FINSEQ_2,REALSET1,WSIERP_1,STRUCT_0,GROUP_1,VECTSP_1,COMPLFLD,QUOFIELD,POLYNOM3,POLYNOM5,VALUED_0,ALGSTR_0,POWER,UPROOTS,FUNCT_2,RELSET_1,PRE_POLY,XBOOLE_0,ZFMISC_1,CKB19,CKB20,CKB25,CKB37,CKB38,CKB55;
constructors WELLORD2,BINOP_1,REAL_1,SQUARE_1,NAT_D,FINSEQOP,FINSOP_1,RVSUM_1,PREPOWER,POWER,REALSET1,SIN_COS,GROUP_4,MOD_2,MATRIX_2,HAHNBAN1,GRAPH_2,POLYNOM4,POLYNOM5,UPROOTS,SEQ_1,RECDEF_1,BINOP_2,RELSET_1,PBOOLE,FUNCT_7,POLYNOM1,NEWTON,FVSUM_1,CKB21,CKB29,CKB48,CKB50,CKB63;
requirements NUMERALS,BOOLE,SUBSET,ARITHM,REAL;
begin
theorem
Th57: (for n,ni being non empty (Element of ( NAT )) holds (for f being (FinSequence of (the carrier of ( Polynom-Ring ( F_Complex ) ))) holds (for s being  finite (Subset of ( F_Complex )) holds (((s = { y where y is (Element of ( MultGroup ( F_Complex ) )): ((( ord y ) divides n & (not ( ord y ) divides ni)) & ( ord y ) <> n) } & ( dom f ) = ( Seg n )) & (for i being non empty (Element of ( NAT )) holds (i in ( dom f ) implies (((((not i divides n) or i divides ni) or i = n) implies ( f . i ) = <% ( 1_ ( F_Complex ) ) %>) & (((i divides n & (not i divides ni)) & i <> n) implies ( f . i ) = ( cyclotomic_poly i )))))) implies ( Product f ) = ( poly_with_roots ( (s,1) -bag ) )))))
proof
set cMGFC = (the carrier of ( MultGroup ( F_Complex ) ));
set cPRFC = (the carrier of ( Polynom-Ring ( F_Complex ) ));
let n being non empty (Element of ( NAT )),ni being non empty (Element of ( NAT ));
let f being (FinSequence of cPRFC);
let s being  finite (Subset of ( F_Complex ));
assume that
A1: s = { y where y is (Element of cMGFC): ((( ord y ) divides n & (not ( ord y ) divides ni)) & ( ord y ) <> n) }
and
A2: ( dom f ) = ( Seg n )
and
A3: (for i being non empty (Element of ( NAT )) holds (i in ( dom f ) implies (((((not i divides n) or i divides ni) or i = n) implies ( f . i ) = <% ( 1_ ( F_Complex ) ) %>) & (((i divides n & (not i divides ni)) & i <> n) implies ( f . i ) = ( cyclotomic_poly i )))));
deffunc MG(Nat) = { y where y is (Element of cMGFC): (y in s & ( ord y ) <= $1) };
A4:now
let i being (Element of ( NAT ));
MG(i) c= s
proof
let x being set;
assume x in MG(i);
then (ex y being (Element of cMGFC) st ((x = y & y in s) & ( ord y ) <= i));
hence thesis;
end;
hence MG(i) is  finite  finite (Subset of ( F_Complex )) by XBOOLE_1:1;
end;
then reconsider sB = MG(n) as  finite (Subset of ( F_Complex ));
A5: ( len f ) = n by A2,FINSEQ_1:def 3;
defpred P[ Nat,set ]
 means
(for fi being (FinSequence of cPRFC) holds (fi = ( f | ( Seg $1 ) ) implies $2 = ( Product fi )));
A6:now
let i being Nat;
assume i in ( Seg ( len f ) );
reconsider fi = ( f | ( Seg i ) ) as (FinSequence of cPRFC) by FINSEQ_1:18;
set x = ( Product fi );
take x;
thus P[ i,x ];
end;
consider F being (FinSequence of cPRFC) such that ( dom F ) = ( Seg ( len f ) ) and A7: (for i being Nat holds (i in ( Seg ( len f ) ) implies P[ i,( F . i ) ])) from FINSEQ_1:sch 5(A6);
defpred R[ (Element of ( NAT )) ]
 means
(ex t being  finite (Subset of ( F_Complex )) st (t = MG($1) & ( F . $1 ) = ( poly_with_roots ( (t,1) -bag ) )));
A8: (for i being (Element of ( NAT )) holds ((1 <= i & i < ( len f )) implies (R[ i ] implies R[ ( i + 1 ) ])))
proof
let i being (Element of ( NAT ));
assume that
A9: 1 <= i
and
A10: i < ( len f )
and
A11: R[ i ];
reconsider fi = ( f | ( Seg i ) ) as (FinSequence of (the carrier of ( Polynom-Ring ( F_Complex ) ))) by FINSEQ_1:18;
i in ( Seg ( len f ) ) by A9,A10,FINSEQ_1:1;
then A12: ( F . i ) = ( Product fi ) by A7;
reconsider fi1 = ( f | ( Seg ( i + 1 ) ) ) as (FinSequence of (the carrier of ( Polynom-Ring ( F_Complex ) ))) by FINSEQ_1:18;
A13: ( i + 1 ) <= ( len f ) by A10,NAT_1:13;
then ( i + 1 ) = ( min (( i + 1 ),( len f )) ) by XXREAL_0:def 9;
then A14: ( len fi1 ) = ( i + 1 ) by FINSEQ_2:21;
reconsider sB = MG(( i + 1 )) as  finite (Subset of ( F_Complex )) by A4;
take sB;
thus sB = MG(( i + 1 ));
set B = ( (sB,1) -bag );
consider sb being  finite (Subset of ( F_Complex )) such that A15: sb = MG(i) and A16: ( F . i ) = ( poly_with_roots ( (sb,1) -bag ) ) by A11;
1 <= ( i + 1 ) by A9,NAT_1:13;
then A17: ( i + 1 ) in ( Seg ( len f ) ) by A13,FINSEQ_1:1;
then A18: ( i + 1 ) in ( dom f ) by FINSEQ_1:def 3;
A19: ( ( f | ( Seg ( i + 1 ) ) ) . ( i + 1 ) ) = ( f . ( i + 1 ) ) by FINSEQ_1:4,FUNCT_1:49;
then reconsider fi1d1 = ( fi1 . ( i + 1 ) ) as (Element of (the carrier of ( Polynom-Ring ( F_Complex ) ))) by A18,FINSEQ_2:11;
reconsider fi1d1p = fi1d1 as (Polynomial of ( F_Complex )) by POLYNOM3:def 10;
A20: ( F . ( i + 1 ) ) = ( Product fi1 ) by A7,A17;
set b = ( (sb,1) -bag );
fi = ( fi1 | ( Seg i ) ) by CKB4:1,NAT_1:12;
then fi1 = ( fi ^ <* fi1d1 *> ) by A14,FINSEQ_3:55;
then ( Product fi1 ) = ( ( Product fi ) * fi1d1 ) by GROUP_4:6;
then A21: ( Product fi1 ) = ( ( poly_with_roots b ) *' fi1d1p ) by A12,A16,POLYNOM3:def 10;
per cases ;
suppose A22: (((not ( i + 1 ) divides n) or ( i + 1 ) divides ni) or ( i + 1 ) = n);

A23:now
let x being set;
hereby
assume x in sB;
then consider y being (Element of ( MultGroup ( F_Complex ) )) such that A24: x = y and A25: y in s and A26: ( ord y ) <= ( i + 1 );
(ex y1 being (Element of cMGFC) st (((y = y1 & ( ord y1 ) divides n) & (not ( ord y1 ) divides ni)) & ( ord y1 ) <> n)) by A1,A25;
then ( ord y ) < ( i + 1 ) by A22,A26,XXREAL_0:1;
then ( ord y ) <= i by NAT_1:13;
hence x in sb by A15,A24,A25;
end;
assume x in sb;
then consider y being (Element of ( MultGroup ( F_Complex ) )) such that A27: (x = y & y in s) and A28: ( ord y ) <= i by A15;
( ord y ) <= ( i + 1 ) by A28,NAT_1:12;
hence x in sB by A27;
end;
( f . ( i + 1 ) ) = <% ( 1_ ( F_Complex ) ) %> by A3,A18,A22;
then ( F . ( i + 1 ) ) = ( poly_with_roots b ) by A20,A19,A21,UPROOTS:32
.= ( poly_with_roots B ) by A23,TARSKI:1;
hence thesis;
end;
suppose A29: ((( i + 1 ) divides n & (not ( i + 1 ) divides ni)) & ( i + 1 ) <> n);

consider scb being non empty  finite (Subset of ( F_Complex )) such that A30: scb = { y where y is (Element of cMGFC): ( ord y ) = ( i + 1 ) } and A31: ( cyclotomic_poly ( i + 1 ) ) = ( poly_with_roots ( (scb,1) -bag ) ) by CKB63:def 1;
now
let x being set;
hereby
assume x in sB;
then consider y being (Element of cMGFC) such that A32: x = y and A33: y in s and A34: ( ord y ) <= ( i + 1 );
(( ord y ) <= i or ( ord y ) = ( i + 1 )) by A34,NAT_1:8;
then (y in sb or y in scb) by A15,A30,A33;
hence x in ( sb \/ scb ) by A32,XBOOLE_0:def 3;
end;
assume A35: x in ( sb \/ scb );
per cases  by A35,XBOOLE_0:def 3;
suppose x in sb;

then consider y being (Element of cMGFC) such that A36: (x = y & y in s) and A37: ( ord y ) <= i by A15;
( ord y ) <= ( i + 1 ) by A37,NAT_1:12;
hence x in sB by A36;
end;
suppose x in scb;

then consider y being (Element of cMGFC) such that A38: x = y and A39: ( ord y ) = ( i + 1 ) by A30;
y in s by A1,A29,A39;
hence x in sB by A38,A39;
end;
end;
then A40: sB = ( sb \/ scb ) by TARSKI:1;
set cb = ( (scb,1) -bag );
A41: sb misses scb
proof
assume ( sb /\ scb ) <> ( {} );
then consider x being set such that A42: x in ( sb /\ scb ) by XBOOLE_0:def 1;
x in scb by A42,XBOOLE_0:def 4;
then A43: (ex y2 being (Element of cMGFC) st (x = y2 & ( ord y2 ) = ( i + 1 ))) by A30;
x in sb by A42,XBOOLE_0:def 4;
then (ex y1 being (Element of cMGFC) st ((x = y1 & y1 in s) & ( ord y1 ) <= i)) by A15;
hence contradiction by A43,NAT_1:13;
end;
( f . ( i + 1 ) ) = ( poly_with_roots cb ) by A3,A18,A29,A31;
then ( F . ( i + 1 ) ) = ( ( poly_with_roots b ) *' ( poly_with_roots cb ) ) by A7,A17,A19,A21
.= ( poly_with_roots ( b + cb ) ) by UPROOTS:64
.= ( poly_with_roots B ) by A40,A41,UPROOTS:10;
hence thesis;
end;
end;
now
let x being set;
hereby
assume A44: x in s;
then consider y being (Element of ( MultGroup ( F_Complex ) )) such that A45: x = y and A46: ( ord y ) divides n and (not ( ord y ) divides ni) and ( ord y ) <> n by A1;
( ord y ) <= n by A46,NAT_D:7;
hence x in sB by A44,A45;
end;
assume x in sB;
then (ex y being (Element of ( MultGroup ( F_Complex ) )) st ((y = x & y in s) & ( ord y ) <= n));
hence x in s;
end;
then A47: s = sB by TARSKI:1;
A48: ( ( 0 ) + 1 ) <= n by NAT_1:13;
A49: R[ 1 ]
proof
reconsider t = MG(1) as  finite (Subset of ( F_Complex )) by A4;
take t;
thus t = MG(1);
reconsider f1 = ( f | ( Seg 1 ) ) as (FinSequence of cPRFC) by FINSEQ_1:18;
A50: 1 in ( dom f ) by A5,A48,FINSEQ_3:25;
A51: 1 divides ni by NAT_D:6;
now
assume t is non empty;
then consider x being set such that A52: x in t by XBOOLE_0:def 1;
consider y being (Element of cMGFC) such that x = y and A53: y in s and A54: ( ord y ) <= 1 by A52;
consider y1 being (Element of cMGFC) such that A55: y = y1 and A56: ( ord y1 ) divides n and A57: (not ( ord y1 ) divides ni) and ( ord y1 ) <> n by A1,A53;
now
assume ( ord y1 ) = ( 0 );
then (ex u being Nat st n = ( ( 0 ) * u )) by A56,NAT_D:def 3;
hence contradiction;
end;
then ( ( 0 ) + 1 ) <= ( ord y1 ) by NAT_1:13;
hence contradiction by A51,A54,A55,A57,XXREAL_0:1;
end;
then A58: ( (t,1) -bag ) = ( EmptyBag (the carrier of ( F_Complex )) ) by UPROOTS:9;
A59: 1 in ( Seg ( len f ) ) by A5,A48,FINSEQ_1:1;
then 1 in ( dom f ) by FINSEQ_1:def 3;
then reconsider fd1 = ( f . 1 ) as (Element of cPRFC) by FINSEQ_2:11;
f1 = <* ( f . 1 ) *> by A5,A48,CKB3:1;
then ( F . 1 ) = ( Product <* fd1 *> ) by A7,A59
.= fd1 by FINSOP_1:11
.= <% ( 1_ ( F_Complex ) ) %> by A3,A50,A51;
hence thesis by A58,UPROOTS:60;
end;
(for i being (Element of ( NAT )) holds ((1 <= i & i <= ( len f )) implies R[ i ])) from INT_1:sch 7(A49,A8);
then (f = ( f | ( Seg ( len f ) ) ) & (ex S being  finite (Subset of ( F_Complex )) st (S = MG(( len f )) & ( F . ( len f ) ) = ( poly_with_roots ( (S,1) -bag ) )))) by A5,A48,FINSEQ_3:49;
hence thesis by A5,A7,A47,FINSEQ_1:3;
end;
