environ
vocabularies NUMBERS,NAT_1,VECTSP_1,SUBSET_1,XBOOLE_0,MATRIX_1,FINSEQ_1,ALGSTR_0,RELAT_1,ARYTM_3,TARSKI,STRUCT_0,ZFMISC_1,ORDINAL4,XXREAL_0,FUNCT_1,PARTFUN1,FINSEQ_3,CARD_1,ARYTM_1,FINSEQ_2,CARD_3,GROUP_1,RFINSEQ,TREES_1,INCSP_1,MATRIX_2,MATRIX_3,SUPINF_2,LAPLACE,MATRIX11,MESFUNC1,RVSUM_1,MATHMORP,VALUED_1,FVSUM_1,MATRIXJ1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,CARD_1,XCMPLX_0,ALGSTR_0,XXREAL_0,NAT_1,RELAT_1,FUNCT_1,PARTFUN1,FINSEQ_1,STRUCT_0,RLVECT_1,GROUP_1,VECTSP_1,FINSEQ_2,MATRIX_1,MATRIX_2,FVSUM_1,NAT_D,BINARITH,GROUP_4,MATRIX_3,MATRIX11,FINSEQOP,MATRIX13,LAPLACE,RFINSEQ,WSIERP_1,CKB7,CKB15,CKB17,CKB18,CKB20,CKB21,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB42,CKB43;
definitions TARSKI,FINSEQ_1,MATRIX_1,LAPLACE,MATRIX13,FVSUM_1,CKB7,CKB15,CKB27,CKB28,CKB42;
theorems CARD_2,FINSEQ_1,FINSEQ_2,FINSEQ_3,FINSEQ_5,FINSEQ_6,FINSEQOP,FUNCT_1,FVSUM_1,GROUP_1,GROUP_4,GOBOARD1,LAPLACE,MATRIX_1,MATRIX_2,MATRIX_3,MATRIX_9,MATRIX11,MATRIX13,MATRIX15,MATRIXR2,NAT_1,ORDINAL1,PARTFUN1,POLYNOM3,PRGCOR_1,RELAT_1,RFINSEQ,RLVECT_1,RVSUM_1,TARSKI,VECTSP_1,XBOOLE_0,XBOOLE_1,XREAL_1,XXREAL_0,ZFMISC_1,MATRIX_4,FUNCT_2,FUNCOP_1,MATRIXR1,CARD_1,NAT_D,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB19,CKB22,CKB27,CKB28,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58;
schemes FINSEQ_1,FINSEQ_2,NAT_1,MATRIX_1;
registrations XBOOLE_0,FINSET_1,STRUCT_0,VECTSP_1,ORDINAL1,XXREAL_0,NAT_1,FINSEQ_1,RELAT_1,FINSEQ_2,MATRIX13,XREAL_0,VALUED_0,CARD_1,FVSUM_1,CKB16;
constructors XXREAL_0,GROUP_4,VECTSP_7,MATRIX11,MATRIX13,LAPLACE,RFINSEQ,POLYNOM1,WSIERP_1,SEQ_1,VALUED_0,VALUED_1,REAL_1,NAT_D,BINARITH,RELSET_1,FVSUM_1,CKB7,CKB15,CKB20,CKB21,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB42,CKB43;
requirements ARITHM,NUMERALS,REAL,BOOLE,SUBSET;
begin
reserve i for Nat;
reserve m for Nat;
reserve D for non empty set;
reserve d for (Element of D);
reserve F for (FinSequence_of_Matrix of D);
theorem
((i in ( Seg ( Sum ( Len F ) ) ) & m = ( min (( Len F ),i) )) implies ( Line (( block_diagonal (F,d) ),i) ) = ( ( ( ( Sum ( Width ( F | ( m -' 1 ) ) ) ) |-> d ) ^ ( Line (( F . m ),( i -' ( Sum ( Len ( F | ( m -' 1 ) ) ) ) )) ) ) ^ ( ( ( Sum ( Width F ) ) -' ( Sum ( Width ( F | m ) ) ) ) |-> d ) ))
proof
assume that
A1: i in ( Seg ( Sum ( Len F ) ) )
and
A2: m = ( min (( Len F ),i) );
set L = ( Len F );
A3: ( ( L | m ) . m ) = ( L . m ) by FINSEQ_3:112;
set BF9m = ( block_diagonal (( F /^ m ),d) );
set BFm = ( block_diagonal (( F | m ),d) );
A4: ( len BFm ) = ( Sum ( Len ( F | m ) ) ) by CKB42:def 1
.= ( Sum ( L | m ) ) by CKB36:1;
F = ( ( F | m ) ^ ( F /^ m ) ) by RFINSEQ:8;
then A5: ( block_diagonal (F,d) ) = ( block_diagonal (( ( F | m ) ^ <* BF9m *> ),d) ) by CKB58:1
.= ( block_diagonal (<* BFm,BF9m *>,d) ) by CKB57:1;
then ( Sum ( Width F ) ) = ( width ( block_diagonal (<* BFm,BF9m *>,d) ) ) by CKB42:def 1
.= ( Sum ( Width <* BFm,BF9m *> ) ) by CKB42:def 1
.= ( ( width BFm ) + ( width BF9m ) ) by CKB40:1
.= ( ( Sum ( Width ( F | m ) ) ) + ( width BF9m ) ) by CKB42:def 1;
then A6: ( ( Sum ( Width F ) ) -' ( Sum ( Width ( F | m ) ) ) ) = ( ( ( Sum ( Width ( F | m ) ) ) + ( width BF9m ) ) - ( Sum ( Width ( F | m ) ) ) ) by NAT_1:11,XREAL_1:233
.= ( width BF9m );
( Sum ( L | ( m -' 1 ) ) ) < i by A1,A2,CKB9:1;
then A7: ( i - ( Sum ( L | ( m -' 1 ) ) ) ) = ( i -' ( Sum ( L | ( m -' 1 ) ) ) ) by XREAL_1:233;
A8: m in ( dom L ) by A1,A2,CKB7:def 1;
then 1 <= m by FINSEQ_3:25;
then ( m -' 1 ) = ( m - 1 ) by XREAL_1:233;
then A9: m = ( ( m -' 1 ) + 1 );
then ( m -' 1 ) <= m by NAT_1:11;
then A10: ( Seg ( m -' 1 ) ) c= ( Seg m ) by FINSEQ_1:5;
then A11: ( ( F | m ) | ( m -' 1 ) ) = ( F | ( m -' 1 ) ) by RELAT_1:74;
m <= ( len L ) by A8,FINSEQ_3:25;
then ( len ( L | m ) ) = m by FINSEQ_1:59;
then A12: ( L | m ) = ( ( ( L | m ) | ( m -' 1 ) ) ^ <* ( ( L | m ) . m ) *> ) by A9,FINSEQ_3:55;
( ( L | m ) | ( m -' 1 ) ) = ( L | ( m -' 1 ) ) by A10,RELAT_1:74;
then ( Sum ( L | m ) ) = ( ( Sum ( L | ( m -' 1 ) ) ) + ( L . m ) ) by A12,A3,RVSUM_1:74
.= ( ( Sum ( L | ( m -' 1 ) ) ) + ( len ( F . m ) ) ) by A8,CKB27:def 1;
then ( ( len ( F . m ) ) + ( Sum ( L | ( m -' 1 ) ) ) ) >= ( ( i -' ( Sum ( L | ( m -' 1 ) ) ) ) + ( Sum ( L | ( m -' 1 ) ) ) ) by A1,A2,A7,CKB7:def 1;
then A13: ( len ( F . m ) ) >= ( i -' ( Sum ( L | ( m -' 1 ) ) ) ) by XREAL_1:6;
( i - ( Sum ( L | ( m -' 1 ) ) ) ) <> ( 0 ) by A1,A2,CKB9:1;
then ( i -' ( Sum ( L | ( m -' 1 ) ) ) ) >= 1 by A7,NAT_1:14;
then A14: ( i -' ( Sum ( L | ( m -' 1 ) ) ) ) in ( dom ( F . m ) ) by A13,FINSEQ_3:25;
set BFm1 = ( block_diagonal (( F | ( m -' 1 ) ),d) );
A15: ( ( F | m ) . m ) = ( F . m ) by FINSEQ_3:112;
A16: ( width BFm1 ) = ( Sum ( Width ( F | ( m -' 1 ) ) ) ) by CKB42:def 1
.= ( Sum ( ( Width F ) | ( m -' 1 ) ) ) by CKB41:1;
A17: 1 <= i by A1,FINSEQ_1:1;
i <= ( Sum ( L | m ) ) by A1,A2,CKB7:def 1;
then i in ( dom BFm ) by A17,A4,FINSEQ_3:25;
then A18: ( Line (( block_diagonal (F,d) ),i) ) = ( ( Line (BFm,i) ) ^ ( ( width BF9m ) |-> d ) ) by A5,CKB45:1;
( dom L ) = ( dom F ) by CKB27:def 1;
then m <= ( len F ) by A8,FINSEQ_3:25;
then ( len ( F | m ) ) = m by FINSEQ_1:59;
then ( F | m ) = ( ( ( F | m ) | ( m -' 1 ) ) ^ <* ( ( F | m ) . m ) *> ) by A9,FINSEQ_3:55;
then A19: BFm = ( block_diagonal (<* BFm1,( F . m ) *>,d) ) by A15,A11,CKB57:1;
( len BFm1 ) = ( Sum ( Len ( F | ( m -' 1 ) ) ) ) by CKB42:def 1
.= ( Sum ( L | ( m -' 1 ) ) ) by CKB36:1;
then ( ( ( Sum ( ( Width F ) | ( m -' 1 ) ) ) |-> d ) ^ ( Line (( F . m ),( i -' ( Sum ( L | ( m -' 1 ) ) ) )) ) ) = ( Line (BFm,( ( Sum ( L | ( m -' 1 ) ) ) + ( i -' ( Sum ( L | ( m -' 1 ) ) ) ) )) ) by A14,A16,A19,CKB45:1
.= ( Line (BFm,i) ) by A7;
then ( Line (BFm,i) ) = ( ( ( Sum ( Width ( F | ( m -' 1 ) ) ) ) |-> d ) ^ ( Line (( F . m ),( i -' ( Sum ( L | ( m -' 1 ) ) ) )) ) ) by CKB41:1;
hence thesis by A6,A18,CKB36:1;
end;
