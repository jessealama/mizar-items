environ
vocabularies XBOOLE_0,STRUCT_0,MSUALG_1,RELAT_1,PBOOLE,MSAFREE,MSUALG_3,REALSET1,MEMBER_1,FUNCT_6,TARSKI,FUNCT_1,WELLORD1,MSUALG_2,PRALG_2,CARD_3,SUBSET_1,MSUALG_5,MSUALG_4,FUNCOP_1,RLVECT_2,PRALG_1,EQREL_1,CLOSURE2,SETFAM_1,FUNCT_4,ZFMISC_1,GROUP_6,NUMBERS,EQUATION,ZF_MODEL,ZF_LANG,MCART_1,PZFMISC1,MSAFREE2,FINSET_1,BIRKHOFF;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,SETFAM_1,RELAT_1,MCART_1,STRUCT_0,FUNCT_1,PBOOLE,RELSET_1,PARTFUN1,FUNCT_2,FINSET_1,CARD_3,FUNCT_6,FUNCOP_1,MSUALG_1,MSUALG_2,PRALG_3,MSUALG_3,MSAFREE,MSAFREE2,PRALG_2,MSUALG_4,PZFMISC1,MSSUBFAM,CLOSURE2,MSUALG_5,EQUATION,CKB1;
definitions FUNCT_1,RELAT_1,TARSKI,PBOOLE,MSUALG_3,PRALG_2,MSUALG_4,EQUATION,FUNCOP_1,PZFMISC1,CKB1;
theorems AUTALG_1,CARD_3,CLOSURE2,EXTENS_1,FUNCOP_1,FUNCT_1,FUNCT_2,MCART_1,MSAFREE,MSAFREE2,MSSCYC_1,MSSUBFAM,MSUALG_2,MSUALG_3,MSUALG_4,MSUALG_5,MSUALG_7,MSUALG_9,PBOOLE,PRALG_2,PRALG_3,EQUATION,RELAT_1,ZFMISC_1,SETFAM_1,PARTFUN1,CKB1,CKB2;
schemes DOMAIN_1,PBOOLE,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13;
registrations XBOOLE_0,ORDINAL1,RELSET_1,FUNCT_2,FUNCOP_1,PBOOLE,STRUCT_0,MSUALG_1,MSUALG_2,MSUALG_4,MSAFREE1,MSAFREE2,EXTENS_1,MSUALG_5,CLOSURE2,PRALG_3,MSUALG_9,EQUATION,MSSUBFAM,AUTALG_1;
constructors SETFAM_1,BINOP_1,PZFMISC1,MSSUBFAM,MSUALG_3,MSAFREE2,MSUALG_5,CLOSURE2,PRALG_3,EQUATION,RELSET_1,CKB1;
requirements SUBSET,BOOLE;
begin
scheme Birkhoff { S() -> non  empty non  void ManySortedSign,P[set] } : (ex E being (EqualSet of S()) st (for A being  non-empty MSAlgebra over S() holds (P[ A ] iff A |= E)))
provided
A1: (for A,B being  non-empty MSAlgebra over S() holds ((A,B are_isomorphic  & P[ A ]) implies P[ B ]))
and
A2: (for A being  non-empty MSAlgebra over S() holds (for B being  strict  non-empty (MSSubAlgebra of A) holds (P[ A ] implies P[ B ])))
and
A3: (for A being  non-empty MSAlgebra over S() holds (for R being (MSCongruence of A) holds (P[ A ] implies P[ ( QuotMSAlg (A,R) ) ])))
and
A4: (for I being set holds (for F being (MSAlgebra-Family of I,S()) holds ((for i being set holds (i in I implies (ex A being MSAlgebra over S() st (A = ( F . i ) & P[ A ])))) implies P[ ( product F ) ])))
proof
A5: (for A being  non-empty MSAlgebra over S() holds (for B being  strict  non-empty (MSSubAlgebra of A) holds (P[ A ] implies P[ B ]))) by A2;
set XX = ( (the carrier of S()) --> ( NAT ) );
set I = (the carrier of S());
defpred R[ set,set ]
 means
(ex s being (SortSymbol of S()) st ($1 = s & $2 = { e where e is (Element of ( ( Equations S() ) . s )): (for A being  non-empty MSAlgebra over S() holds (P[ A ] implies A |= e)) }));
A6:now
let w being set;
assume w in I;
then consider s being (SortSymbol of S()) such that A7: s = w;
take d = { e where e is (Element of ( ( Equations S() ) . s )): (for A being  non-empty MSAlgebra over S() holds (P[ A ] implies A |= e)) };
thus R[ w,d ] by A7;
end;
consider E being (ManySortedSet of I) such that A8: (for i being set holds (i in I implies R[ i,( E . i ) ])) from PBOOLE:sch 3(A6);
E is (ManySortedSubset of ( Equations S() ))
proof
let j being set;
assume j in I;
then consider s being (SortSymbol of S()) such that A9: j = s and A10: ( E . j ) = { e where e is (Element of ( ( Equations S() ) . s )): (for A being  non-empty MSAlgebra over S() holds (P[ A ] implies A |= e)) } by A8;
let q being set;
assume q in ( E . j );
then (ex z being (Element of ( ( Equations S() ) . s )) st (q = z & (for A being  non-empty MSAlgebra over S() holds (P[ A ] implies A |= z)))) by A10;
hence thesis by A9;
end;
then reconsider E as (EqualSet of S());
A11: (for A,B being  non-empty MSAlgebra over S() holds ((A,B are_isomorphic  & P[ A ]) implies P[ B ])) by A1;
defpred Q[ MSAlgebra over S() ]
 means
$1 |= E;
A12: (for D being  non-empty MSAlgebra over S() holds (Q[ D ] iff (for s being (SortSymbol of S()) holds (for e being (Element of ( ( Equations S() ) . s )) holds ((for M being  non-empty MSAlgebra over S() holds (P[ M ] implies M |= e)) implies D |= e)))))
proof
let D being  non-empty MSAlgebra over S();
thus (Q[ D ] implies (for s being (SortSymbol of S()) holds (for e being (Element of ( ( Equations S() ) . s )) holds ((for B being  non-empty MSAlgebra over S() holds (P[ B ] implies B |= e)) implies D |= e))))
proof
assume A13: Q[ D ];
let s being (SortSymbol of S());
let e being (Element of ( ( Equations S() ) . s ));
assume that
A14: (for B being  non-empty MSAlgebra over S() holds (P[ B ] implies B |= e));
R[ s,( E . s ) ] by A8;
then e in ( E . s ) by A14;
hence thesis by A13,EQUATION:def 6;
end;

assume A15: (for s being (SortSymbol of S()) holds (for e being (Element of ( ( Equations S() ) . s )) holds ((for B being  non-empty MSAlgebra over S() holds (P[ B ] implies B |= e)) implies D |= e)));
let s being (SortSymbol of S());
let e being (Element of ( ( Equations S() ) . s ));
assume that
A16: e in ( E . s );
R[ s,( E . s ) ] by A8;
then (ex f being (Element of ( ( Equations S() ) . s )) st (e = f & (for A being  non-empty MSAlgebra over S() holds (P[ A ] implies A |= f)))) by A16;
hence thesis by A15;
end;
A17: (for A being  non-empty MSAlgebra over S() holds (for B being  strict  non-empty (MSSubAlgebra of A) holds (Q[ A ] implies Q[ B ]))) by EQUATION:32;
A18: (for I being set holds (for F being (MSAlgebra-Family of I,S()) holds ((for i being set holds (i in I implies (ex A being MSAlgebra over S() st (A = ( F . i ) & Q[ A ])))) implies Q[ ( product F ) ]))) by EQUATION:38;
A19: (for A,B being  non-empty MSAlgebra over S() holds (A,B are_isomorphic  implies (Q[ A ] implies Q[ B ]))) by EQUATION:34;
consider K being  strict  non-empty MSAlgebra over S(),F being (ManySortedFunction of XX,(the Sorts of K)) such that A20: Q[ K ] and A21: (for B being  non-empty MSAlgebra over S() holds (for G being (ManySortedFunction of XX,(the Sorts of B)) holds (Q[ B ] implies (ex H being (ManySortedFunction of K,B) st ((H is_homomorphism K,B & ( H ** F ) = G) & (for W being (ManySortedFunction of K,B) holds ((W is_homomorphism K,B & ( W ** F ) = G) implies H = W))))))) from CKB4:sch 1(A19,A17,A18);
A22: (for M being  non-empty MSAlgebra over S() holds (for G being (ManySortedFunction of ( (the carrier of S()) --> ( NAT ) ),(the Sorts of M)) holds (Q[ M ] implies (ex H being (ManySortedFunction of K,M) st (H is_homomorphism K,M & G = ( H ** F ))))))
proof
let M being  non-empty MSAlgebra over S();
let G being (ManySortedFunction of ( (the carrier of S()) --> ( NAT ) ),(the Sorts of M));
assume Q[ M ];
then (ex H being (ManySortedFunction of K,M) st ((H is_homomorphism K,M & ( H ** F ) = G) & (for W being (ManySortedFunction of K,M) holds ((W is_homomorphism K,M & ( W ** F ) = G) implies H = W)))) by A21;
hence (ex H being (ManySortedFunction of K,M) st (H is_homomorphism K,M & ( H ** F ) = G));
end;
A23: (for I being set holds (for F being (MSAlgebra-Family of I,S()) holds ((for i being set holds (i in I implies (ex A being MSAlgebra over S() st (A = ( F . i ) & P[ A ])))) implies P[ ( product F ) ]))) by A4;
take E;
let A being  non-empty MSAlgebra over S();
hereby
assume A24: P[ A ];
thus A |= E
proof
let s1 being (SortSymbol of S());
A25: R[ s1,( E . s1 ) ] by A8;
let e being (Element of ( ( Equations S() ) . s1 ));
assume e in ( E . s1 );
then consider x being (Element of ( ( Equations S() ) . s1 )) such that A26: e = x and A27: (for A being  non-empty MSAlgebra over S() holds (P[ A ] implies A |= x)) by A25;
A28: A |= x by A24,A27;
let h being (ManySortedFunction of ( TermAlg S() ),A);
assume h is_homomorphism ( TermAlg S() ),A;
hence thesis by A26,A28,EQUATION:def 5;
end;

end;
assume A29: A |= E;
A30: (for A being  non-empty MSAlgebra over S() holds (for R being (MSCongruence of A) holds (P[ A ] implies P[ ( QuotMSAlg (A,R) ) ]))) by A3;
A31: Q[ K ] by A20;
A32: P[ K ] from CKB13:sch 1(A12,A21,A31,A11,A5,A23);
A33: (for B being  strict  non-empty  finitely-generated (MSSubAlgebra of A) holds P[ B ])
proof
let B being  strict  non-empty  finitely-generated (MSSubAlgebra of A);
A34: Q[ B ] by A29,EQUATION:32;
thus P[ B ] from CKB9:sch 1(A34,A32,A22,A11,A30);
end;
thus P[ A ] from CKB11:sch 1(A33,A11,A5,A30,A23);
end;
