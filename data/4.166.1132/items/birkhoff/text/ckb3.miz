environ
vocabularies XBOOLE_0,STRUCT_0,MSUALG_1,RELAT_1,PBOOLE,MSAFREE,MSUALG_3,REALSET1,MEMBER_1,FUNCT_6,TARSKI,FUNCT_1,WELLORD1,MSUALG_2,PRALG_2,CARD_3,SUBSET_1,MSUALG_5,MSUALG_4,FUNCOP_1,RLVECT_2,PRALG_1,EQREL_1,CLOSURE2,SETFAM_1,FUNCT_4,ZFMISC_1,GROUP_6,NUMBERS,EQUATION,ZF_MODEL,ZF_LANG,MCART_1,PZFMISC1,MSAFREE2,FINSET_1,BIRKHOFF;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,SETFAM_1,RELAT_1,MCART_1,STRUCT_0,FUNCT_1,PBOOLE,RELSET_1,PARTFUN1,FUNCT_2,FINSET_1,CARD_3,FUNCT_6,FUNCOP_1,MSUALG_1,MSUALG_2,PRALG_3,MSUALG_3,MSAFREE,MSAFREE2,PRALG_2,MSUALG_4,PZFMISC1,MSSUBFAM,CLOSURE2,MSUALG_5,EQUATION,CKB1;
definitions FUNCT_1,RELAT_1,TARSKI,PBOOLE,MSUALG_3,PRALG_2,MSUALG_4,EQUATION,FUNCOP_1,PZFMISC1,CKB1;
theorems AUTALG_1,CARD_3,CLOSURE2,EXTENS_1,FUNCOP_1,FUNCT_1,FUNCT_2,MCART_1,MSAFREE,MSAFREE2,MSSCYC_1,MSSUBFAM,MSUALG_2,MSUALG_3,MSUALG_4,MSUALG_5,MSUALG_7,MSUALG_9,PBOOLE,PRALG_2,PRALG_3,EQUATION,RELAT_1,ZFMISC_1,SETFAM_1,PARTFUN1,CKB1,CKB2;
schemes DOMAIN_1,PBOOLE;
registrations XBOOLE_0,ORDINAL1,RELSET_1,FUNCT_2,FUNCOP_1,PBOOLE,STRUCT_0,MSUALG_1,MSUALG_2,MSUALG_4,MSAFREE1,MSAFREE2,EXTENS_1,MSUALG_5,CLOSURE2,PRALG_3,MSUALG_9,EQUATION,MSSUBFAM,AUTALG_1;
constructors SETFAM_1,BINOP_1,PZFMISC1,MSSUBFAM,MSUALG_3,MSAFREE2,MSUALG_5,CLOSURE2,PRALG_3,EQUATION,RELSET_1,CKB1;
requirements SUBSET,BOOLE;
begin
scheme ExFreeAlg1 { S() -> non empty non void ManySortedSign,X() ->  non-empty MSAlgebra over S(),P[set] } : (ex A being  strict  non-empty MSAlgebra over S() st (ex F being (ManySortedFunction of X(),A) st ((P[ A ] & F is_epimorphism X(),A) & (for B being  non-empty MSAlgebra over S() holds (for G being (ManySortedFunction of X(),B) holds ((G is_homomorphism X(),B & P[ B ]) implies (ex H being (ManySortedFunction of A,B) st ((H is_homomorphism A,B & ( H ** F ) = G) & (for K being (ManySortedFunction of A,B) holds (( K ** F ) = G implies H = K))))))))))
provided
A1: (for A,B being  non-empty MSAlgebra over S() holds ((A,B are_isomorphic  & P[ A ]) implies P[ B ]))
and
A2: (for A being  non-empty MSAlgebra over S() holds (for B being  strict  non-empty (MSSubAlgebra of A) holds (P[ A ] implies P[ B ])))
and
A3: (for I being set holds (for F being (MSAlgebra-Family of I,S()) holds ((for i being set holds (i in I implies (ex A being MSAlgebra over S() st (A = ( F . i ) & P[ A ])))) implies P[ ( product F ) ])))
proof
set EMF = the (MSAlgebra-Family of ( {} ),S());
set CC = { C where C is (Element of ( CongrLatt X() )): (ex R being (MSCongruence of X()) st (R = C & P[ ( QuotMSAlg (X(),R) ) ])) };
set SF = (the Sorts of X());
set I = (the carrier of S());
consider Xi being (ManySortedSet of I) such that A4: { Xi } = ( I --> { ( {} ) } ) by MSUALG_9:5;
now
let i being set;
assume i in I;
then reconsider s = i as (SortSymbol of S());
thus ( (the Sorts of ( product EMF )) . i ) = ( product ( Carrier (EMF,s) ) ) by PRALG_2:def 10
.= { ( {} ) } by CARD_3:10,PRALG_2:def 9
.= ( ( I --> { ( {} ) } ) . s ) by FUNCOP_1:7
.= ( { Xi } . i ) by A4;
end;
then A5: (the Sorts of ( product EMF )) = { Xi } by PBOOLE:3;
reconsider R = [| SF,SF |] as (MSCongruence of X()) by MSUALG_5:18;
[| SF,SF |] is (MSCongruence of X()) by MSUALG_5:18;
then A6: [| SF,SF |] is (Element of ( CongrLatt X() )) by MSUALG_5:def 6;
(the Sorts of ( QuotMSAlg (X(),R) )) = { SF } by MSUALG_9:29;
then A7: ( QuotMSAlg (X(),R) ),( Trivial_Algebra S() ) are_isomorphic  by MSUALG_9:26;
(for i being set holds (i in ( {} ) implies (ex A being MSAlgebra over S() st (A = ( EMF . i ) & P[ A ]))));
then P[ ( product EMF ) ] by A3;
then P[ ( Trivial_Algebra S() ) ] by A1,A5,MSUALG_9:26;
then P[ ( QuotMSAlg (X(),R) ) ] by A1,A7,MSUALG_3:17;
then A8: [| SF,SF |] in CC by A6;
defpred P[ set,set ]
 means
(ex R being (MSCongruence of X()) st (R = $1 & $2 = ( QuotMSAlg (X(),R) )));
defpred P1[ set ]
 means
(ex R being (MSCongruence of X()) st (R = $1 & P[ ( QuotMSAlg (X(),R) ) ]));
A9:now
let q being set;
assume q in CC;
then (ex C being (Element of ( CongrLatt X() )) st (q = C & (ex R being (MSCongruence of X()) st (R = C & P[ ( QuotMSAlg (X(),R) ) ]))));
hence q is (MSCongruence of X());
end;
A10: CC c= (the carrier of ( EqRelLatt SF ))
proof
let q being set;
assume q in CC;
then q is (Equivalence_Relation of SF) by A9;
hence thesis by MSUALG_5:def 5;
end;
then reconsider CC as non empty (SubsetFamily of [| SF,SF |]) by A8,MSUALG_7:5;
set R0 = ( meet |: CC :| );
A11: R0 is  MSEquivalence_Relation-like  MSEquivalence_Relation-like (ManySortedRelation of SF) by A10,MSUALG_7:8;
reconsider R0 as (ManySortedRelation of X()) by A10,MSUALG_7:8;
R0 is  MSEquivalence-like
proof
let i being set;
let R being (Relation of ( SF . i ));
assume that
A12: i in I
and
A13: ( R0 . i ) = R;
thus thesis by A11,A12,A13,MSUALG_4:def 2;
end;
then reconsider R0 as  MSEquivalence-like (ManySortedRelation of X());
{ C where C is (Element of ( CongrLatt X() )): P1[ C ] } is (Subset of ( CongrLatt X() )) from DOMAIN_1:sch 7;
then reconsider R0 as (MSCongruence of X()) by MSUALG_9:28;
take A = ( QuotMSAlg (X(),R0) );
reconsider F = ( MSNat_Hom (X(),R0) ) as (ManySortedFunction of X(),A);
take F;
A14:now
let c being set;
assume c in CC;
then reconsider cc = c as (MSCongruence of X()) by A9;
consider w being set such that A15: w = ( QuotMSAlg (X(),cc) );
take w;
thus P[ c,w ] by A15;
end;
consider FF being (ManySortedSet of CC) such that A16: (for c being set holds (c in CC implies P[ c,( FF . c ) ])) from PBOOLE:sch 3(A14);
FF is (MSAlgebra-Family of CC,S())
proof
let c being set;
assume c in CC;
then (ex R being (MSCongruence of X()) st (R = c & ( FF . c ) = ( QuotMSAlg (X(),R) ))) by A16;
hence thesis;
end;
then reconsider FF as (MSAlgebra-Family of CC,S());
defpred P[ (Element of CC),set ]
 means
(ex F1 being (ManySortedFunction of X(),( FF . $1 )) st ((F1 = $2 & F1 is_homomorphism X(),( FF . $1 )) & (ex R being (MSCongruence of X()) st ($1 = R & F1 = ( MSNat_Hom (X(),R) )))));
A17: (for c being (Element of CC) holds (ex j being set st P[ c,j ]))
proof
let c being (Element of CC);
consider R being (MSCongruence of X()) such that A18: R = c and A19: ( FF . c ) = ( QuotMSAlg (X(),R) ) by A16;
set j = ( MSNat_Hom (X(),R) );
reconsider F1 = j as (ManySortedFunction of X(),( FF . c )) by A19;
take j;
take F1;
thus F1 = j;
( MSNat_Hom (X(),R) ) is_epimorphism X(),( QuotMSAlg (X(),R) ) by MSUALG_4:3;
hence F1 is_homomorphism X(),( FF . c ) by A19,MSUALG_3:def 8;
take R;
thus thesis by A18;
end;
consider FofI1 being (ManySortedSet of CC) such that A20: (for c being (Element of CC) holds P[ c,( FofI1 . c ) ]) from PBOOLE:sch 6(A17);
A21: (for c being (Element of CC) holds (ex F1 being (ManySortedFunction of X(),( FF . c )) st (F1 = ( FofI1 . c ) & F1 is_homomorphism X(),( FF . c ))))
proof
let c being (Element of CC);
consider F1 being (ManySortedFunction of X(),( FF . c )) such that A22: F1 = ( FofI1 . c ) and A23: F1 is_homomorphism X(),( FF . c ) and (ex R being (MSCongruence of X()) st (c = R & F1 = ( MSNat_Hom (X(),R) ))) by A20;
take F1;
thus thesis by A22,A23;
end;
FofI1 is  Function-yielding
proof
let c being set;
assume c in ( dom FofI1 );
then reconsider cc = c as (Element of CC) by PARTFUN1:def 2;
(ex F1 being (ManySortedFunction of X(),( FF . cc )) st (F1 = ( FofI1 . cc ) & F1 is_homomorphism X(),( FF . cc ))) by A21;
hence thesis;
end;
then reconsider FofI1 as (ManySortedFunction of CC);
consider H being (ManySortedFunction of X(),( product FF )) such that A24: H is_homomorphism X(),( product FF ) and A25: (for c being (Element of CC) holds ( ( proj (FF,c) ) ** H ) = ( FofI1 . c )) by A21,PRALG_3:29;
now
let i being set;
assume i in I;
then reconsider s = i as (SortSymbol of S());
consider Q being (Subset-Family of ( [| SF,SF |] . s )) such that A26: Q = ( |: CC :| . s ) and A27: ( ( meet |: CC :| ) . s ) = ( Intersect Q ) by MSSUBFAM:def 1;
A28: ( |: CC :| . s ) = { ( t . s ) where t is (Element of ( Bool [| SF,SF |] )): t in CC } by CLOSURE2:14;
( ( MSCng H ) . s ) = ( R0 . s )
proof
let a being set,b being set;
hereby
assume A29: [ a,b ] in ( ( MSCng H ) . s );
then A30: a in ( SF . s ) by ZFMISC_1:87;
A31: b in ( SF . s ) by A29,ZFMISC_1:87;
A32: [ a,b ] in ( MSCng (H,s) ) by A24,A29,MSUALG_4:def 18;
A33: (for Y being set holds (Y in Q implies [ a,b ] in Y))
proof
let Y being set;
assume Y in Q;
then consider t being (Element of ( Bool [| SF,SF |] )) such that A34: Y = ( t . s ) and A35: t in CC by A26,A28;
reconsider t1 = t as (Element of CC) by A35;
consider F1 being (ManySortedFunction of X(),( FF . t1 )) such that A36: F1 = ( FofI1 . t1 ) and F1 is_homomorphism X(),( FF . t1 ) and A37: (ex R being (MSCongruence of X()) st (t1 = R & F1 = ( MSNat_Hom (X(),R) ))) by A20;
( ( F1 . s ) . a ) = ( ( ( ( proj (FF,t1) ) ** H ) . s ) . a ) by A25,A36
.= ( ( ( ( proj (FF,t1) ) . s ) * ( H . s ) ) . a ) by MSUALG_3:2
.= ( ( ( proj (FF,t1) ) . s ) . ( ( H . s ) . a ) ) by A30,FUNCT_2:15
.= ( ( ( proj (FF,t1) ) . s ) . ( ( H . s ) . b ) ) by A30,A31,A32,MSUALG_4:def 17
.= ( ( ( ( proj (FF,t1) ) . s ) * ( H . s ) ) . b ) by A31,FUNCT_2:15
.= ( ( ( ( proj (FF,t1) ) ** H ) . s ) . b ) by MSUALG_3:2
.= ( ( F1 . s ) . b ) by A25,A36;
hence thesis by A30,A31,A34,A37,MSUALG_9:33;
end;
[ a,b ] in [: ( SF . s ),( SF . s ) :] by A29;
then [ a,b ] in ( [| SF,SF |] . s ) by PBOOLE:def 16;
hence [ a,b ] in ( R0 . s ) by A27,A33,SETFAM_1:43;
end;
assume A38: [ a,b ] in ( R0 . s );
then A39: a in ( SF . s ) by ZFMISC_1:87;
A40: b in ( SF . s ) by A38,ZFMISC_1:87;
A41: (for c being (Element of CC) holds ( ( proj (( Carrier (FF,s) ),c) ) . ( ( H . s ) . a ) ) = ( ( proj (( Carrier (FF,s) ),c) ) . ( ( H . s ) . b ) ))
proof
let c being (Element of CC);
reconsider t1 = c as (MSCongruence of X()) by A9;
consider F1 being (ManySortedFunction of X(),( FF . c )) such that A42: F1 = ( FofI1 . c ) and F1 is_homomorphism X(),( FF . c ) and A43: (ex R being (MSCongruence of X()) st (c = R & F1 = ( MSNat_Hom (X(),R) ))) by A20;
t1 is (Element of ( Bool [| SF,SF |] )) by CLOSURE2:def 1;
then ( t1 . s ) in ( |: CC :| . s ) by A28;
then A44: [ a,b ] in ( t1 . s ) by A26,A27,A38,SETFAM_1:43;
thus ( ( proj (( Carrier (FF,s) ),c) ) . ( ( H . s ) . a ) ) = ( ( ( proj (FF,c) ) . s ) . ( ( H . s ) . a ) ) by PRALG_3:def 2
.= ( ( ( ( proj (FF,c) ) . s ) * ( H . s ) ) . a ) by A39,FUNCT_2:15
.= ( ( ( ( proj (FF,c) ) ** H ) . s ) . a ) by MSUALG_3:2
.= ( ( F1 . s ) . a ) by A25,A42
.= ( ( F1 . s ) . b ) by A39,A40,A44,A43,MSUALG_9:33
.= ( ( ( ( proj (FF,c) ) ** H ) . s ) . b ) by A25,A42
.= ( ( ( ( proj (FF,c) ) . s ) * ( H . s ) ) . b ) by MSUALG_3:2
.= ( ( ( proj (FF,c) ) . s ) . ( ( H . s ) . b ) ) by A40,FUNCT_2:15
.= ( ( proj (( Carrier (FF,s) ),c) ) . ( ( H . s ) . b ) ) by PRALG_3:def 2;
end;
( ( H . s ) . b ) in ( (the Sorts of ( product FF )) . s ) by A40,FUNCT_2:5;
then A45: ( ( H . s ) . b ) in ( product ( Carrier (FF,s) ) ) by PRALG_2:def 10;
( ( H . s ) . a ) in ( (the Sorts of ( product FF )) . s ) by A39,FUNCT_2:5;
then ( ( H . s ) . a ) in ( product ( Carrier (FF,s) ) ) by PRALG_2:def 10;
then ( ( H . s ) . a ) = ( ( H . s ) . b ) by A45,A41,MSUALG_9:14;
then [ a,b ] in ( MSCng (H,s) ) by A39,A40,MSUALG_4:def 17;
hence thesis by A24,MSUALG_4:def 18;
end;
hence ( ( MSCng H ) . i ) = ( R0 . i );
end;
then A46: ( MSCng H ) = R0 by PBOOLE:3;
( QuotMSAlg (X(),( MSCng H )) ),( Image ( MSHomQuot H ) ) are_isomorphic  by A24,MSUALG_4:4,MSUALG_9:16;
then consider XX being  strict  non-empty (MSSubAlgebra of ( product FF )) such that A47: A,XX are_isomorphic  by A46;
(for cc being set holds (cc in CC implies (ex A being MSAlgebra over S() st (A = ( FF . cc ) & P[ A ]))))
proof
let cc being set;
assume A48: cc in CC;
then reconsider c = cc as (Element of CC);
take ( FF . c );
A49: (ex C being (Element of ( CongrLatt X() )) st (cc = C & (ex R being (MSCongruence of X()) st (R = C & P[ ( QuotMSAlg (X(),R) ) ])))) by A48;
(ex R being (MSCongruence of X()) st (R = cc & ( FF . cc ) = ( QuotMSAlg (X(),R) ))) by A16,A48;
hence thesis by A49;
end;
then P[ XX ] by A2,A3;
hence P[ A ] by A1,A47,MSUALG_3:17;
thus F is_epimorphism X(),A by MSUALG_4:3;
then A50: F is  "onto" by MSUALG_3:def 8;
let B being  non-empty MSAlgebra over S();
let G being (ManySortedFunction of X(),B);
assume that
A51: G is_homomorphism X(),B
and
A52: P[ B ];
reconsider C = ( Image ( MSHomQuot G ) ) as  strict  non-empty (MSSubAlgebra of B);
A53: ( QuotMSAlg (X(),( MSCng G )) ),C are_isomorphic  by A51,MSUALG_4:4,MSUALG_9:16;
A54: ( MSCng G ) is (Element of ( CongrLatt X() )) by MSUALG_5:def 6;
P[ C ] by A2,A52;
then P[ ( QuotMSAlg (X(),( MSCng G )) ) ] by A1,A53,MSUALG_3:17;
then ( MSCng G ) in CC by A54;
then R0 c= ( MSCng G ) by CLOSURE2:21,MSSUBFAM:43;
then consider H being (ManySortedFunction of A,B) such that A55: H is_homomorphism A,B and A56: G = ( H ** F ) by A51,MSUALG_9:36;
take H;
thus H is_homomorphism A,B by A55;
thus G = ( H ** F ) by A56;
let K being (ManySortedFunction of A,B);
assume ( K ** F ) = G;
hence thesis by A56,A50,EXTENS_1:12;
end;
