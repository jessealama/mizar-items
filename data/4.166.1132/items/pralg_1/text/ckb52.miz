environ
vocabularies UNIALG_1,NAT_1,XBOOLE_0,FINSEQ_1,ZFMISC_1,MCART_1,RELAT_1,FUNCT_1,FUNCT_2,PARTFUN1,FINSEQ_2,SUBSET_1,TARSKI,NUMBERS,STRUCT_0,CQC_SIM1,UNIALG_2,ORDINAL1,PBOOLE,FUNCOP_1,RLVECT_2,CARD_3,CARD_1,FINSEQ_4,FUNCT_5,PRALG_1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,ORDINAL1,NUMBERS,NAT_1,STRUCT_0,RELAT_1,FUNCT_1,FINSEQ_1,FUNCT_2,BINOP_1,FUNCOP_1,MCART_1,DOMAIN_1,PARTFUN1,FINSEQ_2,FUNCT_4,FUNCT_5,CARD_3,MARGREL1,DTCONSTR,UNIALG_1,UNIALG_2,PBOOLE,CKB1,CKB2,CKB3,CKB4,CKB6,CKB7,CKB14,CKB17,CKB21,CKB22,CKB23,CKB27,CKB29,CKB30,CKB31,CKB33,CKB35,CKB36,CKB37,CKB40,CKB43,CKB50,CKB51;
definitions TARSKI,UNIALG_1,UNIALG_2,FUNCT_1,PBOOLE,XBOOLE_0,BINOP_1,FINSEQ_2,FUNCOP_1,PARTFUN1,MARGREL1,CKB1,CKB2,CKB3,CKB4,CKB6,CKB7,CKB14,CKB17,CKB21,CKB22,CKB23,CKB27,CKB31,CKB33,CKB35,CKB37,CKB40,CKB43,CKB50,CKB51;
theorems TARSKI,FUNCT_1,PARTFUN1,FINSEQ_1,FINSEQ_2,FUNCOP_1,UNIALG_1,DOMAIN_1,ZFMISC_1,MCART_1,UNIALG_2,FUNCT_2,PBOOLE,FUNCT_5,CARD_3,FUNCT_4,FINSEQ_3,RELAT_1,RELSET_1,ORDINAL1,XBOOLE_0,XBOOLE_1,MARGREL1,CARD_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB16,CKB17,CKB18,CKB19,CKB21,CKB22,CKB23,CKB27,CKB31,CKB33,CKB35,CKB37,CKB39,CKB40,CKB43,CKB50,CKB51;
schemes FINSEQ_1,PARTFUN1,FUNCT_2,FUNCT_1,CLASSES1;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,PARTFUN1,FUNCOP_1,FINSEQ_1,FINSEQ_2,CARD_3,PBOOLE,STRUCT_0,UNIALG_1,CARD_1,RELSET_1,MARGREL1,CKB15,CKB20,CKB24,CKB25,CKB26,CKB28,CKB32,CKB34,CKB38,CKB41,CKB42,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49;
constructors BINOP_1,DOMAIN_1,FUNCT_4,FUNCT_5,CARD_3,PBOOLE,UNIALG_2,DTCONSTR,STRUCT_0,RELSET_1,CKB1,CKB2,CKB3,CKB4,CKB6,CKB7,CKB14,CKB17,CKB21,CKB22,CKB23,CKB27,CKB29,CKB30,CKB31,CKB33,CKB35,CKB36,CKB37,CKB40,CKB43,CKB50,CKB51;
requirements BOOLE,SUBSET;
begin
reserve x for set;
reserve y for set;
reserve z for set;
definition
let J being non empty set;
let B being  non-empty (ManySortedSet of J);
let O being  equal-arity (ManySortedOperation of B);
func [[:O :]] ->  homogeneous  quasi_total non empty (PartFunc of ( ( product B ) * ),( product B ))
means
(( dom it ) = ( ( ComAr O ) -tuples_on ( product B ) ) & (for p being (Element of ( ( product B ) * )) holds (p in ( dom it ) implies ((( dom p ) = ( {} ) implies ( it . p ) = ( O .. ( EmptySeq B ) )) & (( dom p ) <> ( {} ) implies (for Z being non empty set holds (for w being (ManySortedSet of [: J,Z :]) holds ((Z = ( dom p ) & w = ( ~ ( uncurry p ) )) implies ( it . p ) = ( O .. ( curry w ) )))))))));
existence
proof
set pr = ( product B );
set ca = ( ComAr O );
set ct = ( ca -tuples_on pr );
defpred P[ set,set ]
 means
(for p being (Element of ( pr * )) holds (p = $1 implies ((( dom p ) = ( {} ) implies $2 = ( O .. ( EmptySeq B ) )) & (( dom p ) <> ( {} ) implies (for Z being non empty set holds (for w being (ManySortedSet of [: J,Z :]) holds ((Z = ( dom p ) & w = ( ~ ( uncurry p ) )) implies $2 = ( O .. ( curry w ) ))))))));
set aa = { q where q is (Element of ( pr * )): ( len q ) = ca };
A1: (for x holds (x in ct implies (ex y st (y in pr & P[ x,y ]))))
proof
let x;
assume x in ct;
then consider w being (Element of ( pr * )) such that A2: x = w and A3: ( len w ) = ca;
now
per cases ;
case A4: ( dom w ) = ( {} );
A5: (for z holds (z in ( dom B ) implies ( ( O .. ( EmptySeq B ) ) . z ) in ( B . z )))
proof
let z;
assume z in ( dom B );
then reconsider j = z as (Element of J) by PARTFUN1:def 2;
A6: ( rng ( O . j ) ) c= ( B . j ) by RELAT_1:def 19;
w = ( {} ) by A4;
then ( arity ( O . j ) ) = ( 0 ) by A3,CKB50:def 1;
then ( dom ( O . j ) ) = ( ( 0 ) -tuples_on ( B . j ) ) by MARGREL1:22
.= { ( <*> ( B . j ) ) } by FINSEQ_2:94;
then ( {} ( B . j ) ) in ( dom ( O . j ) ) by TARSKI:def 1;
then A7: ( ( O . j ) . ( {} ( B . j ) ) ) in ( rng ( O . j ) ) by FUNCT_1:def 3;
( ( O .. ( EmptySeq B ) ) . z ) = ( ( O . j ) . ( ( EmptySeq B ) . j ) ) by CKB43:def 1
.= ( ( O . j ) . ( {} ( B . j ) ) ) by CKB51:def 1;
hence thesis by A7,A6;
end;
take y = ( O .. ( EmptySeq B ) );
( dom ( O .. ( EmptySeq B ) ) ) = J by PARTFUN1:def 2
.= ( dom B ) by PARTFUN1:def 2;
hence y in pr by A5,CARD_3:def 5;
let p being (Element of ( pr * ));
assume p = x;
hence ((( dom p ) = ( {} ) implies y = ( O .. ( EmptySeq B ) )) & (( dom p ) <> ( {} ) implies (for Z being non empty set holds (for w being (ManySortedSet of [: J,Z :]) holds ((Z = ( dom p ) & w = ( ~ ( uncurry p ) )) implies y = ( O .. ( curry w ) )))))) by A2,A4;
end;
case ( dom w ) <> ( {} );
then reconsider Z = ( dom w ) as non empty set;
reconsider p = ( ~ ( uncurry w ) ) as (ManySortedSet of [: J,Z :]);
take y = ( O .. ( curry p ) );
A8: (for z holds (z in ( dom B ) implies ( ( O .. ( curry p ) ) . z ) in ( B . z )))
proof
let z;
assume z in ( dom B );
then reconsider j = z as (Element of J) by PARTFUN1:def 2;
A9: ( dom p ) = [: J,Z :] by PARTFUN1:def 2;
then ( proj1 ( dom p ) ) = J by FUNCT_5:9;
then consider g being Function such that A10: ( ( curry p ) . j ) = g and A11: ( dom g ) = ( proj2 ( ( dom p ) /\ [: { j },( proj2 ( dom p ) ) :] ) ) and A12: (for y holds (y in ( dom g ) implies ( g . y ) = ( p . (j,y) ))) by FUNCT_5:def 1;
( proj2 ( dom p ) ) = Z by A9,FUNCT_5:9;
then A13: ( dom g ) = ( proj2 [: ( J /\ { j } ),( Z /\ Z ) :] ) by A9,A11,ZFMISC_1:100
.= ( proj2 [: { j },Z :] ) by ZFMISC_1:46
.= ( dom w ) by FUNCT_5:9
.= ( Seg ( len w ) ) by FINSEQ_1:def 3;
then reconsider g as FinSequence by FINSEQ_1:def 2;
( rng g ) c= ( B . j )
proof
let y;
assume y in ( rng g );
then consider x such that A14: x in ( dom g ) and A15: ( g . x ) = y by FUNCT_1:def 3;
(( dom ( uncurry w ) ) = [: ( dom w ),J :] & ( dom g ) = ( dom w )) by A13,FINSEQ_1:def 3,PARTFUN1:def 2;
then A16: [ x,j ] in ( dom ( uncurry w ) ) by A14,ZFMISC_1:87;
then consider a being set,f being Function,b being set such that A17: [ x,j ] = [ a,b ] and A18: a in ( dom w ) and A19: f = ( w . a ) and A20: b in ( dom f ) by FUNCT_5:def 2;
y = ( ( ~ ( uncurry w ) ) . (j,x) ) by A12,A14,A15;
then A21: y = ( ( uncurry w ) . (x,j) ) by A16,FUNCT_4:def 2;
(( [ a,b ] `1 ) = a & ( [ a,b ] `2 ) = j) by A17,MCART_1:7;
then A22: y = ( f . j ) by A16,A21,A17,A19,FUNCT_5:def 2;
A23: j = b by A17,ZFMISC_1:27;
A24: (( rng w ) c= pr & ( w . a ) in ( rng w )) by A18,FINSEQ_1:def 4,FUNCT_1:def 3;
then ( dom f ) = ( dom B ) by A19,CARD_3:9;
hence thesis by A19,A20,A23,A24,A22,CARD_3:9;
end;
then reconsider g as (FinSequence of ( B . j )) by FINSEQ_1:def 4;
reconsider g as (Element of ( ( B . j ) * )) by FINSEQ_1:def 11;
( arity ( O . j ) ) = ca by CKB50:def 1;
then A25: ( dom ( O . j ) ) = ( ca -tuples_on ( B . j ) ) by MARGREL1:22
.= { s where s is (Element of ( ( B . j ) * )): ( len s ) = ca };
( len g ) = ( len w ) by A13,FINSEQ_1:def 3;
then g in ( dom ( O . j ) ) by A3,A25;
then A26: ( ( O . j ) . g ) in ( rng ( O . j ) ) by FUNCT_1:def 3;
(( ( O .. ( curry p ) ) . z ) = ( ( O . j ) . ( ( curry p ) . j ) ) & ( rng ( O . j ) ) c= ( B . j )) by CKB43:def 1,RELAT_1:def 19;
hence thesis by A10,A26;
end;
( dom ( O .. ( curry p ) ) ) = J by PARTFUN1:def 2
.= ( dom B ) by PARTFUN1:def 2;
hence y in pr by A8,CARD_3:def 5;
let l being (Element of ( pr * ));
assume l = x;
hence ((( dom l ) = ( {} ) implies y = ( O .. ( EmptySeq B ) )) & (( dom l ) <> ( {} ) implies (for Z being non empty set holds (for w being (ManySortedSet of [: J,Z :]) holds ((Z = ( dom l ) & w = ( ~ ( uncurry l ) )) implies y = ( O .. ( curry w ) )))))) by A2;
end;
end;
hence thesis;
end;
consider f being Function such that A27: ((( dom f ) = ct & ( rng f ) c= pr) & (for x holds (x in ct implies P[ x,( f . x ) ]))) from FUNCT_1:sch 5(A1);
ca in ( NAT ) by ORDINAL1:def 12;
then ct in { ( n -tuples_on pr ) where n is (Element of ( NAT )): (not contradiction) };
then A28: ct c= ( union { ( m -tuples_on pr ) where m is (Element of ( NAT )): (not contradiction) } ) by ZFMISC_1:74;
then ( dom f ) c= ( pr * ) by A27,FINSEQ_2:108;
then reconsider f as (PartFunc of ( pr * ),pr) by A27,RELSET_1:4;
A29: f is  homogeneous
proof
let x being FinSequence,y being FinSequence;
assume A30: (x in ( dom f ) & y in ( dom f ));
then reconsider x1 = x,y1 = y as (Element of ( pr * )) by A27,A28,FINSEQ_2:108;
((ex w being (Element of ( pr * )) st (x1 = w & ( len w ) = ca)) & (ex w being (Element of ( pr * )) st (y1 = w & ( len w ) = ca))) by A27,A30;
hence thesis;
end;
f is  quasi_total
proof
let x being (FinSequence of pr),y being (FinSequence of pr);
assume that
A31: ( len x ) = ( len y )
and
A32: x in ( dom f );
reconsider x1 = x,y1 = y as (Element of ( pr * )) by FINSEQ_1:def 11;
(ex w being (Element of ( pr * )) st (x1 = w & ( len w ) = ca)) by A27,A32;
then y1 in aa by A31;
hence thesis by A27;
end;
then reconsider f as  homogeneous  quasi_total non empty (PartFunc of ( pr * ),pr) by A27,A29;
take f;
thus ( dom f ) = ct by A27;
let p being (Element of ( pr * ));
assume p in ( dom f );
hence thesis by A27;
end;
uniqueness
proof
set pr = ( product B );
set ca = ( ComAr O );
let f being  homogeneous  quasi_total non empty (PartFunc of ( pr * ),pr),g being  homogeneous  quasi_total non empty (PartFunc of ( pr * ),pr);
assume that
A33: ( dom f ) = ( ca -tuples_on pr )
and
A34: (for p being (Element of ( pr * )) holds (p in ( dom f ) implies ((( dom p ) = ( {} ) implies ( f . p ) = ( O .. ( EmptySeq B ) )) & (( dom p ) <> ( {} ) implies (for Z being non empty set holds (for w being (ManySortedSet of [: J,Z :]) holds ((Z = ( dom p ) & w = ( ~ ( uncurry p ) )) implies ( f . p ) = ( O .. ( curry w ) ))))))))
and
A35: ( dom g ) = ( ca -tuples_on pr )
and
A36: (for p being (Element of ( pr * )) holds (p in ( dom g ) implies ((( dom p ) = ( {} ) implies ( g . p ) = ( O .. ( EmptySeq B ) )) & (( dom p ) <> ( {} ) implies (for Z being non empty set holds (for w being (ManySortedSet of [: J,Z :]) holds ((Z = ( dom p ) & w = ( ~ ( uncurry p ) )) implies ( g . p ) = ( O .. ( curry w ) ))))))));
(for x holds (x in ( ca -tuples_on pr ) implies ( f . x ) = ( g . x )))
proof
let x;
assume A37: x in ( ca -tuples_on pr );
then consider s being (Element of ( pr * )) such that A38: x = s and ( len s ) = ca;
now
per cases ;
case A39: ( dom s ) = ( {} );
then ( f . s ) = ( O .. ( EmptySeq B ) ) by A33,A34,A37,A38;
hence thesis by A35,A36,A37,A38,A39;
end;
case ( dom s ) <> ( {} );
then reconsider Z = ( dom s ) as non empty set;
reconsider w = ( ~ ( uncurry s ) ) as (ManySortedSet of [: J,Z :]);
( f . s ) = ( O .. ( curry w ) ) by A33,A34,A37,A38;
hence thesis by A35,A36,A37,A38;
end;
end;
hence thesis;
end;
hence thesis by A33,A35,FUNCT_1:2;
end;
end;
