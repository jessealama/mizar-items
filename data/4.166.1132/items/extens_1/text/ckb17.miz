environ
vocabularies STRUCT_0,XBOOLE_0,MSUALG_1,RELAT_1,PBOOLE,MEMBER_1,TARSKI,REALSET1,FUNCT_1,PZFMISC1,MSUALG_3,FUNCT_6,MSAFREE,LANG1,MCART_1,TREES_4,SUBSET_1,FUNCOP_1,PRELAMB,MSUALG_2,UNIALG_2,MARGREL1,CARD_3,NAT_1,PARTFUN1;
notations TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,RELSET_1,FUNCT_1,MCART_1,PARTFUN1,FUNCOP_1,FUNCT_6,PZFMISC1,FINSEQ_2,STRUCT_0,LANG1,FUNCT_2,CARD_3,NAT_1,TREES_4,DTCONSTR,PBOOLE,MSUALG_1,MSUALG_2,MSUALG_3,MSAFREE;
definitions MSUALG_2,MSUALG_3,PBOOLE,FUNCOP_1,TARSKI,XBOOLE_0;
theorems FUNCOP_1,FUNCT_1,FUNCT_2,FUNCT_6,MCART_1,MSAFREE,MSAFREE2,MSUALG_1,MSUALG_2,MSUALG_3,MSUHOM_1,PBOOLE,RELAT_1,CARD_3,RELSET_1,PZFMISC1,ORDINAL1,PARTFUN1,FINSEQ_2,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16;
schemes MSAFREE1,PBOOLE;
registrations FUNCT_1,RELSET_1,FUNCOP_1,PBOOLE,STRUCT_0,MSUALG_1,MSUALG_3,MSAFREE,MSSUBFAM;
constructors PZFMISC1,MSSUBFAM,MSUALG_3,MSAFREE,RELSET_1,FINSEQ_2;
requirements SUBSET,BOOLE;
begin
reserve S for non  void non  empty ManySortedSign;
reserve U1 for  non-empty MSAlgebra over S;
reserve U2 for  non-empty MSAlgebra over S;
reserve U3 for  non-empty MSAlgebra over S;
theorem
(for F being (ManySortedFunction of U2,U3) holds (F is_homomorphism U2,U3 implies (F is_monomorphism U2,U3 iff (for U1 being  non-empty MSAlgebra over S holds (for h1,h2 being (ManySortedFunction of U1,U2) holds ((h1 is_homomorphism U1,U2 & h2 is_homomorphism U1,U2) implies (( F ** h1 ) = ( F ** h2 ) implies h1 = h2)))))))
proof
let F being (ManySortedFunction of U2,U3);
assume that
A1: F is_homomorphism U2,U3;
set C = (the Sorts of U3);
set B = (the Sorts of U2);
thus (F is_monomorphism U2,U3 implies (for U1 being  non-empty MSAlgebra over S holds (for h1,h2 being (ManySortedFunction of U1,U2) holds ((h1 is_homomorphism U1,U2 & h2 is_homomorphism U1,U2) implies (( F ** h1 ) = ( F ** h2 ) implies h1 = h2)))))
proof
assume F is_monomorphism U2,U3;
then F is  "1-1" by MSUALG_3:def 9;
hence thesis by CKB14:1;
end;

set I = (the carrier of S);
assume that
A2: (for U1 being  non-empty MSAlgebra over S holds (for h1,h2 being (ManySortedFunction of U1,U2) holds ((h1 is_homomorphism U1,U2 & h2 is_homomorphism U1,U2) implies (( F ** h1 ) = ( F ** h2 ) implies h1 = h2))))
and
A3: (not F is_monomorphism U2,U3);
(not F is  "1-1") by A1,A3,MSUALG_3:def 9;
then consider j being set such that A4: j in I and A5: (not ( F . j ) is  one-to-one) by MSUALG_3:1;
set f = ( F . j );
( F . j ) is (Function of ( B . j ),( C . j )) by A4,PBOOLE:def 15;
then consider x1,x2 being set such that A6: x1 in ( B . j ) and A7: x2 in ( B . j ) and A8: ( f . x1 ) = ( f . x2 ) and A9: x1 <> x2 by A4,A5,FUNCT_2:19;
(ex U1 being  non-empty MSAlgebra over S st (ex h1,h2 being (ManySortedFunction of (the Sorts of U1),(the Sorts of U2)) st (((h1 is_homomorphism U1,U2 & h2 is_homomorphism U1,U2) & ( F ** h1 ) = ( F ** h2 )) & h1 <> h2)))
proof
take U1 = ( FreeMSA (the Sorts of U2) );
reconsider FG = ( FreeGen B ) as (GeneratorSet of U1);
FG is  non-empty by MSAFREE:14;
then reconsider FGj = ( FG . j ),Bj = ( B . j ) as non  empty set by A4;
reconsider h = ( FGj --> x2 ) as (Function of FGj,Bj) by A7,FUNCOP_1:45;
reconsider g = ( FGj --> x1 ) as (Function of FGj,Bj) by A6,FUNCOP_1:45;
set r = ( Reverse B );
deffunc F(set) = ( IFEQ ($1,j,g,( r . $1 )) );
consider G being (ManySortedSet of I) such that A10: (for i being set holds (i in I implies ( G . i ) = F(i))) from PBOOLE:sch 4;
deffunc F(set) = ( IFEQ ($1,j,h,( r . $1 )) );
consider H being (ManySortedSet of I) such that A11: (for i being set holds (i in I implies ( H . i ) = F(i))) from PBOOLE:sch 4;
now
let G being (ManySortedSet of I);
let g being (Function of FGj,Bj);
let h being (Function of FGj,Bj);
assume that
A12: (for i being set holds (i in I implies ( G . i ) = ( IFEQ (i,j,g,( r . i )) )));
thus G is  Function-yielding
proof
let i being set;
assume i in ( dom G );
then A13: i in I by PARTFUN1:def 2;
now
per cases ;
case i = j;
then ( IFEQ (i,j,g,( r . i )) ) = g by FUNCOP_1:def 8;
hence thesis by A12,A13;
end;
case i <> j;
then ( IFEQ (i,j,g,( r . i )) ) = ( r . i ) by FUNCOP_1:def 8;
hence thesis by A12,A13;
end;
end;
hence thesis;
end;

end;
then reconsider G,H as (ManySortedFunction of I) by A10,A11;
now
let G being (ManySortedFunction of I);
let g being (Function of FGj,Bj);
let h being (Function of FGj,Bj);
assume that
A14: (for i being set holds (i in I implies ( G . i ) = ( IFEQ (i,j,g,( r . i )) )));
thus G is (ManySortedFunction of FG,B)
proof
let i being set;
assume that
A15: i in I;
now
per cases ;
case A16: i = j;
then ( IFEQ (i,j,g,( r . i )) ) = g by FUNCOP_1:def 8;
hence thesis by A14,A15,A16;
end;
case i <> j;
then ( IFEQ (i,j,g,( r . i )) ) = ( r . i ) by FUNCOP_1:def 8;
then ( G . i ) = ( r . i ) by A14,A15;
hence thesis by A15,PBOOLE:def 15;
end;
end;
hence thesis;
end;

end;
then reconsider G,H as (ManySortedFunction of FG,B) by A10,A11;
A17: FG is  free by MSAFREE:16;
then consider h1 being (ManySortedFunction of U1,U2) such that A18: h1 is_homomorphism U1,U2 and A19: ( h1 || FG ) = G by MSAFREE:def 5;
consider h2 being (ManySortedFunction of U1,U2) such that A20: h2 is_homomorphism U1,U2 and A21: ( h2 || FG ) = H by A17,MSAFREE:def 5;
take h1;
take h2;
thus (h1 is_homomorphism U1,U2 & h2 is_homomorphism U1,U2) by A18,A20;
reconsider Fh1 = ( F ** h1 ),Fh2 = ( F ** h2 ) as (ManySortedFunction of U1,U3);
A22: Fh1 is_homomorphism U1,U3 by A1,A18,MSUALG_3:10;
now
let i being set;
assume A23: i in I;
now
per cases ;
case A24: i = j;
then A25: f is (Function of ( B . i ),( C . i )) by A4,PBOOLE:def 15;
then reconsider fg = ( f * g ) as (Function of FGj,( C . i )) by A24,FUNCT_2:13;
reconsider fh = ( f * h ) as (Function of FGj,( C . i )) by A24,A25,FUNCT_2:13;
now
let x being set;
assume A26: x in FGj;
hence ( fg . x ) = ( f . ( g . x ) ) by FUNCT_2:15
.= ( f . x2 ) by A8,A26,FUNCOP_1:7
.= ( f . ( h . x ) ) by A26,FUNCOP_1:7
.= ( fh . x ) by A26,FUNCT_2:15;
end;
then A27: ( f * g ) = ( f * h ) by FUNCT_2:12;
( IFEQ (i,j,g,( r . i )) ) = g by A24,FUNCOP_1:def 8;
then g = ( ( h1 || FG ) . i ) by A10,A19,A23;
then A28: ( ( F ** ( h1 || FG ) ) . i ) = ( f * g ) by A4,A24,MSUALG_3:2;
( IFEQ (i,j,h,( r . i )) ) = h by A24,FUNCOP_1:def 8;
then h = ( ( h2 || FG ) . i ) by A11,A21,A23;
hence ( ( F ** ( h1 || FG ) ) . i ) = ( ( F ** ( h2 || FG ) ) . i ) by A4,A24,A27,A28,MSUALG_3:2;
end;
case A29: i <> j;
reconsider f9 = ( F . i ) as (Function of ( B . i ),( C . i )) by A23,PBOOLE:def 15;
reconsider h29 = ( ( h2 || FG ) . i ) as (Function of ( FG . i ),( B . i )) by A23,PBOOLE:def 15;
A30: ( IFEQ (i,j,h,( r . i )) ) = ( r . i ) by A29,FUNCOP_1:def 8;
( IFEQ (i,j,g,( r . i )) ) = ( r . i ) by A29,FUNCOP_1:def 8;
then ( ( h1 || FG ) . i ) = ( r . i ) by A10,A19,A23
.= ( ( h2 || FG ) . i ) by A11,A21,A23,A30;
hence ( ( F ** ( h1 || FG ) ) . i ) = ( f9 * h29 ) by A23,MSUALG_3:2
.= ( ( F ** ( h2 || FG ) ) . i ) by A23,MSUALG_3:2;
end;
end;
hence ( ( F ** ( h1 || FG ) ) . i ) = ( ( F ** ( h2 || FG ) ) . i );
end;
then A31: ( F ** ( h1 || FG ) ) = ( F ** ( h2 || FG ) ) by PBOOLE:3;
A32: Fh2 is_homomorphism U1,U3 by A1,A20,MSUALG_3:10;
( ( F ** h1 ) || FG ) = ( F ** ( h1 || FG ) ) by CKB5:1
.= ( ( F ** h2 ) || FG ) by A31,CKB5:1;
hence ( F ** h1 ) = ( F ** h2 ) by A22,A32,CKB15:1;
now
take i = j;
thus i in I by A4;
A33:now
let x being (Element of FGj);
assume g = h;
then ( g . x ) = x2 by FUNCOP_1:7;
hence contradiction by A9,FUNCOP_1:7;
end;
A34: h = ( IFEQ (i,j,h,( r . i )) ) by FUNCOP_1:def 8
.= ( H . i ) by A4,A11;
g = ( IFEQ (i,j,g,( r . i )) ) by FUNCOP_1:def 8
.= ( G . i ) by A4,A10;
hence G <> H by A34,A33;
end;
hence thesis by A19,A21;
end;
hence contradiction by A2;
end;
