environ
vocabularies NUMBERS,XBOOLE_0,ORDERS_2,MSUALG_4,OSALG_1,RELAT_1,STRUCT_0,FUNCOP_1,PBOOLE,SUBSET_1,XXREAL_0,FUNCT_1,MSUALG_1,TARSKI,EQREL_1,NAT_1,MARGREL1,PARTFUN1,FINSEQ_1,ARYTM_3,ARYTM_1,ZFMISC_1,FINSEQ_5,CARD_1,RELAT_2,ORDINAL4,NATTRA_1,YELLOW15,SETFAM_1,COH_SP,YELLOW18,WAYBEL_0,CARD_3,MSUALG_3,WELLORD1,SEQM_3,OSALG_4;
notations ZFMISC_1,TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,RELAT_2,FUNCT_1,RELSET_1,PARTFUN1,EQREL_1,SETFAM_1,XCMPLX_0,ORDERS_2,ORDERS_3,NUMBERS,NAT_1,FUNCT_2,FINSEQ_1,CARD_3,FINSEQ_2,FINSEQ_4,FINSEQ_5,FUNCOP_1,PBOOLE,STRUCT_0,WAYBEL_0,MSUALG_1,MSUALG_3,OSALG_1,OSALG_3,MSUALG_4,XXREAL_0,CKB2,CKB4,CKB7,CKB8,CKB11;
definitions TARSKI,MSUALG_3,XBOOLE_0,OSALG_1,OSALG_3,CKB2,CKB8;
theorems XBOOLE_0,XBOOLE_1,FUNCT_1,FUNCT_2,PBOOLE,CARD_3,MSUALG_1,MSUALG_5,OSALG_1,OSALG_3,RELAT_2,ZFMISC_1,RELAT_1,RELSET_1,EQREL_1,MSUALG_3,MSUALG_6,MSAFREE,TARSKI,SYSREL,ORDERS_2,FINSEQ_1,FINSEQ_3,ENUMSET1,FINSEQ_5,INT_1,ORDERS_3,PARTFUN1,WAYBEL_0,GRFUNC_1,MSUALG_9,MSUALG_4,FINSEQ_2,ORDERS_1,FUNCOP_1,XREAL_1,XXREAL_0,CKB2,CKB5,CKB8;
schemes FUNCT_1,CLASSES1,NAT_1,FUNCT_2;
registrations SUBSET_1,RELAT_1,PARTFUN1,FUNCOP_1,XREAL_0,INT_1,FINSEQ_1,EQREL_1,FUNCT_1,PBOOLE,STRUCT_0,MSUALG_1,MSUALG_3,MSUALG_4,ORDERS_3,OSALG_1,ORDINAL1,CARD_3,TOLER_1,RELSET_1,FINSEQ_2,CKB1,CKB3,CKB6,CKB9,CKB10;
constructors XXREAL_0,REAL_1,NAT_1,NAT_D,EQREL_1,FINSEQ_4,FINSEQ_5,MSUALG_3,MSUALG_4,ORDERS_3,WAYBEL_0,OSALG_3,RELSET_1,CKB2,CKB8;
requirements BOOLE,SUBSET,NUMERALS,REAL,ARITHM;
begin
definition
let R being non  empty Poset;
func Path_Rel R -> (Equivalence_Relation of (the carrier of R)) means 
:Def4: (for x,y being set holds ([ x,y ] in it iff ((x in (the carrier of R) & y in (the carrier of R)) & (ex p being (FinSequence of (the carrier of R)) st (((1 < ( len p ) & ( p . 1 ) = x) & ( p . ( len p ) ) = y) & (for n being Nat holds ((2 <= n & n <= ( len p )) implies ([ ( p . n ),( p . ( n - 1 ) ) ] in (the InternalRel of R) or [ ( p . ( n - 1 ) ),( p . n ) ] in (the InternalRel of R)))))))));
existence
proof
defpred PC[ set,set ]
 means
(ex p being (FinSequence of (the carrier of R)) st (((1 < ( len p ) & ( p . 1 ) = $1) & ( p . ( len p ) ) = $2) & (for n being Nat holds ((2 <= n & n <= ( len p )) implies ([ ( p . n ),( p . ( n - 1 ) ) ] in (the InternalRel of R) or [ ( p . ( n - 1 ) ),( p . n ) ] in (the InternalRel of R))))));
set P = { [ x,y ] where x is (Element of R),y is (Element of R): ((x in (the carrier of R) & y in (the carrier of R)) & PC[ x,y ]) };
P c= [: (the carrier of R),(the carrier of R) :]
proof
let z being set;
assume z in P;
then (ex x,y being (Element of R) st (((z = [ x,y ] & x in (the carrier of R)) & y in (the carrier of R)) & PC[ x,y ]));
hence thesis by ZFMISC_1:87;
end;
then reconsider P1 = P as (Relation of (the carrier of R));
A1: (for x,y being set holds ([ x,y ] in P iff ((x in (the carrier of R) & y in (the carrier of R)) & PC[ x,y ])))
proof
let x being set;
let y being set;
hereby
assume [ x,y ] in P;
then consider x1,y1 being (Element of R) such that A2: [ x,y ] = [ x1,y1 ] and x1 in (the carrier of R) and y1 in (the carrier of R) and A3: PC[ x1,y1 ];
(x = x1 & y = y1) by A2,ZFMISC_1:27;
hence ((x in (the carrier of R) & y in (the carrier of R)) & PC[ x,y ]) by A3;
end;
thus thesis;
end;
now
let x being set;
let y being set;
assume that
A4: (x in (the carrier of R) & y in (the carrier of R))
and
A5: [ x,y ] in P1;
consider p being (FinSequence of (the carrier of R)) such that A6: 1 < ( len p ) and A7: (( p . 1 ) = x & ( p . ( len p ) ) = y) and A8: (for n being Nat holds ((2 <= n & n <= ( len p )) implies ([ ( p . n ),( p . ( n - 1 ) ) ] in (the InternalRel of R) or [ ( p . ( n - 1 ) ),( p . n ) ] in (the InternalRel of R)))) by A1,A5;
PC[ y,x ]
proof
take F = ( Rev p );
thus 1 < ( len F ) by A6,FINSEQ_5:def 3;
A9: ( len F ) = ( len p ) by FINSEQ_5:def 3;
hence (( F . 1 ) = y & ( F . ( len F ) ) = x) by A7,FINSEQ_5:62;
let n1 being Nat;
assume that
A10: 2 <= n1
and
A11: n1 <= ( len F );
1 <= n1 by A10,XXREAL_0:2;
then A12: n1 in ( dom p ) by A9,A11,FINSEQ_3:25;
set n2 = ( ( ( len p ) - n1 ) + 2 );
( 0 ) <= ( ( len p ) - n1 ) by A9,A11,XREAL_1:48;
then A13: ( 2 + ( 0 ) ) <= n2 by XREAL_1:6;
A14: ( 2 - 1 ) <= ( n1 - 1 ) by A10,XREAL_1:9;
then reconsider n11 = ( n1 - 1 ) as (Element of ( NAT )) by INT_1:3,XXREAL_0:2;
( n1 - 1 ) <= ( ( len F ) - ( 0 ) ) by A11,XREAL_1:13;
then n11 in ( dom p ) by A9,A14,FINSEQ_3:25;
then A15: ( F . ( n1 - 1 ) ) = ( p . ( ( ( len p ) - ( n1 - 1 ) ) + 1 ) ) by FINSEQ_5:58
.= ( p . ( ( ( len p ) - n1 ) + 2 ) );
reconsider n2 = ( ( ( len p ) - n1 ) + 2 ) as (Element of ( NAT )) by A13,INT_1:3,XXREAL_0:2;
( ( len p ) - n1 ) <= ( ( len p ) - 2 ) by A10,XREAL_1:13;
then A16: ( ( ( len p ) - n1 ) + 2 ) <= ( ( ( len p ) - 2 ) + 2 ) by XREAL_1:6;
( p . ( n2 - 1 ) ) = ( p . ( ( ( len p ) - n1 ) + ( 2 - 1 ) ) )
.= ( F . n1 ) by A12,FINSEQ_5:58;
hence thesis by A8,A15,A13,A16;
end;
hence [ y,x ] in P1 by A4;
end;
then A17: P1 is_symmetric_in (the carrier of R) by RELAT_2:def 3;
A18: (the InternalRel of R) is_reflexive_in (the carrier of R) by ORDERS_2:def 2;
now
let x being set;
assume A19: x in (the carrier of R);
PC[ x,x ]
proof
set F = <* x,x *>;
( rng F ) = { x,x } by FINSEQ_2:127
.= { x } by ENUMSET1:29;
then ( rng F ) c= (the carrier of R) by A19,ZFMISC_1:31;
then reconsider F1 = F as (FinSequence of (the carrier of R)) by FINSEQ_1:def 4;
take F1;
A20: ( len F ) = 2 by FINSEQ_1:44;
hence 1 < ( len F1 );
thus (( F1 . 1 ) = x & ( F1 . ( len F1 ) ) = x) by A20,FINSEQ_1:44;
let n1 being Nat;
assume (2 <= n1 & n1 <= ( len F1 ));
then A21: n1 = 2 by A20,XXREAL_0:1;
(( F . 1 ) = x & ( F . 2 ) = x) by FINSEQ_1:44;
hence thesis by A18,A19,A21,RELAT_2:def 1;
end;
hence [ x,x ] in P1 by A19;
end;
then P1 is_reflexive_in (the carrier of R) by RELAT_2:def 1;
then A22: (( dom P1 ) = (the carrier of R) & ( field P1 ) = (the carrier of R)) by ORDERS_1:13;
now
let x being set;
let y being set;
let z being set;
assume that
A23: x in (the carrier of R)
and
A24: y in (the carrier of R)
and
A25: z in (the carrier of R)
and
A26: ([ x,y ] in P1 & [ y,z ] in P1);
(PC[ x,y ] & PC[ y,z ]) by A1,A26;
then consider p1,p2 being (FinSequence of (the carrier of R)) such that A27: 1 < ( len p1 ) and A28: ( p1 . 1 ) = x and A29: ( p1 . ( len p1 ) ) = y and A30: (for n being Nat holds ((2 <= n & n <= ( len p1 )) implies ([ ( p1 . n ),( p1 . ( n - 1 ) ) ] in (the InternalRel of R) or [ ( p1 . ( n - 1 ) ),( p1 . n ) ] in (the InternalRel of R)))) and A31: 1 < ( len p2 ) and A32: ( p2 . 1 ) = y and A33: ( p2 . ( len p2 ) ) = z and A34: (for n being Nat holds ((2 <= n & n <= ( len p2 )) implies ([ ( p2 . n ),( p2 . ( n - 1 ) ) ] in (the InternalRel of R) or [ ( p2 . ( n - 1 ) ),( p2 . n ) ] in (the InternalRel of R))));
PC[ x,z ]
proof
take F = ( p1 ^ p2 );
A35: ( len F ) = ( ( len p1 ) + ( len p2 ) ) by FINSEQ_1:22;
( 1 + 1 ) < ( ( len p1 ) + ( len p2 ) ) by A27,A31,XREAL_1:8;
hence 1 < ( len F ) by A35,XXREAL_0:2;
1 in ( dom p1 ) by A27,FINSEQ_3:25;
hence ( F . 1 ) = x by A28,FINSEQ_1:def 7;
( len p2 ) in ( dom p2 ) by A31,FINSEQ_3:25;
hence ( F . ( len F ) ) = z by A33,A35,FINSEQ_1:def 7;
let n1 being Nat;
assume that
A36: 2 <= n1
and
A37: n1 <= ( len F );
A38: 1 <= n1 by A36,XXREAL_0:2;
A39: ( 2 - 1 ) <= ( n1 - 1 ) by A36,XREAL_1:9;
then reconsider n11 = ( n1 - 1 ) as (Element of ( NAT )) by INT_1:3,XXREAL_0:2;
A40: (( ( len p1 ) + 1 ) <= n1 implies (( ( len p1 ) + 1 ) = n1 or ( ( len p1 ) + 1 ) < n1)) by XXREAL_0:1;
A41: ( n1 - 1 ) <= ( ( len F ) - ( 0 ) ) by A37,XREAL_1:13;
per cases  by A40,INT_1:7;
suppose A42: n1 <= ( len p1 );

then ( n1 - 1 ) <= ( ( len p1 ) - ( 0 ) ) by XREAL_1:13;
then n11 in ( dom p1 ) by A39,FINSEQ_3:25;
then A43: ( F . ( n1 - 1 ) ) = ( p1 . ( n1 - 1 ) ) by FINSEQ_1:def 7;
n1 in ( dom p1 ) by A38,A42,FINSEQ_3:25;
then ( F . n1 ) = ( p1 . n1 ) by FINSEQ_1:def 7;
hence thesis by A30,A36,A42,A43;
end;
suppose A44: ( ( len p1 ) + 1 ) < n1;

( len p1 ) < ( ( len p1 ) + 1 ) by XREAL_1:29;
then A45: ( len p1 ) < n1 by A44,XXREAL_0:2;
then reconsider k = ( n1 - ( len p1 ) ) as (Element of ( NAT )) by INT_1:3,XREAL_1:48;
( ( ( len p1 ) + 1 ) - 1 ) < ( n1 - 1 ) by A44,XREAL_1:9;
then ( F . n11 ) = ( p2 . ( n11 - ( len p1 ) ) ) by A41,FINSEQ_1:24;
then A46: ( F . ( n1 - 1 ) ) = ( p2 . ( k - 1 ) );
1 < ( n1 - ( len p1 ) ) by A44,XREAL_1:20;
then A47: ( 1 + 1 ) <= ( n1 - ( len p1 ) ) by INT_1:7;
n1 <= ( ( len p1 ) + ( len p2 ) ) by A37,FINSEQ_1:22;
then A48: k <= ( len p2 ) by XREAL_1:20;
( F . n1 ) = ( p2 . k ) by A37,A45,FINSEQ_1:24;
hence thesis by A34,A46,A47,A48;
end;
suppose A49: ( ( len p1 ) + 1 ) = n1;

(( ( len p1 ) + 1 ) <= ( ( len p1 ) + ( len p2 ) ) & ( ( ( len p1 ) + 1 ) - ( len p1 ) ) = 1) by A31,XREAL_1:8;
then A50: ( F . n1 ) = y by A32,A49,FINSEQ_1:23;
( len p1 ) in ( dom p1 ) by A27,FINSEQ_3:25;
then ( F . ( n1 - 1 ) ) = y by A29,A49,FINSEQ_1:def 7;
hence thesis by A18,A24,A50,RELAT_2:def 1;
end;
end;
hence [ x,z ] in P1 by A23,A25;
end;
then P1 is_transitive_in (the carrier of R) by RELAT_2:def 8;
then reconsider P1 = P as (Equivalence_Relation of (the carrier of R)) by A22,A17,PARTFUN1:def 2,RELAT_2:def 11,RELAT_2:def 16;
take P1;
thus thesis by A1;
end;
uniqueness
proof
let X being (Equivalence_Relation of (the carrier of R));
let Y being (Equivalence_Relation of (the carrier of R));
defpred PC1[ set,set ]
 means
(($1 in (the carrier of R) & $2 in (the carrier of R)) & (ex p being (FinSequence of (the carrier of R)) st (((1 < ( len p ) & ( p . 1 ) = $1) & ( p . ( len p ) ) = $2) & (for n being Nat holds ((2 <= n & n <= ( len p )) implies ([ ( p . n ),( p . ( n - 1 ) ) ] in (the InternalRel of R) or [ ( p . ( n - 1 ) ),( p . n ) ] in (the InternalRel of R)))))));
assume A51: (for x,y being set holds ([ x,y ] in X iff PC1[ x,y ]));
assume A52: (for x,y being set holds ([ x,y ] in Y iff PC1[ x,y ]));
(for x,y being set holds ([ x,y ] in X iff [ x,y ] in Y))
proof
let x being set;
let y being set;
hereby
assume [ x,y ] in X;
then PC1[ x,y ] by A51;
hence [ x,y ] in Y by A52;
end;
assume [ x,y ] in Y;
then PC1[ x,y ] by A52;
hence thesis by A51;
end;
hence thesis by RELAT_1:def 2;
end;
end;
