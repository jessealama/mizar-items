environ
vocabularies OSALG_1,MSUALG_2,OSALG_2,MSUALG_1,TARSKI,STRUCT_0,RELAT_1,SEQM_3,PBOOLE,MSUALG_3,REALSET1,ZFMISC_1,XBOOLE_0,CARD_3,MSAFREE,SUBSET_1,FINSEQ_1,MARGREL1,FUNCT_1,XXREAL_0,PARTFUN1,LANG1,TDGROUP,DTCONSTR,TREES_3,TREES_4,NAT_1,TREES_2,OSALG_4,CARD_5,NATTRA_1,CARD_LAR,QC_LANG1,EQREL_1,RELAT_2,MSUALG_4,COH_SP,MCART_1,UNIALG_2,MEMBER_1,FUNCT_7,OSAFREE;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NAT_1,RELAT_1,RELSET_1,FUNCT_1,MCART_1,PARTFUN1,FUNCT_2,FINSEQ_1,FINSEQ_2,PBOOLE,RELAT_2,TREES_2,CARD_3,EQREL_1,STRUCT_0,LANG1,TREES_3,TREES_4,DTCONSTR,ORDERS_2,ORDERS_3,MSUALG_1,MSUALG_2,MSUALG_3,MSUALG_4,OSALG_1,OSALG_2,OSALG_3,OSALG_4,MSAFREE,FUNCT_7,CKB1,CKB3,CKB4,CKB5,CKB7;
definitions TARSKI,XBOOLE_0,PBOOLE,MSUALG_3,OSALG_1,OSALG_3,OSALG_4,CKB1,CKB3,CKB4,CKB5,CKB7;
theorems TARSKI,FUNCT_1,FUNCT_2,MCART_1,ZFMISC_1,PBOOLE,CARD_3,MSUALG_1,MSUALG_2,MSUALG_3,RELAT_1,LANG1,DTCONSTR,FINSEQ_1,TREES_4,TREES_1,DOMAIN_1,RELSET_1,XBOOLE_0,XBOOLE_1,OSALG_1,OSALG_2,OSALG_3,OSALG_4,MSAFREE,MSUALG_6,MSAFREE2,CARD_5,FINSEQ_2,FINSEQ_3,MSUALG_9,MSUALG_4,EQREL_1,FUNCT_5,ORDERS_2,RELAT_2,PARTFUN1,ORDERS_1,FUNCT_7,FUNCOP_1,TREES_3,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB9;
schemes CLASSES1,FUNCT_1,RELSET_1,DTCONSTR,XBOOLE_0,FUNCT_2,PBOOLE;
registrations XBOOLE_0,SUBSET_1,RELAT_1,ORDINAL1,PARTFUN1,FUNCOP_1,FUNCT_1,PBOOLE,TREES_2,TREES_3,STRUCT_0,DTCONSTR,MSUALG_1,MSUALG_3,MSAFREE,MSUALG_4,MSUALG_9,OSALG_1,OSALG_4,RELSET_1,FINSEQ_1,CKB8;
constructors XXREAL_0,NAT_1,FINSEQOP,FUNCT_7,MSUALG_3,MSAFREE,ORDERS_3,OSALG_2,OSALG_3,OSALG_4,RELSET_1,CKB1,CKB3,CKB4,CKB5,CKB7;
requirements BOOLE,SUBSET;
begin
reserve x for set;
registration
let S being OrderSortedSign;
let X being  non-empty (ManySortedSet of S);
cluster ( DTConOSA X ) ->  with_terminals  with_nonterminals  with_useful_nonterminals;
coherence
proof
set D = ( DTConOSA X );
set A = ( [: (the carrier' of S),{ (the carrier of S) } :] \/ ( Union ( coprod (X qua (ManySortedSet of S)) ) ) );
A1: ( Terminals D ) = ( Union ( coprod X ) ) by CKB9:1;
A2: ( NonTerminals D ) = [: (the carrier' of S),{ (the carrier of S) } :] by CKB9:1;
A3: ( Union ( coprod X ) ) misses [: (the carrier' of S),{ (the carrier of S) } :] by MSAFREE:4;
(for nt being (Symbol of D) holds (nt in ( NonTerminals D ) implies (ex p being (FinSequence of ( TS D )) st nt ==> ( roots p ))))
proof
let nt being (Symbol of D);
assume nt in ( NonTerminals D );
then consider o being (Element of (the carrier' of S)),x2 being (Element of { (the carrier of S) }) such that A4: nt = [ o,x2 ] by A2,DOMAIN_1:1;
set O = ( the_arity_of o );
A5: (the carrier of S) = x2 by TARSKI:def 1;
defpred P[ set,set ]
 means
(ex i being (Element of S) st (i <= ( O /. $1 ) & $2 in ( coprod (i,X) )));
A6: (for a being set holds (a in ( Seg ( len O ) ) implies (ex b being set st P[ a,b ])))
proof
let a being set;
assume a in ( Seg ( len O ) );
then A7: a in ( dom O ) by FINSEQ_1:def 3;
then A8: ( O . a ) in ( rng O ) by FUNCT_1:def 3;
A9: ( rng O ) c= (the carrier of S) by FINSEQ_1:def 4;
then consider x being set such that A10: x in ( X . ( O . a ) ) by A8,XBOOLE_0:def 1;
take y = [ x,( O . a ) ];
take ( O /. a );
y in ( coprod (( O . a ),X) ) by A8,A9,A10,MSAFREE:def 2;
hence thesis by A7,PARTFUN1:def 6;
end;
consider b being Function such that A11: (( dom b ) = ( Seg ( len O ) ) & (for a being set holds (a in ( Seg ( len O ) ) implies P[ a,( b . a ) ]))) from CLASSES1:sch 1(A6);
reconsider b as FinSequence by A11,FINSEQ_1:def 2;
A12: ( rng b ) c= A
proof
let a being set;
assume a in ( rng b );
then consider c being set such that A13: c in ( dom b ) and A14: ( b . c ) = a by FUNCT_1:def 3;
consider i being (Element of S) such that i <= ( O /. c ) and A15: a in ( coprod (i,X) ) by A11,A13,A14;
( dom ( coprod X ) ) = (the carrier of S) by PARTFUN1:def 2;
then ( ( coprod X ) . i ) in ( rng ( coprod X ) ) by FUNCT_1:def 3;
then ( coprod (i,X) ) in ( rng ( coprod X ) ) by MSAFREE:def 3;
then a in ( union ( rng ( coprod X ) ) ) by A15,TARSKI:def 4;
then a in ( Union ( coprod X ) ) by CARD_3:def 4;
hence thesis by XBOOLE_0:def 3;
end;
then reconsider b as (FinSequence of A) by FINSEQ_1:def 4;
reconsider b as (Element of ( A * )) by FINSEQ_1:def 11;
deffunc F(set) = ( root-tree ( b . $1 ) );
consider f being Function such that A16: (( dom f ) = ( dom b ) & (for x holds (x in ( dom b ) implies ( f . x ) = F(x)))) from FUNCT_1:sch 3;
reconsider f as FinSequence by A11,A16,FINSEQ_1:def 2;
( rng f ) c= ( TS D )
proof
let x;
assume x in ( rng f );
then consider y being set such that A17: y in ( dom f ) and A18: ( f . y ) = x by FUNCT_1:def 3;
( b . y ) in ( rng b ) by A16,A17,FUNCT_1:def 3;
then reconsider a = ( b . y ) as (Symbol of D) by A12;
consider i being (Element of S) such that i <= ( O /. y ) and A19: ( b . y ) in ( coprod (i,X) ) by A11,A16,A17;
( dom ( coprod X ) ) = (the carrier of S) by PARTFUN1:def 2;
then ( ( coprod X ) . i ) in ( rng ( coprod X ) ) by FUNCT_1:def 3;
then ( coprod (i,X) ) in ( rng ( coprod X ) ) by MSAFREE:def 3;
then ( b . y ) in ( union ( rng ( coprod X ) ) ) by A19,TARSKI:def 4;
then A20: a in ( Terminals D ) by A1,CARD_3:def 4;
x = ( root-tree ( b . y ) ) by A16,A17,A18;
hence thesis by A20,DTCONSTR:def 1;
end;
then reconsider f as (FinSequence of ( TS D )) by FINSEQ_1:def 4;
A21: (for x holds (x in ( dom b ) implies ( ( roots f ) . x ) = ( b . x )))
proof
let x;
assume A22: x in ( dom b );
then reconsider i = x as Nat;
A23: (ex T being DecoratedTree st (T = ( f . i ) & ( ( roots f ) . i ) = ( T . ( {} ) ))) by A16,A22,TREES_3:def 18;
( f . x ) = ( root-tree ( b . x ) ) by A16,A22;
hence thesis by A23,TREES_4:3;
end;
A24:now
let c being set;
assume c in ( dom b );
then consider i being (Element of S) such that A25: i <= ( O /. c ) and A26: ( b . c ) in ( coprod (i,X) ) by A11;
( dom ( coprod X ) ) = (the carrier of S) by PARTFUN1:def 2;
then ( ( coprod X ) . i ) in ( rng ( coprod X ) ) by FUNCT_1:def 3;
then ( coprod (i,X) ) in ( rng ( coprod X ) ) by MSAFREE:def 3;
then ( b . c ) in ( union ( rng ( coprod X ) ) ) by A26,TARSKI:def 4;
then ( b . c ) in ( Union ( coprod X ) ) by CARD_3:def 4;
hence (( b . c ) in [: (the carrier' of S),{ (the carrier of S) } :] implies (for o1 being (OperSymbol of S) holds ([ o1,(the carrier of S) ] = ( b . c ) implies ( the_result_sort_of o1 ) <= ( O /. c )))) by A3,XBOOLE_0:3;
assume ( b . c ) in ( Union ( coprod X ) );
thus (ex i being (Element of S) st (i <= ( O /. c ) & ( b . c ) in ( coprod (i,X) ))) by A25,A26;
end;
( len b ) = ( len O ) by A11,FINSEQ_1:def 3;
then [ nt,b ] in ( OSREL X ) by A4,A5,A24,CKB6:1;
then A27: nt ==> b by LANG1:def 1;
take f;
( dom ( roots f ) ) = ( dom f ) by TREES_3:def 18;
hence thesis by A27,A16,A21,FUNCT_1:2;
end;
hence thesis by A1,A2,DTCONSTR:def 3,DTCONSTR:def 4,DTCONSTR:def 5;
end;
end;
