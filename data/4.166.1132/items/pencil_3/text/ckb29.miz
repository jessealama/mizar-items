environ
vocabularies NUMBERS,XBOOLE_0,STRUCT_0,PRE_TOPC,PENCIL_2,PENCIL_1,FUNCT_1,RELAT_1,TARSKI,SUBSET_1,PRALG_1,PBOOLE,ZFMISC_1,RELAT_2,FINSEQ_1,NAT_1,XXREAL_0,ARYTM_3,CARD_1,ARYTM_1,WAYBEL_3,RLVECT_2,CARD_3,INTEGRA1,FUNCT_4,FINSET_1,FDIFF_1,PARSP_1,GRAPH_2,FUNCT_2,CAT_1,RCOMP_1,FUNCOP_1,PENCIL_3;
notations TARSKI,XBOOLE_0,ZFMISC_1,XCMPLX_0,XXREAL_0,NUMBERS,NAT_1,RELAT_1,SUBSET_1,FUNCT_1,FUNCT_2,FUNCOP_1,RELSET_1,CARD_1,FINSET_1,FINSEQ_1,CARD_3,DOMAIN_1,STRUCT_0,PRE_TOPC,PBOOLE,PZFMISC1,T_0TOPSP,PRALG_1,WAYBEL_3,PENCIL_1,FUNCT_7,PENCIL_2,TOPS_2,GRAPH_2,CKB19,CKB21,CKB28;
definitions TARSKI,XBOOLE_0,PBOOLE,FUNCT_1,T_0TOPSP,STRUCT_0,RELAT_1,CKB19,CKB21,CKB28;
theorems XBOOLE_0,ZFMISC_1,FUNCT_1,FINSEQ_1,FINSEQ_3,NAT_1,CARD_3,PBOOLE,PRE_TOPC,FUNCT_7,PRALG_1,PZFMISC1,TARSKI,FUNCT_2,REALSET1,TOPS_2,PENCIL_1,PENCIL_2,CARD_1,XBOOLE_1,PUA2MSS1,FINSET_1,CARD_2,GRAPH_2,FUNCOP_1,RELAT_1,RELSET_1,XREAL_1,XXREAL_0,ORDINAL1,PARTFUN1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28;
schemes TRANSGEO,NAT_1,FINSEQ_2,PENCIL_2,FINSEQ_1,PBOOLE,CLASSES1;
registrations XBOOLE_0,SUBSET_1,RELSET_1,FUNCT_2,XXREAL_0,XREAL_0,NAT_1,CARD_1,PBOOLE,REALSET1,STRUCT_0,PENCIL_1,ORDINAL1,FUNCT_1,RELAT_1,FINSEQ_1,ZFMISC_1,PRE_POLY;
constructors XXREAL_0,PZFMISC1,TOPS_2,REALSET2,T_0TOPSP,GRAPH_2,PENCIL_2,RELSET_1,PBOOLE,FUNCT_7,PRE_POLY,CKB19,CKB21,CKB28;
requirements REAL,BOOLE,SUBSET,NUMERALS,ARITHM;
begin
definition
let I being  finite non  empty set;
let A being  PLS-yielding (ManySortedSet of I);
let f being (Collineation of ( Segre_Product A ));
let b1 being  Segre-like non  trivial-yielding (ManySortedSubset of ( Carrier A ));
assume that
A1: (for i being (Element of I) holds ( A . i ) is  strongly_connected);
assume that
A2: ( product b1 ) is (Segre-Coset of A);
func canonical_embedding (f,b1) -> (Function of ( A . ( indx b1 ) ),( A . ( ( permutation_of_indices f ) . ( indx b1 ) ) )) means 
:Def4: (it is  isomorphic & (for a being (ManySortedSet of I) holds ((a is (Point of ( Segre_Product A )) & a in ( product b1 )) implies (for b being (ManySortedSet of I) holds (b = ( f . a ) implies ( b . ( ( permutation_of_indices f ) . ( indx b1 ) ) ) = ( it . ( a . ( indx b1 ) ) ))))));
existence
proof
reconsider B1 = ( product b1 ) as (Segre-Coset of A) by A2;
set s = ( permutation_of_indices f );
set i = ( indx b1 );
defpred P[ set,set ]
 means
(for J being (ManySortedSet of I) holds (J in ( f .: ( product ( b1 +* (i,{ $1 }) ) ) ) implies $2 = ( J . ( s . i ) )));
set B = (the carrier of ( A . i ));
set t = s;
reconsider B2 = ( f .: B1 ) as (Segre-Coset of A) by A1,PENCIL_2:24;
consider b2 being  Segre-like non  trivial-yielding (ManySortedSubset of ( Carrier A )) such that A3: ( product b2 ) = B2 and A4: ( b2 . ( indx b2 ) ) = ( [#] ( A . ( indx b2 ) ) ) by PENCIL_2:def 2;
set j = ( indx b2 );
A5: f is  bijective by PENCIL_2:def 4;
then A6: ( f " B2 ) c= B1 by FUNCT_1:82;
A7: ( Segre_Product A ) = TopStruct (# ( product ( Carrier A ) ),( Segre_Blocks A ) #) by PENCIL_1:def 23;
A8: (for x being set holds (x in B implies (ex y being set st P[ x,y ])))
proof
let x being set;
consider bb being set such that A9: bb in B1 by XBOOLE_0:def 1;
A10: (ex bf being Function st ((bf = bb & ( dom bf ) = ( dom b1 )) & (for o being set holds (o in ( dom b1 ) implies ( bf . o ) in ( b1 . o ))))) by A9,CARD_3:def 5;
A11: ( dom b1 ) = I by PARTFUN1:def 2;
then reconsider bb as (ManySortedSet of I) by A10,PARTFUN1:def 2,RELAT_1:def 18;
set bbx = ( bb +* (i,x) );
A12: ( dom ( Carrier A ) ) = I by PARTFUN1:def 2;
A13: { (bbx qua set) } = ( product ( b1 +* (i,{ x }) ) )
proof
thus { (bbx qua set) } c= ( product ( b1 +* (i,{ x }) ) )
proof
A14:now
let z being set;
assume z in ( dom ( b1 +* (i,{ x }) ) );
then A15: z in I by PARTFUN1:def 2;
then A16: z in ( dom bb ) by PARTFUN1:def 2;
per cases ;
suppose A17: z = i;

then ( bbx . z ) = x by A16,FUNCT_7:31;
then ( bbx . z ) in { x } by TARSKI:def 1;
hence ( bbx . z ) in ( ( b1 +* (i,{ x }) ) . z ) by A11,A17,FUNCT_7:31;
end;
suppose A18: z <> i;

then ( bbx . z ) = ( bb . z ) by FUNCT_7:32;
then ( bbx . z ) in ( b1 . z ) by A9,A11,A15,CARD_3:9;
hence ( bbx . z ) in ( ( b1 +* (i,{ x }) ) . z ) by A18,FUNCT_7:32;
end;
end;
let o being set;
assume o in { (bbx qua set) };
then A19: o = bbx by TARSKI:def 1;
( dom bbx ) = I by PARTFUN1:def 2
.= ( dom ( b1 +* (i,{ x }) ) ) by PARTFUN1:def 2;
hence thesis by A19,A14,CARD_3:9;
end;

let o being set;
assume o in ( product ( b1 +* (i,{ x }) ) );
then consider u being Function such that A20: u = o and A21: ( dom u ) = ( dom ( b1 +* (i,{ x }) ) ) and A22: (for z being set holds (z in ( dom ( b1 +* (i,{ x }) ) ) implies ( u . z ) in ( ( b1 +* (i,{ x }) ) . z ))) by CARD_3:def 5;
A23:now
let z being set;
assume A24: z in ( dom u );
then A25: z in I by A21,PARTFUN1:def 2;
reconsider zz = z as (Element of I) by A21,A24,PARTFUN1:def 2;
A26: ( u . z ) in ( ( b1 +* (i,{ x }) ) . z ) by A21,A22,A24;
per cases ;
suppose A27: zz = i;

then ( u . z ) in { x } by A11,A26,FUNCT_7:31;
then ( u . z ) = x by TARSKI:def 1;
hence ( u . z ) = ( bbx . z ) by A10,A11,A27,FUNCT_7:31;
end;
suppose A28: zz <> i;

then ( b1 . zz ) is non  empty  trivial by PENCIL_1:def 21;
then ( b1 . zz ) is 1 -element;
then consider o being set such that A29: ( b1 . z ) = { o } by ZFMISC_1:131;
( u . z ) in ( b1 . z ) by A26,A28,FUNCT_7:32;
then A30: ( u . z ) = o by A29,TARSKI:def 1;
( bbx . z ) = ( bb . z ) by A28,FUNCT_7:32;
then ( bbx . z ) in { o } by A10,A11,A25,A29;
hence ( u . z ) = ( bbx . z ) by A30,TARSKI:def 1;
end;
end;
( dom u ) = I by A21,PARTFUN1:def 2
.= ( dom bbx ) by PARTFUN1:def 2;
then u = bbx by A23,FUNCT_1:2;
hence thesis by A20,TARSKI:def 1;
end;
assume A31: x in B;
A32:now
let o being set;
assume A33: o in ( dom ( Carrier A ) );
then reconsider u = o as (Element of I) by PARTFUN1:def 2;
per cases ;
suppose A34: u = i;

then ( bbx . u ) in ( [#] ( A . i ) ) by A31,A10,A11,FUNCT_7:31;
hence ( bbx . o ) in ( ( Carrier A ) . o ) by A34,CKB7:1;
end;
suppose A35: u <> i;

b1 c= ( Carrier A ) by PBOOLE:def 18;
then A36: ( b1 . o ) c= ( ( Carrier A ) . o ) by A12,A33,PBOOLE:def 2;
( bbx . u ) = ( bb . u ) by A35,FUNCT_7:32;
then ( bbx . u ) in ( b1 . u ) by A9,A11,CARD_3:9;
hence ( bbx . o ) in ( ( Carrier A ) . o ) by A36;
end;
end;
( dom bbx ) = I by PARTFUN1:def 2
.= ( dom ( Carrier A ) ) by PARTFUN1:def 2;
then reconsider bbx1 = bbx as (Point of ( Segre_Product A )) by A7,A32,CARD_3:9;
reconsider fbbx = ( f . bbx1 ) as (ManySortedSet of I) by PENCIL_1:14;
take ( fbbx . ( s . i ) );
( dom f ) = (the carrier of ( Segre_Product A )) by FUNCT_2:def 1;
then bbx1 in ( dom f );
then A37: ( Im (f,bbx) ) = { ( f . bbx ) } by FUNCT_1:59;
let J being (ManySortedSet of I);
assume J in ( f .: ( product ( b1 +* (i,{ x }) ) ) );
hence thesis by A13,A37,TARSKI:def 1;
end;
consider M being Function such that A38: (( dom M ) = B & (for x being set holds (x in B implies P[ x,( M . x ) ]))) from CLASSES1:sch 1(A8);
A39: ( dom f ) = (the carrier of ( Segre_Product A )) by FUNCT_2:def 1;
then B1 c= ( f " B2 ) by FUNCT_1:76;
then A40: ( f " B2 ) = B1 by A6,XBOOLE_0:def 10;
( rng M ) c= (the carrier of ( A . ( t . i ) ))
proof
let x being set;
assume x in ( rng M );
then consider o being set such that A41: o in ( dom M ) and A42: x = ( M . o ) by FUNCT_1:def 3;
reconsider o as (Point of ( A . i )) by A38,A41;
consider p being (ManySortedSet of I) such that A43: p in ( product b1 ) and A44: { (( p +* (i,o) ) qua set) } = ( product ( b1 +* (i,{ o }) ) ) by CKB18:1;
reconsider pio = ( p +* (i,o) ) as (Point of ( Segre_Product A )) by A2,A43,PENCIL_1:25;
reconsider J = ( f . pio ) as (ManySortedSet of I) by PENCIL_1:14;
( Im (f,( p +* (i,o) )) ) = { ( f . pio ) } by A39,FUNCT_1:59;
then A45: J in ( f .: ( product ( b1 +* (i,{ o }) ) ) ) by A44,TARSKI:def 1;
( s . i ) in I;
then ( s . i ) in ( dom ( Carrier A ) ) by PARTFUN1:def 2;
then ( J . ( s . i ) ) in ( ( Carrier A ) . ( s . i ) ) by A7,CARD_3:9;
then ( J . ( s . i ) ) in ( [#] ( A . ( s . i ) ) ) by CKB7:1;
hence thesis by A38,A42,A45;
end;
then reconsider M as (Function of ( A . i ),( A . ( t . i ) )) by A38,FUNCT_2:def 1,RELSET_1:4;
set m = M;
A46: ( indx b2 ) = ( s . i ) by A1,A3,CKB28:def 1;
A47: m is  one-to-one
proof
let x1 being set;
let x2 being set;
assume that
A48: (x1 in ( dom m ) & x2 in ( dom m ))
and
A49: ( m . x1 ) = ( m . x2 );
reconsider o1 = x1,o2 = x2 as (Point of ( A . i )) by A48;
consider p1 being (ManySortedSet of I) such that A50: p1 in ( product b1 ) and A51: { (( p1 +* (i,o1) ) qua set) } = ( product ( b1 +* (i,{ o1 }) ) ) by CKB18:1;
reconsider p1io = ( p1 +* (i,o1) ) as (Point of ( Segre_Product A )) by A2,A50,PENCIL_1:25;
reconsider J1 = ( f . p1io ) as (ManySortedSet of I) by PENCIL_1:14;
consider p2 being (ManySortedSet of I) such that A52: p2 in ( product b1 ) and A53: { (( p2 +* (i,o2) ) qua set) } = ( product ( b1 +* (i,{ o2 }) ) ) by CKB18:1;
A54: ( dom b1 ) = I by PARTFUN1:def 2;
A55: ( dom p1 ) = I by PARTFUN1:def 2;
A56:now
let o being set;
assume A57: o in I;
per cases ;
suppose A58: o = ( indx b1 );

then ( ( p1 +* (i,o1) ) . o ) = o1 by A55,FUNCT_7:31;
then ( ( p1 +* (i,o1) ) . o ) in ( [#] ( A . i ) );
hence ( ( p1 +* (i,o1) ) . o ) in ( b1 . o ) by A2,A58,CKB10:1;
end;
suppose o <> ( indx b1 );

then ( ( p1 +* (i,o1) ) . o ) = ( p1 . o ) by FUNCT_7:32;
hence ( ( p1 +* (i,o1) ) . o ) in ( b1 . o ) by A50,A54,A57,CARD_3:9;
end;
end;
( dom ( p1 +* (i,o1) ) ) = I by PARTFUN1:def 2;
then p1io in ( product b1 ) by A54,A56,CARD_3:9;
then A59: J1 in B2 by A39,FUNCT_1:def 6;
reconsider p2io = ( p2 +* (i,o2) ) as (Point of ( Segre_Product A )) by A2,A52,PENCIL_1:25;
reconsider J2 = ( f . p2io ) as (ManySortedSet of I) by PENCIL_1:14;
( Im (f,( p2 +* (i,o2) )) ) = { ( f . p2io ) } by A39,FUNCT_1:59;
then J2 in ( f .: ( product ( b1 +* (i,{ o2 }) ) ) ) by A53,TARSKI:def 1;
then A60: ( M . o2 ) = ( J2 . ( s . i ) ) by A38;
( dom p1 ) = I by PARTFUN1:def 2;
then A61: ( ( p1 +* (i,o1) ) . i ) = o1 by FUNCT_7:31;
A62: ( dom b1 ) = I by PARTFUN1:def 2;
A63: ( dom p2 ) = I by PARTFUN1:def 2;
A64:now
let o being set;
assume A65: o in I;
per cases ;
suppose A66: o = ( indx b1 );

then ( ( p2 +* (i,o2) ) . o ) = o2 by A63,FUNCT_7:31;
then ( ( p2 +* (i,o2) ) . o ) in ( [#] ( A . i ) );
hence ( ( p2 +* (i,o2) ) . o ) in ( b1 . o ) by A2,A66,CKB10:1;
end;
suppose o <> ( indx b1 );

then ( ( p2 +* (i,o2) ) . o ) = ( p2 . o ) by FUNCT_7:32;
hence ( ( p2 +* (i,o2) ) . o ) in ( b1 . o ) by A52,A62,A65,CARD_3:9;
end;
end;
( dom ( p2 +* (i,o2) ) ) = I by PARTFUN1:def 2;
then p2io in ( product b1 ) by A62,A64,CARD_3:9;
then A67: J2 in B2 by A39,FUNCT_1:def 6;
( Im (f,( p1 +* (i,o1) )) ) = { ( f . p1io ) } by A39,FUNCT_1:59;
then A68: J1 in ( f .: ( product ( b1 +* (i,{ o1 }) ) ) ) by A51,TARSKI:def 1;
A69:now
let o being set;
assume o in I;
then reconsider l = o as (Element of I);
per cases ;
suppose l = ( indx b2 );

hence ( J1 . o ) = ( J2 . o ) by A46,A38,A49,A68,A60;
end;
suppose l <> ( indx b2 );

hence ( J1 . o ) = ( J2 . o ) by A3,A59,A67,PENCIL_1:23;
end;
end;
( dom p2 ) = I by PARTFUN1:def 2;
then A70: ( ( p2 +* (i,o2) ) . i ) = o2 by FUNCT_7:31;
(( dom J1 ) = I & ( dom J2 ) = I) by PARTFUN1:def 2;
then J1 = J2 by A69,FUNCT_1:2;
hence thesis by A39,A5,A61,A70,FUNCT_1:def 4;
end;
f is  bijective by PENCIL_2:def 4;
then A71: ( rng f ) = (the carrier of ( Segre_Product A )) by FUNCT_2:def 3;
A72: ( f " ) = ( (f qua Function) " ) by A5,TOPS_2:def 4;
(the carrier of ( A . ( t . i ) )) c= ( rng m )
proof
let x being set;
assume x in (the carrier of ( A . ( t . i ) ));
then reconsider x1 = x as (Point of ( A . ( t . i ) ));
consider p0 being (ManySortedSet of I) such that A73: p0 in ( product b2 ) and { (( p0 +* (( indx b2 ),x1) ) qua set) } = ( product ( b2 +* (( indx b2 ),{ x1 }) ) ) by A46,CKB18:1;
reconsider p = ( p0 +* (( indx b2 ),x1) ) as (Point of ( Segre_Product A )) by A3,A46,A73,PENCIL_1:25;
reconsider p1 = p as (ManySortedSet of I);
reconsider q = ( ( f " ) . p ) as (ManySortedSet of I) by PENCIL_1:14;
A74: p = ( f . ( ( f " ) . p ) ) by A71,A5,A72,FUNCT_1:35;
A75: ( dom b1 ) = I by PARTFUN1:def 2;
A76:now
let o being set;
assume o in I;
then reconsider l = o as (Element of I);
per cases ;
suppose l = i;

then ( ( b1 +* (i,{ ( q . i ) }) ) . l ) = { ( q . o ) } by A75,FUNCT_7:31;
hence ( q . o ) in ( ( b1 +* (i,{ ( q . i ) }) ) . o ) by TARSKI:def 1;
end;
suppose l <> i;

then A77: ( ( b1 +* (i,{ ( q . i ) }) ) . l ) = ( b1 . l ) by FUNCT_7:32;
A78: ( dom b2 ) = I by PARTFUN1:def 2;
A79: ( dom p0 ) = I by PARTFUN1:def 2;
A80:now
let o being set;
assume A81: o in I;
per cases ;
suppose A82: o = ( indx b2 );

then ( p1 . o ) = x1 by A79,FUNCT_7:31;
then ( p1 . o ) in (the carrier of ( A . ( t . i ) ));
hence ( p1 . o ) in ( b2 . o ) by A1,A3,A4,A82,CKB28:def 1;
end;
suppose o <> ( indx b2 );

then ( p1 . o ) = ( p0 . o ) by FUNCT_7:32;
hence ( p1 . o ) in ( b2 . o ) by A73,A78,A81,CARD_3:9;
end;
end;
( dom p1 ) = I by PARTFUN1:def 2;
then p in ( product b2 ) by A78,A80,CARD_3:9;
then consider q0 being set such that A83: q0 in ( dom f ) and A84: q0 in B1 and A85: p = ( f . q0 ) by A3,FUNCT_1:def 6;
q = q0 by A39,A5,A74,A83,A85,FUNCT_1:def 4;
hence ( q . o ) in ( ( b1 +* (i,{ ( q . i ) }) ) . o ) by A75,A77,A84,CARD_3:9;
end;
end;
I = ( dom ( Carrier A ) ) by PARTFUN1:def 2;
then ( q . i ) in ( ( Carrier A ) . i ) by A7,CARD_3:9;
then A86: ( q . i ) in ( [#] ( A . i ) ) by CKB7:1;
(( dom q ) = I & ( dom ( b1 +* (i,{ ( q . i ) }) ) ) = I) by PARTFUN1:def 2;
then q in ( product ( b1 +* (i,{ ( q . i ) }) ) ) by A76,CARD_3:9;
then ( p0 +* (( indx b2 ),x1) ) in ( f .: ( product ( b1 +* (i,{ ( q . i ) }) ) ) ) by A39,A74,FUNCT_1:def 6;
then (( dom p0 ) = I & ( m . ( q . i ) ) = ( ( p0 +* (( indx b2 ),x1) ) . ( s . i ) )) by A38,A86,PARTFUN1:def 2;
then (( dom m ) = (the carrier of ( A . i )) & ( m . ( q . i ) ) = x) by A46,FUNCT_2:def 1,FUNCT_7:31;
hence thesis by A86,FUNCT_1:3;
end;
then A87: ( rng m ) = (the carrier of ( A . ( t . i ) )) by XBOOLE_0:def 10;
then m is  onto by FUNCT_2:def 3;
then A88: ( m " ) = ( (m qua Function) " ) by A47,TOPS_2:def 4;
A89: ( m " ) is  open
proof
let S0 being (Subset of ( A . ( t . i ) ));
assume S0 is  open;
then reconsider S = S0 as (Block of ( A . ( t . i ) )) by PRE_TOPC:def 2;
reconsider L = ( product ( b2 +* (j,S) ) ) as (Block of ( Segre_Product A )) by A46,CKB12:1;
reconsider K = ( f " L ) as (Block of ( Segre_Product A ));
consider k being  Segre-like non  trivial-yielding (ManySortedSubset of ( Carrier A )) such that A90: K = ( product k ) and A91: ( k . ( indx k ) ) is (Block of ( A . ( indx k ) )) by PENCIL_1:24;
A92: ( dom b2 ) = I by PARTFUN1:def 2;
A93:now
let x being set;
assume x in I;
per cases ;
suppose A94: x = j;

then ( ( b2 +* (j,S) ) . x ) = S by A92,FUNCT_7:31;
then ( ( b2 +* (j,S) ) . x ) c= (the carrier of ( A . ( t . i ) ));
hence ( ( b2 +* (j,S) ) . x ) c= ( b2 . x ) by A1,A3,A4,A94,CKB28:def 1;
end;
suppose x <> j;

hence ( ( b2 +* (j,S) ) . x ) c= ( b2 . x ) by FUNCT_7:32;
end;
end;
( dom ( b2 +* (j,S) ) ) = I by PARTFUN1:def 2;
then L c= ( product b2 ) by A92,A93,CARD_3:27;
then ( ( product b1 ) /\ ( product k ) ) = K by A3,A40,A90,RELAT_1:143,XBOOLE_1:28;
then A95: 2 c= ( card ( ( product b1 ) /\ ( product k ) ) ) by PENCIL_1:def 6;
then A96: ( indx k ) = i by PENCIL_1:26;
( m " S ) = ( k . ( indx k ) )
proof
thus ( m " S ) c= ( k . ( indx k ) )
proof
let o being set;
A97: ( dom b2 ) = I by PARTFUN1:def 2;
assume A98: o in ( m " S );
then reconsider u = o as (Point of ( A . i ));
consider p being (ManySortedSet of I) such that A99: p in ( product b1 ) and A100: { (( p +* (i,u) ) qua set) } = ( product ( b1 +* (i,{ u }) ) ) by CKB18:1;
reconsider q = ( p +* (i,u) ) as (Point of ( Segre_Product A )) by A2,A99,PENCIL_1:25;
reconsider fq = ( f . q ) as (ManySortedSet of I) by PENCIL_1:14;
( Im (f,( p +* (i,u) )) ) = { ( f . q ) } by A39,FUNCT_1:59;
then A101: fq in ( f .: ( product ( b1 +* (i,{ u }) ) ) ) by A100,TARSKI:def 1;
( product ( b1 +* (i,{ u }) ) ) c= ( product b1 )
proof
let a being set;
A102: ( dom b1 ) = I by PARTFUN1:def 2;
assume a in ( product ( b1 +* (i,{ u }) ) );
then consider g being Function such that A103: a = g and A104: ( dom g ) = ( dom ( b1 +* (i,{ u }) ) ) and A105: (for o being set holds (o in ( dom ( b1 +* (i,{ u }) ) ) implies ( g . o ) in ( ( b1 +* (i,{ u }) ) . o ))) by CARD_3:def 5;
A106: ( dom g ) = I by A104,PARTFUN1:def 2;
now
let o being set;
assume o in I;
then A107: ( g . o ) in ( ( b1 +* (i,{ u }) ) . o ) by A104,A105,A106;
per cases ;
suppose A108: o = i;

then ( g . o ) in { u } by A102,A107,FUNCT_7:31;
then ( g . o ) in ( [#] ( A . i ) );
hence ( g . o ) in ( b1 . o ) by A2,A108,CKB10:1;
end;
suppose o <> i;

hence ( g . o ) in ( b1 . o ) by A107,FUNCT_7:32;
end;
end;
hence thesis by A103,A106,A102,CARD_3:9;
end;
then A109: ( f .: ( product ( b1 +* (i,{ u }) ) ) ) c= ( product b2 ) by A3,RELAT_1:123;
( m . o ) in S by A98,FUNCT_1:def 7;
then A110: ( fq . ( s . i ) ) in S by A38,A101;
A111:now
let o being set;
assume A112: o in I;
per cases ;
suppose o = j;

hence ( fq . o ) in ( ( b2 +* (j,S) ) . o ) by A46,A110,A97,FUNCT_7:31;
end;
suppose o <> j;

then ( ( b2 +* (j,S) ) . o ) = ( b2 . o ) by FUNCT_7:32;
hence ( fq . o ) in ( ( b2 +* (j,S) ) . o ) by A101,A109,A97,A112,CARD_3:9;
end;
end;
(( dom fq ) = I & ( dom ( b2 +* (j,S) ) ) = I) by PARTFUN1:def 2;
then fq in L by A111,CARD_3:9;
then (( dom k ) = I & q in K) by A39,FUNCT_1:def 7,PARTFUN1:def 2;
then (( dom p ) = I & ( ( p +* (i,u) ) . i ) in ( k . i )) by A90,CARD_3:9,PARTFUN1:def 2;
hence thesis by A96,FUNCT_7:31;
end;

let o being set;
assume A113: o in ( k . ( indx k ) );
( k . ( indx k ) ) in (the topology of ( A . i )) by A91,A96;
then reconsider u = o as (Point of ( A . i )) by A113;
consider p0 being (ManySortedSet of I) such that A114: p0 in ( product b1 ) and A115: { (( p0 +* (i,u) ) qua set) } = ( product ( b1 +* (i,{ u }) ) ) by CKB18:1;
reconsider p = ( p0 +* (i,u) ) as (Point of ( Segre_Product A )) by A2,A114,PENCIL_1:25;
reconsider fp = ( f . p ) as (ManySortedSet of I) by PENCIL_1:14;
A116: ( dom b1 ) = I by PARTFUN1:def 2;
A117: ( dom p0 ) = I by PARTFUN1:def 2;
A118:now
let a being set;
assume A119: a in I;
per cases ;
suppose a = i;

hence ( ( p0 +* (i,u) ) . a ) in ( k . a ) by A96,A113,A117,FUNCT_7:31;
end;
suppose A120: a <> i;

then ( ( p0 +* (i,u) ) . a ) = ( p0 . a ) by FUNCT_7:32;
then ( ( p0 +* (i,u) ) . a ) in ( b1 . a ) by A114,A116,A119,CARD_3:9;
hence ( ( p0 +* (i,u) ) . a ) in ( k . a ) by A95,A120,PENCIL_1:26;
end;
end;
(( dom ( p0 +* (i,u) ) ) = I & ( dom k ) = I) by PARTFUN1:def 2;
then p in K by A90,A118,CARD_3:9;
then (( dom ( b2 +* (j,S) ) ) = I & fp in L) by FUNCT_1:def 7,PARTFUN1:def 2;
then (( dom b2 ) = I & ( fp . j ) in ( ( b2 +* (j,S) ) . j )) by CARD_3:9,PARTFUN1:def 2;
then A121: ( fp . ( s . i ) ) in S by A46,FUNCT_7:31;
( Im (f,( p0 +* (i,u) )) ) = { ( f . p ) } by A39,FUNCT_1:59;
then fp in ( f .: ( product ( b1 +* (i,{ u }) ) ) ) by A115,TARSKI:def 1;
then ( m . u ) = ( fp . ( s . i ) ) by A38;
hence thesis by A38,A121,FUNCT_1:def 7;
end;
then ( ( m " ) .: S ) is (Block of ( A . i )) by A47,A88,A91,A96,FUNCT_1:85;
hence thesis by PRE_TOPC:def 2;
end;
A122: m is  open
proof
let S0 being (Subset of ( A . i ));
assume S0 is  open;
then reconsider S = S0 as (Block of ( A . i )) by PRE_TOPC:def 2;
reconsider L = ( product ( b1 +* (i,S) ) ) as (Block of ( Segre_Product A )) by CKB12:1;
reconsider K = ( f .: L ) as (Block of ( Segre_Product A ));
consider k being  Segre-like non  trivial-yielding (ManySortedSubset of ( Carrier A )) such that A123: K = ( product k ) and A124: ( k . ( indx k ) ) is (Block of ( A . ( indx k ) )) by PENCIL_1:24;
A125: ( dom b1 ) = I by PARTFUN1:def 2;
A126:now
let x being set;
assume x in I;
per cases ;
suppose A127: x = i;

then ( ( b1 +* (i,S) ) . x ) = S by A125,FUNCT_7:31;
then ( ( b1 +* (i,S) ) . x ) c= ( [#] ( A . i ) );
hence ( ( b1 +* (i,S) ) . x ) c= ( b1 . x ) by A2,A127,CKB10:1;
end;
suppose x <> i;

hence ( ( b1 +* (i,S) ) . x ) c= ( b1 . x ) by FUNCT_7:32;
end;
end;
( dom ( b1 +* (i,S) ) ) = I by PARTFUN1:def 2;
then A128: L c= ( product b1 ) by A125,A126,CARD_3:27;
then ( ( product b2 ) /\ ( product k ) ) = K by A3,A123,RELAT_1:123,XBOOLE_1:28;
then 2 c= ( card ( ( product b2 ) /\ ( product k ) ) ) by PENCIL_1:def 6;
then A129: ( indx k ) = ( t . i ) by A46,PENCIL_1:26;
A130: ( dom k ) = I by PARTFUN1:def 2;
( m .: S ) = ( k . ( indx k ) )
proof
thus ( m .: S ) c= ( k . ( indx k ) )
proof
let o being set;
A131: ( dom b1 ) = I by PARTFUN1:def 2;
assume o in ( m .: S );
then consider u being set such that A132: u in ( dom m ) and A133: u in S and A134: o = ( m . u ) by FUNCT_1:def 6;
reconsider u as (Point of ( A . i )) by A132;
consider p0 being (ManySortedSet of I) such that A135: p0 in ( product b1 ) and A136: { (( p0 +* (( indx b1 ),u) ) qua set) } = ( product ( b1 +* (( indx b1 ),{ u }) ) ) by CKB18:1;
reconsider p = ( p0 +* (( indx b1 ),u) ) as (Point of ( Segre_Product A )) by A2,A135,PENCIL_1:25;
reconsider q = ( f . p ) as (ManySortedSet of I) by PENCIL_1:14;
( Im (f,( p0 +* (( indx b1 ),u) )) ) = { ( f . p ) } by A39,FUNCT_1:59;
then q in ( f .: ( product ( b1 +* (( indx b1 ),{ u }) ) ) ) by A136,TARSKI:def 1;
then A137: ( m . u ) = ( q . ( s . i ) ) by A38;
A138: ( dom p0 ) = I by PARTFUN1:def 2;
A139:now
let a being set;
assume A140: a in I;
per cases ;
suppose A141: a = i;

then ( ( p0 +* (i,u) ) . a ) = u by A138,FUNCT_7:31;
hence ( ( p0 +* (i,u) ) . a ) in ( ( b1 +* (i,S) ) . a ) by A133,A131,A141,FUNCT_7:31;
end;
suppose A142: a <> i;

then ( ( p0 +* (i,u) ) . a ) = ( p0 . a ) by FUNCT_7:32;
then ( ( p0 +* (i,u) ) . a ) in ( b1 . a ) by A135,A131,A140,CARD_3:9;
hence ( ( p0 +* (i,u) ) . a ) in ( ( b1 +* (i,S) ) . a ) by A142,FUNCT_7:32;
end;
end;
(( dom ( p0 +* (i,u) ) ) = I & ( dom ( b1 +* (i,S) ) ) = I) by PARTFUN1:def 2;
then p in L by A139,CARD_3:9;
then q in ( product k ) by A39,A123,FUNCT_1:def 6;
hence thesis by A130,A129,A134,A137,CARD_3:9;
end;

let o being set;
assume A143: o in ( k . ( indx k ) );
( k . ( indx k ) ) in (the topology of ( A . ( s . i ) )) by A124,A129;
then reconsider u = o as (Point of ( A . ( s . i ) )) by A143;
consider p0 being (ManySortedSet of I) such that A144: p0 in ( product k ) and { (( p0 +* (( s . i ),u) ) qua set) } = ( product ( k +* (( s . i ),{ u }) ) ) by A129,CKB18:1;
K in (the topology of ( Segre_Product A ));
then reconsider p = ( p0 +* (( s . i ),u) ) as (Point of ( Segre_Product A )) by A123,A144,PENCIL_1:25;
reconsider q = ( ( f " ) . p ) as (ManySortedSet of I) by PENCIL_1:14;
A145: ( dom k ) = I by PARTFUN1:def 2;
A146: ( dom p0 ) = I by PARTFUN1:def 2;
A147:now
let z being set;
assume A148: z in I;
per cases ;
suppose z = ( s . i );

hence ( ( p0 +* (( s . i ),u) ) . z ) in ( k . z ) by A129,A143,A146,FUNCT_7:31;
end;
suppose z <> ( s . i );

then ( ( p0 +* (( s . i ),u) ) . z ) = ( p0 . z ) by FUNCT_7:32;
hence ( ( p0 +* (( s . i ),u) ) . z ) in ( k . z ) by A144,A145,A148,CARD_3:9;
end;
end;
A149: p = ( f . q ) by A71,A5,A72,FUNCT_1:35;
( dom ( p0 +* (( s . i ),u) ) ) = I by PARTFUN1:def 2;
then p in ( f .: L ) by A123,A145,A147,CARD_3:9;
then (ex qq being set st ((qq in ( dom f ) & qq in L) & p = ( f . qq ))) by FUNCT_1:def 6;
then A150: q in L by A39,A5,A149,FUNCT_1:def 4;
( dom ( b1 +* (i,S) ) ) = I by PARTFUN1:def 2;
then ( q . i ) in ( ( b1 +* (i,S) ) . i ) by A150,CARD_3:9;
then A151: ( q . i ) in S by A125,FUNCT_7:31;
then reconsider qi = ( q . i ) as (Point of ( A . i ));
consider q0 being (ManySortedSet of I) such that A152: q0 in ( product b1 ) and A153: { (( q0 +* (i,qi) ) qua set) } = ( product ( b1 +* (i,{ qi }) ) ) by CKB18:1;
A154: ( dom q0 ) = I by PARTFUN1:def 2;
A155:now
let a being set;
assume a in I;
per cases ;
suppose a = i;

hence ( ( q0 +* (i,qi) ) . a ) = ( q . a ) by A154,FUNCT_7:31;
end;
suppose A156: a <> i;

then ( ( q0 +* (i,qi) ) . a ) = ( q0 . a ) by FUNCT_7:32;
hence ( ( q0 +* (i,qi) ) . a ) = ( q . a ) by A128,A150,A152,A156,PENCIL_1:23;
end;
end;
(( dom q ) = I & ( dom ( q0 +* (i,qi) ) ) = I) by PARTFUN1:def 2;
then ( q0 +* (i,qi) ) = q by A155,FUNCT_1:2;
then ( Im (f,( q0 +* (i,qi) )) ) = { ( f . q ) } by A39,FUNCT_1:59;
then p in ( f .: ( product ( b1 +* (i,{ qi }) ) ) ) by A149,A153,TARSKI:def 1;
then ( m . ( q . i ) ) = ( ( p0 +* (( s . i ),u) ) . ( s . i ) ) by A38;
then ( m . ( q . i ) ) = o by A146,FUNCT_7:31;
hence thesis by A38,A151,FUNCT_1:def 6;
end;
hence thesis by A124,A129,PRE_TOPC:def 2;
end;
take M;
A157: m is  onto by A87,FUNCT_2:def 3;
then ( m " ) is  bijective by A47,PENCIL_2:12;
hence m is  isomorphic by A47,A157,A122,A89,PENCIL_2:def 4;
let a being (ManySortedSet of I);
assume that
A158: a is (Point of ( Segre_Product A ))
and
A159: a in ( product b1 );
( dom ( Carrier A ) ) = I by PARTFUN1:def 2;
then ( a . i ) in ( ( Carrier A ) . i ) by A7,A158,CARD_3:9;
then ( a . i ) in ( [#] ( A . i ) ) by CKB7:1;
then reconsider ai = ( a . i ) as (Point of ( A . i ));
A160: ( dom b1 ) = I by PARTFUN1:def 2;
A161:now
let o being set;
assume A162: o in I;
per cases ;
suppose A163: o = i;

then ( ( b1 +* (i,{ ai }) ) . o ) = { ai } by A160,FUNCT_7:31;
hence ( a . o ) in ( ( b1 +* (i,{ ai }) ) . o ) by A163,TARSKI:def 1;
end;
suppose o <> i;

then ( ( b1 +* (i,{ ai }) ) . o ) = ( b1 . o ) by FUNCT_7:32;
hence ( a . o ) in ( ( b1 +* (i,{ ai }) ) . o ) by A159,A160,A162,CARD_3:9;
end;
end;
(( dom a ) = I & ( dom ( b1 +* (i,{ ai }) ) ) = I) by PARTFUN1:def 2;
then A164: a in ( product ( b1 +* (i,{ ai }) ) ) by A161,CARD_3:9;
let b being (ManySortedSet of I);
assume b = ( f . a );
then b in ( f .: ( product ( b1 +* (i,{ ai }) ) ) ) by A39,A158,A164,FUNCT_1:def 6;
hence thesis by A38;
end;
uniqueness
proof
set i = ( indx b1 );
set s = ( permutation_of_indices f );
let f1 being (Function of ( A . i ),( A . ( ( permutation_of_indices f ) . i ) ));
let f2 being (Function of ( A . i ),( A . ( ( permutation_of_indices f ) . i ) ));
assume that
f1 is  isomorphic
and
A165: (for a being (ManySortedSet of I) holds ((a is (Point of ( Segre_Product A )) & a in ( product b1 )) implies (for b being (ManySortedSet of I) holds (b = ( f . a ) implies ( b . ( s . i ) ) = ( f1 . ( a . i ) )))))
and
f2 is  isomorphic
and
A166: (for a being (ManySortedSet of I) holds ((a is (Point of ( Segre_Product A )) & a in ( product b1 )) implies (for b being (ManySortedSet of I) holds (b = ( f . a ) implies ( b . ( s . i ) ) = ( f2 . ( a . i ) )))));
A167:now
let x being set;
consider p being set such that A168: p in ( product b1 ) by XBOOLE_0:def 1;
assume x in ( dom f1 );
then reconsider x0 = x as (Point of ( A . i ));
reconsider p as (Point of ( Segre_Product A )) by A2,A168;
reconsider P = p as (ManySortedSet of I) by PENCIL_1:14;
set a = ( P +* (i,x0) );
reconsider a1 = a as (Point of ( Segre_Product A )) by PENCIL_1:25;
A169: ( dom b1 ) = I by PARTFUN1:def 2;
A170: ( dom P ) = I by PARTFUN1:def 2;
A171:now
let e being set;
assume A172: e in I;
per cases ;
suppose A173: e = i;

then ( a . e ) = x0 by A170,FUNCT_7:31;
then ( a . e ) in ( [#] ( A . i ) );
hence ( a . e ) in ( b1 . e ) by A2,A173,CKB10:1;
end;
suppose e <> i;

then ( a . e ) = ( P . e ) by FUNCT_7:32;
hence ( a . e ) in ( b1 . e ) by A168,A169,A172,CARD_3:9;
end;
end;
reconsider b = ( f . a1 ) as (ManySortedSet of I) by PENCIL_1:14;
( dom P ) = I by PARTFUN1:def 2;
then A174: ( a . i ) = x by FUNCT_7:31;
( dom a ) = I by PARTFUN1:def 2;
then A175: a in ( product b1 ) by A169,A171,CARD_3:9;
then ( f2 . ( a . i ) ) = ( b . ( s . i ) ) by A166;
hence ( f1 . x ) = ( f2 . x ) by A165,A175,A174;
end;
( dom f1 ) = (the carrier of ( A . i )) by FUNCT_2:def 1
.= ( dom f2 ) by FUNCT_2:def 1;
hence f1 = f2 by A167,FUNCT_1:2;
end;
end;
