environ
vocabularies NUMBERS,XBOOLE_0,STRUCT_0,PRE_TOPC,PENCIL_2,PENCIL_1,FUNCT_1,RELAT_1,TARSKI,SUBSET_1,PRALG_1,PBOOLE,ZFMISC_1,RELAT_2,FINSEQ_1,NAT_1,XXREAL_0,ARYTM_3,CARD_1,ARYTM_1,WAYBEL_3,RLVECT_2,CARD_3,INTEGRA1,FUNCT_4,FINSET_1,FDIFF_1,PARSP_1,GRAPH_2,FUNCT_2,CAT_1,RCOMP_1,FUNCOP_1,PENCIL_3;
notations TARSKI,XBOOLE_0,ZFMISC_1,XCMPLX_0,XXREAL_0,NUMBERS,NAT_1,RELAT_1,SUBSET_1,FUNCT_1,FUNCT_2,FUNCOP_1,RELSET_1,CARD_1,FINSET_1,FINSEQ_1,CARD_3,DOMAIN_1,STRUCT_0,PRE_TOPC,PBOOLE,PZFMISC1,T_0TOPSP,PRALG_1,WAYBEL_3,PENCIL_1,FUNCT_7,PENCIL_2,TOPS_2,GRAPH_2,CKB19,CKB21;
definitions TARSKI,XBOOLE_0,PBOOLE,FUNCT_1,T_0TOPSP,STRUCT_0,RELAT_1,CKB19,CKB21;
theorems XBOOLE_0,ZFMISC_1,FUNCT_1,FINSEQ_1,FINSEQ_3,NAT_1,CARD_3,PBOOLE,PRE_TOPC,FUNCT_7,PRALG_1,PZFMISC1,TARSKI,FUNCT_2,REALSET1,TOPS_2,PENCIL_1,PENCIL_2,CARD_1,XBOOLE_1,PUA2MSS1,FINSET_1,CARD_2,GRAPH_2,FUNCOP_1,RELAT_1,RELSET_1,XREAL_1,XXREAL_0,ORDINAL1,PARTFUN1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23;
schemes TRANSGEO,NAT_1,FINSEQ_2,PENCIL_2,FINSEQ_1,PBOOLE,CLASSES1;
registrations XBOOLE_0,SUBSET_1,RELSET_1,FUNCT_2,XXREAL_0,XREAL_0,NAT_1,CARD_1,PBOOLE,REALSET1,STRUCT_0,PENCIL_1,ORDINAL1,FUNCT_1,RELAT_1,FINSEQ_1,ZFMISC_1,PRE_POLY;
constructors XXREAL_0,PZFMISC1,TOPS_2,REALSET2,T_0TOPSP,GRAPH_2,PENCIL_2,RELSET_1,PBOOLE,FUNCT_7,PRE_POLY,CKB19,CKB21;
requirements REAL,BOOLE,SUBSET,NUMERALS,ARITHM;
begin
theorem
Th22: (for I being  finite non empty set holds (for A being  PLS-yielding (ManySortedSet of I) holds ((for i being (Element of I) holds ( A . i ) is  connected) implies (for i being (Element of I) holds (for p being (Point of ( A . i )) holds (for b1,b2 being  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A )) holds (((( product b2 ) is (Segre-Coset of A) & b1 = ( b2 +* (i,{ p }) )) & (not p in ( b2 . i ))) implies (ex D being (FinSequence of ( bool (the carrier of ( Segre_Product A )) )) st (((( D . 1 ) = ( product b1 ) & ( D . ( len D ) ) = ( product b2 )) & (for i being Nat holds (i in ( dom D ) implies ( D . i ) is (Segre-Coset of A)))) & (for i being Nat holds ((1 <= i & i < ( len D )) implies (for Di,Di1 being (Segre-Coset of A) holds ((Di = ( D . i ) & Di1 = ( D . ( i + 1 ) )) implies (Di misses Di1 & Di '||' Di1))))))))))))))
proof
let I being  finite non empty set;
let A being  PLS-yielding (ManySortedSet of I);
assume that
A1: (for i being (Element of I) holds ( A . i ) is  connected);
let i being (Element of I);
let p being (Point of ( A . i ));
let b1 being  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A )),b2 being  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A ));
assume that
A2: ( product b2 ) is (Segre-Coset of A)
and
A3: b1 = ( b2 +* (i,{ p }) )
and
A4: (not p in ( b2 . i ));
defpred P[ set,set ]
 means
(for a,b being (Point of ( A . i )) holds (($1 = a & $2 = b) implies a,b are_collinear ));
A5:now
assume i = ( indx b2 );
then ( b2 . i ) = ( [#] ( A . i ) ) by A2,CKB10:1;
hence contradiction by A4;
end;
then ( b2 . i ) is 1 -element by PENCIL_1:12;
then consider q being set such that A6: ( b2 . i ) = { q } by ZFMISC_1:131;
b2 c= ( Carrier A ) by PBOOLE:def 18;
then ( b2 . i ) c= ( ( Carrier A ) . i ) by PBOOLE:def 2;
then { q } c= ( [#] ( A . i ) ) by A6,CKB7:1;
then reconsider q as (Point of ( A . i )) by ZFMISC_1:31;
( A . i ) is  connected by A1;
then consider f being (FinSequence of (the carrier of ( A . i ))) such that A7: (p = ( f . 1 ) & q = ( f . ( len f ) )) and A8: (for j being Nat holds ((1 <= j & j < ( len f )) implies (for a,b being (Point of ( A . i )) holds ((a = ( f . j ) & b = ( f . ( j + 1 ) )) implies a,b are_collinear )))) by PENCIL_1:def 10;
A9: (for j being (Element of ( NAT )) holds (for x,y being set holds ((((1 <= j & j < ( len f )) & x = ( f . j )) & y = ( f . ( j + 1 ) )) implies P[ x,y ]))) by A8;
consider F being  one-to-one (FinSequence of (the carrier of ( A . i ))) such that A10: (((p = ( F . 1 ) & q = ( F . ( len F ) )) & ( rng F ) c= ( rng f )) & (for j being (Element of ( NAT )) holds ((1 <= j & j < ( len F )) implies P[ ( F . j ),( F . ( j + 1 ) ) ]))) from PENCIL_2:sch 1(A7,A9);
A11:now
assume F = ( {} );
then ( dom F ) = ( {} );
then (( F . 1 ) = ( {} ) & ( F . ( len F ) ) = ( {} )) by FUNCT_1:def 2;
hence contradiction by A4,A6,A10,TARSKI:def 1;
end;
deffunc H(set) = ( product ( b2 +* (i,{ ( F . $1 ) }) ) );
consider G being FinSequence such that A12: (( len G ) = ( len F ) & (for j being Nat holds (j in ( dom G ) implies ( G . j ) = H(j)))) from FINSEQ_1:sch 2;
( rng G ) c= ( bool (the carrier of ( Segre_Product A )) )
proof
let a being set;
assume a in ( rng G );
then consider o being set such that A13: o in ( dom G ) and A14: ( G . o ) = a by FUNCT_1:def 3;
reconsider o as (Element of ( NAT )) by A13;
( dom G ) = ( dom F ) by A12,FINSEQ_3:29;
then ( F . o ) in ( rng F ) by A13,FUNCT_1:3;
then { ( F . o ) } is (Subset of ( A . i )) by ZFMISC_1:31;
then A15: ( product ( b2 +* (i,{ ( F . o ) }) ) ) is (Subset of ( Segre_Product A )) by CKB14:1;
( G . o ) = ( product ( b2 +* (i,{ ( F . o ) }) ) ) by A12,A13;
hence thesis by A14,A15;
end;
then reconsider D = G as (FinSequence of ( bool (the carrier of ( Segre_Product A )) )) by FINSEQ_1:def 4;
take D;
A16: ( dom G ) = ( Seg ( len F ) ) by A12,FINSEQ_1:def 3;
( dom F ) = ( Seg ( len F ) ) by FINSEQ_1:def 3;
hence ( D . 1 ) = ( product b1 ) by A3,A10,A12,A16,A11,FINSEQ_3:32;
( D . ( len D ) ) = ( product ( b2 +* (i,{ ( F . ( len F ) ) }) ) ) by A12,A16,A11,FINSEQ_1:3;
hence ( D . ( len D ) ) = ( product b2 ) by A6,A10,FUNCT_7:35;
thus (for j being Nat holds (j in ( dom D ) implies ( D . j ) is (Segre-Coset of A)))
proof
let j being Nat;
assume A17: j in ( dom D );
then j in ( Seg ( len F ) ) by A12,FINSEQ_1:def 3;
then j in ( dom F ) by FINSEQ_1:def 3;
then ( F . j ) in ( rng F ) by FUNCT_1:3;
then reconsider Fj = ( F . j ) as (Point of ( A . i ));
reconsider BB = ( b2 +* (i,{ Fj }) ) as  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A )) by A5,CKB13:1;
( BB . ( indx b2 ) ) = ( b2 . ( indx b2 ) ) by A5,FUNCT_7:32;
then ( BB . ( indx b2 ) ) is non trivial by PENCIL_1:def 21;
then A18: ( indx BB ) = ( indx b2 ) by PENCIL_1:def 21;
then A19: ( BB . ( indx BB ) ) = ( b2 . ( indx b2 ) ) by A5,FUNCT_7:32
.= ( [#] ( A . ( indx BB ) ) ) by A2,A18,CKB10:1;
A20: ( D . j ) = ( product BB ) by A12,A17;
then ( D . j ) is (Subset of ( Segre_Product A )) by CKB14:1;
hence thesis by A20,A19,PENCIL_2:def 2;
end;

A21: ( dom b2 ) = I by PARTFUN1:def 2;
thus (for i being Nat holds ((1 <= i & i < ( len D )) implies (for Di,Di1 being (Segre-Coset of A) holds ((Di = ( D . i ) & Di1 = ( D . ( i + 1 ) )) implies (Di misses Di1 & Di '||' Di1)))))
proof
let j being Nat;
assume A22: (1 <= j & j < ( len D ));
let Di being (Segre-Coset of A),Di1 being (Segre-Coset of A);
assume that
A23: Di = ( D . j )
and
A24: Di1 = ( D . ( j + 1 ) );
reconsider j as (Element of ( NAT )) by ORDINAL1:def 12;
j in ( dom D ) by A22,FINSEQ_3:25;
then j in ( Seg ( len F ) ) by A12,FINSEQ_1:def 3;
then j in ( dom F ) by FINSEQ_1:def 3;
then ( F . j ) in ( rng F ) by FUNCT_1:3;
then reconsider Fj = ( F . j ) as (Point of ( A . i ));
reconsider BB1 = ( b2 +* (i,{ Fj }) ) as  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A )) by A5,CKB13:1;
A25: j in ( dom D ) by A22,FINSEQ_3:25;
then A26: ( D . j ) = ( product BB1 ) by A12;
(1 <= ( j + 1 ) & ( j + 1 ) <= ( len D )) by A22,NAT_1:13;
then ( j + 1 ) in ( dom D ) by FINSEQ_3:25;
then ( j + 1 ) in ( Seg ( len F ) ) by A12,FINSEQ_1:def 3;
then ( j + 1 ) in ( dom F ) by FINSEQ_1:def 3;
then ( F . ( j + 1 ) ) in ( rng F ) by FUNCT_1:3;
then reconsider Fj2 = ( F . ( j + 1 ) ) as (Point of ( A . i ));
reconsider BB2 = ( b2 +* (i,{ Fj2 }) ) as  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A )) by A5,CKB13:1;
(1 <= ( j + 1 ) & ( j + 1 ) <= ( len D )) by A22,NAT_1:13;
then A27: ( j + 1 ) in ( dom D ) by FINSEQ_3:25;
then A28: ( j + 1 ) in ( Seg ( len F ) ) by A12,FINSEQ_1:def 3;
A29: ( D . ( j + 1 ) ) = ( product BB2 ) by A12,A27;
A30: j in ( Seg ( len F ) ) by A12,A25,FINSEQ_1:def 3;
thus A31: Di misses Di1
proof
A32: j <> ( j + 1 );
assume ( Di /\ Di1 ) <> ( {} );
then consider x being set such that A33: x in ( Di /\ Di1 ) by XBOOLE_0:def 1;
x in Di1 by A33,XBOOLE_0:def 4;
then consider x2 being Function such that A34: x2 = x and ( dom x2 ) = ( dom ( b2 +* (i,{ ( F . ( j + 1 ) ) }) ) ) and A35: (for o being set holds (o in ( dom ( b2 +* (i,{ ( F . ( j + 1 ) ) }) ) ) implies ( x2 . o ) in ( ( b2 +* (i,{ ( F . ( j + 1 ) ) }) ) . o ))) by A24,A29,CARD_3:def 5;
( dom ( b2 +* (i,{ ( F . ( j + 1 ) ) }) ) ) = I by PARTFUN1:def 2;
then ( x2 . i ) in ( ( b2 +* (i,{ ( F . ( j + 1 ) ) }) ) . i ) by A35;
then ( x2 . i ) in { ( F . ( j + 1 ) ) } by A21,FUNCT_7:31;
then A36: ( x2 . i ) = ( F . ( j + 1 ) ) by TARSKI:def 1;
x in Di by A33,XBOOLE_0:def 4;
then consider x1 being Function such that A37: x1 = x and ( dom x1 ) = ( dom ( b2 +* (i,{ ( F . j ) }) ) ) and A38: (for o being set holds (o in ( dom ( b2 +* (i,{ ( F . j ) }) ) ) implies ( x1 . o ) in ( ( b2 +* (i,{ ( F . j ) }) ) . o ))) by A23,A26,CARD_3:def 5;
( dom ( b2 +* (i,{ ( F . j ) }) ) ) = I by PARTFUN1:def 2;
then ( x1 . i ) in ( ( b2 +* (i,{ ( F . j ) }) ) . i ) by A38;
then ( x1 . i ) in { ( F . j ) } by A21,FUNCT_7:31;
then A39: ( x1 . i ) = ( F . j ) by TARSKI:def 1;
(j in ( dom F ) & ( j + 1 ) in ( dom F )) by A30,A28,FINSEQ_1:def 3;
hence contradiction by A37,A34,A39,A36,A32,FUNCT_1:def 4;
end;

now
let c1 being  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A )),c2 being  Segre-like non trivial-yielding (ManySortedSubset of ( Carrier A ));
assume that
A40: Di = ( product c1 )
and
A41: Di1 = ( product c2 );
A42: c2 = ( b2 +* (i,{ ( F . ( j + 1 ) ) }) ) by A24,A29,A41,PUA2MSS1:2;
then ( c2 . ( indx b2 ) ) = ( b2 . ( indx b2 ) ) by A5,FUNCT_7:32;
then A43: ( c2 . ( indx b2 ) ) is non trivial by PENCIL_1:def 21;
A44: c1 = ( b2 +* (i,{ ( F . j ) }) ) by A23,A26,A40,PUA2MSS1:2;
then ( c1 . ( indx b2 ) ) = ( b2 . ( indx b2 ) ) by A5,FUNCT_7:32;
then A45: ( c1 . ( indx b2 ) ) is non trivial by PENCIL_1:def 21;
then ( indx c1 ) = ( indx b2 ) by PENCIL_1:def 21;
hence ( indx c1 ) = ( indx c2 ) by A43,PENCIL_1:def 21;
take r = i;
thus r <> ( indx c1 ) by A5,A45,PENCIL_1:def 21;
thus (for j being (Element of I) holds (j <> r implies ( c1 . j ) = ( c2 . j )))
proof
let j being (Element of I);
assume A46: j <> r;
hence ( c1 . j ) = ( b2 . j ) by A44,FUNCT_7:32
.= ( c2 . j ) by A42,A46,FUNCT_7:32;
end;

thus (for p1,p2 being (Point of ( A . r )) holds ((( c1 . r ) = { p1 } & ( c2 . r ) = { p2 }) implies p1,p2 are_collinear ))
proof
let p1 being (Point of ( A . r )),p2 being (Point of ( A . r ));
assume that
A47: ( c1 . r ) = { p1 }
and
A48: ( c2 . r ) = { p2 };
( c2 . r ) = { ( F . ( j + 1 ) ) } by A21,A42,FUNCT_7:31;
then A49: ( F . ( j + 1 ) ) = p2 by A48,ZFMISC_1:3;
( c1 . r ) = { ( F . j ) } by A21,A44,FUNCT_7:31;
then ( F . j ) = p1 by A47,ZFMISC_1:3;
hence thesis by A10,A12,A22,A49;
end;

end;
hence thesis by A31,CKB23:1;
end;

end;
