environ
vocabularies NUMBERS,REAL_1,SUBSET_1,SEQ_1,FDIFF_1,FUNCT_1,RCOMP_1,PARTFUN1,ARYTM_1,VALUED_0,SEQ_2,ORDINAL2,CARD_1,RELAT_1,ARYTM_3,XREAL_0,ORDINAL1,XXREAL_0,COMPLEX1,NAT_1,TARSKI,VALUED_1,FUNCT_2,FUNCOP_1,XXREAL_1,FCONT_1,SQUARE_1,XBOOLE_0,ORDINAL4,LIMFUNC1;
notations TARSKI,XBOOLE_0,SUBSET_1,ORDINAL1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,COMPLEX1,REAL_1,NAT_1,FUNCT_1,FUNCT_2,VALUED_0,VALUED_1,SEQ_1,RELSET_1,SEQ_2,PARTFUN1,SQUARE_1,PARTFUN2,RFUNCT_1,RCOMP_1,FCONT_1,FDIFF_1,LIMFUNC1,RECDEF_1,CKB1;
definitions TARSKI,XBOOLE_0,FDIFF_1,SQUARE_1,SUBSET_1,LIMFUNC1,PROB_1,VALUED_0,VALUED_1,SEQM_3;
theorems TARSKI,FUNCT_1,FUNCT_2,NAT_1,SEQ_1,SEQ_2,SEQM_3,SEQ_4,ABSVALUE,PARTFUN1,PARTFUN2,RCOMP_1,RFUNCT_1,RFUNCT_2,FCONT_1,FDIFF_1,SCHEME1,ROLLE,FCONT_3,FUNCT_3,RELAT_1,RELSET_1,XBOOLE_0,XBOOLE_1,XCMPLX_0,XCMPLX_1,COMPLEX1,FUNCOP_1,XREAL_1,XXREAL_0,ORDINAL1,VALUED_1,XXREAL_1,VALUED_0,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB12;
schemes NAT_1,RECDEF_1,SEQ_1,SCHEME1,FUNCT_2,CKB11;
registrations ORDINAL1,RELSET_1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,NAT_1,MEMBERED,SEQM_3,RCOMP_1,RFUNCT_2,FDIFF_1,FCONT_3,VALUED_0,VALUED_1,FUNCT_2,FUNCOP_1,SEQ_4;
constructors PARTFUN1,REAL_1,SQUARE_1,NAT_1,COMPLEX1,SEQ_2,SEQM_3,PROB_1,RCOMP_1,PARTFUN2,RFUNCT_1,RFUNCT_2,FCONT_1,LIMFUNC1,FDIFF_1,SEQ_1,VALUED_1,RECDEF_1,RELSET_1,BINOP_2,RVSUM_1,CKB1;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
reserve x0 for Real;
reserve g for Real;
reserve g1 for Real;
reserve n for (Element of ( NAT ));
reserve k for (Element of ( NAT ));
reserve h for  convergent_to_0 Real_Sequence;
reserve h1 for  convergent_to_0 Real_Sequence;
reserve c for  constant Real_Sequence;
reserve c1 for  constant Real_Sequence;
reserve f for (PartFunc of ( REAL ),( REAL ));
theorem
Lm1: (((ex N being (Neighbourhood of x0) st N c= ( dom f )) & (for h holds (for c holds ((( rng c ) = { x0 } & ( rng ( h + c ) ) c= ( dom f )) implies ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent)))) implies (f is_differentiable_in x0 & (for h holds (for c holds ((( rng c ) = { x0 } & ( rng ( h + c ) ) c= ( dom f )) implies ( diff (f,x0) ) = ( lim ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) ))))))
proof
deffunc G(Real) = ( 0 );
defpred P[ set ]
 means
$1 in ( REAL );
given N being (Neighbourhood of x0) such that
A1: N c= ( dom f );

assume A2: (for h holds (for c holds ((( rng c ) = { x0 } & ( rng ( h + c ) ) c= ( dom f )) implies ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent)));
then A3: (for h holds (for c holds (((( rng c ) = { x0 } & ( rng ( h + c ) ) c= ( dom f )) & { x0 } c= ( dom f )) implies ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent)));
consider r being  real number such that A4: ( 0 ) < r and A5: N = ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 6;
consider h,c such that A6: ( rng c ) = { x0 } and A7: ( rng ( h + c ) ) c= ( dom f ) and A8: { x0 } c= ( dom f ) by A1,CKB9:1;
set l = ( lim ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) );
deffunc F(Real) = ( l * $1 );
consider L being (PartFunc of ( REAL ),( REAL )) such that A9: (for g holds (g in ( dom L ) iff P[ g ])) and A10: (for g holds (g in ( dom L ) implies ( L . g ) = F(g))) from SEQ_1:sch 3;
A11: ( dom L ) = ( REAL ) by A9,FDIFF_1:1;
then A12: (for g holds ( L . g ) = ( l * g )) by A10;
A13: L is  total by A11,PARTFUN1:def 2;
deffunc F(Real) = ( $1 + x0 );
consider T being (PartFunc of ( REAL ),( REAL )) such that A14: (for g holds (g in ( dom T ) iff P[ g ])) and A15: (for g holds (g in ( dom T ) implies ( T . g ) = F(g))) from SEQ_1:sch 3;
A16: ( dom T ) = ( REAL ) by A14,FDIFF_1:1;
deffunc F( real number) = ( ( ( f * T ) . $1 ) - ( f . x0 ) );
consider T1 being (PartFunc of ( REAL ),( REAL )) such that A17: (for g holds (g in ( dom T1 ) iff P[ g ])) and A18: (for g holds (g in ( dom T1 ) implies ( T1 . g ) = F(g))) from SEQ_1:sch 3;
deffunc F(Real) = ( ( T1 - L ) . $1 );
A19: ( dom T1 ) = ( REAL ) by A17,FDIFF_1:1;
then A20: T1 is  total by PARTFUN1:def 2;
reconsider L as LINEAR by A13,A12,FDIFF_1:def 3;
defpred P[ set ]
 means
$1 in ]. ( - r ),r .[;
consider R being (PartFunc of ( REAL ),( REAL )) such that A21: R is  total and A22: (for g holds (g in ( dom R ) implies ((P[ g ] implies ( R . g ) = F(g)) & ((not P[ g ]) implies ( R . g ) = G(g))))) from SCHEME1:sch 8;
A23: ( dom R ) = ( REAL ) by A21,PARTFUN1:def 2;
A24:now
let n;
( c . n ) in { x0 } by A6,VALUED_0:28;
hence ( c . n ) = x0 by TARSKI:def 1;
end;
now
let h1;
A25: ( lim h1 ) = ( 0 ) by FDIFF_1:def 1;
h1 is  convergent by FDIFF_1:def 1;
then consider k such that A26: (for n holds (k <= n implies ( abs ( ( h1 . n ) - ( 0 ) ) ) < r)) by A4,A25,SEQ_2:def 7;
set h2 = ( h1 ^\ k );
A27:now
let n;
( abs ( ( h1 . ( n + k ) ) - ( 0 ) ) ) < r by A26,NAT_1:12;
then ( h1 . ( n + k ) ) in ]. ( ( 0 ) - r ),( ( 0 ) + r ) .[ by RCOMP_1:1;
hence ( h2 . n ) in ]. ( - r ),r .[ by NAT_1:def 3;
end;
A28: ( rng ( h2 + c ) ) c= ( dom f )
proof
let x;
assume x in ( rng ( h2 + c ) );
then consider n such that A29: x = ( ( h2 + c ) . n ) by FUNCT_2:113;
( h2 . n ) in ]. ( - r ),r .[ by A27;
then ( h2 . n ) in { g: (( - r ) < g & g < r) } by RCOMP_1:def 2;
then A30: (ex g st ((g = ( h2 . n ) & ( - r ) < g) & g < r));
then A31: ( ( h2 . n ) + x0 ) < ( x0 + r ) by XREAL_1:6;
( x0 + ( - r ) ) < ( ( h2 . n ) + x0 ) by A30,XREAL_1:6;
then A32: ( ( h2 . n ) + x0 ) in { g: (( x0 - r ) < g & g < ( x0 + r )) } by A31;
x = ( ( h2 . n ) + ( c . n ) ) by A29,SEQ_1:7
.= ( ( h2 . n ) + x0 ) by A24;
then x in ]. ( x0 - r ),( x0 + r ) .[ by A32,RCOMP_1:def 2;
hence thesis by A1,A5;
end;
set b = ( ( h2 " ) (#) ( L /* h2 ) );
set a = ( ( h2 " ) (#) ( T1 /* h2 ) );
A33: ( ( ( h1 " ) (#) ( R /* h1 ) ) ^\ k ) = ( ( ( h1 " ) ^\ k ) (#) ( ( R /* h1 ) ^\ k ) ) by SEQM_3:19
.= ( ( h2 " ) (#) ( ( R /* h1 ) ^\ k ) ) by SEQM_3:18
.= ( ( h2 " ) (#) ( R /* h2 ) ) by A21,VALUED_0:29;
A34: ( a - b ) = ( ( h2 " ) (#) ( ( T1 /* h2 ) - ( L /* h2 ) ) ) by SEQ_1:21
.= ( ( h2 " ) (#) ( ( T1 - L ) /* h2 ) ) by A13,A20,RFUNCT_2:13;
A35:now
let n;
A36: ( h2 . n ) in ]. ( - r ),r .[ by A27;
thus ( ( a - b ) . n ) = ( ( ( h2 " ) . n ) * ( ( ( T1 - L ) /* h2 ) . n ) ) by A34,SEQ_1:8
.= ( ( ( h2 " ) . n ) * ( ( T1 - L ) . ( h2 . n ) ) ) by A13,A20,FUNCT_2:115
.= ( ( ( h2 " ) . n ) * ( R . ( h2 . n ) ) ) by A22,A23,A36
.= ( ( ( h2 " ) . n ) * ( ( R /* h2 ) . n ) ) by A21,FUNCT_2:115
.= ( ( ( h2 " ) (#) ( R /* h2 ) ) . n ) by SEQ_1:8;
end;
A37: h2 is  non-zero by FDIFF_1:def 1;
A38:now
let n being Nat;
A39: n in ( NAT ) by ORDINAL1:def 12;
then A40: ( h2 . n ) <> ( 0 ) by A37,SEQ_1:5;
thus ( b . n ) = ( ( ( h2 " ) . n ) * ( ( L /* h2 ) . n ) ) by A39,SEQ_1:8
.= ( ( ( h2 " ) . n ) * ( L . ( h2 . n ) ) ) by A13,A39,FUNCT_2:115
.= ( ( ( h2 " ) . n ) * ( ( h2 . n ) * l ) ) by A10,A11
.= ( ( ( ( h2 " ) . n ) * ( h2 . n ) ) * l )
.= ( ( ( ( h2 . n ) " ) * ( h2 . n ) ) * l ) by VALUED_1:10
.= ( 1 * l ) by A40,XCMPLX_0:def 7
.= l;
end;
then A41: b is  constant by VALUED_0:def 18;
now
let n;
A42: ( c . n ) = x0 by A24;
thus ( a . n ) = ( ( ( h2 " ) . n ) * ( ( T1 /* h2 ) . n ) ) by SEQ_1:8
.= ( ( ( h2 " ) . n ) * ( T1 . ( h2 . n ) ) ) by A20,FUNCT_2:115
.= ( ( ( h2 " ) . n ) * ( ( ( f * T ) . ( h2 . n ) ) - ( f . x0 ) ) ) by A18,A19
.= ( ( ( h2 " ) . n ) * ( ( f . ( T . ( h2 . n ) ) ) - ( f . x0 ) ) ) by A16,FUNCT_1:13
.= ( ( ( h2 " ) . n ) * ( ( f . ( ( h2 . n ) + x0 ) ) - ( f . x0 ) ) ) by A15,A16
.= ( ( ( h2 " ) . n ) * ( ( f . ( ( h2 + c ) . n ) ) - ( f . ( c . n ) ) ) ) by A42,SEQ_1:7
.= ( ( ( h2 " ) . n ) * ( ( f . ( ( h2 + c ) . n ) ) - ( ( f /* c ) . n ) ) ) by A6,A8,FUNCT_2:108
.= ( ( ( h2 " ) . n ) * ( ( ( f /* ( h2 + c ) ) . n ) - ( ( f /* c ) . n ) ) ) by A28,FUNCT_2:108
.= ( ( ( h2 " ) . n ) * ( ( ( f /* ( h2 + c ) ) - ( f /* c ) ) . n ) ) by RFUNCT_2:1
.= ( ( ( h2 " ) (#) ( ( f /* ( h2 + c ) ) - ( f /* c ) ) ) . n ) by SEQ_1:8;
end;
then A43: a = ( ( h2 " ) (#) ( ( f /* ( h2 + c ) ) - ( f /* c ) ) ) by FUNCT_2:63;
then A44: a is  convergent by A2,A6,A28;
then ( a - b ) is  convergent by A41,SEQ_2:11;
then A45: ( ( h2 " ) (#) ( R /* h2 ) ) is  convergent by A35,FUNCT_2:63;
hence ( ( h1 " ) (#) ( R /* h1 ) ) is  convergent by A33,SEQ_4:21;
A46: l = ( lim a ) by A3,A6,A7,A8,A28,A43,CKB8:1;
( lim b ) = ( b . ( 0 ) ) by A41,SEQ_4:25
.= l by A38;
then ( lim ( a - b ) ) = ( l - l ) by A44,A46,A41,SEQ_2:12
.= ( 0 );
then ( lim ( ( h2 " ) (#) ( R /* h2 ) ) ) = ( 0 ) by A35,FUNCT_2:63;
hence ( lim ( ( h1 " ) (#) ( R /* h1 ) ) ) = ( 0 ) by A45,A33,SEQ_4:22;
end;
then reconsider R as REST by A21,FDIFF_1:def 2;
A47:now
take N;
thus N c= ( dom f ) by A1;
take L;
take R;
thus ( L . 1 ) = ( l * 1 ) by A10,A11
.= l;
let g1;
assume g1 in N;
then ( g1 - x0 ) in ]. ( - r ),r .[ by A5,FCONT_3:2;
hence ( ( L . ( g1 - x0 ) ) + ( R . ( g1 - x0 ) ) ) = ( ( L . ( g1 - x0 ) ) + ( ( T1 - L ) . ( g1 - x0 ) ) ) by A22,A23
.= ( ( L . ( g1 - x0 ) ) + ( ( T1 . ( g1 - x0 ) ) - ( L . ( g1 - x0 ) ) ) ) by A13,A20,RFUNCT_1:56
.= ( ( ( f * T ) . ( g1 - x0 ) ) - ( f . x0 ) ) by A18,A19
.= ( ( f . ( T . ( g1 - x0 ) ) ) - ( f . x0 ) ) by A16,FUNCT_1:13
.= ( ( f . ( ( g1 - x0 ) + x0 ) ) - ( f . x0 ) ) by A15,A16
.= ( ( f . g1 ) - ( f . x0 ) );
end;
thus f is_differentiable_in x0
proof
consider N1 being (Neighbourhood of x0) such that A48: N1 c= ( dom f ) and A49: (ex L being LINEAR st (ex R being REST st (( L . 1 ) = l & (for g holds (g in N1 implies ( ( f . g ) - ( f . x0 ) ) = ( ( L . ( g - x0 ) ) + ( R . ( g - x0 ) ) )))))) by A47;
take N1;
thus N1 c= ( dom f ) by A48;
consider L1 being LINEAR,R1 being REST such that ( L1 . 1 ) = l and A50: (for g holds (g in N1 implies ( ( f . g ) - ( f . x0 ) ) = ( ( L1 . ( g - x0 ) ) + ( R1 . ( g - x0 ) ) ))) by A49;
take L1;
take R1;
thus thesis by A50;
end;

then A51: ( diff (f,x0) ) = l by A47,FDIFF_1:def 5;
let h1;
let c1;
assume that
A52: ( rng c1 ) = { x0 }
and
A53: ( rng ( h1 + c1 ) ) c= ( dom f );
c1 = c by A6,A52,CKB6:1;
hence thesis by A3,A6,A7,A8,A51,A53,CKB8:1;
end;
