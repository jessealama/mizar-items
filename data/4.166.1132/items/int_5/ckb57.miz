environ
vocabularies NUMBERS,SUBSET_1,INT_1,NAT_1,FINSEQ_1,NEWTON,ARYTM_3,ARYTM_1,RELAT_1,CARD_1,FUNCT_1,CARD_3,FUNCOP_1,ORDINAL4,XBOOLE_0,TARSKI,XXREAL_0,FINSEQ_5,SQUARE_1,INT_2,COMPLEX1,ORDINAL1,ABIAN,FINSEQ_2,FUNCT_7,PARTFUN1,FINSET_1,RFINSEQ,CALCUL_2,REAL_1,ZFMISC_1,INT_5;
notations GROUP_4,INT_1,RVSUM_1,FINSET_1,ORDINAL1,CARD_1,NAT_D,INT_2,FUNCT_1,RELSET_1,PARTFUN1,FUNCT_2,NAT_3,ABIAN,GR_CY_1,FINSEQ_5,FINSEQ_2,EULER_2,NEWTON,GOBRD10,FINSEQ_7,REAL_1,PEPIN,TARSKI,XBOOLE_0,SUBSET_1,XCMPLX_0,NUMBERS,XXREAL_0,NAT_1,DOMAIN_1,FINSEQ_1,RFINSEQ,FUNCOP_1,CALCUL_2,ZFMISC_1,CARD_3,WSIERP_1,BINOP_1,PROB_3,RECDEF_1,CKB4,CKB11,CKB29,CKB54;
definitions INT_1,FUNCT_1,XCMPLX_0,SQUARE_1,FINSEQ_2,TARSKI,CALCUL_2,CARD_3,CKB4,CKB11,CKB29;
theorems FINSEQ_1,FINSEQ_7,RELAT_1,FINSEQ_3,FINSEQ_2,ABSVALUE,FINSEQ_5,EULER_2,INT_3,SEQ_2,FINSEQ_4,FUNCT_2,XBOOLE_0,NAT_3,NEWTON,INT_2,NAT_2,WSIERP_1,CARD_1,PEPIN,NAT_1,XCMPLX_1,XREAL_1,HEYTING3,ORDINAL1,EULER_1,XBOOLE_1,TARSKI,RVSUM_1,NUMBERS,INT_1,FUNCT_1,FUNCOP_1,XXREAL_0,NAT_D,HILBERT3,GOBRD10,SERIES_2,GRAPH_5,HILBERT2,RFINSEQ,ZFMISC_1,CARD_2,XREAL_0,FINSEQ_6,CALCUL_2,NAT_4,PROB_3,TOPREAL7,CARD_3,REAL_3,PRE_FF,INT_4,VALUED_1,PRE_POLY,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB55,CKB56;
schemes NAT_1,FUNCT_2,RECDEF_1,FINSEQ_2,FUNCT_7,FINSEQ_1;
registrations XXREAL_0,MEMBERED,RELAT_1,FINSEQ_1,ORDINAL1,WSIERP_1,NUMBERS,XBOOLE_0,XREAL_0,NAT_1,INT_1,FINSET_1,NAT_3,RVSUM_1,FUNCT_1,CARD_1,NEWTON,SUBSET_1,VALUED_0,VALUED_1,FINSEQ_2,PRE_POLY,CARD_3,RELSET_1;
constructors BINARITH,ABIAN,WSIERP_1,PEPIN,UPROOTS,NAT_3,NAT_D,REALSET1,GR_CY_1,FINSEQ_5,GOBRD10,EULER_2,RFINSEQ,GROUP_4,FINSEQ_7,REAL_1,WELLORD2,CALCUL_2,SETFAM_1,PROB_3,SEQ_1,RECDEF_1,BINOP_1,BINOP_2,CLASSES1,RELSET_1,CKB4,CKB11,CKB29,CKB54;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve d for Nat;
reserve e for Nat;
reserve p for Prime;
reserve q for Prime;
theorem
Th49: (((p > 2 & q > 2) & p <> q) implies ( ( Lege (p,q) ) * ( Lege (q,p) ) ) = ( ( - 1 ) |^ ( ( ( p -' 1 ) div 2 ) * ( ( q -' 1 ) div 2 ) ) ))
proof
assume that
A1: p > 2
and
A2: q > 2
and
A3: p <> q;
A4: q,p are_relative_prime  by A3,INT_2:30;
then A5: ( q gcd p ) = 1 by INT_2:def 3;
reconsider p,q as  prime (Element of ( NAT )) by ORDINAL1:def 12;
set p9 = ( ( p -' 1 ) div 2 );
A6: p > 1 by INT_2:def 4;
then A7: ( p -' 1 ) = ( p - 1 ) by XREAL_1:233;
then A8: ( p -' 1 ) > ( 0 ) by A6,XREAL_1:50;
p is  odd by A1,PEPIN:17;
then A9: ( p -' 1 ) is  even by A7,HILBERT3:2;
then A10: 2 divides ( p -' 1 ) by PEPIN:22;
then A11: ( p -' 1 ) = ( 2 * p9 ) by NAT_D:3;
then p9 divides ( p -' 1 ) by NAT_D:def 3;
then p9 <= ( p -' 1 ) by A8,NAT_D:7;
then A12: p9 < p by A7,XREAL_1:146,XXREAL_0:2;
set f1 = ( q * ( idseq p9 ) );
A13: (for d holds (d in ( dom f1 ) implies ( f1 . d ) = ( q * d )))
proof
let d;
assume A14: d in ( dom f1 );
then d in ( dom ( idseq p9 ) ) by VALUED_1:def 5;
then d in ( Seg ( len ( idseq p9 ) ) ) by FINSEQ_1:def 3;
then A15: d is (Element of ( Seg p9 )) by CARD_1:def 7;
( f1 . d ) = ( q * ( ( idseq p9 ) . d ) ) by A14,VALUED_1:def 5;
hence thesis by A15,FINSEQ_2:49;
end;
A16: (for d being Nat holds (d in ( dom f1 ) implies ( f1 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom f1 );
then ( f1 . d ) = ( q * d ) by A13;
hence thesis;
end;
( dom f1 ) = ( dom ( idseq p9 ) ) by VALUED_1:def 5;
then A17: ( len f1 ) = ( len ( idseq p9 ) ) by FINSEQ_3:29;
then A18: ( len f1 ) = p9 by CARD_1:def 7;
set q9 = ( ( q -' 1 ) div 2 );
set g1 = ( p * ( idseq q9 ) );
A19: (for d holds (d in ( dom g1 ) implies ( g1 . d ) = ( p * d )))
proof
let d;
assume A20: d in ( dom g1 );
then d in ( dom ( idseq q9 ) ) by VALUED_1:def 5;
then d in ( Seg ( len ( idseq q9 ) ) ) by FINSEQ_1:def 3;
then A21: d is (Element of ( Seg q9 )) by CARD_1:def 7;
( g1 . d ) = ( p * ( ( idseq q9 ) . d ) ) by A20,VALUED_1:def 5;
hence thesis by A21,FINSEQ_2:49;
end;
A22: (for d being Nat holds (d in ( dom g1 ) implies ( g1 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom g1 );
then ( g1 . d ) = ( p * d ) by A19;
hence thesis;
end;
( dom g1 ) = ( dom ( idseq q9 ) ) by VALUED_1:def 5;
then ( len g1 ) = ( len ( idseq q9 ) ) by FINSEQ_3:29;
then A23: ( len g1 ) = q9 by CARD_1:def 7;
reconsider g1 as (FinSequence of ( NAT )) by A22,FINSEQ_2:12;
set g3 = ( g1 mod q );
set g4 = ( Sgm ( rng g3 ) );
A24: ( len g3 ) = ( len g1 ) by EULER_2:def 1;
then A25: ( dom g1 ) = ( dom g3 ) by FINSEQ_3:29;
set XX = { k where k is (Element of ( NAT )): (k in ( rng g4 ) & k > ( q / 2 )) };
(for x being set holds (x in XX implies x in ( rng g4 )))
proof
let x being set;
assume x in XX;
then (ex k being (Element of ( NAT )) st ((x = k & k in ( rng g4 )) & k > ( q / 2 )));
hence thesis;
end;
then A26: XX c= ( rng g4 ) by TARSKI:def 3;
reconsider f1 as (FinSequence of ( NAT )) by A16,FINSEQ_2:12;
deffunc F(Nat) = ( ( f1 . $1 ) div p );
consider f2 being FinSequence such that A27: (( len f2 ) = p9 & (for d being Nat holds (d in ( dom f2 ) implies ( f2 . d ) = F(d)))) from FINSEQ_1:sch 2;
A28: q > 1 by INT_2:def 4;
then A29: ( q -' 1 ) = ( q - 1 ) by XREAL_1:233;
then A30: ( q -' 1 ) > ( 0 ) by A28,XREAL_1:50;
q >= ( 2 + 1 ) by A2,NAT_1:13;
then ( q - 1 ) >= ( 3 - 1 ) by XREAL_1:9;
then A31: q9 >= 1 by A29,NAT_2:13;
then ( len g3 ) >= 1 by A23,EULER_2:def 1;
then g3 <> ( {} );
then ( rng g3 ) is  finite non empty  finite non empty (Subset of ( NAT )) by FINSEQ_1:def 4;
then consider n2 being (Element of ( NAT )) such that A32: ( rng g3 ) c= ( ( Seg n2 ) \/ { ( 0 ) } ) by HEYTING3:1;
deffunc F(Nat) = ( ( g1 . $1 ) div q );
consider g2 being FinSequence such that A33: (( len g2 ) = q9 & (for d being Nat holds (d in ( dom g2 ) implies ( g2 . d ) = F(d)))) from FINSEQ_1:sch 2;
(for d being Nat holds (d in ( dom g2 ) implies ( g2 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom g2 );
then ( g2 . d ) = ( ( g1 . d ) div q ) by A33;
hence thesis;
end;
then reconsider g2 as (FinSequence of ( NAT )) by FINSEQ_2:12;
A34: ( dom g1 ) = ( dom g2 ) by A23,A33,FINSEQ_3:29;
A35: (for d holds (d in ( dom g1 ) implies ( g1 . d ) = ( ( ( g2 . d ) * q ) + ( g3 . d ) )))
proof
let d;
assume A36: d in ( dom g1 );
then A37: ( g3 . d ) = ( ( g1 . d ) mod q ) by EULER_2:def 1;
( g2 . d ) = ( ( g1 . d ) div q ) by A33,A34,A36;
hence thesis by A37,NAT_D:2;
end;
q is  odd by A2,PEPIN:17;
then A38: ( q -' 1 ) is  even by A29,HILBERT3:2;
then A39: 2 divides ( q -' 1 ) by PEPIN:22;
then A40: ( q -' 1 ) = ( 2 * q9 ) by NAT_D:3;
then q9 divides ( q -' 1 ) by NAT_D:def 3;
then q9 <= ( q -' 1 ) by A30,NAT_D:7;
then A41: q9 < q by A29,XREAL_1:146,XXREAL_0:2;
(not ( 0 ) in ( rng g3 ))
proof
assume ( 0 ) in ( rng g3 );
then consider a being Nat such that A42: a in ( dom g3 ) and A43: ( g3 . a ) = ( 0 ) by FINSEQ_2:10;
a in ( dom g1 ) by A24,A42,FINSEQ_3:29;
then A44: ( g1 . a ) = ( ( ( g2 . a ) * q ) + ( 0 ) ) by A35,A43;
a in ( dom g1 ) by A24,A42,FINSEQ_3:29;
then ( p * a ) = ( ( g2 . a ) * q ) by A19,A44;
then A45: q divides ( p * a ) by NAT_D:def 3;
a >= 1 by A42,FINSEQ_3:25;
then A46: q <= a by A4,A45,NAT_D:7,PEPIN:3;
a <= q9 by A23,A24,A42,FINSEQ_3:25;
hence contradiction by A41,A46,XXREAL_0:2;
end;
then A47: { ( 0 ) } misses ( rng g3 ) by ZFMISC_1:50;
then A48: g4 is  one-to-one by A32,FINSEQ_3:92,XBOOLE_1:73;
A49: (for d holds (for e holds (((d in ( dom g1 ) & e in ( dom g1 )) & q divides ( ( g1 . d ) - ( g1 . e ) )) implies d = e)))
proof
A50: q,(p qua Integer) are_relative_prime  by A3,INT_2:30;
let d;
let e;
assume that
A51: d in ( dom g1 )
and
A52: e in ( dom g1 )
and
A53: q divides ( ( g1 . d ) - ( g1 . e ) );
A54: ( g1 . e ) = ( p * e ) by A19,A52;
( g1 . d ) = ( p * d ) by A19,A51;
then A55: q divides ( ( d - e ) * p ) by A53,A54;
now
assume d <> e;
then ( d - e ) <> ( 0 );
then ( abs q ) <= ( abs ( d - e ) ) by A55,A50,INT_2:25,INT_4:6;
then A56: q <= ( abs ( d - e ) ) by ABSVALUE:def 1;
A57: e >= 1 by A52,FINSEQ_3:25;
A58: d >= 1 by A51,FINSEQ_3:25;
e <= q9 by A23,A52,FINSEQ_3:25;
then A59: ( d - e ) >= ( 1 - q9 ) by A58,XREAL_1:13;
A60: ( q9 - 1 ) < q by A41,XREAL_1:147;
d <= q9 by A23,A51,FINSEQ_3:25;
then ( d - e ) <= ( q9 - 1 ) by A57,XREAL_1:13;
then A61: ( d - e ) < q by A60,XXREAL_0:2;
( - ( q9 - 1 ) ) > ( - q ) by A60,XREAL_1:24;
then ( d - e ) > ( - q ) by A59,XXREAL_0:2;
hence contradiction by A56,A61,SEQ_2:1;
end;
hence thesis;
end;
(for x,y being set holds (((x in ( dom g3 ) & y in ( dom g3 )) & ( g3 . x ) = ( g3 . y )) implies x = y))
proof
let x being set,y being set;
assume that
A62: x in ( dom g3 )
and
A63: y in ( dom g3 )
and
A64: ( g3 . x ) = ( g3 . y );
reconsider x,y as (Element of ( NAT )) by A62,A63;
A65: ( g1 . y ) = ( ( ( g2 . y ) * q ) + ( g3 . y ) ) by A25,A35,A63;
( g1 . x ) = ( ( ( g2 . x ) * q ) + ( g3 . x ) ) by A25,A35,A62;
then ( ( g1 . x ) - ( g1 . y ) ) = ( ( ( g2 . x ) - ( g2 . y ) ) * q ) by A64,A65;
then q divides ( ( g1 . x ) - ( g1 . y ) ) by INT_1:def 3;
hence thesis by A49,A25,A62,A63;
end;
then A66: g3 is  one-to-one by FUNCT_1:def 4;
then ( len g3 ) = ( card ( rng g3 ) ) by FINSEQ_4:62;
then A67: ( len g4 ) = q9 by A23,A24,A32,A47,FINSEQ_3:39,XBOOLE_1:73;
reconsider XX as  finite (Subset of ( NAT )) by A26,XBOOLE_1:1;
set mm = ( card XX );
reconsider YY = ( ( rng g4 ) \ XX ) as  finite (Subset of ( NAT ));
A68: g3 is (Element of ( ( NAT ) * )) by FINSEQ_1:def 11;
( len g3 ) = q9 by A23,EULER_2:def 1;
then g3 in ( q9 -tuples_on ( NAT ) ) by A68;
then A69: g3 is (Element of ( q9 -tuples_on ( REAL ) )) by FINSEQ_2:109;
(for d being Nat holds (d in ( dom ( idseq q9 ) ) implies ( ( idseq q9 ) . d ) in ( NAT ))) by ORDINAL1:def 12;
then ( idseq q9 ) is (FinSequence of ( NAT )) by FINSEQ_2:12;
then reconsider N = ( Sum ( idseq q9 ) ) as (Element of ( NAT )) by CKB56:1;
A70: 2,q are_relative_prime  by A2,EULER_1:2;
( dom ( q * g2 ) ) = ( dom g2 ) by VALUED_1:def 5;
then A71: ( len ( q * g2 ) ) = q9 by A33,FINSEQ_3:29;
( q * g2 ) is (Element of ( ( NAT ) * )) by FINSEQ_1:def 11;
then ( q * g2 ) in ( q9 -tuples_on ( NAT ) ) by A71;
then A72: ( q * g2 ) is (Element of ( q9 -tuples_on ( REAL ) )) by FINSEQ_2:109;
A73: ( dom ( ( q * g2 ) + g3 ) ) = ( ( dom ( q * g2 ) ) /\ ( dom g3 ) ) by VALUED_1:def 1
.= ( ( dom g2 ) /\ ( dom g3 ) ) by VALUED_1:def 5
.= ( dom g1 ) by A25,A34;
(for d being Nat holds (d in ( dom g1 ) implies ( g1 . d ) = ( ( ( q * g2 ) + g3 ) . d )))
proof
let d being Nat;
assume A74: d in ( dom g1 );
then A75: d in ( dom ( q * g2 ) ) by A34,VALUED_1:def 5;
( ( ( q * g2 ) + g3 ) . d ) = ( ( ( q * g2 ) . d ) + ( g3 . d ) ) by A73,A74,VALUED_1:def 1;
hence ( ( ( q * g2 ) + g3 ) . d ) = ( ( q * ( g2 . d ) ) + ( g3 . d ) ) by A75,VALUED_1:def 5
.= ( g1 . d ) by A35,A74;
end;
then g1 = ( ( q * g2 ) + g3 ) by A73,FINSEQ_1:13;
then A76: ( Sum g1 ) = ( ( Sum ( q * g2 ) ) + ( Sum g3 ) ) by A72,A69,RVSUM_1:89
.= ( ( q * ( Sum g2 ) ) + ( Sum g3 ) ) by RVSUM_1:87;
A77: ( rng g3 ) c= ( Seg n2 ) by A32,A47,XBOOLE_1:73;
then A78: ( rng g4 ) = ( rng g3 ) by FINSEQ_1:def 13;
then A79: XX c= ( Seg n2 ) by A77,A26,XBOOLE_1:1;
A80: ( len g3 ) = ( card ( rng g4 ) ) by A66,A78,FINSEQ_4:62;
mm <= ( card ( rng g4 ) ) by A26,NAT_1:43;
then mm <= q9 by A23,A80,EULER_2:def 1;
then reconsider nn = ( q9 - mm ) as (Element of ( NAT )) by NAT_1:21;
A81: g4 = ( ( g4 | nn ) ^ ( g4 /^ nn ) ) by RFINSEQ:8;
then A82: ( g4 /^ nn ) is  one-to-one by A48,FINSEQ_3:91;
A83: q9 = ( ( ( q -' 1 ) + 1 ) div 2 ) by A38,NAT_2:26
.= ( q div 2 ) by A28,XREAL_1:235;
g4 is (FinSequence of ( REAL )) by FINSEQ_2:24;
then A84: ( Sum g4 ) = ( Sum g3 ) by A66,A78,A48,RFINSEQ:9,RFINSEQ:26;
A85: ( ( rng g4 ) \ XX ) c= ( rng g4 ) by XBOOLE_1:36;
then A86: YY c= ( Seg n2 ) by A77,A78,XBOOLE_1:1;
(for k,l being (Element of ( NAT )) holds ((k in YY & l in XX) implies k < l))
proof
let k being (Element of ( NAT )),l being (Element of ( NAT ));
assume that
A87: k in YY
and
A88: l in XX;
A89: (not k in XX) by A87,XBOOLE_0:def 5;
A90: (ex l1 being (Element of ( NAT )) st ((l1 = l & l1 in ( rng g4 )) & l1 > ( q / 2 ))) by A88;
k in ( rng g4 ) by A87,XBOOLE_0:def 5;
then k <= ( q / 2 ) by A89;
hence thesis by A90,XXREAL_0:2;
end;
then ( Sgm ( YY \/ XX ) ) = ( ( Sgm YY ) ^ ( Sgm XX ) ) by A86,A79,FINSEQ_3:42;
then ( Sgm ( ( rng g4 ) \/ XX ) ) = ( ( Sgm YY ) ^ ( Sgm XX ) ) by XBOOLE_1:39;
then A91: g4 = ( ( Sgm YY ) ^ ( Sgm XX ) ) by A78,A26,XBOOLE_1:12;
then ( Sum g4 ) = ( ( Sum ( Sgm YY ) ) + ( Sum ( Sgm XX ) ) ) by RVSUM_1:75;
then A92: ( p * ( Sum ( idseq q9 ) ) ) = ( ( ( q * ( Sum g2 ) ) + ( Sum ( Sgm YY ) ) ) + ( Sum ( Sgm XX ) ) ) by A76,A84,RVSUM_1:87;
A93: ( len ( Sgm YY ) ) = ( card YY ) by A77,A78,A85,FINSEQ_3:39,XBOOLE_1:1
.= ( q9 - mm ) by A23,A24,A26,A80,CARD_2:44;
then A94: ( g4 /^ nn ) = ( Sgm XX ) by A91,FINSEQ_5:37;
(for d being Nat holds (d in ( dom f2 ) implies ( f2 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom f2 );
then ( f2 . d ) = ( ( f1 . d ) div p ) by A27;
hence thesis;
end;
then reconsider f2 as (FinSequence of ( NAT )) by FINSEQ_2:12;
set f3 = ( f1 mod p );
A95: ( len f3 ) = ( len f1 ) by EULER_2:def 1;
then A96: ( dom f1 ) = ( dom f3 ) by FINSEQ_3:29;
set f4 = ( Sgm ( rng f3 ) );
p >= ( 2 + 1 ) by A1,NAT_1:13;
then A97: ( p - 1 ) >= ( 3 - 1 ) by XREAL_1:9;
then f3 <> ( {} ) by A18,A7,A95,NAT_2:13;
then ( rng f3 ) is  finite non empty  finite non empty (Subset of ( NAT )) by FINSEQ_1:def 4;
then consider n1 being (Element of ( NAT )) such that A98: ( rng f3 ) c= ( ( Seg n1 ) \/ { ( 0 ) } ) by HEYTING3:1;
A99: ( dom f1 ) = ( dom f2 ) by A18,A27,FINSEQ_3:29;
A100: (for d holds (d in ( dom f1 ) implies ( f1 . d ) = ( ( ( f2 . d ) * p ) + ( f3 . d ) )))
proof
let d;
assume A101: d in ( dom f1 );
then A102: ( f3 . d ) = ( ( f1 . d ) mod p ) by EULER_2:def 1;
( f2 . d ) = ( ( f1 . d ) div p ) by A27,A99,A101;
hence thesis by A102,NAT_D:2;
end;
(not ( 0 ) in ( rng f3 ))
proof
assume ( 0 ) in ( rng f3 );
then consider a being Nat such that A103: a in ( dom f3 ) and A104: ( f3 . a ) = ( 0 ) by FINSEQ_2:10;
( f1 . a ) = ( ( ( f2 . a ) * p ) + ( 0 ) ) by A96,A100,A103,A104;
then ( q * a ) = ( ( f2 . a ) * p ) by A13,A96,A103;
then A105: p divides ( q * a ) by NAT_D:def 3;
a >= 1 by A103,FINSEQ_3:25;
then A106: p <= a by A4,A105,NAT_D:7,PEPIN:3;
a <= p9 by A18,A95,A103,FINSEQ_3:25;
hence contradiction by A12,A106,XXREAL_0:2;
end;
then A107: { ( 0 ) } misses ( rng f3 ) by ZFMISC_1:50;
then A108: f4 is  one-to-one by A98,FINSEQ_3:92,XBOOLE_1:73;
A109: (for d holds (for e holds (((d in ( dom f1 ) & e in ( dom f1 )) & p divides ( ( f1 . d ) - ( f1 . e ) )) implies d = e)))
proof
A110: q,(p qua Integer) are_relative_prime  by A3,INT_2:30;
let d;
let e;
assume that
A111: d in ( dom f1 )
and
A112: e in ( dom f1 )
and
A113: p divides ( ( f1 . d ) - ( f1 . e ) );
A114: ( f1 . e ) = ( q * e ) by A13,A112;
( f1 . d ) = ( q * d ) by A13,A111;
then A115: p divides ( ( d - e ) * q ) by A113,A114;
now
assume d <> e;
then ( d - e ) <> ( 0 );
then ( abs p ) <= ( abs ( d - e ) ) by A115,A110,INT_2:25,INT_4:6;
then A116: p <= ( abs ( d - e ) ) by ABSVALUE:def 1;
A117: e >= 1 by A112,FINSEQ_3:25;
A118: d >= 1 by A111,FINSEQ_3:25;
e <= p9 by A18,A112,FINSEQ_3:25;
then A119: ( d - e ) >= ( 1 - p9 ) by A118,XREAL_1:13;
A120: ( p9 - 1 ) < p by A12,XREAL_1:147;
d <= p9 by A18,A111,FINSEQ_3:25;
then ( d - e ) <= ( p9 - 1 ) by A117,XREAL_1:13;
then A121: ( d - e ) < p by A120,XXREAL_0:2;
( - ( p9 - 1 ) ) > ( - p ) by A120,XREAL_1:24;
then ( d - e ) > ( - p ) by A119,XXREAL_0:2;
hence contradiction by A116,A121,SEQ_2:1;
end;
hence thesis;
end;
(for x,y being set holds (((x in ( dom f3 ) & y in ( dom f3 )) & ( f3 . x ) = ( f3 . y )) implies x = y))
proof
let x being set,y being set;
assume that
A122: x in ( dom f3 )
and
A123: y in ( dom f3 )
and
A124: ( f3 . x ) = ( f3 . y );
reconsider x,y as (Element of ( NAT )) by A122,A123;
A125: ( f1 . y ) = ( ( ( f2 . y ) * p ) + ( f3 . y ) ) by A96,A100,A123;
( f1 . x ) = ( ( ( f2 . x ) * p ) + ( f3 . x ) ) by A96,A100,A122;
then ( ( f1 . x ) - ( f1 . y ) ) = ( ( ( f2 . x ) - ( f2 . y ) ) * p ) by A124,A125;
then p divides ( ( f1 . x ) - ( f1 . y ) ) by INT_1:def 3;
hence thesis by A109,A96,A122,A123;
end;
then A126: f3 is  one-to-one by FUNCT_1:def 4;
then ( len f3 ) = ( card ( rng f3 ) ) by FINSEQ_4:62;
then A127: ( len f4 ) = p9 by A18,A95,A98,A107,FINSEQ_3:39,XBOOLE_1:73;
A128: ( g4 | nn ) = ( Sgm YY ) by A91,A93,FINSEQ_3:113,FINSEQ_6:10;
A129: ( g4 | nn ) is  one-to-one by A48,A81,FINSEQ_3:91;
A130: ( Lege (p,q) ) = ( ( - 1 ) |^ ( Sum g2 ) )
proof
set g5 = ( ( mm |-> q ) - ( g4 /^ nn ) );
set g6 = ( ( g4 | nn ) ^ g5 );
A131: ( rng ( idseq q9 ) ) = ( Seg q9 ) by RELAT_1:45;
A132: ( g4 /^ nn ) is (FinSequence of ( REAL )) by FINSEQ_2:24;
A133: ( len ( g4 | nn ) ) = nn by A67,FINSEQ_1:59,XREAL_1:43;
A134: ( len ( g4 /^ nn ) ) = ( ( len g4 ) -' nn ) by RFINSEQ:29
.= ( ( len g4 ) - nn ) by A67,XREAL_1:43,XREAL_1:233
.= mm by A67;
A135: ( dom g5 ) = ( ( dom ( mm |-> q ) ) /\ ( dom ( g4 /^ nn ) ) ) by VALUED_1:12
.= ( ( Seg ( len ( mm |-> q ) ) ) /\ ( dom ( g4 /^ nn ) ) ) by FINSEQ_1:def 3
.= ( ( Seg ( len ( g4 /^ nn ) ) ) /\ ( dom ( g4 /^ nn ) ) ) by A134,CARD_1:def 7
.= ( ( dom ( g4 /^ nn ) ) /\ ( dom ( g4 /^ nn ) ) ) by FINSEQ_1:def 3
.= ( dom ( g4 /^ nn ) );
then A136: ( len g5 ) = ( len ( g4 /^ nn ) ) by FINSEQ_3:29;
A137: (for d holds (d in ( dom g5 ) implies ( g5 . d ) = ( q - ( ( g4 /^ nn ) . d ) )))
proof
let d;
assume A138: d in ( dom g5 );
then d in ( Seg mm ) by A134,A135,FINSEQ_1:def 3;
then ( ( mm |-> q ) . d ) = q by FINSEQ_2:57;
hence thesis by A138,VALUED_1:13;
end;
A139: (for d holds (d in ( dom g5 ) implies (( g5 . d ) > ( 0 ) & ( g5 . d ) <= q9)))
proof
let d;
reconsider w = ( g5 . d ) as (Element of ( INT )) by INT_1:def 2;
assume A140: d in ( dom g5 );
then ( ( Sgm XX ) . d ) in ( rng ( Sgm XX ) ) by A94,A135,FUNCT_1:3;
then ( ( Sgm XX ) . d ) in XX by A79,FINSEQ_1:def 13;
then A141: (ex ll being (Element of ( NAT )) st ((ll = ( ( Sgm XX ) . d ) & ll in ( rng g3 )) & ll > ( q / 2 ))) by A78;
then consider e being Nat such that A142: e in ( dom g3 ) and A143: ( g3 . e ) = ( ( g4 /^ nn ) . d ) by A94,FINSEQ_2:10;
( ( g4 /^ nn ) . d ) = ( ( g1 . e ) mod q ) by A25,A142,A143,EULER_2:def 1;
then A144: ( ( g4 /^ nn ) . d ) < q by NAT_D:1;
A145: ( g5 . d ) = ( q - ( ( g4 /^ nn ) . d ) ) by A137,A140;
then w < ( q - ( q / 2 ) ) by A94,A141,XREAL_1:10;
hence thesis by A83,A145,A144,INT_1:54,XREAL_1:50;
end;
(for d being Nat holds (d in ( dom g5 ) implies ( g5 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom g5 );
then ( g5 . d ) > ( 0 ) by A139;
hence thesis by INT_1:3;
end;
then reconsider g5 as (FinSequence of ( NAT )) by FINSEQ_2:12;
g5 is (FinSequence of ( NAT ));
then reconsider g6 as (FinSequence of ( NAT )) by FINSEQ_1:75;
A146: g6 is (FinSequence of ( REAL )) by FINSEQ_2:24;
A147: nn <= ( len g4 ) by A67,XREAL_1:43;
A148: ( rng ( g4 | nn ) ) misses ( rng g5 )
proof
assume (not ( rng ( g4 | nn ) ) misses ( rng g5 ));
then consider x being set such that A149: x in ( rng ( g4 | nn ) ) and A150: x in ( rng g5 ) by XBOOLE_0:3;
consider e being Nat such that A151: e in ( dom g5 ) and A152: ( g5 . e ) = x by A150,FINSEQ_2:10;
x = ( q - ( ( g4 /^ nn ) . e ) ) by A137,A151,A152;
then A153: x = ( q - ( g4 . ( e + nn ) ) ) by A147,A135,A151,RFINSEQ:def 1;
( e + nn ) in ( dom g4 ) by A135,A151,FINSEQ_5:26;
then consider e1 being Nat such that A154: e1 in ( dom g3 ) and A155: ( g3 . e1 ) = ( g4 . ( e + nn ) ) by A78,FINSEQ_2:10,FUNCT_1:3;
A156: e1 <= q9 by A23,A24,A154,FINSEQ_3:25;
( rng ( g4 | nn ) ) c= ( rng g4 ) by FINSEQ_5:19;
then consider d1 being Nat such that A157: d1 in ( dom g3 ) and A158: ( g3 . d1 ) = x by A78,A149,FINSEQ_2:10;
d1 <= q9 by A23,A24,A157,FINSEQ_3:25;
then ( d1 + e1 ) <= ( q9 + q9 ) by A156,XREAL_1:7;
then A159: ( d1 + e1 ) < q by A29,A40,XREAL_1:146,XXREAL_0:2;
A160: e1 in ( dom g1 ) by A24,A154,FINSEQ_3:29;
then A161: ( g4 . ( e + nn ) ) = ( ( g1 . e1 ) mod q ) by A155,EULER_2:def 1;
A162: d1 in ( dom g1 ) by A24,A157,FINSEQ_3:29;
then x = ( ( g1 . d1 ) mod q ) by A158,EULER_2:def 1;
then ( ( ( ( g1 . d1 ) mod q ) + ( ( g1 . e1 ) mod q ) ) mod q ) = ( 0 ) by A153,A161,NAT_D:25;
then ( ( ( g1 . d1 ) + ( g1 . e1 ) ) mod q ) = ( 0 ) by EULER_2:6;
then q divides ( ( g1 . d1 ) + ( g1 . e1 ) ) by PEPIN:6;
then q divides ( ( d1 * p ) + ( g1 . e1 ) ) by A19,A162;
then q divides ( ( d1 * p ) + ( e1 * p ) ) by A19,A160;
then A163: q divides ( ( d1 + e1 ) * p );
d1 >= 1 by A157,FINSEQ_3:25;
hence contradiction by A4,A163,A159,NAT_D:7,PEPIN:3;
end;
(for d,e being (Element of ( NAT )) holds (((1 <= d & d < e) & e <= ( len g5 )) implies ( g5 . d ) <> ( g5 . e )))
proof
let d being (Element of ( NAT )),e being (Element of ( NAT ));
assume that
A164: 1 <= d
and
A165: d < e
and
A166: e <= ( len g5 );
1 <= e by A164,A165,XXREAL_0:2;
then A167: e in ( dom g5 ) by A166,FINSEQ_3:25;
then A168: ( g5 . e ) = ( q - ( ( g4 /^ nn ) . e ) ) by A137;
d < ( len g5 ) by A165,A166,XXREAL_0:2;
then A169: d in ( dom g5 ) by A164,FINSEQ_3:25;
then ( g5 . d ) = ( q - ( ( g4 /^ nn ) . d ) ) by A137;
hence thesis by A82,A135,A165,A169,A167,A168,FUNCT_1:def 4;
end;
then ( len g5 ) = ( card ( rng g5 ) ) by GRAPH_5:7;
then g5 is  one-to-one by FINSEQ_4:62;
then A170: g6 is  one-to-one by A129,A148,FINSEQ_3:91;
A171: (for d holds (d in ( dom g6 ) implies (( g6 . d ) > ( 0 ) & ( g6 . d ) <= q9)))
proof
let d;
assume A172: d in ( dom g6 );
per cases  by A172,FINSEQ_1:25;
suppose A173: d in ( dom ( g4 | nn ) );

then ( ( g4 | nn ) . d ) in ( rng ( Sgm YY ) ) by A128,FUNCT_1:3;
then A174: ( ( g4 | nn ) . d ) in YY by A86,FINSEQ_1:def 13;
then A175: ( ( g4 | nn ) . d ) in ( rng g4 ) by XBOOLE_0:def 5;
(not ( ( g4 | nn ) . d ) in XX) by A174,XBOOLE_0:def 5;
then ( ( g4 | nn ) . d ) <= ( q / 2 ) by A175;
then A176: ( ( g4 | nn ) . d ) <= q9 by A83,INT_1:54;
(not ( ( g4 | nn ) . d ) in { ( 0 ) }) by A47,A78,A175,XBOOLE_0:3;
then ( ( g4 | nn ) . d ) <> ( 0 ) by TARSKI:def 1;
hence thesis by A173,A176,FINSEQ_1:def 7;
end;
suppose (ex l being Nat st (l in ( dom g5 ) & d = ( ( len ( g4 | nn ) ) + l )));

then consider l being (Element of ( NAT )) such that A177: l in ( dom g5 ) and A178: d = ( ( len ( g4 | nn ) ) + l );
( g6 . d ) = ( g5 . l ) by A177,A178,FINSEQ_1:def 7;
hence thesis by A139,A177;
end;
end;
( len g6 ) = ( ( len ( g4 | nn ) ) + ( len g5 ) ) by FINSEQ_1:22
.= q9 by A133,A134,A136;
then ( rng g6 ) = ( rng ( idseq q9 ) ) by A131,A170,A171,CKB46:1;
then N = ( Sum g6 ) by A170,A146,RFINSEQ:9,RFINSEQ:26
.= ( ( Sum ( g4 | nn ) ) + ( Sum g5 ) ) by RVSUM_1:75
.= ( ( Sum ( g4 | nn ) ) + ( ( mm * q ) - ( Sum ( g4 /^ nn ) ) ) ) by A134,A132,CKB53:1
.= ( ( ( Sum ( g4 | nn ) ) + ( mm * q ) ) - ( Sum ( g4 /^ nn ) ) );
then ( ( p - 1 ) * N ) = ( ( ( q * ( Sum g2 ) ) + ( 2 * ( Sum ( Sgm XX ) ) ) ) - ( mm * q ) ) by A92,A94,A128;
then A179: ( ( ( p -' 1 ) * N ) mod 2 ) = ( ( ( ( q * ( Sum g2 ) ) - ( mm * q ) ) + ( 2 * ( Sum ( Sgm XX ) ) ) ) mod 2 ) by A6,XREAL_1:233
.= ( ( ( q * ( Sum g2 ) ) - ( mm * q ) ) mod 2 ) by EULER_1:12;
2 divides ( ( p -' 1 ) * N ) by A10,NAT_D:9;
then ( ( q * ( ( Sum g2 ) - mm ) ) mod 2 ) = ( 0 ) by A179,PEPIN:6;
then 2 divides ( q * ( ( Sum g2 ) - mm ) ) by CKB3:1;
then 2 divides ( ( Sum g2 ) - mm ) by A70,INT_2:25;
then ( Sum g2 ),mm are_congruent_mod 2 by INT_2:15;
then ( ( Sum g2 ) mod 2 ) = ( mm mod 2 ) by NAT_D:64;
then ( ( - 1 ) |^ ( Sum g2 ) ) = ( ( - 1 ) |^ mm ) by CKB51:1;
hence thesis by A2,A5,A78,CKB47:1;
end;
(for d being Nat holds (d in ( dom ( idseq p9 ) ) implies ( ( idseq p9 ) . d ) in ( NAT )))
proof
let d being Nat;
assume A180: d in ( dom ( idseq p9 ) );
then d in ( Seg ( len ( idseq p9 ) ) ) by FINSEQ_1:def 3;
then d is (Element of ( Seg p9 )) by CARD_1:def 7;
then ( ( idseq p9 ) . d ) = d by FINSEQ_2:49;
hence thesis by A180;
end;
then ( idseq p9 ) is (FinSequence of ( NAT )) by FINSEQ_2:12;
then reconsider M = ( Sum ( idseq p9 ) ) as (Element of ( NAT )) by CKB56:1;
A181: 2,p are_relative_prime  by A1,EULER_1:2;
set X = { k where k is (Element of ( NAT )): (k in ( rng f4 ) & k > ( p / 2 )) };
(for x being set holds (x in X implies x in ( rng f4 )))
proof
let x being set;
assume x in X;
then (ex k being (Element of ( NAT )) st ((x = k & k in ( rng f4 )) & k > ( p / 2 )));
hence thesis;
end;
then A182: X c= ( rng f4 ) by TARSKI:def 3;
A183: p9 >= 1 by A7,A97,NAT_2:13;
A184: ( ( Sum f2 ) + ( Sum g2 ) ) = ( p9 * q9 )
proof
reconsider A = ( Seg p9 ),B = ( Seg q9 ) as non empty  finite (Subset of ( NAT )) by A183,A31;
deffunc F((Element of A),(Element of B)) = ( ( $1 / p ) - ( $2 / q ) );
A185: (for x being (Element of A) holds (for y being (Element of B) holds F(x,y) in ( REAL ))) by XREAL_0:def 1;
consider z being (Function of [: A,B :],( REAL )) such that A186: (for x being (Element of A) holds (for y being (Element of B) holds ( z . (x,y) ) = F(x,y))) from FUNCT_7:sch 1(A185);
defpred G[ set,set ]
 means
(ex x being (Element of A) st ($1 = x & $2 = { [ x,y ] where y is (Element of B): ( z . (x,y) ) > ( 0 ) }));
A187: (for d being Nat holds (d in ( Seg p9 ) implies (ex x1 being (Element of ( bool ( dom z ) )) st G[ d,x1 ])))
proof
let d being Nat;
assume d in ( Seg p9 );
then reconsider d as (Element of A);
take x1 = { [ d,y ] where y is (Element of B): ( z . (d,y) ) > ( 0 ) };
x1 c= ( dom z )
proof
let l being set;
assume l in x1;
then (ex yy being (Element of B) st ([ d,yy ] = l & ( z . (d,yy) ) > ( 0 )));
then l in [: A,B :];
hence thesis by FUNCT_2:def 1;
end;
hence thesis;
end;
consider Pr being (FinSequence of ( bool ( dom z ) )) such that A188: (( dom Pr ) = ( Seg p9 ) & (for d being Nat holds (d in ( Seg p9 ) implies G[ d,( Pr . d ) ]))) from FINSEQ_1:sch 5(A187);
A189: ( dom ( Card Pr ) ) = ( dom Pr ) by CARD_3:def 2
.= ( dom f2 ) by A27,A188,FINSEQ_1:def 3;
(for d being Nat holds (d in ( dom ( Card Pr ) ) implies ( ( Card Pr ) . d ) = ( f2 . d )))
proof
let d being Nat;
assume A190: d in ( dom ( Card Pr ) );
then d in ( Seg p9 ) by A27,A189,FINSEQ_1:def 3;
then consider m being (Element of A) such that A191: m = d and A192: ( Pr . d ) = { [ m,y ] where y is (Element of B): ( z . (m,y) ) > ( 0 ) } by A188;
( Pr . d ) = [: { m },( Seg ( f2 . m ) ) :]
proof
set L = [: { m },( Seg ( f2 . m ) ) :];
A193: L c= ( Pr . d )
proof
now
assume ( q mod p ) = ( 0 );
then A194: p divides q by PEPIN:6;
then p <= q by NAT_D:7;
then p < q by A3,XXREAL_0:1;
hence contradiction by A6,A194,NAT_4:12;
end;
then A195: ( - ( q div p ) ) = ( ( ( - q ) div p ) + 1 ) by WSIERP_1:41;
2 divides ( ( p -' 1 ) * q ) by A10,NAT_D:9;
then ( ( ( p -' 1 ) * q ) mod 2 ) = ( 0 ) by PEPIN:6;
then ( ( ( p -' 1 ) * q ) div 2 ) = ( ( ( p -' 1 ) * q ) / 2 ) by REAL_3:4;
then A196: ( ( p9 * q ) div p ) = ( ( ( p - 1 ) * q ) div ( 2 * p ) ) by A7,A11,NAT_2:27
.= ( ( ( ( p * q ) - q ) div p ) div 2 ) by PRE_FF:5
.= ( ( q + ( ( - ( q div p ) ) - 1 ) ) div 2 ) by A195,NAT_D:61
.= ( ( ( 2 * q9 ) + ( - ( q div p ) ) ) div 2 ) by A29,A40
.= ( q9 + ( ( - ( q div p ) ) div 2 ) ) by NAT_D:61;
A197: ( ( p9 * q ) div p ) <= q9
proof
per cases ;
suppose ( ( q div p ) mod 2 ) = ( 0 );

then ( ( - ( q div p ) ) div 2 ) = ( - ( ( q div p ) div 2 ) ) by WSIERP_1:42
.= ( - ( q div ( 2 * p ) ) ) by NAT_2:27;
then ( ( p9 * q ) div p ) = ( q9 - ( q div ( 2 * p ) ) ) by A196;
hence thesis by XREAL_1:43;
end;
suppose ( ( q div p ) mod 2 ) <> ( 0 );

then ( - ( ( q div p ) div 2 ) ) = ( ( ( - ( q div p ) ) div 2 ) + 1 ) by WSIERP_1:41;
then ( ( - ( q div p ) ) div 2 ) = ( ( - ( ( q div p ) div 2 ) ) - 1 )
.= ( ( - ( q div ( 2 * p ) ) ) - 1 ) by NAT_2:27;
then ( ( p9 * q ) div p ) = ( q9 - ( ( q div ( 2 * p ) ) + 1 ) ) by A196;
hence thesis by XREAL_1:43;
end;
end;
m <= p9 by FINSEQ_1:1;
then ( m * q ) <= ( p9 * q ) by XREAL_1:64;
then ( ( m * q ) div p ) <= ( ( p9 * q ) div p ) by NAT_2:24;
then A198: ( ( m * q ) div p ) <= q9 by A197,XXREAL_0:2;
m in ( Seg p9 );
then A199: m in ( dom f1 ) by A18,FINSEQ_1:def 3;
then A200: ( f2 . m ) = ( ( f1 . m ) div p ) by A27,A99
.= ( ( m * q ) div p ) by A13,A199;
now
assume ( ( m * q ) / p ) is  integer;
then A201: p divides ( m * q ) by WSIERP_1:17;
A202: m <= p9 by FINSEQ_1:1;
( ( 0 ) + 1 ) <= m by FINSEQ_1:1;
then p <= m by A5,A201,NAT_D:7,WSIERP_1:30;
hence contradiction by A12,A202,XXREAL_0:2;
end;
then A203: [\ ( ( m * q ) / p ) /] < ( ( m * q ) / p ) by INT_1:26;
let l being set;
assume l in L;
then consider x being set,y being set such that A204: x in { m } and A205: y in ( Seg ( f2 . m ) ) and A206: l = [ x,y ] by ZFMISC_1:def 2;
reconsider y as (Element of ( NAT )) by A205;
A207: 1 <= y by A205,FINSEQ_1:1;
y <= ( f2 . m ) by A205,FINSEQ_1:1;
then y <= q9 by A198,A200,XXREAL_0:2;
then reconsider y as (Element of B) by A207,FINSEQ_1:1;
y <= [\ ( ( m * q ) / p ) /] by A205,A200,FINSEQ_1:1;
then y < ( ( m * q ) / p ) by A203,XXREAL_0:2;
then ( y * p ) < ( ( ( m * q ) / p ) * p ) by XREAL_1:68;
then ( y * p ) < ( m * q ) by XCMPLX_1:87;
then ( y / q ) < ( m / p ) by XREAL_1:106;
then ( ( m / p ) - ( y / q ) ) > ( 0 ) by XREAL_1:50;
then ( z . (m,y) ) > ( 0 ) by A186;
then [ m,y ] in ( Pr . d ) by A192;
hence thesis by A204,A206,TARSKI:def 1;
end;
( Pr . d ) c= L
proof
let l being set;
A208: m in { m } by TARSKI:def 1;
m in ( Seg p9 );
then A209: m in ( dom f1 ) by A18,FINSEQ_1:def 3;
assume l in ( Pr . d );
then consider y1 being (Element of B) such that A210: l = [ m,y1 ] and A211: ( z . (m,y1) ) > ( 0 ) by A192;
( ( m / p ) - ( y1 / q ) ) > ( 0 ) by A186,A211;
then ( ( ( m / p ) - ( y1 / q ) ) + ( y1 / q ) ) > ( ( 0 ) + ( y1 / q ) ) by XREAL_1:6;
then ( ( m / p ) * q ) > ( ( y1 / q ) * q ) by XREAL_1:68;
then ( ( m * q ) / p ) > y1 by XCMPLX_1:87;
then ( ( m * q ) div p ) >= y1 by INT_1:54;
then ( ( f1 . m ) div p ) >= y1 by A13,A209;
then A212: y1 <= ( f2 . m ) by A27,A99,A209;
y1 >= 1 by FINSEQ_1:1;
then y1 in ( Seg ( f2 . m ) ) by A212,FINSEQ_1:1;
hence thesis by A210,A208,ZFMISC_1:def 2;
end;
hence thesis by A193,XBOOLE_0:def 10;
end;
then ( card ( Pr . d ) ) = ( card [: ( Seg ( f2 . m ) ),{ m } :] ) by CARD_2:4
.= ( card ( Seg ( f2 . m ) ) ) by CARD_1:69;
then A213: ( card ( Pr . d ) ) = ( card ( f2 . d ) ) by A191,FINSEQ_1:55
.= ( f2 . d ) by CARD_1:def 2;
d in ( dom Pr ) by A190,CARD_3:def 2;
hence thesis by A213,CARD_3:def 2;
end;
then A214: ( Card Pr ) = f2 by A189,FINSEQ_1:13;
defpred K[ set,set ]
 means
(ex y being (Element of B) st ($1 = y & $2 = { [ x,y ] where x is (Element of A): ( z . (x,y) ) < ( 0 ) }));
A215: (for d being Nat holds (d in ( Seg q9 ) implies (ex x1 being (Element of ( bool ( dom z ) )) st K[ d,x1 ])))
proof
let d being Nat;
assume d in ( Seg q9 );
then reconsider d as (Element of B);
take x1 = { [ x,d ] where x is (Element of A): ( z . (x,d) ) < ( 0 ) };
x1 c= ( dom z )
proof
let l being set;
assume l in x1;
then (ex xx being (Element of A) st ([ xx,d ] = l & ( z . (xx,d) ) < ( 0 )));
then l in [: A,B :];
hence thesis by FUNCT_2:def 1;
end;
hence thesis;
end;
consider Pk being (FinSequence of ( bool ( dom z ) )) such that A216: (( dom Pk ) = ( Seg q9 ) & (for d being Nat holds (d in ( Seg q9 ) implies K[ d,( Pk . d ) ]))) from FINSEQ_1:sch 5(A215);
A217: ( dom ( Card Pk ) ) = ( Seg ( len g2 ) ) by A33,A216,CARD_3:def 2
.= ( dom g2 ) by FINSEQ_1:def 3;
A218: (for d being Nat holds (d in ( dom ( Card Pk ) ) implies ( ( Card Pk ) . d ) = ( g2 . d )))
proof
let d being Nat;
assume A219: d in ( dom ( Card Pk ) );
then d in ( Seg q9 ) by A33,A217,FINSEQ_1:def 3;
then consider n being (Element of B) such that A220: n = d and A221: ( Pk . d ) = { [ x,n ] where x is (Element of A): ( z . (x,n) ) < ( 0 ) } by A216;
( Pk . d ) = [: ( Seg ( g2 . n ) ),{ n } :]
proof
set L = [: ( Seg ( g2 . n ) ),{ n } :];
A222: L c= ( Pk . d )
proof
now
assume ( p mod q ) = ( 0 );
then A223: q divides p by PEPIN:6;
then q <= p by NAT_D:7;
then q < p by A3,XXREAL_0:1;
hence contradiction by A28,A223,NAT_4:12;
end;
then A224: ( - ( p div q ) ) = ( ( ( - p ) div q ) + 1 ) by WSIERP_1:41;
2 divides ( ( q -' 1 ) * p ) by A39,NAT_D:9;
then ( ( ( q -' 1 ) * p ) mod 2 ) = ( 0 ) by PEPIN:6;
then ( ( ( q -' 1 ) * p ) div 2 ) = ( ( ( q -' 1 ) * p ) / 2 ) by REAL_3:4;
then A225: ( ( q9 * p ) div q ) = ( ( ( q - 1 ) * p ) div ( 2 * q ) ) by A29,A40,NAT_2:27
.= ( ( ( ( q * p ) - p ) div q ) div 2 ) by PRE_FF:5
.= ( ( p + ( ( - ( p div q ) ) - 1 ) ) div 2 ) by A224,NAT_D:61
.= ( ( ( 2 * p9 ) - ( p div q ) ) div 2 ) by A7,A11
.= ( p9 + ( ( - ( p div q ) ) div 2 ) ) by NAT_D:61;
A226: ( ( q9 * p ) div q ) <= p9
proof
per cases ;
suppose ( ( p div q ) mod 2 ) = ( 0 );

then ( ( - ( p div q ) ) div 2 ) = ( - ( ( p div q ) div 2 ) ) by WSIERP_1:42
.= ( - ( p div ( 2 * q ) ) ) by NAT_2:27;
then ( ( q9 * p ) div q ) = ( p9 - ( p div ( 2 * q ) ) ) by A225;
hence thesis by XREAL_1:43;
end;
suppose ( ( p div q ) mod 2 ) <> ( 0 );

then ( - ( ( p div q ) div 2 ) ) = ( ( ( - ( p div q ) ) div 2 ) + 1 ) by WSIERP_1:41;
then ( ( - ( p div q ) ) div 2 ) = ( ( - ( ( p div q ) div 2 ) ) - 1 )
.= ( ( - ( p div ( 2 * q ) ) ) - 1 ) by NAT_2:27;
then ( ( q9 * p ) div q ) = ( p9 - ( ( p div ( 2 * q ) ) + 1 ) ) by A225;
hence thesis by XREAL_1:43;
end;
end;
n in ( Seg q9 );
then A227: n in ( dom g1 ) by A23,FINSEQ_1:def 3;
then A228: ( g2 . n ) = ( ( g1 . n ) div q ) by A33,A34
.= ( ( n * p ) div q ) by A19,A227;
let l being set;
assume l in L;
then consider x being set,y being set such that A229: x in ( Seg ( g2 . n ) ) and A230: y in { n } and A231: l = [ x,y ] by ZFMISC_1:def 2;
reconsider x as (Element of ( NAT )) by A229;
A232: x <= ( g2 . n ) by A229,FINSEQ_1:1;
n <= q9 by FINSEQ_1:1;
then ( n * p ) <= ( q9 * p ) by XREAL_1:64;
then ( ( n * p ) div q ) <= ( ( q9 * p ) div q ) by NAT_2:24;
then ( ( n * p ) div q ) <= p9 by A226,XXREAL_0:2;
then A233: x <= p9 by A228,A232,XXREAL_0:2;
1 <= x by A229,FINSEQ_1:1;
then reconsider x as (Element of A) by A233,FINSEQ_1:1;
now
assume ( ( n * p ) / q ) is  integer;
then A234: q divides ( n * p ) by WSIERP_1:17;
A235: n <= q9 by FINSEQ_1:1;
( ( 0 ) + 1 ) <= n by FINSEQ_1:1;
then q <= n by A5,A234,NAT_D:7,WSIERP_1:30;
hence contradiction by A41,A235,XXREAL_0:2;
end;
then [\ ( ( n * p ) / q ) /] < ( ( n * p ) / q ) by INT_1:26;
then x < ( ( n * p ) / q ) by A228,A232,XXREAL_0:2;
then ( x * q ) < ( ( ( n * p ) / q ) * q ) by XREAL_1:68;
then ( x * q ) < ( n * p ) by XCMPLX_1:87;
then ( ( x / p ) - ( n / q ) ) < ( 0 ) by XREAL_1:49,XREAL_1:106;
then ( z . (x,n) ) < ( 0 ) by A186;
then [ x,n ] in ( Pk . d ) by A221;
hence thesis by A230,A231,TARSKI:def 1;
end;
( Pk . d ) c= L
proof
let l being set;
A236: n in { n } by TARSKI:def 1;
n in ( Seg q9 );
then A237: n in ( dom g1 ) by A23,FINSEQ_1:def 3;
assume l in ( Pk . d );
then consider x being (Element of A) such that A238: l = [ x,n ] and A239: ( z . (x,n) ) < ( 0 ) by A221;
( ( x / p ) - ( n / q ) ) < ( 0 ) by A186,A239;
then ( ( ( x / p ) - ( n / q ) ) + ( n / q ) ) < ( ( 0 ) + ( n / q ) ) by XREAL_1:6;
then ( ( x / p ) * p ) < ( ( n / q ) * p ) by XREAL_1:68;
then x < ( ( n * p ) / q ) by XCMPLX_1:87;
then x <= ( ( n * p ) div q ) by INT_1:54;
then ( ( g1 . n ) div q ) >= x by A19,A237;
then A240: x <= ( g2 . n ) by A33,A34,A237;
x >= 1 by FINSEQ_1:1;
then x in ( Seg ( g2 . n ) ) by A240,FINSEQ_1:1;
hence thesis by A238,A236,ZFMISC_1:def 2;
end;
hence thesis by A222,XBOOLE_0:def 10;
end;
then ( card ( Pk . d ) ) = ( card ( Seg ( g2 . n ) ) ) by CARD_1:69;
then A241: ( card ( Pk . d ) ) = ( card ( g2 . d ) ) by A220,FINSEQ_1:55
.= ( g2 . d ) by CARD_1:def 2;
d in ( dom Pk ) by A219,CARD_3:def 2;
hence thesis by A241,CARD_3:def 2;
end;
reconsider U1 = ( union ( rng Pr ) ),U2 = ( union ( rng Pk ) ) as  finite (Subset of ( dom z )) by PROB_3:48;
( dom z ) c= ( U1 \/ U2 )
proof
let l being set;
assume l in ( dom z );
then consider x being set,y being set such that A242: x in A and A243: y in B and A244: l = [ x,y ] by ZFMISC_1:def 2;
reconsider y as (Element of B) by A243;
reconsider x as (Element of A) by A242;
A245: ( z . (x,y) ) <> ( 0 )
proof
assume ( z . (x,y) ) = ( 0 );
then ( ( x / p ) - ( y / q ) ) = ( 0 ) by A186;
then ( x * q ) = ( y * p ) by XCMPLX_1:95;
then A246: p divides ( x * q ) by NAT_D:def 3;
A247: x <= p9 by FINSEQ_1:1;
x >= ( ( 0 ) + 1 ) by FINSEQ_1:1;
then p <= x by A5,A246,NAT_D:7,WSIERP_1:30;
hence contradiction by A12,A247,XXREAL_0:2;
end;
per cases  by A245;
suppose A248: ( z . (x,y) ) > ( 0 );

G[ x,( Pr . x ) ] by A188;
then l in ( Pr . x ) by A244,A248;
then l in ( Union Pr ) by A188,PROB_3:49;
hence thesis by XBOOLE_0:def 3;
end;
suppose A249: ( z . (x,y) ) < ( 0 );

K[ y,( Pk . y ) ] by A216;
then l in ( Pk . y ) by A244,A249;
then l in ( Union Pk ) by A216,PROB_3:49;
hence thesis by XBOOLE_0:def 3;
end;
end;
then A250: ( U1 \/ U2 ) = ( dom z ) by XBOOLE_0:def 10;
A251: U1 misses U2
proof
assume U1 meets U2;
then consider l being set such that A252: l in U1 and A253: l in U2 by XBOOLE_0:3;
l in ( Union Pk ) by A253;
then consider k2 being Nat such that A254: k2 in ( dom Pk ) and A255: l in ( Pk . k2 ) by PROB_3:49;
l in ( Union Pr ) by A252;
then consider k1 being Nat such that A256: k1 in ( dom Pr ) and A257: l in ( Pr . k1 ) by PROB_3:49;
reconsider k1,k2 as (Element of ( NAT )) by ORDINAL1:def 12;
consider n1 being (Element of B) such that n1 = k2 and A258: ( Pk . k2 ) = { [ x,n1 ] where x is (Element of A): ( z . (x,n1) ) < ( 0 ) } by A216,A254;
consider n2 being (Element of A) such that A259: l = [ n2,n1 ] and A260: ( z . (n2,n1) ) < ( 0 ) by A255,A258;
consider m1 being (Element of A) such that m1 = k1 and A261: ( Pr . k1 ) = { [ m1,y ] where y is (Element of B): ( z . (m1,y) ) > ( 0 ) } by A188,A256;
A262: (ex m2 being (Element of B) st (l = [ m1,m2 ] & ( z . (m1,m2) ) > ( 0 ))) by A257,A261;
then m1 = n2 by A259,ZFMISC_1:27;
hence contradiction by A262,A259,A260,ZFMISC_1:27;
end;
A263: (for d holds (for e holds (((d in ( dom Pk ) & e in ( dom Pk )) & d <> e) implies ( Pk . d ) misses ( Pk . e ))))
proof
let d;
let e;
assume that
A264: d in ( dom Pk )
and
A265: e in ( dom Pk )
and
A266: d <> e;
consider y2 being (Element of B) such that A267: y2 = e and A268: ( Pk . e ) = { [ x,y2 ] where x is (Element of A): ( z . (x,y2) ) < ( 0 ) } by A216,A265;
consider y1 being (Element of B) such that A269: y1 = d and A270: ( Pk . d ) = { [ x,y1 ] where x is (Element of A): ( z . (x,y1) ) < ( 0 ) } by A216,A264;
now
assume (not ( Pk . d ) misses ( Pk . e ));
then consider l being set such that A271: l in ( Pk . d ) and A272: l in ( Pk . e ) by XBOOLE_0:3;
A273: (ex x2 being (Element of A) st (l = [ x2,y2 ] & ( z . (x2,y2) ) < ( 0 ))) by A268,A272;
(ex x1 being (Element of A) st (l = [ x1,y1 ] & ( z . (x1,y1) ) < ( 0 ))) by A270,A271;
hence contradiction by A266,A269,A267,A273,ZFMISC_1:27;
end;
hence thesis;
end;
( len Pk ) = q9 by A216,FINSEQ_1:def 3;
then A274: ( card ( union ( rng Pk ) ) ) = ( Sum ( Card Pk ) ) by A263,CKB55:1;
A275: (for d holds (for e holds (((d in ( dom Pr ) & e in ( dom Pr )) & d <> e) implies ( Pr . d ) misses ( Pr . e ))))
proof
let d;
let e;
assume that
A276: d in ( dom Pr )
and
A277: e in ( dom Pr )
and
A278: d <> e;
consider x2 being (Element of A) such that A279: x2 = e and A280: ( Pr . e ) = { [ x2,y ] where y is (Element of B): ( z . (x2,y) ) > ( 0 ) } by A188,A277;
consider x1 being (Element of A) such that A281: x1 = d and A282: ( Pr . d ) = { [ x1,y ] where y is (Element of B): ( z . (x1,y) ) > ( 0 ) } by A188,A276;
now
assume (not ( Pr . d ) misses ( Pr . e ));
then consider l being set such that A283: l in ( Pr . d ) and A284: l in ( Pr . e ) by XBOOLE_0:3;
A285: (ex y2 being (Element of B) st (l = [ x2,y2 ] & ( z . (x2,y2) ) > ( 0 ))) by A280,A284;
(ex y1 being (Element of B) st (l = [ x1,y1 ] & ( z . (x1,y1) ) > ( 0 ))) by A282,A283;
hence contradiction by A278,A281,A279,A285,ZFMISC_1:27;
end;
hence thesis;
end;
( len Pr ) = p9 by A188,FINSEQ_1:def 3;
then ( card ( union ( rng Pr ) ) ) = ( Sum ( Card Pr ) ) by A275,CKB55:1;
then ( card ( U1 \/ U2 ) ) = ( ( Sum ( Card Pr ) ) + ( Sum ( Card Pk ) ) ) by A274,A251,CARD_2:40;
then ( ( Sum ( Card Pr ) ) + ( Sum ( Card Pk ) ) ) = ( card [: A,B :] ) by A250,FUNCT_2:def 1
.= ( ( card A ) * ( card B ) ) by CARD_2:46
.= ( p9 * ( card B ) ) by FINSEQ_1:57
.= ( p9 * q9 ) by FINSEQ_1:57;
hence thesis by A214,A217,A218,FINSEQ_1:13;
end;
( dom ( p * f2 ) ) = ( dom f2 ) by VALUED_1:def 5;
then A286: ( len ( p * f2 ) ) = p9 by A27,FINSEQ_3:29;
( p * f2 ) is (Element of ( ( NAT ) * )) by FINSEQ_1:def 11;
then ( p * f2 ) in ( p9 -tuples_on ( NAT ) ) by A286;
then A287: ( p * f2 ) is (Element of ( p9 -tuples_on ( REAL ) )) by FINSEQ_2:109;
A288: p9 = ( ( ( p -' 1 ) + 1 ) div 2 ) by A9,NAT_2:26
.= ( p div 2 ) by A6,XREAL_1:235;
reconsider X as  finite (Subset of ( NAT )) by A182,XBOOLE_1:1;
set m = ( card X );
reconsider Y = ( ( rng f4 ) \ X ) as  finite (Subset of ( NAT ));
A289: f3 is (Element of ( ( NAT ) * )) by FINSEQ_1:def 11;
( len f3 ) = p9 by A17,A95,CARD_1:def 7;
then f3 in ( p9 -tuples_on ( NAT ) ) by A289;
then A290: f3 is (Element of ( p9 -tuples_on ( REAL ) )) by FINSEQ_2:109;
A291: ( rng f3 ) c= ( Seg n1 ) by A98,A107,XBOOLE_1:73;
then A292: ( rng f4 ) = ( rng f3 ) by FINSEQ_1:def 13;
then A293: X c= ( Seg n1 ) by A291,A182,XBOOLE_1:1;
A294: ( dom ( ( p * f2 ) + f3 ) ) = ( ( dom ( p * f2 ) ) /\ ( dom f3 ) ) by VALUED_1:def 1
.= ( ( dom f2 ) /\ ( dom f3 ) ) by VALUED_1:def 5
.= ( dom f1 ) by A96,A99;
(for d being Nat holds (d in ( dom f1 ) implies ( f1 . d ) = ( ( ( p * f2 ) + f3 ) . d )))
proof
let d being Nat;
assume A295: d in ( dom f1 );
then A296: d in ( dom ( p * f2 ) ) by A99,VALUED_1:def 5;
( ( ( p * f2 ) + f3 ) . d ) = ( ( ( p * f2 ) . d ) + ( f3 . d ) ) by A294,A295,VALUED_1:def 1;
hence ( ( ( p * f2 ) + f3 ) . d ) = ( ( p * ( f2 . d ) ) + ( f3 . d ) ) by A296,VALUED_1:def 5
.= ( f1 . d ) by A100,A295;
end;
then f1 = ( ( p * f2 ) + f3 ) by A294,FINSEQ_1:13;
then A297: ( Sum f1 ) = ( ( Sum ( p * f2 ) ) + ( Sum f3 ) ) by A287,A290,RVSUM_1:89
.= ( ( p * ( Sum f2 ) ) + ( Sum f3 ) ) by RVSUM_1:87;
A298: ( ( rng f4 ) \ X ) c= ( rng f4 ) by XBOOLE_1:36;
then A299: Y c= ( Seg n1 ) by A291,A292,XBOOLE_1:1;
A300: ( len f3 ) = ( card ( rng f4 ) ) by A126,A292,FINSEQ_4:62;
then reconsider n = ( p9 - m ) as (Element of ( NAT )) by A18,A95,A182,NAT_1:21,NAT_1:43;
A301: f4 = ( ( f4 | n ) ^ ( f4 /^ n ) ) by RFINSEQ:8;
then A302: ( f4 /^ n ) is  one-to-one by A108,FINSEQ_3:91;
f4 is (FinSequence of ( REAL )) by FINSEQ_2:24;
then A303: ( Sum f4 ) = ( Sum f3 ) by A126,A292,A108,RFINSEQ:9,RFINSEQ:26;
(for k,l being (Element of ( NAT )) holds ((k in Y & l in X) implies k < l))
proof
let k being (Element of ( NAT )),l being (Element of ( NAT ));
assume that
A304: k in Y
and
A305: l in X;
A306: (not k in X) by A304,XBOOLE_0:def 5;
A307: (ex l1 being (Element of ( NAT )) st ((l1 = l & l1 in ( rng f4 )) & l1 > ( p / 2 ))) by A305;
k in ( rng f4 ) by A304,XBOOLE_0:def 5;
then k <= ( p / 2 ) by A306;
hence thesis by A307,XXREAL_0:2;
end;
then ( Sgm ( Y \/ X ) ) = ( ( Sgm Y ) ^ ( Sgm X ) ) by A293,A299,FINSEQ_3:42;
then ( Sgm ( ( rng f4 ) \/ X ) ) = ( ( Sgm Y ) ^ ( Sgm X ) ) by XBOOLE_1:39;
then A308: f4 = ( ( Sgm Y ) ^ ( Sgm X ) ) by A292,A182,XBOOLE_1:12;
then ( Sum f4 ) = ( ( Sum ( Sgm Y ) ) + ( Sum ( Sgm X ) ) ) by RVSUM_1:75;
then A309: ( q * ( Sum ( idseq p9 ) ) ) = ( ( ( p * ( Sum f2 ) ) + ( Sum ( Sgm Y ) ) ) + ( Sum ( Sgm X ) ) ) by A297,A303,RVSUM_1:87;
A310: ( len ( Sgm Y ) ) = ( card Y ) by A291,A292,A298,FINSEQ_3:39,XBOOLE_1:1
.= ( p9 - m ) by A18,A95,A182,A300,CARD_2:44;
then A311: ( f4 /^ n ) = ( Sgm X ) by A308,FINSEQ_5:37;
A312: ( f4 | n ) = ( Sgm Y ) by A308,A310,FINSEQ_3:113,FINSEQ_6:10;
A313: ( f4 | n ) is  one-to-one by A108,A301,FINSEQ_3:91;
( Lege (q,p) ) = ( ( - 1 ) |^ ( Sum f2 ) )
proof
set f5 = ( ( m |-> p ) - ( f4 /^ n ) );
set f6 = ( ( f4 | n ) ^ f5 );
A314: ( rng ( idseq p9 ) ) = ( Seg p9 ) by RELAT_1:45;
A315: ( f4 /^ n ) is (FinSequence of ( REAL )) by FINSEQ_2:24;
A316: ( len ( f4 | n ) ) = n by A127,FINSEQ_1:59,XREAL_1:43;
A317: ( len ( f4 /^ n ) ) = ( ( len f4 ) -' n ) by RFINSEQ:29
.= ( ( len f4 ) - n ) by A127,XREAL_1:43,XREAL_1:233
.= m by A127;
A318: ( dom f5 ) = ( ( dom ( m |-> p ) ) /\ ( dom ( f4 /^ n ) ) ) by VALUED_1:12
.= ( ( Seg ( len ( m |-> p ) ) ) /\ ( dom ( f4 /^ n ) ) ) by FINSEQ_1:def 3
.= ( ( Seg ( len ( f4 /^ n ) ) ) /\ ( dom ( f4 /^ n ) ) ) by A317,CARD_1:def 7
.= ( ( dom ( f4 /^ n ) ) /\ ( dom ( f4 /^ n ) ) ) by FINSEQ_1:def 3
.= ( dom ( f4 /^ n ) );
then A319: ( len f5 ) = ( len ( f4 /^ n ) ) by FINSEQ_3:29;
A320: (for d holds (d in ( dom f5 ) implies ( f5 . d ) = ( p - ( ( f4 /^ n ) . d ) )))
proof
let d;
assume A321: d in ( dom f5 );
then d in ( Seg m ) by A317,A318,FINSEQ_1:def 3;
then ( ( m |-> p ) . d ) = p by FINSEQ_2:57;
hence thesis by A321,VALUED_1:13;
end;
A322: (for d holds (d in ( dom f5 ) implies (( f5 . d ) > ( 0 ) & ( f5 . d ) <= p9)))
proof
let d;
reconsider w = ( f5 . d ) as (Element of ( INT )) by INT_1:def 2;
assume A323: d in ( dom f5 );
then ( ( Sgm X ) . d ) in ( rng ( Sgm X ) ) by A311,A318,FUNCT_1:3;
then ( ( Sgm X ) . d ) in X by A293,FINSEQ_1:def 13;
then A324: (ex ll being (Element of ( NAT )) st ((ll = ( ( Sgm X ) . d ) & ll in ( rng f3 )) & ll > ( p / 2 ))) by A292;
then consider e being Nat such that A325: e in ( dom f3 ) and A326: ( f3 . e ) = ( ( f4 /^ n ) . d ) by A311,FINSEQ_2:10;
( ( f4 /^ n ) . d ) = ( ( f1 . e ) mod p ) by A96,A325,A326,EULER_2:def 1;
then A327: ( ( f4 /^ n ) . d ) < p by NAT_D:1;
A328: ( f5 . d ) = ( p - ( ( f4 /^ n ) . d ) ) by A320,A323;
then w < ( p - ( p / 2 ) ) by A311,A324,XREAL_1:10;
hence thesis by A288,A328,A327,INT_1:54,XREAL_1:50;
end;
(for d being Nat holds (d in ( dom f5 ) implies ( f5 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom f5 );
then ( f5 . d ) > ( 0 ) by A322;
hence thesis by INT_1:3;
end;
then reconsider f5 as (FinSequence of ( NAT )) by FINSEQ_2:12;
f5 is (FinSequence of ( NAT ));
then reconsider f6 as (FinSequence of ( NAT )) by FINSEQ_1:75;
A329: f6 is (FinSequence of ( REAL )) by FINSEQ_2:24;
A330: n <= ( len f4 ) by A127,XREAL_1:43;
A331: ( rng ( f4 | n ) ) misses ( rng f5 )
proof
assume (not ( rng ( f4 | n ) ) misses ( rng f5 ));
then consider x being set such that A332: x in ( rng ( f4 | n ) ) and A333: x in ( rng f5 ) by XBOOLE_0:3;
consider e being Nat such that A334: e in ( dom f5 ) and A335: ( f5 . e ) = x by A333,FINSEQ_2:10;
x = ( p - ( ( f4 /^ n ) . e ) ) by A320,A334,A335;
then A336: x = ( p - ( f4 . ( e + n ) ) ) by A330,A318,A334,RFINSEQ:def 1;
( e + n ) in ( dom f4 ) by A318,A334,FINSEQ_5:26;
then consider e1 being Nat such that A337: e1 in ( dom f3 ) and A338: ( f3 . e1 ) = ( f4 . ( e + n ) ) by A292,FINSEQ_2:10,FUNCT_1:3;
A339: e1 <= p9 by A18,A95,A337,FINSEQ_3:25;
( rng ( f4 | n ) ) c= ( rng f4 ) by FINSEQ_5:19;
then consider d1 being Nat such that A340: d1 in ( dom f3 ) and A341: ( f3 . d1 ) = x by A292,A332,FINSEQ_2:10;
d1 <= p9 by A18,A95,A340,FINSEQ_3:25;
then ( d1 + e1 ) <= ( p9 + p9 ) by A339,XREAL_1:7;
then A342: ( d1 + e1 ) < p by A7,A11,XREAL_1:146,XXREAL_0:2;
x = ( ( f1 . d1 ) mod p ) by A96,A340,A341,EULER_2:def 1;
then ( ( ( f1 . d1 ) mod p ) + ( f4 . ( e + n ) ) ) = p by A336;
then ( ( ( f1 . d1 ) mod p ) + ( ( f1 . e1 ) mod p ) ) = p by A96,A337,A338,EULER_2:def 1;
then ( ( ( ( f1 . d1 ) mod p ) + ( ( f1 . e1 ) mod p ) ) mod p ) = ( 0 ) by NAT_D:25;
then ( ( ( f1 . d1 ) + ( f1 . e1 ) ) mod p ) = ( 0 ) by EULER_2:6;
then p divides ( ( f1 . d1 ) + ( f1 . e1 ) ) by PEPIN:6;
then p divides ( ( d1 * q ) + ( f1 . e1 ) ) by A13,A96,A340;
then p divides ( ( d1 * q ) + ( e1 * q ) ) by A13,A96,A337;
then A343: p divides ( ( d1 + e1 ) * q );
d1 >= 1 by A340,FINSEQ_3:25;
hence contradiction by A4,A343,A342,NAT_D:7,PEPIN:3;
end;
(for d,e being (Element of ( NAT )) holds (((1 <= d & d < e) & e <= ( len f5 )) implies ( f5 . d ) <> ( f5 . e )))
proof
let d being (Element of ( NAT )),e being (Element of ( NAT ));
assume that
A344: 1 <= d
and
A345: d < e
and
A346: e <= ( len f5 );
1 <= e by A344,A345,XXREAL_0:2;
then A347: e in ( dom f5 ) by A346,FINSEQ_3:25;
then A348: ( f5 . e ) = ( p - ( ( f4 /^ n ) . e ) ) by A320;
d < ( len f5 ) by A345,A346,XXREAL_0:2;
then A349: d in ( dom f5 ) by A344,FINSEQ_3:25;
then ( f5 . d ) = ( p - ( ( f4 /^ n ) . d ) ) by A320;
hence thesis by A302,A318,A345,A349,A347,A348,FUNCT_1:def 4;
end;
then ( len f5 ) = ( card ( rng f5 ) ) by GRAPH_5:7;
then f5 is  one-to-one by FINSEQ_4:62;
then A350: f6 is  one-to-one by A313,A331,FINSEQ_3:91;
A351: (for d holds (d in ( dom f6 ) implies (( f6 . d ) > ( 0 ) & ( f6 . d ) <= p9)))
proof
let d;
assume A352: d in ( dom f6 );
per cases  by A352,FINSEQ_1:25;
suppose A353: d in ( dom ( f4 | n ) );

then ( ( f4 | n ) . d ) in ( rng ( Sgm Y ) ) by A312,FUNCT_1:3;
then A354: ( ( f4 | n ) . d ) in Y by A299,FINSEQ_1:def 13;
then A355: ( ( f4 | n ) . d ) in ( rng f4 ) by XBOOLE_0:def 5;
(not ( ( f4 | n ) . d ) in X) by A354,XBOOLE_0:def 5;
then ( ( f4 | n ) . d ) <= ( p / 2 ) by A355;
then A356: ( ( f4 | n ) . d ) <= p9 by A288,INT_1:54;
(not ( ( f4 | n ) . d ) in { ( 0 ) }) by A107,A292,A355,XBOOLE_0:3;
then ( ( f4 | n ) . d ) <> ( 0 ) by TARSKI:def 1;
hence thesis by A353,A356,FINSEQ_1:def 7;
end;
suppose (ex l being Nat st (l in ( dom f5 ) & d = ( ( len ( f4 | n ) ) + l )));

then consider l being (Element of ( NAT )) such that A357: l in ( dom f5 ) and A358: d = ( ( len ( f4 | n ) ) + l );
( f6 . d ) = ( f5 . l ) by A357,A358,FINSEQ_1:def 7;
hence thesis by A322,A357;
end;
end;
( len f6 ) = ( ( len ( f4 | n ) ) + ( len f5 ) ) by FINSEQ_1:22
.= p9 by A316,A317,A319;
then ( rng f6 ) = ( rng ( idseq p9 ) ) by A314,A350,A351,CKB46:1;
then M = ( Sum f6 ) by A350,A329,RFINSEQ:9,RFINSEQ:26
.= ( ( Sum ( f4 | n ) ) + ( Sum f5 ) ) by RVSUM_1:75
.= ( ( Sum ( f4 | n ) ) + ( ( m * p ) - ( Sum ( f4 /^ n ) ) ) ) by A317,A315,CKB53:1
.= ( ( ( Sum ( f4 | n ) ) + ( m * p ) ) - ( Sum ( f4 /^ n ) ) );
then ( ( q - 1 ) * M ) = ( ( ( p * ( Sum f2 ) ) + ( 2 * ( Sum ( Sgm X ) ) ) ) - ( m * p ) ) by A309,A311,A312;
then A359: ( ( ( q -' 1 ) * M ) mod 2 ) = ( ( ( ( p * ( Sum f2 ) ) - ( m * p ) ) + ( 2 * ( Sum ( Sgm X ) ) ) ) mod 2 ) by A28,XREAL_1:233
.= ( ( ( p * ( Sum f2 ) ) - ( m * p ) ) mod 2 ) by EULER_1:12;
2 divides ( ( q -' 1 ) * M ) by A39,NAT_D:9;
then ( ( ( q -' 1 ) * M ) mod 2 ) = ( 0 ) by PEPIN:6;
then 2 divides ( p * ( ( Sum f2 ) - m ) ) by A359,CKB3:1;
then 2 divides ( ( Sum f2 ) - m ) by A181,INT_2:25;
then ( Sum f2 ),m are_congruent_mod 2 by INT_2:15;
then ( ( Sum f2 ) mod 2 ) = ( m mod 2 ) by NAT_D:64;
then ( ( - 1 ) |^ ( Sum f2 ) ) = ( ( - 1 ) |^ m ) by CKB51:1;
hence thesis by A1,A5,A292,CKB47:1;
end;
hence thesis by A130,A184,NEWTON:8;
end;
