environ
vocabularies NUMBERS,SUBSET_1,INT_1,NAT_1,FINSEQ_1,NEWTON,ARYTM_3,ARYTM_1,RELAT_1,CARD_1,FUNCT_1,CARD_3,FUNCOP_1,ORDINAL4,XBOOLE_0,TARSKI,XXREAL_0,FINSEQ_5,SQUARE_1,INT_2,COMPLEX1,ORDINAL1,ABIAN,FINSEQ_2,FUNCT_7,PARTFUN1,FINSET_1,RFINSEQ,CALCUL_2,REAL_1,ZFMISC_1,INT_5;
notations GROUP_4,INT_1,RVSUM_1,FINSET_1,ORDINAL1,CARD_1,NAT_D,INT_2,FUNCT_1,RELSET_1,PARTFUN1,FUNCT_2,NAT_3,ABIAN,GR_CY_1,FINSEQ_5,FINSEQ_2,EULER_2,NEWTON,GOBRD10,FINSEQ_7,REAL_1,PEPIN,TARSKI,XBOOLE_0,SUBSET_1,XCMPLX_0,NUMBERS,XXREAL_0,NAT_1,DOMAIN_1,FINSEQ_1,RFINSEQ,FUNCOP_1,CALCUL_2,ZFMISC_1,CARD_3,WSIERP_1,BINOP_1,PROB_3,RECDEF_1,CKB4,CKB11,CKB29;
definitions INT_1,FUNCT_1,XCMPLX_0,SQUARE_1,FINSEQ_2,TARSKI,CALCUL_2,CARD_3,CKB4,CKB11,CKB29;
theorems FINSEQ_1,FINSEQ_7,RELAT_1,FINSEQ_3,FINSEQ_2,ABSVALUE,FINSEQ_5,EULER_2,INT_3,SEQ_2,FINSEQ_4,FUNCT_2,XBOOLE_0,NAT_3,NEWTON,INT_2,NAT_2,WSIERP_1,CARD_1,PEPIN,NAT_1,XCMPLX_1,XREAL_1,HEYTING3,ORDINAL1,EULER_1,XBOOLE_1,TARSKI,RVSUM_1,NUMBERS,INT_1,FUNCT_1,FUNCOP_1,XXREAL_0,NAT_D,HILBERT3,GOBRD10,SERIES_2,GRAPH_5,HILBERT2,RFINSEQ,ZFMISC_1,CARD_2,XREAL_0,FINSEQ_6,CALCUL_2,NAT_4,PROB_3,TOPREAL7,CARD_3,REAL_3,PRE_FF,INT_4,VALUED_1,PRE_POLY,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46;
schemes NAT_1,FUNCT_2,RECDEF_1,FINSEQ_2,FUNCT_7,FINSEQ_1;
registrations XXREAL_0,MEMBERED,RELAT_1,FINSEQ_1,ORDINAL1,WSIERP_1,NUMBERS,XBOOLE_0,XREAL_0,NAT_1,INT_1,FINSET_1,NAT_3,RVSUM_1,FUNCT_1,CARD_1,NEWTON,SUBSET_1,VALUED_0,VALUED_1,FINSEQ_2,PRE_POLY,CARD_3,RELSET_1;
constructors BINARITH,ABIAN,WSIERP_1,PEPIN,UPROOTS,NAT_3,NAT_D,REALSET1,GR_CY_1,FINSEQ_5,GOBRD10,EULER_2,RFINSEQ,GROUP_4,FINSEQ_7,REAL_1,WELLORD2,CALCUL_2,SETFAM_1,PROB_3,SEQ_1,RECDEF_1,BINOP_1,BINOP_2,CLASSES1,RELSET_1,CKB4,CKB11,CKB29;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve d for Nat;
reserve p for Prime;
reserve a for Nat;
reserve m for Nat;
theorem
Th41: (for f being (FinSequence of ( NAT )) holds ((((p > 2 & ( a gcd p ) = 1) & f = ( a * ( idseq ( ( p -' 1 ) div 2 ) ) )) & m = ( card { k where k is (Element of ( NAT )): (k in ( rng ( f mod p ) ) & k > ( p / 2 )) } )) implies ( Lege (a,p) ) = ( ( - 1 ) |^ m )))
proof
let f being (FinSequence of ( NAT ));
assume that
A1: p > 2
and
A2: ( a gcd p ) = 1
and
A3: f = ( a * ( idseq ( ( p -' 1 ) div 2 ) ) )
and
A4: m = ( card { k where k is (Element of ( NAT )): (k in ( rng ( f mod p ) ) & k > ( p / 2 )) } );
set f1 = ( f mod p );
A5: ( len f1 ) = ( len f ) by EULER_2:def 1;
set X = { k where k is (Element of ( NAT )): (k in ( rng f1 ) & k > ( p / 2 )) };
(for x being set holds (x in X implies x in ( rng f1 )))
proof
let x being set;
assume x in X;
then (ex k being (Element of ( NAT )) st ((x = k & k in ( rng f1 )) & k > ( p / 2 )));
hence thesis;
end;
then A6: X c= ( rng f1 ) by TARSKI:def 3;
then reconsider X as  finite set;
A7: ( rng f1 ) c= ( NAT ) by FINSEQ_1:def 4;
then reconsider X as  finite (Subset of ( NAT )) by A6,XBOOLE_1:1;
( card X ) is (Element of ( NAT ));
then reconsider m as (Element of ( NAT )) by A4;
A8: ( ( rng f1 ) \ X ) c= ( rng f1 ) by XBOOLE_1:36;
then reconsider Y = ( ( rng f1 ) \ X ) as  finite (Subset of ( NAT )) by A7,XBOOLE_1:1;
A9: ( a |^ ( ( p -' 1 ) div 2 ) ),( Lege (a,p) ) are_congruent_mod p by A1,A2,CKB34:1,INT_1:14;
set f2 = ( Sgm ( rng f1 ) );
( ( Product f1 ) mod p ) = ( ( Product f ) mod p ) by EULER_2:11;
then A10: ( Product f1 ),( Product f ) are_congruent_mod p by NAT_D:64;
A11: p > 1 by INT_2:def 4;
then A12: ( p -' 1 ) = ( p - 1 ) by XREAL_1:233;
then A13: ( p -' 1 ) > ( 0 ) by A11,XREAL_1:50;
set p9 = ( ( p -' 1 ) div 2 );
A14: ( rng ( idseq p9 ) ) = ( Seg p9 ) by RELAT_1:45;
then reconsider I = ( idseq p9 ) as (FinSequence of ( NAT )) by FINSEQ_1:def 4;
( dom f ) = ( dom I ) by A3,VALUED_1:def 5;
then A15: ( len f ) = ( len I ) by FINSEQ_3:29
.= p9 by CARD_1:def 7;
p >= ( 2 + 1 ) by A1,NAT_1:13;
then ( p - 1 ) >= ( 3 - 1 ) by XREAL_1:9;
then f1 <> ( {} ) by A15,A12,A5,NAT_2:13;
then ( rng f1 ) is non empty non empty (Subset of ( NAT )) by FINSEQ_1:def 4;
then consider n1 being (Element of ( NAT )) such that A16: ( rng f1 ) c= ( ( Seg n1 ) \/ { ( 0 ) } ) by HEYTING3:1;
I is (Element of ( p9 -tuples_on ( REAL ) )) by FINSEQ_2:109;
then A17: ( Product f ) = ( ( Product ( p9 |-> a ) ) * ( Product I ) ) by A3,RVSUM_1:108
.= ( ( a |^ p9 ) * ( Product I ) ) by NEWTON:def 1;
p is  odd by A1,PEPIN:17;
then A18: ( p -' 1 ) is  even by A12,HILBERT3:2;
then A19: p9 = ( ( ( p -' 1 ) + 1 ) div 2 ) by NAT_2:26
.= ( p div 2 ) by A11,XREAL_1:235;
2 divides ( p -' 1 ) by A18,PEPIN:22;
then A20: ( p -' 1 ) = ( 2 * p9 ) by NAT_D:3;
then p9 divides ( p -' 1 ) by NAT_D:def 3;
then p9 <= ( p -' 1 ) by A13,NAT_D:7;
then A21: p9 < p by A12,XREAL_1:146,XXREAL_0:2;
(for d being Nat holds (d in ( dom I ) implies ( ( I . d ) gcd p ) = 1))
proof
let d being Nat;
assume d in ( dom I );
then A22: d in ( Seg ( len I ) ) by FINSEQ_1:def 3;
then A23: d in ( Seg p9 ) by CARD_1:def 7;
then A24: ( I . d ) = d by FINSEQ_2:49;
d <= p9 by A23,FINSEQ_1:1;
then A25: d < p by A21,XXREAL_0:2;
d >= 1 by A22,FINSEQ_1:1;
then d,p are_relative_prime  by A25,EULER_1:2;
hence thesis by A24,INT_2:def 3;
end;
then A26: ( ( Product I ) gcd p ) = 1 by WSIERP_1:36;
A27: (for d holds (d in ( dom f ) implies ( f . d ) = ( a * d )))
proof
let d;
assume A28: d in ( dom f );
then d in ( dom I ) by A3,VALUED_1:def 5;
then d in ( Seg ( len I ) ) by FINSEQ_1:def 3;
then A29: d is (Element of ( Seg p9 )) by CARD_1:def 7;
thus ( f . d ) = ( a * ( I . d ) ) by A3,A28,VALUED_1:def 5
.= ( a * d ) by A29,FINSEQ_2:49;
end;
A30: (for d,e being (Element of ( NAT )) holds (((1 <= d & d < e) & e <= ( len f1 )) implies ( f1 . d ) <> ( f1 . e )))
proof
let d being (Element of ( NAT )),e being (Element of ( NAT ));
assume that
A31: 1 <= d
and
A32: d < e
and
A33: e <= ( len f1 );
A34: e <= ( len f ) by A33,EULER_2:def 1;
1 <= e by A31,A32,XXREAL_0:2;
then A35: e in ( dom f ) by A34,FINSEQ_3:25;
then A36: ( f1 . e ) = ( ( f . e ) mod p ) by EULER_2:def 1;
d < ( len f ) by A32,A34,XXREAL_0:2;
then A37: d in ( dom f ) by A31,FINSEQ_3:25;
then A38: ( f1 . d ) = ( ( f . d ) mod p ) by EULER_2:def 1;
now
assume ( f1 . d ) = ( f1 . e );
then ( f . e ),( f . d ) are_congruent_mod p by A38,A36,NAT_D:64;
then p divides ( ( f . e ) - ( f . d ) ) by INT_2:15;
then p divides ( ( a * e ) - ( f . d ) ) by A27,A35;
then p divides ( ( a * e ) - ( a * d ) ) by A27,A37;
then A39: p divides ( a * ( e - d ) );
A40: ( p9 - 1 ) < p by A21,XREAL_1:147;
reconsider dd = ( e - d ) as (Element of ( NAT )) by A32,NAT_1:21;
A41: ( abs p ) = p by ABSVALUE:def 1;
A42: ( abs dd ) = dd by ABSVALUE:def 1;
A43: dd <= ( p9 - 1 ) by A15,A5,A31,A33,XREAL_1:13;
dd <> ( 0 ) by A32;
then p <= dd by A2,A39,A41,A42,INT_4:6,WSIERP_1:29;
hence contradiction by A43,A40,XXREAL_0:2;
end;
hence thesis;
end;
then A44: ( len f1 ) = ( card ( rng f1 ) ) by GRAPH_5:7;
then A45: f1 is  one-to-one by FINSEQ_4:62;
A46: ( dom f1 ) = ( dom f ) by A5,FINSEQ_3:29;
(not ( 0 ) in ( rng f1 ))
proof
reconsider a as (Element of ( NAT )) by ORDINAL1:def 12;
assume ( 0 ) in ( rng f1 );
then consider n being Nat such that A47: n in ( dom f1 ) and A48: ( f1 . n ) = ( 0 ) by FINSEQ_2:10;
( 0 ) = ( ( f . n ) mod p ) by A46,A47,A48,EULER_2:def 1
.= ( ( a * n ) mod p ) by A27,A46,A47;
then A49: p divides ( a * n ) by PEPIN:6;
n >= 1 by A47,FINSEQ_3:25;
then A50: p <= n by A2,A49,NAT_D:7,WSIERP_1:30;
n <= p9 by A15,A5,A47,FINSEQ_3:25;
hence contradiction by A21,A50,XXREAL_0:2;
end;
then A51: { ( 0 ) } misses ( rng f1 ) by ZFMISC_1:50;
then A52: f2 is  one-to-one by A16,FINSEQ_3:92,XBOOLE_1:73;
A53: ( rng f1 ) c= ( Seg n1 ) by A16,A51,XBOOLE_1:73;
then A54: X c= ( Seg n1 ) by A6,XBOOLE_1:1;
( len f ) = ( card ( rng f1 ) ) by A5,A30,GRAPH_5:7;
then reconsider n = ( p9 - m ) as (Element of ( NAT )) by A4,A15,A6,NAT_1:21,NAT_1:43;
A55: Y c= ( Seg n1 ) by A53,A8,XBOOLE_1:1;
A56: ( rng f1 ) = ( rng f2 ) by A53,FINSEQ_1:def 13;
then A57: ( Product f1 ) = ( Product f2 ) by A45,A52,EULER_2:10,RFINSEQ:26;
set f3 = ( ( ( len ( f2 /^ n ) ) |-> p ) - ( f2 /^ n ) );
set f4 = ( ( f2 | n ) ^ f3 );
A58: ( f2 /^ n ) is (FinSequence of ( INT )) by FINSEQ_2:24,NUMBERS:17;
A59: ( dom f3 ) = ( ( dom ( ( len ( f2 /^ n ) ) |-> p ) ) /\ ( dom ( f2 /^ n ) ) ) by VALUED_1:12
.= ( ( Seg ( len ( ( len ( f2 /^ n ) ) |-> p ) ) ) /\ ( dom ( f2 /^ n ) ) ) by FINSEQ_1:def 3
.= ( ( Seg ( len ( f2 /^ n ) ) ) /\ ( dom ( f2 /^ n ) ) ) by CARD_1:def 7
.= ( ( dom ( f2 /^ n ) ) /\ ( dom ( f2 /^ n ) ) ) by FINSEQ_1:def 3
.= ( dom ( f2 /^ n ) );
then A60: ( len f3 ) = ( len ( f2 /^ n ) ) by FINSEQ_3:29;
(for k,l being (Element of ( NAT )) holds ((k in Y & l in X) implies k < l))
proof
let k being (Element of ( NAT )),l being (Element of ( NAT ));
assume that
A61: k in Y
and
A62: l in X;
A63: (not k in X) by A61,XBOOLE_0:def 5;
A64: (ex l1 being (Element of ( NAT )) st ((l1 = l & l1 in ( rng f1 )) & l1 > ( p / 2 ))) by A62;
k in ( rng f1 ) by A61,XBOOLE_0:def 5;
then k <= ( p / 2 ) by A63;
hence thesis by A64,XXREAL_0:2;
end;
then ( Sgm ( Y \/ X ) ) = ( ( Sgm Y ) ^ ( Sgm X ) ) by A54,A55,FINSEQ_3:42;
then ( Sgm ( ( rng f1 ) \/ X ) ) = ( ( Sgm Y ) ^ ( Sgm X ) ) by XBOOLE_1:39;
then A65: f2 = ( ( Sgm Y ) ^ ( Sgm X ) ) by A6,XBOOLE_1:12;
A66: (for d holds (d in ( dom f3 ) implies ( f3 . d ) = ( p - ( ( f2 /^ n ) . d ) )))
proof
let d;
assume A67: d in ( dom f3 );
then d in ( Seg ( len ( f2 /^ n ) ) ) by A59,FINSEQ_1:def 3;
then ( ( ( len ( f2 /^ n ) ) |-> p ) . d ) = p by FINSEQ_2:57;
hence thesis by A67,VALUED_1:13;
end;
A68: ( len ( Sgm Y ) ) = ( card Y ) by A53,A8,FINSEQ_3:39,XBOOLE_1:1
.= ( p9 - m ) by A4,A15,A5,A6,A44,CARD_2:44;
then A69: ( f2 /^ n ) = ( Sgm X ) by A65,FINSEQ_5:37;
A70: (for d holds (d in ( dom f3 ) implies (( f3 . d ) > ( 0 ) & ( f3 . d ) <= p9)))
proof
let d;
reconsider w = ( f3 . d ) as (Element of ( INT )) by INT_1:def 2;
assume A71: d in ( dom f3 );
then ( ( Sgm X ) . d ) in ( rng ( Sgm X ) ) by A69,A59,FUNCT_1:3;
then ( ( Sgm X ) . d ) in X by A54,FINSEQ_1:def 13;
then A72: (ex ll being (Element of ( NAT )) st ((ll = ( ( Sgm X ) . d ) & ll in ( rng f1 )) & ll > ( p / 2 )));
then consider e being Nat such that A73: e in ( dom f1 ) and A74: ( f1 . e ) = ( ( f2 /^ n ) . d ) by A69,FINSEQ_2:10;
( ( f2 /^ n ) . d ) = ( ( f . e ) mod p ) by A46,A73,A74,EULER_2:def 1;
then A75: ( ( f2 /^ n ) . d ) < p by NAT_D:1;
A76: ( f3 . d ) = ( p - ( ( f2 /^ n ) . d ) ) by A66,A71;
then w < ( p - ( p / 2 ) ) by A69,A72,XREAL_1:10;
hence thesis by A19,A76,A75,INT_1:54,XREAL_1:50;
end;
(for d being Nat holds (d in ( dom f3 ) implies ( f3 . d ) in ( NAT )))
proof
let d being Nat;
assume d in ( dom f3 );
then ( f3 . d ) > ( 0 ) by A70;
hence thesis by INT_1:3;
end;
then reconsider f3 as (FinSequence of ( NAT )) by FINSEQ_2:12;
( abs ( ( - 1 ) |^ m ) ) = 1 by SERIES_2:1;
then A77: (( ( - 1 ) |^ m ) = 1 or ( - ( ( - 1 ) |^ m ) ) = 1) by ABSVALUE:1;
f3 is (FinSequence of ( NAT ));
then reconsider f4 as (FinSequence of ( NAT )) by FINSEQ_1:75;
A78: ( f2 | n ) = ( Sgm Y ) by A65,A68,FINSEQ_3:113,FINSEQ_6:10;
A79: (for d holds (d in ( dom f4 ) implies (( f4 . d ) > ( 0 ) & ( f4 . d ) <= p9)))
proof
let d;
assume A80: d in ( dom f4 );
per cases  by A80,FINSEQ_1:25;
suppose A81: d in ( dom ( f2 | n ) );

reconsider d as (Element of ( NAT )) by ORDINAL1:def 12;
( ( f2 | n ) . d ) in ( rng ( Sgm Y ) ) by A78,A81,FUNCT_1:3;
then A82: ( ( f2 | n ) . d ) in Y by A55,FINSEQ_1:def 13;
then A83: ( ( f2 | n ) . d ) in ( rng f1 ) by XBOOLE_0:def 5;
(not ( ( f2 | n ) . d ) in X) by A82,XBOOLE_0:def 5;
then ( ( f2 | n ) . d ) <= ( p / 2 ) by A83;
then A84: ( ( f2 | n ) . d ) <= p9 by A19,INT_1:54;
(not ( ( f2 | n ) . d ) in { ( 0 ) }) by A51,A83,XBOOLE_0:3;
then ( ( f2 | n ) . d ) <> ( 0 ) by TARSKI:def 1;
hence thesis by A81,A84,FINSEQ_1:def 7;
end;
suppose (ex l being Nat st (l in ( dom f3 ) & d = ( ( len ( f2 | n ) ) + l )));

then consider l being (Element of ( NAT )) such that A85: l in ( dom f3 ) and A86: d = ( ( len ( f2 | n ) ) + l );
( f4 . d ) = ( f3 . l ) by A85,A86,FINSEQ_1:def 7;
hence thesis by A70,A85;
end;
end;
A87: f2 = ( ( f2 | n ) ^ ( f2 /^ n ) ) by RFINSEQ:8;
then A88: ( f2 /^ n ) is  one-to-one by A52,FINSEQ_3:91;
(for d,e being (Element of ( NAT )) holds (((1 <= d & d < e) & e <= ( len f3 )) implies ( f3 . d ) <> ( f3 . e )))
proof
let d being (Element of ( NAT )),e being (Element of ( NAT ));
assume that
A89: 1 <= d
and
A90: d < e
and
A91: e <= ( len f3 );
1 <= e by A89,A90,XXREAL_0:2;
then A92: e in ( dom f3 ) by A91,FINSEQ_3:25;
then A93: ( f3 . e ) = ( p - ( ( f2 /^ n ) . e ) ) by A66;
d < ( len f3 ) by A90,A91,XXREAL_0:2;
then A94: d in ( dom f3 ) by A89,FINSEQ_3:25;
then ( f3 . d ) = ( p - ( ( f2 /^ n ) . d ) ) by A66;
hence thesis by A88,A59,A90,A94,A92,A93,FUNCT_1:def 4;
end;
then ( len f3 ) = ( card ( rng f3 ) ) by GRAPH_5:7;
then A95: f3 is  one-to-one by FINSEQ_4:62;
A96: ( len f2 ) = p9 by A15,A5,A16,A51,A44,FINSEQ_3:39,XBOOLE_1:73;
then A97: n <= ( len f2 ) by XREAL_1:43;
A98: ( rng ( f2 | n ) ) misses ( rng f3 )
proof
assume ( rng ( f2 | n ) ) meets ( rng f3 );
then consider x being set such that A99: x in ( rng ( f2 | n ) ) and A100: x in ( rng f3 ) by XBOOLE_0:3;
consider e being Nat such that A101: e in ( dom f3 ) and A102: ( f3 . e ) = x by A100,FINSEQ_2:10;
x = ( p - ( ( f2 /^ n ) . e ) ) by A66,A101,A102;
then A103: x = ( p - ( f2 . ( e + n ) ) ) by A97,A59,A101,RFINSEQ:def 1;
( e + n ) in ( dom f2 ) by A59,A101,FINSEQ_5:26;
then consider e1 being Nat such that A104: e1 in ( dom f1 ) and A105: ( f1 . e1 ) = ( f2 . ( e + n ) ) by A56,FINSEQ_2:10,FUNCT_1:3;
A106: e1 in ( dom f ) by A5,A104,FINSEQ_3:29;
A107: e1 <= p9 by A15,A5,A104,FINSEQ_3:25;
( rng ( f2 | n ) ) c= ( rng f2 ) by FINSEQ_5:19;
then consider d1 being Nat such that A108: d1 in ( dom f1 ) and A109: ( f1 . d1 ) = x by A56,A99,FINSEQ_2:10;
d1 <= p9 by A15,A5,A108,FINSEQ_3:25;
then ( d1 + e1 ) <= ( p9 + p9 ) by A107,XREAL_1:7;
then A110: ( d1 + e1 ) < p by A12,A20,XREAL_1:146,XXREAL_0:2;
x = ( ( f . d1 ) mod p ) by A46,A108,A109,EULER_2:def 1;
then ( ( ( f . d1 ) mod p ) + ( f2 . ( e + n ) ) ) = p by A103;
then ( ( ( f . d1 ) mod p ) + ( ( f . e1 ) mod p ) ) = p by A105,A106,EULER_2:def 1;
then ( ( ( ( f . d1 ) mod p ) + ( ( f . e1 ) mod p ) ) mod p ) = ( 0 ) by NAT_D:25;
then ( ( ( f . d1 ) + ( f . e1 ) ) mod p ) = ( 0 ) by EULER_2:6;
then p divides ( ( f . d1 ) + ( f . e1 ) ) by PEPIN:6;
then p divides ( ( d1 * a ) + ( f . e1 ) ) by A27,A46,A108;
then p divides ( ( d1 * a ) + ( e1 * a ) ) by A27,A106;
then A111: p divides ( ( d1 + e1 ) * a );
d1 >= 1 by A108,FINSEQ_3:25;
hence contradiction by A2,A111,A110,NAT_D:7,WSIERP_1:30;
end;
( f2 | n ) is  one-to-one by A52,A87,FINSEQ_3:91;
then A112: f4 is  one-to-one by A95,A98,FINSEQ_3:91;
A113: (for d holds (d in ( dom f3 ) implies ( f3 . d ),( - ( ( f2 /^ n ) . d ) ) are_congruent_mod p))
proof
let d;
assume d in ( dom f3 );
then ( ( f3 . d ) mod p ) = ( ( p - ( ( f2 /^ n ) . d ) ) mod p ) by A66
.= ( ( ( 1 * p ) + ( - ( ( f2 /^ n ) . d ) ) ) mod p )
.= ( ( - ( ( f2 /^ n ) . d ) ) mod p ) by EULER_1:12;
hence thesis by NAT_D:64;
end;
A114: ( len ( f2 /^ n ) ) = ( ( len f2 ) -' n ) by RFINSEQ:29
.= ( ( len f2 ) - n ) by A96,XREAL_1:43,XREAL_1:233
.= m by A96;
( len ( f2 | n ) ) = n by A96,FINSEQ_1:59,XREAL_1:43;
then ( len f4 ) = ( n + m ) by A60,A114,FINSEQ_1:22
.= ( len f ) by A15;
then ( rng f4 ) = ( rng I ) by A14,A15,A112,A79,CKB46:1;
then ( Product f4 ) = ( Product I ) by A112,EULER_2:10,RFINSEQ:26;
then A115: ( ( Product ( f2 | n ) ) * ( Product f3 ) ) = ( Product I ) by RVSUM_1:97;
f3 is (FinSequence of ( INT )) by FINSEQ_2:24,NUMBERS:17;
then ( ( Product f3 ) * ( Product ( f2 | n ) ) ),( ( ( ( - 1 ) |^ m ) * ( Product ( f2 /^ n ) ) ) * ( Product ( f2 | n ) ) ) are_congruent_mod p by A60,A114,A58,A113,CKB39:1,INT_4:11;
then ( ( Product f3 ) * ( Product ( f2 | n ) ) ),( ( ( - 1 ) |^ m ) * ( ( Product ( f2 | n ) ) * ( Product ( f2 /^ n ) ) ) ) are_congruent_mod p;
then ( Product I ),( ( ( - 1 ) |^ m ) * ( Product ( ( f2 | n ) ^ ( f2 /^ n ) ) ) ) are_congruent_mod p by A115,RVSUM_1:97;
then A116: ( Product I ),( ( ( - 1 ) |^ m ) * ( Product f1 ) ) are_congruent_mod p by A57,RFINSEQ:8;
( ( ( - 1 ) |^ m ) * ( Product f1 ) ),( ( ( - 1 ) |^ m ) * ( Product f ) ) are_congruent_mod p by A10,INT_4:11;
then ( Product I ),( ( ( ( - 1 ) |^ m ) * ( a |^ p9 ) ) * ( Product I ) ) are_congruent_mod p by A17,A116,INT_1:15;
then p divides ( ( 1 * ( Product I ) ) - ( ( ( ( - 1 ) |^ m ) * ( a |^ p9 ) ) * ( Product I ) ) ) by INT_2:15;
then p divides ( ( 1 - ( ( ( - 1 ) |^ m ) * ( a |^ p9 ) ) ) * ( Product I ) );
then p divides ( 1 - ( ( ( - 1 ) |^ m ) * ( a |^ p9 ) ) ) by A26,WSIERP_1:29;
then p divides ( ( ( - 1 ) |^ m ) * ( 1 - ( ( ( - 1 ) |^ m ) * ( a |^ p9 ) ) ) ) by INT_2:2;
then A117: p divides ( ( ( - 1 ) |^ m ) - ( ( ( ( - 1 ) |^ m ) * ( ( - 1 ) |^ m ) ) * ( a |^ p9 ) ) );
( ( ( - 1 ) |^ m ) * ( ( - 1 ) |^ m ) ) = ( ( - 1 ) |^ ( m + m ) ) by NEWTON:8
.= ( ( - 1 ) |^ ( 2 * m ) )
.= ( ( ( - 1 ) |^ 2 ) |^ m ) by NEWTON:9
.= ( ( 1 |^ 2 ) |^ m ) by WSIERP_1:1
.= ( ( 1 ^2 ) |^ m ) by NEWTON:81
.= 1 by NEWTON:10;
then ( ( - 1 ) |^ m ),( a |^ p9 ) are_congruent_mod p by A117,INT_2:15;
then A118: ( ( - 1 ) |^ m ),( Lege (a,p) ) are_congruent_mod p by A9,INT_1:15;
per cases  by A77;
suppose A119: ( ( - 1 ) |^ m ) = 1;

A120:now
assume ( Lege (a,p) ) = ( - 1 );
then p divides ( 1 - ( - 1 ) ) by A118,A119,INT_2:15;
hence contradiction by A1,NAT_D:7;
end;
now
assume ( Lege (a,p) ) = ( 0 );
then p divides ( 1 - ( 0 ) ) by A118,A119,INT_2:15;
then p = 1 by WSIERP_1:15;
hence contradiction by A1;
end;
hence thesis by A119,CKB30:1,A120;
end;
suppose A121: ( ( - 1 ) |^ m ) = ( - 1 );

A122:now
assume ( Lege (a,p) ) = 1;
then p divides ( ( - 1 ) - 1 ) by A118,A121,INT_2:15;
then p divides ( - 2 );
then p divides 2 by INT_2:10;
hence contradiction by A1,NAT_D:7;
end;
now
assume ( Lege (a,p) ) = ( 0 );
then p divides ( ( - 1 ) - ( 0 ) ) by A118,A121,INT_2:15;
then p divides 1 by INT_2:10;
then p = 1 by WSIERP_1:15;
hence contradiction by A1;
end;
hence thesis by A121,CKB30:1,A122;
end;
end;
