environ
vocabularies XBOOLE_0,STRUCT_0,MSUALG_1,CARD_3,RELAT_1,FUNCT_1,SUBSET_1,PBOOLE,MSUALG_3,TARSKI,FUNCT_6,MEMBER_1,CATALG_1,ZF_MODEL,MSUALG_2,MSAFREE,FUNCOP_1,CARD_1,LANG1,ZFMISC_1,TREES_4,MCART_1,MARGREL1,FINSEQ_1,MSATERM,UNIALG_2,DTCONSTR,FINSET_1,TREES_2,TREES_9,ZF_LANG1,TREES_3,TREES_A,NUMBERS,ARYTM_3,ORDINAL4,XXREAL_0,NAT_1,PARTFUN1,MSUALG_6,PRELAMB;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,DOMAIN_1,RELAT_1,FUNCT_1,RELSET_1,STRUCT_0,NUMBERS,NAT_1,MCART_1,FINSET_1,CARD_3,FINSEQ_1,FINSEQ_2,TREES_1,TREES_2,FUNCT_6,TREES_3,TREES_4,DTCONSTR,LANG1,PBOOLE,TREES_9,MSUALG_1,MSUALG_2,MSAFREE,FUNCOP_1,MSUALG_3,EQUATION,MSATERM,MSUALG_6,CATALG_1,XXREAL_0,CKB2,CKB4,CKB17,CKB18,CKB25,CKB27;
definitions TARSKI,XBOOLE_0,PBOOLE,MSUALG_2,MSUALG_6,CATALG_1,CKB4,CKB17,CKB18,CKB25,CKB27;
theorems TARSKI,ZFMISC_1,FUNCT_1,FUNCT_2,FINSEQ_1,FINSEQ_3,NAT_1,MCART_1,PBOOLE,RELAT_1,CARD_3,CARD_5,FUNCT_6,TREES_3,MSUALG_1,INSTALG1,TREES_4,PRE_CIRC,TREES_1,TREES_2,MSUALG_2,MSUALG_3,MSAFREE,MSATERM,EQUATION,MSUALG_6,XBOOLE_0,XBOOLE_1,ORDINAL1,PARTFUN1,TREES_9,FINSEQ_2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB10,CKB11,CKB12,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31;
schemes PBOOLE,MSATERM;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCOP_1,XREAL_0,FINSEQ_1,TREES_2,TREES_3,TREES_9,STRUCT_0,RELSET_1,MSUALG_1,MSUALG_2,MSUALG_3,MSAFREE,MSATERM,INDEX_1,MSUALG_6,MSUALG_9,INSTALG1,CATALG_1,PRE_CIRC,MSSUBFAM,PBOOLE,CKB1,CKB9,CKB13,CKB14,CKB15,CKB16;
constructors DOMAIN_1,XXREAL_0,NAT_1,TREES_9,MSSUBFAM,MSUALG_3,MSATERM,MSUALG_6,CATALG_1,EQUATION,SEQ_4,RELSET_1,FINSEQ_2,CKB4,CKB17,CKB18,CKB25,CKB27;
requirements BOOLE,SUBSET,NUMERALS;
begin
reserve x for set;
reserve y for set;
reserve z for set;
theorem
Th21: (for S being non  void Signature holds (for X being  non-empty (ManySortedSet of (the carrier of S)) holds (for A being (MSSubset of ( FreeMSA X )) holds (A is  opers_closed iff (for o being (OperSymbol of S) holds (for p being (ArgumentSeq of ( Sym (o,X) )) holds (( rng p ) c= ( Union A ) implies ( ( Sym (o,X) ) -tree p ) in ( A . ( the_result_sort_of o ) ))))))))
proof
let S being non  void Signature;
let X being  non-empty (ManySortedSet of (the carrier of S));
set A = ( FreeMSA X );
let T being (MSSubset of ( FreeMSA X ));
hereby
assume A1: T is  opers_closed;
let o being (OperSymbol of S);
let p being (ArgumentSeq of ( Sym (o,X) ));
T is_closed_on o by A1,MSUALG_2:def 6;
then A2: ( rng ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) ) c= ( ( T * (the ResultSort of S) ) . o ) by MSUALG_2:def 5;
A3: p is (Element of ( Args (o,A) )) by INSTALG1:1;
A4: ( dom p ) = ( dom ( the_arity_of o ) ) by MSATERM:22;
A5: ( dom T ) = (the carrier of S) by PARTFUN1:def 2;
assume A6: ( rng p ) c= ( Union T );
A7:now
let x;
assume A8: x in ( dom ( the_arity_of o ) );
then reconsider i = x as Nat;
reconsider t = ( p . i ) as (Term of S,X) by A4,A8,MSATERM:22;
A9: (( the_sort_of t ) = ( ( the_arity_of o ) . x ) & ( ( T * ( the_arity_of o ) ) . x ) = ( T . ( ( the_arity_of o ) . x ) )) by A4,A8,FUNCT_1:13,MSATERM:23;
( p . x ) in ( rng p ) by A4,A8,FUNCT_1:def 3;
then consider y such that A10: y in ( dom T ) and A11: ( p . x ) in ( T . y ) by A6,CARD_5:2;
T c= (the Sorts of A) by PBOOLE:def 18;
then ( T . y ) c= ( (the Sorts of A) . y ) by A5,A10,PBOOLE:def 2;
hence ( p . x ) in ( ( T * ( the_arity_of o ) ) . x ) by A5,A10,A11,A9,CKB11:1;
end;
( rng ( the_arity_of o ) ) c= ( dom T ) by A5;
then ( dom ( T * ( the_arity_of o ) ) ) = ( dom ( the_arity_of o ) ) by RELAT_1:27;
then A12: p in ( product ( T * ( the_arity_of o ) ) ) by A4,A7,CARD_3:9;
A13: ( ( ( T # ) * (the Arity of S) ) . o ) = ( ( T # ) . ( (the Arity of S) . o ) ) by FUNCT_2:15
.= ( ( T # ) . ( the_arity_of o ) ) by MSUALG_1:def 1
.= ( product ( T * ( the_arity_of o ) ) ) by FINSEQ_2:def 5;
then A14: ( ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) . p ) = ( ( Den (o,A) ) . p ) by A12,FUNCT_1:49;
( dom ( Den (o,A) ) ) = ( Args (o,A) ) by FUNCT_2:def 1;
then p in ( dom ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) ) by A13,A3,A12,RELAT_1:57;
then A15: ( ( Den (o,A) ) . p ) in ( rng ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) ) by A14,FUNCT_1:def 3;
( ( T * (the ResultSort of S) ) . o ) = ( T . ( (the ResultSort of S) . o ) ) by FUNCT_2:15
.= ( T . ( the_result_sort_of o ) ) by MSUALG_1:def 2;
then ([ o,(the carrier of S) ] = ( Sym (o,X) ) & ( ( Den (o,A) ) . p ) in ( T . ( the_result_sort_of o ) )) by A2,A15,MSAFREE:def 9;
hence ( ( Sym (o,X) ) -tree p ) in ( T . ( the_result_sort_of o ) ) by A3,INSTALG1:3;
end;
assume A16: (for o being (OperSymbol of S) holds (for p being (ArgumentSeq of ( Sym (o,X) )) holds (( rng p ) c= ( Union T ) implies ( ( Sym (o,X) ) -tree p ) in ( T . ( the_result_sort_of o ) ))));
let o being (OperSymbol of S);
let x being set;
A17: ( ( T * (the ResultSort of S) ) . o ) = ( T . ( (the ResultSort of S) . o ) ) by FUNCT_2:15
.= ( T . ( the_result_sort_of o ) ) by MSUALG_1:def 2;
assume x in ( rng ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) );
then consider y such that A18: y in ( dom ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) ) and A19: x = ( ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) . y ) by FUNCT_1:def 3;
y in ( dom ( Den (o,A) ) ) by A18,RELAT_1:57;
then reconsider y as (Element of ( Args (o,A) )) by A18;
reconsider p = y as (ArgumentSeq of ( Sym (o,X) )) by INSTALG1:1;
A20: ( dom ( ( Den (o,A) ) | ( ( ( T # ) * (the Arity of S) ) . o ) ) ) c= ( ( ( T # ) * (the Arity of S) ) . o ) by RELAT_1:58;
A21: ( ( ( T # ) * (the Arity of S) ) . o ) = ( ( T # ) . ( (the Arity of S) . o ) ) by FUNCT_2:15
.= ( ( T # ) . ( the_arity_of o ) ) by MSUALG_1:def 1
.= ( product ( T * ( the_arity_of o ) ) ) by FINSEQ_2:def 5;
A22: ( rng p ) c= ( Union T )
proof
let z;
A23: ( dom T ) = (the carrier of S) by PARTFUN1:def 2;
assume z in ( rng p );
then consider a being set such that A24: a in ( dom p ) and A25: z = ( p . a ) by FUNCT_1:def 3;
A26: ( dom p ) = ( dom ( T * ( the_arity_of o ) ) ) by A18,A21,A20,CARD_3:9;
then A27: (z in ( ( T * ( the_arity_of o ) ) . a ) & ( ( T * ( the_arity_of o ) ) . a ) = ( T . ( ( the_arity_of o ) . a ) )) by A18,A21,A20,A24,A25,CARD_3:9,FUNCT_1:12;
( rng ( the_arity_of o ) ) c= (the carrier of S);
then ( dom ( T * ( the_arity_of o ) ) ) = ( dom ( the_arity_of o ) ) by A23,RELAT_1:27;
then ( ( the_arity_of o ) . a ) in ( rng ( the_arity_of o ) ) by A24,A26,FUNCT_1:def 3;
hence thesis by A23,A27,CARD_5:2;
end;
x = ( ( Den (o,A) ) . y ) by A18,A19,FUNCT_1:47
.= ( [ o,(the carrier of S) ] -tree y ) by INSTALG1:3
.= ( ( Sym (o,X) ) -tree p ) by MSAFREE:def 9;
hence thesis by A16,A17,A22;
end;
