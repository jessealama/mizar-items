environ
vocabularies XBOOLE_0,TREES_3,SUBSET_1,FINSET_1,TREES_2,TREES_1,CARD_1,ARYTM_3,NAT_1,ORDINAL4,FINSEQ_1,ARYTM_1,RELAT_1,FUNCT_1,TARSKI,ORDINAL1,NUMBERS,XXREAL_0,ZFMISC_1,TREES_4,FUNCT_6,TREES_A,TREES_9,MCART_1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,CARD_1,NUMBERS,XCMPLX_0,RELAT_1,FUNCT_1,RELSET_1,FUNCT_2,FUNCT_6,NAT_1,BINOP_1,FINSET_1,FINSEQ_1,FINSEQ_2,TREES_1,TREES_2,TREES_3,TREES_4,MCART_1,XXREAL_0,CKB1,CKB8,CKB9,CKB16,CKB18,CKB19,CKB27,CKB28,CKB33,CKB35,CKB36,CKB42,CKB47,CKB50,CKB51,CKB53,CKB54,CKB61,CKB66;
definitions TARSKI,XBOOLE_0,FUNCT_1,TREES_2,TREES_3,TREES_4,BINOP_1,CKB9,CKB16,CKB18,CKB19,CKB27,CKB28,CKB33,CKB42,CKB47,CKB50,CKB51,CKB61,CKB66;
theorems TARSKI,AXIOMS,ZFMISC_1,NAT_1,WELLORD2,FUNCT_1,FUNCT_2,FINSEQ_1,FINSEQ_3,CARD_1,CARD_2,FUNCT_6,TREES_1,TREES_2,TREES_3,TREES_4,RELSET_1,RELAT_1,XBOOLE_0,XBOOLE_1,FINSET_1,XREAL_1,XXREAL_0,ORDINAL1,FINSEQ_2,REALSET1,TREES_A,MCART_1,FINSEQ_6,CKB3,CKB4,CKB5,CKB6,CKB7,CKB9,CKB10,CKB11,CKB12,CKB16,CKB18,CKB19,CKB26,CKB27,CKB28,CKB29,CKB31,CKB33,CKB38,CKB39,CKB40,CKB41,CKB42,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB55,CKB56,CKB57,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB68,CKB69,CKB70,CKB71,CKB72,CKB73,CKB74,CKB75,CKB76,CKB77,CKB78,CKB79,CKB80,CKB81,CKB82;
schemes NAT_1,FUNCT_1,FINSEQ_1,CLASSES1,FUNCT_2,TREES_2,CKB25;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FINSET_1,XREAL_0,FINSEQ_1,TREES_1,TREES_2,TREES_3,PRE_CIRC,CARD_1,ZFMISC_1,REALSET1,BINOP_1,SUBSET_1,RELSET_1,NAT_1,TREES_A,CKB2,CKB13,CKB14,CKB15,CKB17,CKB20,CKB21,CKB22,CKB23,CKB24,CKB30,CKB32,CKB34,CKB37,CKB43,CKB52,CKB58,CKB67;
constructors WELLORD2,XXREAL_0,XREAL_0,NAT_1,FINSEQ_2,TREES_4,RELSET_1,BINOP_1,FINSEQ_4,CKB1,CKB16,CKB18,CKB19,CKB27,CKB28,CKB33,CKB35,CKB36,CKB42,CKB47,CKB50,CKB51,CKB53,CKB54,CKB61,CKB66;
requirements NUMERALS,BOOLE,SUBSET,ARITHM,REAL;
begin
reserve T for  finite-branching DecoratedTree;
reserve t for (Element of ( dom T ));
reserve x9 for (Element of ( dom T ));
reserve n for (Element of ( NAT ));
reserve k1 for (Element of ( NAT ));
reserve k2 for (Element of ( NAT ));
reserve l for (Element of ( NAT ));
reserve k for (Element of ( NAT ));
reserve m for (Element of ( NAT ));
reserve x for set;
reserve y for set;
scheme ExDecTrees { D() -> non  empty set,d() -> (Element of D()),G(set) -> (FinSequence of D()) } : (ex T being  finite-branching (DecoratedTree of D()) st (( T . ( {} ) ) = d() & (for t being (Element of ( dom T )) holds (for w being (Element of D()) holds (w = ( T . t ) implies ( succ (T,t) ) = G(w))))))
proof
defpred P[ set,set ]
 means
((( len G($1) ) = ( 0 ) & $2 = ( {} )) or (( len G($1) ) <> ( 0 ) & (ex m st (( m + 1 ) = ( len G($1) ) & $2 = ( { ( 0 ) } \/ ( Seg m ) )))));
A1: (for x holds (x in D() implies (ex y st P[ x,y ])))
proof
let x;
assume that
x in D();
per cases ;
suppose ( len G(x) ) = ( 0 );

hence thesis;
end;
suppose ( len G(x) ) <> ( 0 );

then consider m being Nat such that A2: ( m + 1 ) = ( len G(x) ) by NAT_1:6;
reconsider m as (Element of ( NAT )) by ORDINAL1:def 12;
(ex y st y = ( { ( 0 ) } \/ ( Seg m ) ));
hence thesis by A2;
end;
end;
(ex F being Function st (( dom F ) = D() & (for x holds (x in D() implies P[ x,( F . x ) ])))) from CLASSES1:sch 1(A1);
then consider F being Function such that A3: (for x holds (x in D() implies ((( len G(x) ) = ( 0 ) & ( F . x ) = ( {} )) or (( len G(x) ) <> ( 0 ) & (ex m st (( m + 1 ) = ( len G(x) ) & ( F . x ) = ( { ( 0 ) } \/ ( Seg m ) )))))));
deffunc F(set) = ( F . $1 );
A4: (for k holds (for x holds (x in D() implies (k in F(x) iff ( k + 1 ) in ( Seg ( len G(x) ) )))))
proof
let k;
let x;
assume that
A5: x in D();
now
assume A6: k in F(x);
then consider m such that A7: ( m + 1 ) = ( len G(x) ) and A8: ( F . x ) = ( { ( 0 ) } \/ ( Seg m ) ) by A3,A5;
(( 0 ) <= k & k <= m)
proof
per cases  by A6,A8,XBOOLE_0:def 3;
suppose k in { ( 0 ) };

then k = ( 0 ) by TARSKI:def 1;
hence thesis by NAT_1:2;
end;
suppose A9: k in ( Seg m );

then ( ( 0 ) + 1 ) <= k by FINSEQ_1:1;
hence thesis by A9,FINSEQ_1:1,NAT_1:13;
end;
end;
then (( ( 0 ) + 1 ) <= ( k + 1 ) & ( k + 1 ) <= ( m + 1 )) by XREAL_1:6;
hence ( k + 1 ) in ( Seg ( len G(x) ) ) by A7,FINSEQ_1:1;
end;
hence (k in F(x) implies ( k + 1 ) in ( Seg ( len G(x) ) ));
assume A10: ( k + 1 ) in ( Seg ( len G(x) ) );
then ( len G(x) ) <> ( 0 );
then consider m such that A11: ( m + 1 ) = ( len G(x) ) and A12: ( F . x ) = ( { ( 0 ) } \/ ( Seg m ) ) by A3,A5;
k in ( { ( 0 ) } \/ ( Seg m ) )
proof
per cases ;
suppose k = ( 0 );

then k in { ( 0 ) } by TARSKI:def 1;
hence thesis by XBOOLE_0:def 3;
end;
suppose k <> ( 0 );

then ( 0 ) < k by NAT_1:3;
then A13: ( ( 0 ) + 1 ) <= k by NAT_1:13;
( k + 1 ) <= ( len G(x) ) by A10,FINSEQ_1:1;
then k <= m by A11,XREAL_1:6;
then k in ( Seg m ) by A13,FINSEQ_1:1;
hence thesis by XBOOLE_0:def 3;
end;
end;
hence thesis by A12;
end;
A14: (for x being set holds (for t being (Element of ( dom T )) holds (x in D() implies { ( t ^ <* k *> ): k in F(x) } = { ( t ^ <* m *> ): ( m + 1 ) in ( Seg ( len G(x) ) ) })))
proof
let x being set;
let t being (Element of ( dom T ));
assume that
A15: x in D();
thus { ( t ^ <* k *> ): k in F(x) } c= { ( t ^ <* m *> ): ( m + 1 ) in ( Seg ( len G(x) ) ) }
proof
let y being set;
assume y in { ( t ^ <* k *> ): k in F(x) };
then consider k such that A16: y = ( t ^ <* k *> ) and A17: k in F(x);
( k + 1 ) in ( Seg ( len G(x) ) ) by A4,A15,A17;
hence thesis by A16;
end;

thus { ( t ^ <* m *> ): ( m + 1 ) in ( Seg ( len G(x) ) ) } c= { ( t ^ <* k *> ): k in F(x) }
proof
let y being set;
assume y in { ( t ^ <* m *> ): ( m + 1 ) in ( Seg ( len G(x) ) ) };
then consider m such that A18: y = ( t ^ <* m *> ) and A19: ( m + 1 ) in ( Seg ( len G(x) ) );
m in F(x) by A4,A15,A19;
hence thesis by A18;
end;

end;
defpred P[ set,set ]
 means
(ex x st (ex n st ((x in D() & $1 = [ x,n ]) & ((n in F(x) & $2 = ( G(x) . ( n + 1 ) )) or ((not n in F(x)) & $2 = d())))));
A20: (for c being (Element of [: D(),( NAT ) :]) holds (ex y being (Element of D()) st P[ c,y ]))
proof
let c being (Element of [: D(),( NAT ) :]);
(( c `1 ) in D() & ( c `2 ) in ( NAT )) by MCART_1:10;
then consider x being (Element of D()),n being (Element of ( NAT )) such that A21: (x = ( c `1 ) & n = ( c `2 ));
A22: c = [ x,n ] by A21,MCART_1:21;
per cases ;
suppose A23: n in F(x);

then ( n + 1 ) in ( Seg ( len G(x) ) ) by A4;
then ( n + 1 ) in ( dom G(x) ) by FINSEQ_1:def 3;
then A24: ( G(x) . ( n + 1 ) ) in ( rng G(x) ) by FUNCT_1:def 3;
thus thesis by A22,A23,A24;
end;
suppose (not n in F(x));

hence thesis by A22;
end;
end;
(ex S being (Function of [: D(),( NAT ) :],D()) st (for c being (Element of [: D(),( NAT ) :]) holds P[ c,( S . c ) ])) from FUNCT_2:sch 3(A20);
then consider S being (Function of [: D(),( NAT ) :],D()) such that A25: (for c being (Element of [: D(),( NAT ) :]) holds P[ c,( S . c ) ]);
A26: (for n holds (for x holds (for m holds ((( m + 1 ) = ( len G(x) ) & x in D()) implies (n in F(x) iff (( 0 ) <= n & n <= m))))))
proof
let n;
let x;
let m;
assume that
A27: ( m + 1 ) = ( len G(x) )
and
A28: x in D();
thus (n in F(x) implies (( 0 ) <= n & n <= m))
proof
A29: (ex k st (( k + 1 ) = ( len G(x) ) & F(x) = ( { ( 0 ) } \/ ( Seg k ) ))) by A3,A27,A28;
assume A30: n in F(x);
per cases  by A27,A30,A29,XBOOLE_0:def 3;
suppose n in { ( 0 ) };

then n = ( 0 ) by TARSKI:def 1;
hence thesis by NAT_1:2;
end;
suppose A31: n in ( Seg m );

then 1 <= n by FINSEQ_1:1;
hence thesis by A31,FINSEQ_1:1,XXREAL_0:2;
end;
end;

thus ((( 0 ) <= n & n <= m) implies n in F(x))
proof
assume that
( 0 ) <= n
and
A32: n <= m;
A33: (ex k st (( k + 1 ) = ( len G(x) ) & F(x) = ( { ( 0 ) } \/ ( Seg k ) ))) by A3,A27,A28;
per cases ;
suppose n = ( 0 );

then n in { ( 0 ) } by TARSKI:def 1;
hence thesis by A33,XBOOLE_0:def 3;
end;
suppose n <> ( 0 );

then ( 0 ) < n by NAT_1:3;
then ( ( 0 ) + 1 ) <= n by NAT_1:13;
then n in ( Seg m ) by A32,FINSEQ_1:1;
hence thesis by A27,A33,XBOOLE_0:def 3;
end;
end;

end;
A34: (for d being (Element of D()) holds (for k1 holds (for k2 holds ((k1 <= k2 & k2 in F(d)) implies k1 in F(d)))))
proof
let d being (Element of D());
let k1;
let k2;
assume that
A35: k1 <= k2
and
A36: k2 in F(d);
(ex m st (( m + 1 ) = ( len G(d) ) & ( F . d ) = ( { ( 0 ) } \/ ( Seg m ) ))) by A3,A36;
then consider m such that A37: ( m + 1 ) = ( len G(d) );
k2 <= m by A26,A36,A37;
then (( 0 ) <= k1 & k1 <= m) by A35,NAT_1:2,XXREAL_0:2;
hence thesis by A26,A37;
end;
consider T being (DecoratedTree of D()) such that A38: (( T . ( {} ) ) = d() & (for t being (Element of ( dom T )) holds (( succ t ) = { ( t ^ <* k *> ): k in F(( T . t )) } & (for n holds (n in F(( T . t )) implies ( T . ( t ^ <* n *> ) ) = ( S . (( T . t ),n) )))))) from TREES_2:sch 8(A34);
(for t being (Element of ( dom T )) holds ( succ t ) is  finite)
proof
let t being (Element of ( dom T ));
defpred P[ set,set ]
 means
(ex m st (( m + 1 ) = $1 & $2 = ( t ^ <* m *> )));
A39: (for k being Nat holds (k in ( Seg ( len G(( T . t )) ) ) implies (ex x st P[ k,x ])))
proof
let k being Nat;
assume k in ( Seg ( len G(( T . t )) ) );
then k <> ( 0 ) by FINSEQ_1:1;
then consider m being Nat such that A40: ( m + 1 ) = k by NAT_1:6;
reconsider m as (Element of ( NAT )) by ORDINAL1:def 12;
(ex x st x = ( t ^ <* m *> ));
hence thesis by A40;
end;
(ex L being FinSequence st (( dom L ) = ( Seg ( len G(( T . t )) ) ) & (for k being Nat holds (k in ( Seg ( len G(( T . t )) ) ) implies P[ k,( L . k ) ])))) from FINSEQ_1:sch 1(A39);
then consider L being FinSequence such that A41: ( dom L ) = ( Seg ( len G(( T . t )) ) ) and A42: (for k being Nat holds (k in ( Seg ( len G(( T . t )) ) ) implies P[ k,( L . k ) ]));
A43: (for k holds ((1 <= ( k + 1 ) & ( k + 1 ) <= ( len G(( T . t )) )) implies ( L . ( k + 1 ) ) = ( t ^ <* k *> )))
proof
let k;
assume (1 <= ( k + 1 ) & ( k + 1 ) <= ( len G(( T . t )) ));
then ( k + 1 ) in ( Seg ( len G(( T . t )) ) ) by FINSEQ_1:1;
then (ex m st (( m + 1 ) = ( k + 1 ) & ( L . ( k + 1 ) ) = ( t ^ <* m *> ))) by A42;
hence thesis;
end;
A44: ( succ t ) = { ( t ^ <* k *> ): k in F(( T . t )) } by A38;
( succ t ) c= ( rng L )
proof
let x;
assume x in ( succ t );
then consider k such that A45: x = ( t ^ <* k *> ) and A46: k in F(( T . t )) by A44;
A47: ( k + 1 ) in ( Seg ( len G(( T . t )) ) ) by A4,A46;
then (1 <= ( k + 1 ) & ( k + 1 ) <= ( len G(( T . t )) )) by FINSEQ_1:1;
then ( L . ( k + 1 ) ) = ( t ^ <* k *> ) by A43;
hence thesis by A41,A45,A47,FUNCT_1:def 3;
end;
hence thesis;
end;
then ( dom T ) is  finite-branching by CKB16:def 1;
then reconsider T as  finite-branching (DecoratedTree of D()) by CKB19:def 1;
A48: (for n holds (for x holds ((x in D() & n in F(x)) implies ( S . (x,n) ) = ( G(x) . ( n + 1 ) ))))
proof
let n;
let x;
assume that
A49: x in D()
and
A50: n in F(x);
(( [ x,n ] `1 ) = x & ( [ x,n ] `2 ) = n) by MCART_1:def 1,MCART_1:def 2;
then [ x,n ] in [: D(),( NAT ) :] by A49,MCART_1:11;
then consider c being (Element of [: D(),( NAT ) :]) such that A51: c = [ x,n ];
consider x9 being set,n9 being (Element of ( NAT )) such that x9 in D() and A52: c = [ x9,n9 ] and A53: ((n9 in F(x9) & ( S . c ) = ( G(x9) . ( n9 + 1 ) )) or ((not n9 in F(x9)) & ( S . c ) = d())) by A25;
x9 = x by A51,A52,ZFMISC_1:27;
hence thesis by A50,A51,A52,A53,ZFMISC_1:27;
end;
now
let t being (Element of ( dom T ));
let w being (Element of D());
assume that
A54: w = ( T . t );
( succ t ) = { ( t ^ <* k *> ): k in F(w) } by A38,A54;
then A55: ( succ t ) = { ( t ^ <* k *> ): ( k + 1 ) in ( Seg ( len G(w) ) ) } by A14;
A56: ( dom G(w) ) = ( Seg ( len G(w) ) ) by FINSEQ_1:def 3;
A57: ( dom ( t succ ) ) = ( Seg ( len ( t succ ) ) ) by FINSEQ_1:def 3;
A58: ( dom ( t succ ) ) c= ( dom G(w) )
proof
let n9 being set;
A59: ( Seg ( len ( t succ ) ) ) = { k: (1 <= k & k <= ( len ( t succ ) )) } by FINSEQ_1:def 1;
assume n9 in ( dom ( t succ ) );
then consider m such that A60: n9 = m and A61: 1 <= m and A62: m <= ( len ( t succ ) ) by A57,A59;
( 0 ) <> m by A61;
then consider n being Nat such that A63: m = ( n + 1 ) by NAT_1:6;
reconsider n as (Element of ( NAT )) by ORDINAL1:def 12;
( n + 1 ) in ( dom ( t succ ) ) by A57,A59,A61,A62,A63;
then ( t ^ <* n *> ) in ( dom T ) by CKB79:1;
then ( t ^ <* n *> ) in ( succ t );
then consider k such that A64: ( t ^ <* k *> ) = ( t ^ <* n *> ) and A65: ( k + 1 ) in ( Seg ( len G(w) ) ) by A55;
<* k *> = <* n *> by A64,FINSEQ_1:33;
hence thesis by A56,A60,A63,A65,TREES_1:5;
end;
( dom G(w) ) c= ( dom ( t succ ) )
proof
let n9 being set;
A66: ( Seg ( len G(w) ) ) = { k: (1 <= k & k <= ( len G(w) )) } by FINSEQ_1:def 1;
assume n9 in ( dom G(w) );
then consider m such that A67: n9 = m and A68: 1 <= m and A69: m <= ( len G(w) ) by A56,A66;
( 0 ) <> m by A68;
then consider n being Nat such that A70: m = ( n + 1 ) by NAT_1:6;
reconsider n as (Element of ( NAT )) by ORDINAL1:def 12;
( n + 1 ) in ( Seg ( len G(w) ) ) by A66,A68,A69,A70;
then ( t ^ <* n *> ) in ( succ t ) by A55;
hence thesis by A67,A70,CKB79:1;
end;
then A71: ( dom G(w) ) = ( dom ( t succ ) ) by A58,XBOOLE_0:def 10;
then A72: ( dom ( succ (T,t) ) ) = ( dom G(w) ) by CKB78:1;
(for m being Nat holds (m in ( dom ( succ (T,t) ) ) implies ( ( succ (T,t) ) . m ) = ( G(w) . m )))
proof
let m being Nat;
A73: ( Seg ( len G(w) ) ) = { k: (1 <= k & k <= ( len G(w) )) } by FINSEQ_1:def 1;
assume A74: m in ( dom ( succ (T,t) ) );
then A75: m in ( Seg ( len G(w) ) ) by A72,FINSEQ_1:def 3;
then ( len G(w) ) <> ( 0 );
then consider l such that A76: ( l + 1 ) = ( len G(( T . t )) ) and A77: ( F . ( T . t ) ) = ( { ( 0 ) } \/ ( Seg l ) ) by A3,A54;
consider k such that A78: m = k and A79: 1 <= k and A80: k <= ( len G(w) ) by A75,A73;
( 0 ) <> k by A79;
then consider n being Nat such that A81: m = ( n + 1 ) by A78,NAT_1:6;
reconsider n as (Element of ( NAT )) by ORDINAL1:def 12;
A82: n <= l by A54,A78,A80,A81,A76,XREAL_1:6;
A83: n in ( { ( 0 ) } \/ ( Seg l ) )
proof
per cases ;
suppose n = ( 0 );

then n in { ( 0 ) } by TARSKI:def 1;
hence thesis by XBOOLE_0:def 3;
end;
suppose n <> ( 0 );

then ( 0 ) < n by NAT_1:3;
then ( ( 0 ) + 1 ) <= n by NAT_1:13;
then n in ( Seg l ) by A82,FINSEQ_1:1;
hence thesis by XBOOLE_0:def 3;
end;
end;
( n + 1 ) in ( dom ( t succ ) ) by A74,A81,CKB78:1;
then ( t ^ <* n *> ) in ( dom T ) by CKB79:1;
then ( ( succ (T,t) ) . ( n + 1 ) ) = ( T . ( t ^ <* n *> ) ) by CKB80:1
.= ( S . (( T . t ),n) ) by A38,A77,A83
.= ( G(w) . ( n + 1 ) ) by A48,A54,A77,A83;
hence thesis by A81;
end;
hence ( succ (T,t) ) = G(w) by A71,CKB78:1,FINSEQ_1:13;
end;
hence thesis by A38;
end;
