environ
vocabularies NAT_1,XBOOLE_0,SUBSET_1,FINSEQ_2,TARSKI,UNIALG_1,FUNCT_2,PARTFUN1,RELAT_1,FINSEQ_1,FUNCOP_1,STRUCT_0,CQC_SIM1,FUNCT_1,NUMBERS,CARD_1,ZFMISC_1,SETFAM_1,EQREL_1,BINOP_1,LATTICES,UNIALG_2;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,NAT_1,STRUCT_0,RELAT_1,FUNCT_1,FINSEQ_1,SETFAM_1,FUNCOP_1,PARTFUN1,FINSEQ_2,LATTICES,BINOP_1,UNIALG_1,MARGREL1,CKB1,CKB2,CKB3,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB15,CKB26,CKB27,CKB28,CKB29;
definitions TARSKI,UNIALG_1,XBOOLE_0,SUBSET_1,FUNCOP_1,MARGREL1,CKB3,CKB7,CKB9,CKB10,CKB11,CKB12,CKB15,CKB26,CKB27,CKB28,CKB29;
theorems TARSKI,FUNCT_1,PARTFUN1,FINSEQ_1,FINSEQ_2,UNIALG_1,ZFMISC_1,SETFAM_1,FUNCOP_1,BINOP_1,LATTICES,FINSEQ_3,RELAT_1,RELSET_1,XBOOLE_0,XBOOLE_1,MARGREL1,CKB3,CKB4,CKB5,CKB6,CKB7,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB32,CKB33,CKB34;
schemes FINSEQ_1,BINOP_1,XBOOLE_0;
registrations XBOOLE_0,SUBSET_1,RELSET_1,PARTFUN1,FINSEQ_2,STRUCT_0,LATTICES,UNIALG_1,ORDINAL1,FINSEQ_1,CARD_1,MARGREL1,CKB16,CKB30,CKB31;
constructors SETFAM_1,BINOP_1,DOMAIN_1,FUNCOP_1,LATTICES,UNIALG_1,MARGREL1,FINSEQ_2,RELSET_1,CKB3,CKB7,CKB9,CKB10,CKB11,CKB12,CKB15,CKB26,CKB27,CKB28,CKB29;
requirements BOOLE,SUBSET;
begin
reserve U0 for Universal_Algebra;
reserve U1 for Universal_Algebra;
reserve n for Nat;
reserve x for set;
reserve y for set;
reserve A for non  empty (Subset of U0);
reserve o for (operation of U0);
definition
let U0 being Universal_Algebra;
let A being (Subset of U0);
assume A1: (( Constants U0 ) <> ( {} ) or A <> ( {} ));
func GenUnivAlg A ->  strict (SubAlgebra of U0) means 
:Def13: (A c= (the carrier of it) & (for U1 being (SubAlgebra of U0) holds (A c= (the carrier of U1) implies it is (SubAlgebra of U1))));
existence
proof
defpred P[ set ]
 means
((A c= $1 & ( Constants U0 ) c= $1) & (for B being non  empty (Subset of U0) holds (B = $1 implies B is  opers_closed)));
set C = ( bool (the carrier of U0) );
consider X being set such that A2: (for x holds (x in X iff (x in C & P[ x ]))) from XBOOLE_0:sch 1;
set P = ( meet X );
((the carrier of U0) in C & (for B being non  empty (Subset of U0) holds (B = (the carrier of U0) implies B is  opers_closed))) by CKB13:1,ZFMISC_1:def 1;
then A3: (the carrier of U0) in X by A2;
A4: P c= (the carrier of U0)
proof
let t being set;
assume t in P;
hence thesis by A3,SETFAM_1:def 1;
end;
now
let x being set;
assume x in X;
then (A c= x & ( Constants U0 ) c= x) by A2;
hence ( A \/ ( Constants U0 ) ) c= x by XBOOLE_1:8;
end;
then A5: ( A \/ ( Constants U0 ) ) c= P by A3,SETFAM_1:5;
then reconsider P as non  empty (Subset of U0) by A1,A4;
take E = ( UniAlgSetClosed P );
A6: P is  opers_closed
proof
let o being (operation of U0);
let s being (FinSequence of P);
assume A7: ( len s ) = ( arity o );
now
let a being set;
A8: ( rng s ) c= P by FINSEQ_1:def 4;
assume A9: a in X;
then reconsider a0 = a as (Subset of U0) by A2;
(A c= a0 & ( Constants U0 ) c= a0) by A2,A9;
then reconsider a0 as non  empty (Subset of U0) by A1;
P c= a0 by A9,SETFAM_1:3;
then ( rng s ) c= a0 by A8,XBOOLE_1:1;
then reconsider s0 = s as (FinSequence of a0) by FINSEQ_1:def 4;
a0 is  opers_closed by A2,A9;
then a0 is_closed_on o by CKB10:def 1;
then ( o . s0 ) in a0 by A7,CKB9:def 1;
hence ( o . s ) in a;
end;
hence thesis by A3,SETFAM_1:def 1;
end;
then A10: E = UAStr (# P,( Opers (U0,P) ) #) by CKB26:def 1;
A c= ( A \/ ( Constants U0 ) ) by XBOOLE_1:7;
hence A c= (the carrier of E) by A5,A10,XBOOLE_1:1;
let U1 being (SubAlgebra of U0);
assume A11: A c= (the carrier of U1);
set u1 = (the carrier of U1);
A12: ( Constants U0 ) c= u1
proof
reconsider B = u1 as non  empty (Subset of U0) by CKB15:def 1;
let x being set;
assume x in ( Constants U0 );
then consider a being (Element of U0) such that A13: a = x and A14: (ex o being (operation of U0) st (( arity o ) = ( 0 ) & a in ( rng o )));
consider o0 being (operation of U0) such that A15: ( arity o0 ) = ( 0 ) and A16: a in ( rng o0 ) by A14;
consider y being set such that A17: y in ( dom o0 ) and A18: a = ( o0 . y ) by A16,FUNCT_1:def 3;
( dom o0 ) = ( ( 0 ) -tuples_on (the carrier of U0) ) by A15,MARGREL1:22
.= { ( <*> (the carrier of U0) ) } by FINSEQ_2:94;
then y in { ( <*> B ) } by A17;
then y in ( ( 0 ) -tuples_on B ) by FINSEQ_2:94;
then y in ( ( dom o0 ) /\ ( ( arity o0 ) -tuples_on B ) ) by A15,A17,XBOOLE_0:def 4;
then A19: y in ( dom ( o0 | ( ( arity o0 ) -tuples_on B ) ) ) by RELAT_1:61;
consider n being Nat such that A20: n in ( dom (the charact of U0) ) and A21: ( (the charact of U0) . n ) = o0 by FINSEQ_2:10;
A22: n in ( dom (the charact of U1) ) by A20,CKB18:1;
then reconsider o1 = ( (the charact of U1) . n ) as (operation of U1) by FUNCT_1:def 3;
(the charact of U1) = ( Opers (U0,B) ) by CKB15:def 1;
then A23: o1 = ( o0 /. B ) by A21,A22,CKB12:def 1;
B is  opers_closed by CKB15:def 1;
then A24: B is_closed_on o0 by CKB10:def 1;
then y in ( dom ( o0 /. B ) ) by A19,CKB11:def 1;
then A25: ( o1 . y ) in ( rng o1 ) by A23,FUNCT_1:def 3;
A26: ( rng o1 ) c= (the carrier of U1) by RELAT_1:def 19;
( o1 . y ) = ( ( o0 | ( ( arity o0 ) -tuples_on B ) ) . y ) by A23,A24,CKB11:def 1
.= a by A18,A19,FUNCT_1:47;
hence thesis by A13,A25,A26;
end;
(u1 is (Subset of U0) & (for B being non  empty (Subset of U0) holds (B = u1 implies B is  opers_closed))) by CKB15:def 1;
then A27: u1 in X by A2,A11,A12;
hence (the carrier of E) is (Subset of U1) by A10,SETFAM_1:3;
let B being non  empty (Subset of U1);
assume A28: B = (the carrier of E);
reconsider u11 = u1 as non  empty (Subset of U0) by CKB15:def 1;
A29: (the charact of U1) = ( Opers (U0,u11) ) by CKB15:def 1;
A30: ( dom (the charact of U0) ) = ( dom ( Opers (U0,u11) ) ) by CKB12:def 1;
A31: u11 is  opers_closed by CKB15:def 1;
A32:now
let o1 being (operation of U1);
consider n being Nat such that A33: n in ( dom (the charact of U1) ) and A34: o1 = ( (the charact of U1) . n ) by FINSEQ_2:10;
reconsider o0 = ( (the charact of U0) . n ) as (operation of U0) by A29,A30,A33,FUNCT_1:def 3;
A35: ( arity o0 ) = ( arity o1 ) by A33,A34,CKB17:1;
A36: u11 is_closed_on o0 by A31,CKB10:def 1;
now
let s being (FinSequence of B);
A37: P is_closed_on o0 by A6,CKB10:def 1;
reconsider sE = s as (Element of ( P * )) by A10,A28,FINSEQ_1:def 11;
s is (FinSequence of u11) by FINSEQ_2:24;
then reconsider s1 = s as (Element of ( u11 * )) by FINSEQ_1:def 11;
A38: ( dom ( o0 | ( ( arity o0 ) -tuples_on u11 ) ) ) = ( ( dom o0 ) /\ ( ( arity o0 ) -tuples_on u11 ) ) by RELAT_1:61
.= ( ( ( arity o0 ) -tuples_on (the carrier of U0) ) /\ ( ( arity o0 ) -tuples_on u11 ) ) by MARGREL1:22
.= ( ( arity o0 ) -tuples_on u11 ) by MARGREL1:21;
assume A39: ( len s ) = ( arity o1 );
then s1 in { q where q is (Element of ( u11 * )): ( len q ) = ( arity o0 ) } by A35;
then A40: s1 in ( dom ( o0 | ( ( arity o0 ) -tuples_on u11 ) ) ) by A38,FINSEQ_2:def 4;
( o1 . s ) = ( ( o0 /. u11 ) . s1 ) by A29,A33,A34,CKB12:def 1
.= ( ( o0 | ( ( arity o0 ) -tuples_on u11 ) ) . s1 ) by A36,CKB11:def 1
.= ( o0 . sE ) by A40,FUNCT_1:47;
hence ( o1 . s ) in B by A10,A28,A35,A39,A37,CKB9:def 1;
end;
hence B is_closed_on o1 by CKB9:def 1;
end;
A41: ( dom ( Opers (U1,B) ) ) = ( dom (the charact of U1) ) by CKB12:def 1;
A42: ( dom (the charact of U0) ) = ( dom ( Opers (U0,P) ) ) by CKB12:def 1;
A43: P c= u1 by A27,SETFAM_1:3;
now
let n being Nat;
assume A44: n in ( dom (the charact of U0) );
then reconsider o0 = ( (the charact of U0) . n ) as (operation of U0) by FUNCT_1:def 3;
reconsider o1 = ( (the charact of U1) . n ) as (operation of U1) by A29,A30,A44,FUNCT_1:def 3;
A45: u11 is_closed_on o0 by A31,CKB10:def 1;
A46: P is_closed_on o0 by A6,CKB10:def 1;
thus ( (the charact of E) . n ) = ( o0 /. P ) by A10,A42,A44,CKB12:def 1
.= ( o0 | ( ( arity o0 ) -tuples_on P ) ) by A46,CKB11:def 1
.= ( o0 | ( ( ( arity o0 ) -tuples_on u11 ) /\ ( ( arity o0 ) -tuples_on P ) ) ) by A43,MARGREL1:21
.= ( ( o0 | ( ( arity o0 ) -tuples_on u11 ) ) | ( ( arity o0 ) -tuples_on P ) ) by RELAT_1:71
.= ( ( o0 /. u11 ) | ( ( arity o0 ) -tuples_on P ) ) by A45,CKB11:def 1
.= ( o1 | ( ( arity o0 ) -tuples_on P ) ) by A29,A30,A44,CKB12:def 1
.= ( o1 | ( ( arity o1 ) -tuples_on B ) ) by A10,A28,A29,A30,A44,CKB17:1
.= ( o1 /. B ) by A32,CKB11:def 1
.= ( ( Opers (U1,B) ) . n ) by A29,A30,A41,A44,CKB12:def 1;
end;
hence thesis by A10,A29,A42,A30,A32,A41,CKB10:def 1,FINSEQ_1:13;
end;
uniqueness
proof
let W1 being  strict (SubAlgebra of U0);
let W2 being  strict (SubAlgebra of U0);
assume (((A c= (the carrier of W1) & (for U1 being (SubAlgebra of U0) holds (A c= (the carrier of U1) implies W1 is (SubAlgebra of U1)))) & A c= (the carrier of W2)) & (for U2 being (SubAlgebra of U0) holds (A c= (the carrier of U2) implies W2 is (SubAlgebra of U2))));
then (W1 is  strict  strict (SubAlgebra of W2) & W2 is  strict  strict (SubAlgebra of W1));
hence thesis by CKB21:1;
end;
end;
