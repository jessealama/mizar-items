environ
vocabularies NUMBERS,XREAL_0,ORDINAL1,INTEGRA1,SUBSET_1,PARTFUN1,XXREAL_0,ARYTM_3,XXREAL_1,ARYTM_1,TARSKI,RELAT_1,FUNCT_3,XBOOLE_0,FUNCT_1,MEASURE7,INTEGRA5,ORDINAL2,COMPLEX1,CARD_1,REALSET1,XXREAL_2,REAL_1,VALUED_1,FINSEQ_1,NAT_1,INTEGRA2,SEQ_2,INTEGRA4,INT_1,RFINSEQ,ORDINAL4,CARD_3,FCONT_1,FDIFF_1,RSSPACE,SEQ_1,FUNCT_2,FUNCOP_1,RCOMP_1,VALUED_0,SEQ_4,MEASURE5;
notations TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,ORDINAL1,NUMBERS,XCMPLX_0,XREAL_0,COMPLEX1,REAL_1,NAT_1,INT_1,FUNCT_1,PARTFUN1,FUNCT_2,FUNCOP_1,RCOMP_1,FINSEQ_1,VALUED_0,VALUED_1,SEQ_1,RFUNCT_1,SEQ_2,FDIFF_1,RFINSEQ,XXREAL_2,MEASURE6,RVSUM_1,MEASURE5,INTEGRA1,INTEGRA2,FCONT_1,RSSPACE,INTEGRA3,INTEGRA4,INTEGRA5,XXREAL_0,SEQ_4;
definitions TARSKI,XCMPLX_0,INTEGRA1,FINSEQ_1,INTEGRA5,INTEGRA3;
theorems ORDINAL1,PARTFUN1,INTEGRA1,RFUNCT_1,FUNCT_1,FINSEQ_1,RVSUM_1,SEQ_1,SEQ_2,FDIFF_1,ABSVALUE,NAT_1,INT_1,COMPLEX1,TARSKI,INTEGRA2,INTEGRA3,RFINSEQ,INTEGRA4,FINSEQ_2,FINSEQ_3,RCOMP_1,FCONT_1,XREAL_0,XXREAL_0,FUNCT_2,FINSEQ_5,XBOOLE_0,XBOOLE_1,XCMPLX_1,XREAL_1,INTEGRA5,RSSPACE,RELAT_1,VALUED_1,XXREAL_2,XXREAL_1,SEQM_3,FUNCOP_1,RELSET_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39;
schemes FUNCT_2,PARTFUN1,FINSEQ_2;
registrations XBOOLE_0,RELAT_1,ORDINAL1,FUNCT_2,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,FINSEQ_1,RCOMP_1,FDIFF_1,SEQM_3,INTEGRA1,VALUED_0,VALUED_1,FINSET_1,XXREAL_2,CARD_1,RELSET_1,MEASURE5;
constructors PARTFUN1,REAL_1,NAT_1,BINOP_2,COMPLEX1,RFUNCT_1,RFUNCT_2,FCONT_1,FDIFF_1,RFINSEQ,RSSPACE,MEASURE6,INTEGRA2,INTEGRA4,INTEGRA5,SEQ_1,XXREAL_2,RVSUM_1,SEQ_4,RELSET_1,FUNCOP_1,SEQ_2,INTEGRA3;
requirements NUMERALS,BOOLE,SUBSET,REAL,ARITHM;
begin
reserve a for  real number;
reserve b for  real number;
reserve x for  real number;
reserve f for (PartFunc of ( REAL ),( REAL ));
theorem
Th28: (for x0 being  real number holds (for F being (PartFunc of ( REAL ),( REAL )) holds ((((((((a <= b & f is_integrable_on [' a,b ']) & ( f | [' a,b '] ) is  bounded) & [' a,b '] c= ( dom f )) & ]. a,b .[ c= ( dom F )) & (for x being  real number holds (x in ]. a,b .[ implies ( F . x ) = ( integral (f,a,x) )))) & x0 in ]. a,b .[) & f is_continuous_in x0) implies (F is_differentiable_in x0 & ( diff (F,x0) ) = ( f . x0 )))))
proof
deffunc F2(set) = ( 0 );
let x0 being  real number;
let F being (PartFunc of ( REAL ),( REAL ));
assume that
A1: a <= b
and
A2: f is_integrable_on [' a,b ']
and
A3: ( f | [' a,b '] ) is  bounded
and
A4: [' a,b '] c= ( dom f )
and
A5: ]. a,b .[ c= ( dom F )
and
A6: (for x being  real number holds (x in ]. a,b .[ implies ( F . x ) = ( integral (f,a,x) )))
and
A7: x0 in ]. a,b .[
and
A8: f is_continuous_in x0;
defpred C1[ set ]
 means
( x0 + ( R_id $1 ) ) in ]. a,b .[;
deffunc F0((Element of ( REAL ))) = ( ( f . x0 ) * $1 );
consider L being (Function of ( REAL ),( REAL )) such that A9: (for h being Real holds ( L . h ) = F0(h)) from FUNCT_2:sch 4;
reconsider L as (PartFunc of ( REAL ),( REAL ));
deffunc F1(set) = ( ( ( F . ( x0 + ( R_id $1 ) ) ) - ( F . x0 ) ) - ( L . ( R_id $1 ) ) );
reconsider L as LINEAR by A9,FDIFF_1:def 3;
consider R being Function such that A10: (( dom R ) = ( REAL ) & (for x being set holds (x in ( REAL ) implies ((C1[ x ] implies ( R . x ) = F1(x)) & ((not C1[ x ]) implies ( R . x ) = F2(x)))))) from PARTFUN1:sch 1;
( rng R ) c= ( REAL )
proof
let y being set;
assume y in ( rng R );
then consider x being set such that A11: x in ( dom R ) and A12: y = ( R . x ) by FUNCT_1:def 3;
A13: ((not C1[ x ]) implies ( R . x ) = F2(x)) by A10,A11;
(C1[ x ] implies ( R . x ) = F1(x)) by A10,A11;
hence thesis by A12,A13;
end;
then reconsider R as (PartFunc of ( REAL ),( REAL )) by A10,RELSET_1:4;
A14: R is  total by A10,PARTFUN1:def 2;
A15: [' a,b '] = [. a,b .] by A1,INTEGRA5:def 3;
A16: (for h being  convergent_to_0 Real_Sequence holds (( ( h " ) (#) ( R /* h ) ) is  convergent & ( lim ( ( h " ) (#) ( R /* h ) ) ) = ( 0 )))
proof
let h being  convergent_to_0 Real_Sequence;
A17: (for e being  real number holds (( 0 ) < e implies (ex n being (Element of ( NAT )) st (for m being (Element of ( NAT )) holds (n <= m implies ( abs ( ( ( ( h " ) (#) ( R /* h ) ) . m ) - ( 0 ) ) ) < e)))))
proof
set g = ( ( REAL ) --> ( f . x0 ) );
let e0 being  real number;
set e = ( e0 / 2 );
A18: (h is  convergent & ( lim h ) = ( 0 )) by FDIFF_1:def 1;
assume A19: ( 0 ) < e0;
then ( 0 ) < e by XREAL_1:215;
then consider p being  real number such that A20: ( 0 ) < p and A21: (for t being  real number holds ((t in ( dom f ) & ( abs ( t - x0 ) ) < p) implies ( abs ( ( f . t ) - ( f . x0 ) ) ) < e)) by A8,FCONT_1:3;
A22: ( 0 ) < ( p / 2 ) by A20,XREAL_1:215;
A23: ( p / 2 ) < p by A20,XREAL_1:216;
consider N being (Neighbourhood of x0) such that A24: N c= ]. a,b .[ by A7,RCOMP_1:18;
consider q being  real number such that A25: ( 0 ) < q and A26: N = ]. ( x0 - q ),( x0 + q ) .[ by RCOMP_1:def 6;
A27: ( q / 2 ) < q by A25,XREAL_1:216;
set r = ( min (( p / 2 ),( q / 2 )) );
( 0 ) < ( q / 2 ) by A25,XREAL_1:215;
then ( 0 ) < r by A22,XXREAL_0:15;
then consider n being (Element of ( NAT )) such that A28: (for m being (Element of ( NAT )) holds (n <= m implies ( abs ( ( h . m ) - ( 0 ) ) ) < r)) by A18,SEQ_2:def 7;
take n;
let m being (Element of ( NAT ));
r <= ( q / 2 ) by XXREAL_0:17;
then A29: ]. ( x0 - r ),( x0 + r ) .[ c= ]. ( x0 - q ),( x0 + q ) .[ by A27,CKB2:1,XXREAL_0:2;
assume n <= m;
then A30: ( abs ( ( h . m ) - ( 0 ) ) ) < r by A28;
then ( abs ( ( x0 + ( h . m ) ) - x0 ) ) < r;
then ( x0 + ( h . m ) ) in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:1;
then A31: ( x0 + ( h . m ) ) in ]. ( x0 - q ),( x0 + q ) .[ by A29;
then A32: ( x0 + ( h . m ) ) in ]. a,b .[ by A24,A26;
then ( x0 + ( R_id ( h . m ) ) ) in ]. a,b .[ by RSSPACE:def 3;
then ( R . ( h . m ) ) = ( ( ( F . ( x0 + ( R_id ( h . m ) ) ) ) - ( F . x0 ) ) - ( L . ( R_id ( h . m ) ) ) ) by A10;
then ( R . ( h . m ) ) = ( ( ( F . ( x0 + ( h . m ) ) ) - ( F . x0 ) ) - ( L . ( R_id ( h . m ) ) ) ) by RSSPACE:def 3;
then ( R . ( h . m ) ) = ( ( ( F . ( x0 + ( h . m ) ) ) - ( F . x0 ) ) - ( L . ( h . m ) ) ) by RSSPACE:def 3;
then A33: ( R . ( h . m ) ) = ( ( ( F . ( x0 + ( h . m ) ) ) - ( F . x0 ) ) - ( ( f . x0 ) * ( h . m ) ) ) by A9;
( F . ( x0 + ( h . m ) ) ) = ( integral (f,a,( x0 + ( h . m ) )) ) by A6,A24,A26,A31;
then A34: ( R . ( h . m ) ) = ( ( ( integral (f,a,( x0 + ( h . m ) )) ) - ( integral (f,a,x0) ) ) - ( ( f . x0 ) * ( h . m ) ) ) by A6,A7,A33;
A35: ( dom g ) = ( REAL ) by FUNCT_2:def 1;
then ( [' a,b '] /\ [' a,b '] ) c= ( ( dom f ) /\ ( dom g ) ) by A4,XBOOLE_1:27;
then A36: [' a,b '] c= ( dom ( f - g ) ) by VALUED_1:12;
A37: ]. a,b .[ c= [. a,b .] by XXREAL_1:25;
then A38: ( integral (f,a,( x0 + ( h . m ) )) ) = ( ( integral (f,a,x0) ) + ( integral (f,x0,( x0 + ( h . m ) )) ) ) by A1,A2,A3,A4,A7,A15,A32,CKB24:1;
A39: r <= ( p / 2 ) by XXREAL_0:17;
A40: (for x being  real number holds (x in [' ( min (x0,( x0 + ( h . m ) )) ),( max (x0,( x0 + ( h . m ) )) ) '] implies ( abs ( ( f - g ) . x ) ) <= e))
proof
let x being  real number;
reconsider x1 = x as Real by XREAL_0:def 1;
A41: (( min (x0,( x0 + ( h . m ) )) ) <= x0 & x0 <= ( max (x0,( x0 + ( h . m ) )) )) by XXREAL_0:17,XXREAL_0:25;
assume x in [' ( min (x0,( x0 + ( h . m ) )) ),( max (x0,( x0 + ( h . m ) )) ) '];
then A42: x in [. ( min (x0,( x0 + ( h . m ) )) ),( max (x0,( x0 + ( h . m ) )) ) .] by A41,INTEGRA5:def 3,XXREAL_0:2;
( abs ( x - x0 ) ) <= ( abs ( h . m ) )
proof
per cases ;
suppose x0 <= ( x0 + ( h . m ) );

then (x0 = ( min (x0,( x0 + ( h . m ) )) ) & ( x0 + ( h . m ) ) = ( max (x0,( x0 + ( h . m ) )) )) by XXREAL_0:def 9,XXREAL_0:def 10;
then x in { z where z is Real: (x0 <= z & z <= ( x0 + ( h . m ) )) } by A42,RCOMP_1:def 1;
then A43: (ex z being Real st ((x = z & x0 <= z) & z <= ( x0 + ( h . m ) )));
then ( 0 ) <= ( x - x0 ) by XREAL_1:48;
then A44: ( abs ( x - x0 ) ) = ( x - x0 ) by ABSVALUE:def 1;
A45: ( x - x0 ) <= ( ( x0 + ( h . m ) ) - x0 ) by A43,XREAL_1:9;
then ( 0 ) <= ( h . m ) by A43,XREAL_1:48;
hence thesis by A45,A44,ABSVALUE:def 1;
end;
suppose A46: (not x0 <= ( x0 + ( h . m ) ));

then (x0 = ( max (x0,( x0 + ( h . m ) )) ) & ( x0 + ( h . m ) ) = ( min (x0,( x0 + ( h . m ) )) )) by XXREAL_0:def 9,XXREAL_0:def 10;
then x in { z where z is Real: (( x0 + ( h . m ) ) <= z & z <= x0) } by A42,RCOMP_1:def 1;
then A47: (ex z being Real st ((x = z & ( x0 + ( h . m ) ) <= z) & z <= x0));
then A48: ( ( x0 + ( h . m ) ) - x0 ) <= ( x - x0 ) by XREAL_1:9;
per cases ;
suppose A49: ( x - x0 ) <> ( 0 );

( ( x0 + ( h . m ) ) - x0 ) < ( x0 - x0 ) by A46,XREAL_1:14;
then A50: ( abs ( h . m ) ) = ( - ( h . m ) ) by ABSVALUE:def 1;
( x - x0 ) < ( 0 ) by A47,A49,XREAL_1:47;
then ( abs ( x - x0 ) ) = ( - ( x - x0 ) ) by ABSVALUE:def 1;
hence thesis by A48,A50,XREAL_1:24;
end;
suppose ( x - x0 ) = ( 0 );

then ( abs ( x - x0 ) ) = ( 0 ) by ABSVALUE:def 1;
hence thesis by COMPLEX1:46;
end;
end;
end;
then A51: ( abs ( x - x0 ) ) < r by A30,XXREAL_0:2;
then x in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:1;
then x in ]. ( x0 - q ),( x0 + q ) .[ by A29;
then x in ]. a,b .[ by A24,A26;
then A52: x in [. a,b .] by A37;
( abs ( x - x0 ) ) < ( p / 2 ) by A39,A51,XXREAL_0:2;
then ( abs ( x - x0 ) ) < p by A23,XXREAL_0:2;
then ( abs ( ( f . x ) - ( f . x0 ) ) ) <= e by A4,A15,A21,A52;
then ( abs ( ( f . x1 ) - ( g . x1 ) ) ) <= e by FUNCOP_1:7;
hence thesis by A15,A36,A52,VALUED_1:13;
end;
A53: (for x being  real number holds (x in [' a,b '] implies ( g . x ) = ( f . x0 ))) by FUNCOP_1:7;
then A54: ( g | [' a,b '] ) is  bounded by A1,A35,CKB38:1;
then A55: ( ( f - g ) | ( [' a,b '] /\ [' a,b '] ) ) is  bounded by A3,RFUNCT_1:84;
( rng h ) c= ( dom R ) by A10;
then ( ( R . ( h . m ) ) / ( h . m ) ) = ( ( ( R /* h ) . m ) / ( h . m ) ) by FUNCT_2:108;
then ( ( R . ( h . m ) ) / ( h . m ) ) = ( ( ( R /* h ) . m ) * ( ( h " ) . m ) ) by VALUED_1:10;
then A56: ( ( R . ( h . m ) ) / ( h . m ) ) = ( ( ( h " ) (#) ( R /* h ) ) . m ) by SEQ_1:8;
h is  non-zero by FDIFF_1:def 1;
then ( h . m ) <> ( 0 ) by SEQ_1:4;
then A57: ( 0 ) < ( abs ( h . m ) ) by COMPLEX1:47;
A58: g is_integrable_on [' a,b '] by A1,A35,A53,CKB38:1;
then ( f - g ) is_integrable_on [' a,b '] by A2,A3,A4,A35,A54,CKB12:1;
then A59: ( abs ( integral (( f - g ),x0,( x0 + ( h . m ) )) ) ) <= ( e * ( abs ( ( x0 + ( h . m ) ) - x0 ) ) ) by A1,A7,A15,A37,A32,A55,A36,A40,CKB30:1;
( integral (g,x0,( x0 + ( h . m ) )) ) = ( ( f . x0 ) * ( ( x0 + ( h . m ) ) - x0 ) ) by A1,A7,A15,A37,A32,A35,A53,CKB39:1;
then ( R . ( h . m ) ) = ( integral (( f - g ),x0,( x0 + ( h . m ) )) ) by A1,A2,A3,A4,A7,A15,A37,A32,A34,A35,A58,A54,A38,CKB35:1;
then (( abs ( ( R . ( h . m ) ) / ( h . m ) ) ) = ( ( abs ( R . ( h . m ) ) ) / ( abs ( h . m ) ) ) & ( ( abs ( R . ( h . m ) ) ) / ( abs ( h . m ) ) ) <= ( ( e * ( abs ( h . m ) ) ) / ( abs ( h . m ) ) )) by A59,A57,COMPLEX1:67,XREAL_1:72;
then A60: ( abs ( ( R . ( h . m ) ) / ( h . m ) ) ) <= e by A57,XCMPLX_1:89;
e < e0 by A19,XREAL_1:216;
hence thesis by A60,A56,XXREAL_0:2;
end;
hence ( ( h " ) (#) ( R /* h ) ) is  convergent by SEQ_2:def 6;
hence thesis by A17,SEQ_2:def 7;
end;
consider N being (Neighbourhood of x0) such that A61: N c= ]. a,b .[ by A7,RCOMP_1:18;
reconsider R as REST by A14,A16,FDIFF_1:def 2;
A62: (for x being Real holds (x in N implies ( ( F . x ) - ( F . x0 ) ) = ( ( L . ( x - x0 ) ) + ( R . ( x - x0 ) ) )))
proof
let x being Real;
assume x in N;
then ( x0 + ( x - x0 ) ) in N;
then ( x0 + ( R_id ( x - x0 ) ) ) in N by RSSPACE:def 3;
then (( x0 + ( R_id ( x - x0 ) ) ) = ( x0 + ( x - x0 ) ) & ( R . ( x - x0 ) ) = F1(( x - x0 ))) by A10,A61,RSSPACE:def 3;
hence thesis;
end;
A63: N c= ( dom F ) by A5,A61,XBOOLE_1:1;
hence A64: F is_differentiable_in x0 by A62,FDIFF_1:def 4;
( L . 1 ) = ( ( f . x0 ) * 1 ) by A9;
hence thesis by A63,A62,A64,FDIFF_1:def 5;
end;
