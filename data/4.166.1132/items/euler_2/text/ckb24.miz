environ
vocabularies NUMBERS,NAT_1,INT_1,FINSEQ_1,ARYTM_3,XXREAL_0,CARD_1,SUBSET_1,ARYTM_1,INT_2,COMPLEX1,RELAT_1,TARSKI,FUNCT_1,CLASSES1,CARD_3,ORDINAL4,RFINSEQ,XBOOLE_0,NEWTON,EULER_1,FINSET_1;
notations TARSKI,XBOOLE_0,SUBSET_1,NUMBERS,XCMPLX_0,XXREAL_0,CARD_1,RELAT_1,FUNCT_1,RECDEF_1,INT_1,INT_2,FINSET_1,NAT_1,NAT_D,NEWTON,EULER_1,CLASSES1,RFINSEQ,RVSUM_1,FINSEQ_1,FINSEQ_3,TREES_4,WSIERP_1,CKB14,CKB16;
definitions TARSKI,FUNCT_1,XBOOLE_0,RELAT_1,CKB16;
theorems INT_2,FINSEQ_1,NAT_1,ABSVALUE,INT_1,FUNCT_1,EULER_1,PREPOWER,RFINSEQ,FINSEQ_2,RVSUM_1,FINSEQ_3,NEWTON,RELAT_1,XBOOLE_1,XCMPLX_1,XREAL_1,FINSEQ_5,XXREAL_0,ORDINAL1,NAT_D,CLASSES1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23;
schemes NAT_1,FINSEQ_1;
registrations FUNCT_1,ORDINAL1,RELSET_1,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,FINSEQ_1,SEQM_3,NEWTON,XBOOLE_0,VALUED_0,FINSET_1,CARD_1;
constructors REAL_1,SQUARE_1,NAT_1,NAT_D,NEWTON,RFINSEQ,WSIERP_1,EULER_1,SEQ_1,RECDEF_1,CLASSES1,BINOP_2,RELSET_1,CKB14,CKB16;
requirements REAL,NUMERALS,BOOLE,SUBSET,ARITHM;
begin
reserve a for Nat;
reserve m for Nat;
reserve x for Nat;
reserve n for Nat;
reserve xi for Nat;
reserve xj for Nat;
reserve t for Integer;
theorem
Th33: (((a <> ( 0 ) & m > 1) & a,m are_relative_prime ) implies ( ( a |^ ( Euler m ) ) mod m ) = 1)
proof
assume that
A1: a <> ( 0 )
and
A2: m > 1
and
A3: a,m are_relative_prime ;
set X = { k where k is (Element of ( NAT )): ((m,k are_relative_prime  & k >= 1) & k <= m) };
A4: ( a |^ ( Euler m ) ) <> ( 0 ) by A1,PREPOWER:5;
set Y = { l where l is (Element of ( NAT )): (ex u being (Element of ( NAT )) st (l = ( ( a * u ) mod m ) & u in X)) };
A5: (x in X implies ( ( a * x ) mod m ) in X)
proof
assume x in X;
then consider t being (Element of ( NAT )) such that A6: t = x and A7: m,t are_relative_prime  and A8: t >= 1 and t <= m;
A9: ( a * t ),m are_relative_prime  by A1,A2,A3,A7,EULER_1:14;
( ( a * t ) mod m ) <> ( 0 )
proof
assume ( ( a * t ) mod m ) = ( 0 );
then consider s being Nat such that A10: ( a * t ) = ( ( m * s ) + ( 0 ) ) and ( 0 ) < m by A2,NAT_D:def 2;
( s gcd 1 ) = 1 by NEWTON:51;
then ( ( m * s ) gcd ( m * 1 ) ) = m by EULER_1:5;
hence contradiction by A2,A9,A10,INT_2:def 3;
end;
then A11: ( ( a * t ) mod m ) >= 1 by NAT_1:14;
A12: ( ( a * t ) mod m ) <= m by A2,NAT_D:1;
m,( ( a * t ) mod m ) are_relative_prime  by A1,A2,A3,A7,A8,CKB7:1;
hence thesis by A6,A11,A12;
end;
A13: X = Y
proof
thus X c= Y
proof
let x being set;
assume x in X;
then consider xx being (Element of ( NAT )) such that A14: x = xx and A15: m,xx are_relative_prime  and xx >= 1 and A16: xx <= m;
consider i,j being Integer such that A17: ( ( i * a ) + ( j * m ) ) = xx by A3,EULER_1:10;
xx <> m by A2,A15,EULER_1:1;
then xx < m by A16,XXREAL_0:1;
then A18: ( xx mod m ) = xx by NAT_D:24;
reconsider im = ( i mod m ) as (Element of ( NAT )) by INT_1:3,NEWTON:64;
( i mod m ) <> ( 0 )
proof
assume ( i mod m ) = ( 0 );
then ( 0 ) = ( i - ( ( i div m ) * m ) ) by A2,INT_1:def 10;
then ( m gcd xx ) = ( ( m * 1 ) gcd ( m * ( ( ( i div m ) * a ) + j ) ) ) by A17
.= ( m * ( 1 gcd ( ( ( i div m ) * a ) + j ) ) ) by A2,EULER_1:15
.= ( m * 1 ) by CKB3:1
.= m;
hence contradiction by A2,A15,INT_2:def 3;
end;
then A19: im >= 1 by NAT_1:14;
A20: i = ( ( ( i div m ) * m ) + ( i mod m ) ) by A2,NEWTON:66;
then reconsider ij = ( ( ( i mod m ) * a ) + ( ( ( ( i div m ) * a ) + j ) * m ) ) as (Element of ( NAT )) by A17;
A21: im <= m by A2,NEWTON:65;
A22: ( ij mod m ) = ( ( im * a ) mod m ) by EULER_1:12;
then m,im are_relative_prime  by A2,A15,A18,A17,A20,CKB8:1;
then im in X by A19,A21;
hence thesis by A14,A18,A17,A20,A22;
end;

let y being set;
assume y in Y;
then (ex yy being (Element of ( NAT )) st (y = yy & (ex u being (Element of ( NAT )) st (yy = ( ( a * u ) mod m ) & u in X))));
hence thesis by A5;
end;
A23: (((xi in X & xj in X) & xi <> xj) implies ( ( a * xi ) mod m ) <> ( ( a * xj ) mod m ))
proof
assume that
A24: xi in X
and
A25: xj in X
and
A26: xi <> xj;
set tm = ( ( a * xi ) mod m );
set sm = ( ( a * xj ) mod m );
assume A27: ( ( a * xi ) mod m ) = ( ( a * xj ) mod m );
consider s being (Element of ( NAT )) such that A28: s = xj and m,s are_relative_prime  and A29: (s >= 1 & s <= m) by A25;
A30: sm = ( ( a * s ) - ( m * ( ( a * s ) div m ) ) ) by A2,A28,NEWTON:63;
consider t being (Element of ( NAT )) such that A31: t = xi and m,t are_relative_prime  and A32: (t >= 1 & t <= m) by A24;
tm = ( ( a * t ) - ( m * ( ( a * t ) div m ) ) ) by A2,A31,NEWTON:63;
then ( 0 ) = ( ( a * ( t - s ) ) - ( m * ( ( ( a * t ) div m ) - ( ( a * s ) div m ) ) ) ) by A27,A30;
then A33: m divides ( a * ( t - s ) ) by INT_1:def 3;
reconsider m,c = ( t - s ) as Integer;
(( 1 - m ) <= c & c <= ( m - 1 )) by A32,A29,XREAL_1:13;
then ( t - s ) = ( 0 ) by A3,A33,CKB6:1,INT_2:25;
hence contradiction by A26,A31,A28;
end;
reconsider FX = ( Sgm X ) as (FinSequence of ( NAT ));
reconsider FYY = ( a * FX ) as (FinSequence of ( NAT ));
reconsider FY = ( FYY mod m ) as (FinSequence of ( NAT ));
A34: X c= ( Seg m )
proof
let x being set;
assume x in X;
then (ex xx being (Element of ( NAT )) st (((x = xx & m,xx are_relative_prime ) & xx >= 1) & xx <= m));
hence thesis by FINSEQ_1:1;
end;
then reconsider X as  finite set;
( dom FYY ) = ( Seg ( len FYY ) ) by FINSEQ_1:def 3
.= ( Seg ( len FX ) ) by NEWTON:2;
then A35: ( dom FX ) = ( dom FYY ) by FINSEQ_1:def 3;
A36: ( dom FY ) = ( Seg ( len FY ) ) by FINSEQ_1:def 3
.= ( Seg ( len FYY ) ) by CKB16:def 1
.= ( Seg ( len FX ) ) by NEWTON:2;
then A37: ( dom FX ) = ( dom FY ) by FINSEQ_1:def 3;
A38: ( rng FY ) = Y
proof
thus ( rng FY ) c= Y
proof
let x being set;
assume x in ( rng FY );
then consider y being set such that A39: y in ( dom FY ) and A40: x = ( FY . y ) by FUNCT_1:def 3;
reconsider y as (Element of ( NAT )) by A39;
( FX . y ) in ( rng FX ) by A37,A39,FUNCT_1:def 3;
then A41: ( FX . y ) in X by A34,FINSEQ_1:def 13;
y in ( dom FX ) by A36,A39,FINSEQ_1:def 3;
then ( FY . y ) = ( ( FYY . y ) mod m ) by A35,CKB16:def 1
.= ( ( a * ( FX . y ) ) mod m ) by RVSUM_1:44;
hence thesis by A40,A41;
end;

let y being set;
assume y in Y;
then consider yy being (Element of ( NAT )) such that A42: y = yy and A43: (ex u being (Element of ( NAT )) st (yy = ( ( a * u ) mod m ) & u in X));
consider uu being (Element of ( NAT )) such that A44: yy = ( ( a * uu ) mod m ) and A45: uu in X by A43;
uu in ( rng FX ) by A34,A45,FINSEQ_1:def 13;
then consider xx being set such that A46: xx in ( dom FX ) and A47: uu = ( FX . xx ) by FUNCT_1:def 3;
reconsider xx as (Element of ( NAT )) by A46;
( FY . xx ) = ( ( FYY . xx ) mod m ) by A35,A46,CKB16:def 1
.= y by A42,A44,A47,RVSUM_1:44;
hence thesis by A37,A46,FUNCT_1:def 3;
end;
A48: FY is  one-to-one
proof
A49: FX is  one-to-one by A34,FINSEQ_3:92;
let x1 being set;
let x2 being set;
assume that
A50: x1 in ( dom FY )
and
A51: x2 in ( dom FY )
and
A52: ( FY . x1 ) = ( FY . x2 );
A53: x2 in ( dom FX ) by A36,A51,FINSEQ_1:def 3;
reconsider x2 as (Element of ( NAT )) by A51;
A54: x1 in ( dom FX ) by A36,A50,FINSEQ_1:def 3;
reconsider x1 as (Element of ( NAT )) by A50;
A55: (( FX . x1 ) in ( rng FX ) & ( FX . x2 ) in ( rng FX )) by A37,A50,A51,FUNCT_1:def 3;
A56: ( FY . x2 ) = ( ( FYY . x2 ) mod m ) by A35,A53,CKB16:def 1
.= ( ( a * ( FX . x2 ) ) mod m ) by RVSUM_1:44;
( FY . x1 ) = ( ( FYY . x1 ) mod m ) by A35,A54,CKB16:def 1
.= ( ( a * ( FX . x1 ) ) mod m ) by RVSUM_1:44;
then (not ((( FX . x1 ) in X & ( FX . x2 ) in X) & ( FX . x1 ) <> ( FX . x2 ))) by A23,A52,A56;
hence thesis by A34,A54,A53,A55,A49,FINSEQ_1:def 13,FUNCT_1:def 4;
end;
(for x being set holds ( card ( Coim (FX,x) ) ) = ( card ( Coim (FY,x) ) ))
proof
let x being set;
now
per cases ;
suppose A57: x in X;

A58: FX is  one-to-one by A34,FINSEQ_3:92;
x in ( rng FX ) by A34,A57,FINSEQ_1:def 13;
then A59: ( len ( FX - { x } ) ) = ( ( len FX ) - 1 ) by A58,FINSEQ_3:90;
A60: (( ( len ( FX - { x } ) ) - ( len ( FX - { x } ) ) ) = ( ( ( len FX ) - ( card ( FX " { x } ) ) ) - ( len ( FX - { x } ) ) ) & ( len ( FY - { x } ) ) = ( ( len FY ) - ( card ( FY " { x } ) ) )) by FINSEQ_3:59;
( len ( FY - { x } ) ) = ( ( len FY ) - 1 ) by A13,A38,A48,A57,FINSEQ_3:90;
hence thesis by A59,A60;
end;
suppose (not x in X);

then ((not x in ( rng FX )) & ( FY " { x } ) = ( {} )) by A13,A34,A38,FINSEQ_1:def 13,FUNCT_1:72;
hence thesis by FUNCT_1:72;
end;
end;
hence thesis;
end;
then A61: FX,FY are_fiberwise_equipotent  by CLASSES1:def 9;
then A62: ( len FX ) = ( len FY ) by RFINSEQ:3;
A63: ( ( Product FY ) mod m ) = ( ( ( a |^ ( len FY ) ) * ( Product FX ) ) mod m )
proof
defpred P[ Nat ]
 means
($1 <= ( len FY ) implies ( ( Product ( FY | $1 ) ) mod m ) = ( ( ( a |^ ( len ( FY | $1 ) ) ) * ( Product ( FX | $1 ) ) ) mod m ));
( FY | ( len FY ) ) = ( FY | ( Seg ( len FY ) ) ) by FINSEQ_1:def 15;
then A64: FY = ( FY | ( len FY ) ) by FINSEQ_2:20;
A65: (for n holds (P[ n ] implies P[ ( n + 1 ) ]))
proof
let n;
now
per cases ;
suppose A66: ( n + 1 ) <= ( len FY );

then ( len ( FX | ( n + 1 ) ) ) = ( n + 1 ) by A62,FINSEQ_1:59;
then A67: ( FX | ( n + 1 ) ) = ( ( ( FX | ( n + 1 ) ) | n ) ^ <* ( ( FX | ( n + 1 ) ) . ( n + 1 ) ) *> ) by RFINSEQ:7;
assume A68: P[ n ];
( ( 0 ) + 1 ) <= ( n + 1 ) by NAT_1:13;
then A69: ( n + 1 ) in ( dom FY ) by A66,FINSEQ_3:25;
A70: ( ( FY | ( n + 1 ) ) . ( n + 1 ) ) = ( FY . ( n + 1 ) ) by FINSEQ_3:112;
A71: ( ( FX | ( n + 1 ) ) . ( n + 1 ) ) = ( FX . ( n + 1 ) ) by FINSEQ_3:112;
A72: n <= ( n + 1 ) by NAT_1:11;
then A73: ( len ( FY | n ) ) = n by A66,FINSEQ_1:59,XXREAL_0:2;
A74: ( ( FX | ( n + 1 ) ) | n ) = ( FX | n ) by A72,FINSEQ_5:77;
A75: ( ( FY | ( n + 1 ) ) | n ) = ( FY | n ) by A72,FINSEQ_5:77;
A76: ( len ( FY | ( n + 1 ) ) ) = ( n + 1 ) by A66,FINSEQ_1:59;
then ( FY | ( n + 1 ) ) = ( ( ( FY | ( n + 1 ) ) | n ) ^ <* ( ( FY | ( n + 1 ) ) . ( n + 1 ) ) *> ) by RFINSEQ:7;
then ( ( Product ( FY | ( n + 1 ) ) ) mod m ) = ( ( ( Product ( FY | n ) ) * ( FY . ( n + 1 ) ) ) mod m ) by A75,A70,RVSUM_1:96
.= ( ( ( ( ( a |^ ( len ( FY | n ) ) ) * ( Product ( FX | n ) ) ) mod m ) * ( ( FY . ( n + 1 ) ) mod m ) ) mod m ) by A66,A68,A72,CKB13:1,XXREAL_0:2
.= ( ( ( ( ( a |^ ( len ( FY | n ) ) ) * ( Product ( FX | n ) ) ) mod m ) * ( ( ( FYY . ( n + 1 ) ) mod m ) mod m ) ) mod m ) by A37,A35,A69,CKB16:def 1
.= ( ( ( ( ( a |^ ( len ( FY | n ) ) ) * ( Product ( FX | n ) ) ) mod m ) * ( ( ( a * FX ) . ( n + 1 ) ) mod m ) ) mod m ) by CKB9:1
.= ( ( ( ( a |^ ( len ( FY | n ) ) ) * ( Product ( FX | n ) ) ) * ( ( a * FX ) . ( n + 1 ) ) ) mod m ) by CKB13:1
.= ( ( ( ( a |^ n ) * ( Product ( FX | n ) ) ) * ( a * ( FX . ( n + 1 ) ) ) ) mod m ) by A73,RVSUM_1:44
.= ( ( ( ( a |^ n ) * a ) * ( ( Product ( FX | n ) ) * ( FX . ( n + 1 ) ) ) ) mod m )
.= ( ( ( a |^ ( len ( FY | ( n + 1 ) ) ) ) * ( ( Product ( FX | n ) ) * ( FX . ( n + 1 ) ) ) ) mod m ) by A76,NEWTON:6
.= ( ( ( a |^ ( len ( FY | ( n + 1 ) ) ) ) * ( Product ( FX | ( n + 1 ) ) ) ) mod m ) by A67,A74,A71,RVSUM_1:96;
hence P[ ( n + 1 ) ];
end;
suppose ( n + 1 ) > ( len FY );

hence thesis;
end;
end;
hence thesis;
end;
( FX | ( len FX ) ) = ( FX | ( Seg ( len FX ) ) ) by FINSEQ_1:def 15;
then A77: FX = ( FX | ( len FY ) ) by A62,FINSEQ_2:20;
A78: P[ ( 0 ) ] by NEWTON:4,RVSUM_1:94;
(for n holds P[ n ]) from NAT_1:sch 2(A78,A65);
hence thesis by A64,A77;
end;
A79: ( Product FX ),m are_relative_prime 
proof
defpred P[ Nat ]
 means
($1 <= ( len FX ) implies ( Product ( FX | $1 ) ),m are_relative_prime );
A80: ( FX | ( len FX ) ) = FX by FINSEQ_1:58;
A81: (for n holds (P[ n ] implies P[ ( n + 1 ) ]))
proof
let n;
now
per cases ;
suppose A82: ( len FX ) >= ( n + 1 );

reconsider FF = ( FX | ( n + 1 ) ) as (FinSequence of ( NAT ));
reconsider ff = ( FF . ( n + 1 ) ) as (Element of ( NAT ));
( len FF ) = ( n + 1 ) by A82,FINSEQ_1:59;
then A83: FF = ( ( FF | n ) ^ <* ff *> ) by RFINSEQ:7;
reconsider a = ( Product ( FF | n ) ),b = ff,m9 = m as Integer;
A84: n <= ( n + 1 ) by NAT_1:11;
( ( 0 ) + 1 ) <= ( n + 1 ) by XREAL_1:6;
then (( ( FX | ( n + 1 ) ) . ( n + 1 ) ) = ( FX . ( n + 1 ) ) & ( n + 1 ) in ( dom FX )) by A82,FINSEQ_3:25,FINSEQ_3:112;
then A85: ( ( FX | ( n + 1 ) ) . ( n + 1 ) ) in ( rng FX ) by FUNCT_1:def 3;
( rng FX ) = X by A34,FINSEQ_1:def 13;
then A86: (ex p being (Element of ( NAT )) st (((ff = p & m,p are_relative_prime ) & p >= 1) & p <= m)) by A85;
assume P[ n ];
then a,m9 are_relative_prime  by A82,A84,FINSEQ_5:77,XXREAL_0:2;
then ( a * b ),m9 are_relative_prime  by A86,INT_2:26;
hence P[ ( n + 1 ) ] by A83,RVSUM_1:96;
end;
suppose ( len FX ) < ( n + 1 );

hence thesis;
end;
end;
hence thesis;
end;
( ( Product ( FX | ( 0 ) ) ) gcd m ) = 1 by NEWTON:51,RVSUM_1:94;
then A87: P[ ( 0 ) ] by INT_2:def 3;
(for n holds P[ n ]) from NAT_1:sch 2(A87,A81);
hence thesis by A80;
end;
( len FX ) = ( card X ) by A34,FINSEQ_3:39
.= ( Euler m ) by EULER_1:def 1;
then A88: ( len FY ) = ( Euler m ) by A61,RFINSEQ:3;
( ( Product FX ) mod m ) = ( ( Product FY ) mod m ) by A61,CKB15:1;
hence thesis by A2,A63,A88,A4,A79,CKB18:1;
end;
