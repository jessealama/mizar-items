environ
vocabularies NUMBERS,NAT_1,FUNCT_1,ZFMISC_1,FINSEQ_1,RELAT_1,CARD_3,ARYTM_3,SUBSET_1,XXREAL_0,TARSKI,XBOOLE_0,FINSEQ_2,ARYTM_1,PARTFUN1,BINOP_2,ORDINAL4,CARD_1,FUNCOP_1,PROB_1,MESFUNC2,FUNCT_3,SUPINF_2,PROB_2,MEASURE1,ORDINAL1,XXREAL_2,ORDINAL2,SUPINF_1,XREAL_0,MESFUNC1,VALUED_0,COMPLEX1,SETFAM_1,FINSET_1,FINSOP_1,SETWISEO,INTEGRA1,REAL_1,MESFUNC3;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,ORDINAL1,CARD_1,NUMBERS,XCMPLX_0,NAT_1,REAL_1,RELAT_1,FUNCT_1,RELSET_1,PARTFUN1,FUNCT_2,XREAL_0,SETWOP_2,FINSEQ_1,SETFAM_1,FUNCOP_1,FINSOP_1,FUNCT_3,FINSET_1,PROB_1,PROB_2,XXREAL_0,XXREAL_2,SUPINF_1,SUPINF_2,MEASURE1,FINSEQOP,FINSEQ_2,BINOP_1,SEQ_1,BINOP_2,RVSUM_1,EXTREAL1,MESFUNC1,MESFUNC2,CKB12;
definitions TARSKI,XBOOLE_0,BINOP_1,SUPINF_2,MESFUNC1,CKB12;
theorems MEASURE1,TARSKI,FUNCT_1,FUNCT_2,NAT_1,SUPINF_2,EXTREAL1,EXTREAL2,ZFMISC_1,FINSEQ_1,FINSEQ_2,FINSEQ_3,FUNCOP_1,FINSEQ_4,PROB_2,FUNCT_3,XBOOLE_0,XBOOLE_1,RELAT_1,RVSUM_1,BINOP_2,MESFUNC2,MEASURE2,FINSOP_1,CARD_2,XREAL_1,XXREAL_0,ORDINAL1,NUMBERS,VALUED_1,XXREAL_2,VALUED_0,XXREAL_3,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21;
schemes FINSEQ_1,FINSEQ_2,NAT_1,PARTFUN1,BINOP_1;
registrations SUBSET_1,RELAT_1,ORDINAL1,FUNCT_2,NUMBERS,XXREAL_0,XREAL_0,NAT_1,BINOP_2,MEMBERED,FINSEQ_1,MEASURE1,FINSET_1,VALUED_0,CARD_1,CARD_3,XXREAL_3,RELSET_1;
constructors PARTFUN1,BINOP_1,SETWISEO,REAL_1,NAT_1,FINSEQOP,PROB_2,FINSOP_1,RVSUM_1,MEASURE3,MEASURE6,EXTREAL1,MESFUNC1,BINARITH,MESFUNC2,SEQ_1,BINOP_2,SUPINF_1,RELSET_1,CKB12;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
definition
let X being non  empty set;
let S being (SigmaField of X);
let M being (sigma_Measure of S);
let f being (PartFunc of X,( ExtREAL ));
assume A1: (f is_simple_func_in S & (for x being set holds (x in ( dom f ) implies ( 0. ) <= ( f . x ))));
func integral (X,S,M,f) -> (Element of ( ExtREAL )) means 
(ex F being (Finite_Sep_Sequence of S) st (ex a,x being (FinSequence of ( ExtREAL )) st (((((F,a are_Re-presentation_of f & ( a . 1 ) = ( 0. )) & (for n being Nat holds ((2 <= n & n in ( dom a )) implies (( 0. ) < ( a . n ) & ( a . n ) < ( +infty ))))) & ( dom x ) = ( dom F )) & (for n being Nat holds (n in ( dom x ) implies ( x . n ) = ( ( a . n ) * ( ( M * F ) . n ) )))) & it = ( Sum x ))));
existence
proof
consider F being (Finite_Sep_Sequence of S),a being (FinSequence of ( ExtREAL )) such that A2: ((F,a are_Re-presentation_of f & ( a . 1 ) = ( 0. )) & (for n being Nat holds ((2 <= n & n in ( dom a )) implies (( 0. ) < ( a . n ) & ( a . n ) < ( +infty ))))) by A1,CKB18:1;
defpred P[ set ]
 means
$1 in ( dom F );
deffunc G(set) = ( ( a . $1 ) * ( ( M * F ) . $1 ) );
A3: (for x being set holds (P[ x ] implies G(x) in ( ExtREAL )));
consider p being (PartFunc of ( NAT ),( ExtREAL )) such that A4: ((for x being set holds (x in ( dom p ) iff (x in ( NAT ) & P[ x ]))) & (for x being set holds (x in ( dom p ) implies ( p . x ) = G(x)))) from PARTFUN1:sch 3(A3);
(for x being set holds (x in ( dom F ) implies x in ( dom p ))) by A4;
then A5: ( dom F ) c= ( dom p ) by TARSKI:def 3;
(for x being set holds (x in ( dom p ) implies x in ( dom F ))) by A4;
then ( dom p ) c= ( dom F ) by TARSKI:def 3;
then A6: ( dom p ) = ( dom F ) by A5,XBOOLE_0:def 10;
then ( dom p ) = ( Seg ( len F ) ) by FINSEQ_1:def 3;
then A7: p is FinSequence by FINSEQ_1:def 2;
( rng p ) c= ( ExtREAL );
then reconsider p as (FinSequence of ( ExtREAL )) by A7,FINSEQ_1:def 4;
take ( Sum p );
(for n being Nat holds (n in ( dom p ) implies ( p . n ) = ( ( a . n ) * ( ( M * F ) . n ) ))) by A4;
hence thesis by A2,A6;
end;
uniqueness
proof
let s1 being (Element of ( ExtREAL ));
let s2 being (Element of ( ExtREAL ));
assume that
A8: (ex F1 being (Finite_Sep_Sequence of S) st (ex a1,x1 being (FinSequence of ( ExtREAL )) st (((((F1,a1 are_Re-presentation_of f & ( a1 . 1 ) = ( 0. )) & (for n being Nat holds ((2 <= n & n in ( dom a1 )) implies (( 0. ) < ( a1 . n ) & ( a1 . n ) < ( +infty ))))) & ( dom x1 ) = ( dom F1 )) & (for n being Nat holds (n in ( dom x1 ) implies ( x1 . n ) = ( ( a1 . n ) * ( ( M * F1 ) . n ) )))) & s1 = ( Sum x1 ))))
and
A9: (ex F2 being (Finite_Sep_Sequence of S) st (ex a2 being (FinSequence of ( ExtREAL )) st (ex x2 being (FinSequence of ( ExtREAL )) st (((((F2,a2 are_Re-presentation_of f & ( a2 . 1 ) = ( 0. )) & (for n being Nat holds ((2 <= n & n in ( dom a2 )) implies (( 0. ) < ( a2 . n ) & ( a2 . n ) < ( +infty ))))) & ( dom x2 ) = ( dom F2 )) & (for n being Nat holds (n in ( dom x2 ) implies ( x2 . n ) = ( ( a2 . n ) * ( ( M * F2 ) . n ) )))) & s2 = ( Sum x2 )))));
thus s1 = s2
proof
consider F2 being (Finite_Sep_Sequence of S),a2 being (FinSequence of ( ExtREAL )),x2 being (FinSequence of ( ExtREAL )) such that A10: F2,a2 are_Re-presentation_of f and A11: ( a2 . 1 ) = ( 0. ) and A12: (for n being Nat holds ((2 <= n & n in ( dom a2 )) implies (( 0. ) < ( a2 . n ) & ( a2 . n ) < ( +infty )))) and A13: ( dom x2 ) = ( dom F2 ) and A14: (for n being Nat holds (n in ( dom x2 ) implies ( x2 . n ) = ( ( a2 . n ) * ( ( M * F2 ) . n ) ))) and A15: s2 = ( Sum x2 ) by A9;
A16: ( dom F2 ) = ( dom a2 ) by A10,CKB12:def 1;
A17: (for n being Nat holds (n in ( dom a2 ) implies ( 0. ) <= ( a2 . n )))
proof
let n being Nat;
assume A18: n in ( dom a2 );
now
per cases ;
case n = 1;
thus ( a2 . 1 ) = ( 0. ) by A11;
end;
case A19: n <> 1;
n in ( Seg ( len a2 ) ) by A18,FINSEQ_1:def 3;
then 1 <= n by FINSEQ_1:1;
then 1 < n by A19,XXREAL_0:1;
then ( 1 + 1 ) < ( n + 1 ) by XREAL_1:8;
then 2 <= n by NAT_1:13;
hence thesis by A12,A18;
end;
end;
hence thesis;
end;
A20: (for n being Nat holds (n in ( dom F2 ) implies ( 0. ) <= ( ( M * F2 ) . n )))
proof
let n being Nat;
assume n in ( dom F2 );
then (( ( M * F2 ) . n ) = ( M . ( F2 . n ) ) & ( F2 . n ) in ( rng F2 )) by FUNCT_1:3,FUNCT_1:13;
hence thesis by SUPINF_2:39;
end;
A21: (for n being Nat holds (n in ( dom x2 ) implies ( 0. ) <= ( x2 . n )))
proof
let n being Nat;
assume A22: n in ( dom x2 );
then (( 0. ) <= ( a2 . n ) & ( 0. ) <= ( ( M * F2 ) . n )) by A13,A16,A20,A17;
then ( 0. ) <= ( ( a2 . n ) * ( ( M * F2 ) . n ) );
hence thesis by A14,A22;
end;
consider F1 being (Finite_Sep_Sequence of S),a1 being (FinSequence of ( ExtREAL )),x1 being (FinSequence of ( ExtREAL )) such that A23: F1,a1 are_Re-presentation_of f and A24: ( a1 . 1 ) = ( 0. ) and A25: (for n being Nat holds ((2 <= n & n in ( dom a1 )) implies (( 0. ) < ( a1 . n ) & ( a1 . n ) < ( +infty )))) and A26: ( dom x1 ) = ( dom F1 ) and A27: (for n being Nat holds (n in ( dom x1 ) implies ( x1 . n ) = ( ( a1 . n ) * ( ( M * F1 ) . n ) ))) and A28: s1 = ( Sum x1 ) by A8;
A29: ( dom F1 ) = ( dom a1 ) by A23,CKB12:def 1;
A30: (for n being Nat holds (n in ( dom a1 ) implies ( 0. ) <= ( a1 . n )))
proof
let n being Nat;
assume A31: n in ( dom a1 );
now
per cases ;
case n = 1;
thus ( a1 . 1 ) = ( 0. ) by A24;
end;
case A32: n <> 1;
n in ( Seg ( len a1 ) ) by A31,FINSEQ_1:def 3;
then 1 <= n by FINSEQ_1:1;
then 1 < n by A32,XXREAL_0:1;
then ( 1 + 1 ) < ( n + 1 ) by XREAL_1:8;
then 2 <= n by NAT_1:13;
hence thesis by A25,A31;
end;
end;
hence thesis;
end;
A33: (for n being Nat holds (n in ( dom F1 ) implies ( 0. ) <= ( ( M * F1 ) . n )))
proof
let n being Nat;
assume n in ( dom F1 );
then (( ( M * F1 ) . n ) = ( M . ( F1 . n ) ) & ( F1 . n ) in ( rng F1 )) by FUNCT_1:3,FUNCT_1:13;
hence thesis by SUPINF_2:39;
end;
A34: (for n being Nat holds (n in ( dom x1 ) implies ( 0. ) <= ( x1 . n )))
proof
let n being Nat;
assume A35: n in ( dom x1 );
then (( 0. ) <= ( a1 . n ) & ( 0. ) <= ( ( M * F1 ) . n )) by A26,A29,A33,A30;
then ( 0. ) <= ( ( a1 . n ) * ( ( M * F1 ) . n ) );
hence thesis by A27,A35;
end;
now
per cases ;
case (ex i,j being Nat st ((((i in ( dom F1 ) & j in ( dom F2 )) & 2 <= i) & 2 <= j) & ( M . ( ( F1 . i ) /\ ( F2 . j ) ) ) = ( +infty )));
then consider i,j being Nat such that A36: i in ( dom F1 ) and A37: j in ( dom F2 ) and A38: 2 <= i and A39: 2 <= j and A40: ( M . ( ( F1 . i ) /\ ( F2 . j ) ) ) = ( +infty );
A41: ( F2 . j ) in ( rng F2 ) by A37,FUNCT_1:3;
A42: ( F1 . i ) in ( rng F1 ) by A36,FUNCT_1:3;
then A43: ( ( F1 . i ) /\ ( F2 . j ) ) in S by A41,MEASURE1:34;
( ( F1 . i ) /\ ( F2 . j ) ) c= ( F1 . i ) by XBOOLE_1:17;
then ( M . ( F1 . i ) ) = ( +infty ) by A40,A42,A43,MEASURE1:31,XXREAL_0:4;
then A44: ( ( M * F1 ) . i ) = ( +infty ) by A36,FUNCT_1:13;
( 0. ) < ( a1 . i ) by A25,A29,A36,A38;
then ( +infty ) = ( ( a1 . i ) * ( ( M * F1 ) . i ) ) by A44,XXREAL_3:def 5;
then ( x1 . i ) = ( +infty ) by A26,A27,A36;
then A45: ( Sum x1 ) = ( +infty ) by A26,A34,A36,CKB21:1;
( ( F1 . i ) /\ ( F2 . j ) ) c= ( F2 . j ) by XBOOLE_1:17;
then ( M . ( F2 . j ) ) = ( +infty ) by A40,A41,A43,MEASURE1:31,XXREAL_0:4;
then A46: ( ( M * F2 ) . j ) = ( +infty ) by A37,FUNCT_1:13;
( 0. ) < ( a2 . j ) by A12,A16,A37,A39;
then ( +infty ) = ( ( a2 . j ) * ( ( M * F2 ) . j ) ) by A46,XXREAL_3:def 5;
then ( x2 . j ) = ( +infty ) by A13,A14,A37;
hence thesis by A28,A13,A15,A21,A37,A45,CKB21:1;
end;
case A47: (for i,j being Nat holds ((((i in ( dom F1 ) & j in ( dom F2 )) & 2 <= i) & 2 <= j) implies ( M . ( ( F1 . i ) /\ ( F2 . j ) ) ) <> ( +infty )));
set m = ( len x2 );
set n = ( len x1 );
(ex a being (Function of [: ( Seg n ),( Seg m ) :],( REAL )) st (for i,j being Nat holds ((i in ( Seg n ) & j in ( Seg m )) implies ( a . (i,j) ) = ( ( a1 . i ) * ( M . ( ( F1 . i ) /\ ( F2 . j ) ) ) ))))
proof
deffunc F(set,set) = ( ( a1 . $1 ) * ( M . ( ( F1 . $1 ) /\ ( F2 . $2 ) ) ) );
A48: (for x,y being set holds ((x in ( Seg n ) & y in ( Seg m )) implies F(x,y) in ( REAL )))
proof
let x being set;
let y being set;
assume that
A49: x in ( Seg n )
and
A50: y in ( Seg m );
x in { k where k is (Element of ( NAT )): (1 <= k & k <= n) } by A49,FINSEQ_1:def 1;
then consider kx being (Element of ( NAT )) such that A51: x = kx and A52: 1 <= kx and kx <= n;
y in { k where k is (Element of ( NAT )): (1 <= k & k <= m) } by A50,FINSEQ_1:def 1;
then consider ky being (Element of ( NAT )) such that A53: y = ky and A54: 1 <= ky and ky <= m;
A55: ky in ( dom F2 ) by A13,A50,A53,FINSEQ_1:def 3;
then A56: ( F2 . ky ) in ( rng F2 ) by FUNCT_1:3;
A57: kx in ( dom F1 ) by A26,A49,A51,FINSEQ_1:def 3;
then ( F1 . kx ) in ( rng F1 ) by FUNCT_1:3;
then A58: ( ( F1 . kx ) /\ ( F2 . ky ) ) in S by A56,MEASURE1:34;
now
per cases ;
case A59: (not (2 <= kx & 2 <= ky));
now
per cases  by A59;
case A60: kx < 2;
then kx <= ( 1 + 1 );
then kx <= 1 by A60,NAT_1:8;
then F(kx,ky) = ( ( 0. ) * ( M . ( ( F1 . kx ) /\ ( F2 . ky ) ) ) ) by A24,A52,XXREAL_0:1
.= ( 0 );
hence F(kx,ky) in ( REAL );
end;
case A61: ky < 2;
then ky <= ( 1 + 1 );
then A62: ky <= 1 by A61,NAT_1:8;
now
per cases ;
case ( ( F1 . kx ) /\ ( F2 . ky ) ) = ( {} );
hence F(kx,ky) = ( ( a1 . kx ) * ( 0. ) ) by VALUED_0:def 19
.= ( 0 );
end;
case ( ( F1 . kx ) /\ ( F2 . ky ) ) <> ( {} );
then consider x being set such that A63: x in ( ( F1 . kx ) /\ ( F2 . ky ) ) by XBOOLE_0:def 1;
A64: x in ( F2 . ky ) by A63,XBOOLE_0:def 4;
x in ( F1 . kx ) by A63,XBOOLE_0:def 4;
then ( a1 . kx ) = ( f . x ) by A23,A57,CKB12:def 1
.= ( a2 . ky ) by A10,A55,A64,CKB12:def 1
.= ( 0. ) by A11,A54,A62,XXREAL_0:1;
hence F(kx,ky) = ( 0 );
end;
end;
hence F(kx,ky) in ( REAL );
end;
end;
hence F(kx,ky) in ( REAL );
end;
case A65: (2 <= kx & 2 <= ky);
A66: ( 0. ) <= ( a1 . kx ) by A29,A30,A57;
( a1 . kx ) <> ( +infty ) by A25,A29,A57,A65;
then reconsider r2 = ( a1 . kx ) as Real by A66,XXREAL_0:14;
( 0. ) <= ( M . ( ( F1 . kx ) /\ ( F2 . ky ) ) ) by A58,SUPINF_2:39;
then reconsider r3 = ( M . ( ( F1 . kx ) /\ ( F2 . ky ) ) ) as Real by A47,A57,A55,A65,XXREAL_0:14;
( ( a1 . kx ) * ( M . ( ( F1 . kx ) /\ ( F2 . ky ) ) ) ) = ( r2 * r3 ) by EXTREAL1:1;
hence F(kx,ky) in ( REAL );
end;
end;
hence thesis by A51,A53;
end;
consider f being (Function of [: ( Seg n ),( Seg m ) :],( REAL )) such that A67: (for x,y being set holds ((x in ( Seg n ) & y in ( Seg m )) implies ( f . (x,y) ) = F(x,y))) from BINOP_1:sch 2(A48);
take f;
thus thesis by A67;
end;
then consider a being (Function of [: ( Seg n ),( Seg m ) :],( REAL )) such that A68: (for i,j being Nat holds ((i in ( Seg n ) & j in ( Seg m )) implies ( a . (i,j) ) = ( ( a1 . i ) * ( M . ( ( F1 . i ) /\ ( F2 . j ) ) ) )));
(ex p being (FinSequence of ( REAL )) st (( dom p ) = ( Seg n ) & (for i being Nat holds (i in ( dom p ) implies (ex r being (FinSequence of ( REAL )) st ((( dom r ) = ( Seg m ) & ( p . i ) = ( Sum r )) & (for j being Nat holds (j in ( dom r ) implies ( r . j ) = ( a . [ i,j ] )))))))))
proof
defpred P[ Nat,set ]
 means
(ex r being (FinSequence of ( REAL )) st ((( dom r ) = ( Seg m ) & $2 = ( Sum r )) & (for j being Nat holds (j in ( dom r ) implies ( r . j ) = ( a . [ $1,j ] )))));
A69: (for k being Nat holds (k in ( Seg n ) implies (ex x being set st P[ k,x ])))
proof
let k being Nat;
assume k in ( Seg n );
deffunc G(set) = ( a . [ k,$1 ] );
consider r being FinSequence such that A70: ( len r ) = m and A71: (for i being Nat holds (i in ( dom r ) implies ( r . i ) = G(i))) from FINSEQ_1:sch 2;
A72: ( dom r ) = ( Seg m ) by A70,FINSEQ_1:def 3;
(for i being Nat holds (i in ( dom r ) implies ( r . i ) in ( REAL )))
proof
let i being Nat;
A73: ( a . [ k,i ] ) in ( REAL );
assume i in ( dom r );
hence thesis by A71,A73;
end;
then reconsider r as (FinSequence of ( REAL )) by FINSEQ_2:12;
take x = ( Sum r );
thus thesis by A71,A72;
end;
consider p being FinSequence such that A74: (( dom p ) = ( Seg n ) & (for k being Nat holds (k in ( Seg n ) implies P[ k,( p . k ) ]))) from FINSEQ_1:sch 1(A69);
(for i being Nat holds (i in ( dom p ) implies ( p . i ) in ( REAL )))
proof
let i being Nat;
assume i in ( dom p );
then (ex r being (FinSequence of ( REAL )) st ((( dom r ) = ( Seg m ) & ( p . i ) = ( Sum r )) & (for j being Nat holds (j in ( dom r ) implies ( r . j ) = ( a . [ i,j ] ))))) by A74;
hence thesis;
end;
then reconsider p as (FinSequence of ( REAL )) by FINSEQ_2:12;
take p;
thus thesis by A74;
end;
then consider p being (FinSequence of ( REAL )) such that A75: ( dom p ) = ( Seg n ) and A76: (for i being Nat holds (i in ( dom p ) implies (ex r being (FinSequence of ( REAL )) st ((( dom r ) = ( Seg m ) & ( p . i ) = ( Sum r )) & (for j being Nat holds (j in ( dom r ) implies ( r . j ) = ( a . [ i,j ] )))))));
A77: ( dom p ) = ( dom x1 ) by A75,FINSEQ_1:def 3;
(for k being Nat holds (k in ( dom p ) implies ( p . k ) = ( x1 . k )))
proof
let k being Nat;
assume A78: k in ( dom p );
then consider r being (FinSequence of ( REAL )) such that A79: ( dom r ) = ( Seg m ) and A80: ( p . k ) = ( Sum r ) and A81: (for j being Nat holds (j in ( dom r ) implies ( r . j ) = ( a . [ k,j ] ))) by A76;
(ex F11 being (Finite_Sep_Sequence of S) st ((( union ( rng F11 ) ) = ( F1 . k ) & ( dom F11 ) = ( dom r )) & (for j being Nat holds (j in ( dom r ) implies ( F11 . j ) = ( ( F1 . k ) /\ ( F2 . j ) )))))
proof
deffunc G(set) = ( ( F1 . k ) /\ ( F2 . $1 ) );
consider F being FinSequence such that A82: ( len F ) = m and A83: (for i being Nat holds (i in ( dom F ) implies ( F . i ) = G(i))) from FINSEQ_1:sch 2;
A84: ( dom F ) = ( Seg m ) by A82,FINSEQ_1:def 3;
A85: (for i being Nat holds (i in ( dom F ) implies ( F . i ) in S))
proof
let i being Nat;
assume A86: i in ( dom F );
then i in ( Seg m ) by A82,FINSEQ_1:def 3;
then i in ( dom F2 ) by A13,FINSEQ_1:def 3;
then A87: ( F2 . i ) in ( rng F2 ) by FUNCT_1:3;
( F1 . k ) in ( rng F1 ) by A26,A77,A78,FUNCT_1:3;
then ( ( F1 . k ) /\ ( F2 . i ) ) in S by A87,MEASURE1:34;
hence thesis by A83,A86;
end;
A88: ( dom F ) = ( Seg m ) by A82,FINSEQ_1:def 3;
reconsider F as (FinSequence of S) by A85,FINSEQ_2:12;
A89: ( dom F ) = ( dom F2 ) by A13,A88,FINSEQ_1:def 3;
then reconsider F as (Finite_Sep_Sequence of S) by A83,CKB5:1;
take F;
( union ( rng F ) ) = ( ( F1 . k ) /\ ( union ( rng F2 ) ) ) by A83,A89,CKB6:1
.= ( ( F1 . k ) /\ ( dom f ) ) by A10,CKB12:def 1
.= ( ( F1 . k ) /\ ( union ( rng F1 ) ) ) by A23,CKB12:def 1
.= ( F1 . k ) by A26,A77,A78,CKB7:1;
hence thesis by A79,A83,A84;
end;
then consider F11 being (Finite_Sep_Sequence of S) such that A90: ( union ( rng F11 ) ) = ( F1 . k ) and A91: ( dom F11 ) = ( dom r ) and A92: (for j being Nat holds (j in ( dom r ) implies ( F11 . j ) = ( ( F1 . k ) /\ ( F2 . j ) )));
A93: ( Sum ( M * F11 ) ) = ( M . ( F1 . k ) ) by A90,CKB9:1;
k in ( Seg ( len a1 ) ) by A26,A29,A77,A78,FINSEQ_1:def 3;
then A94: 1 <= k by FINSEQ_1:1;
(( a1 . k ) <> ( -infty ) & ( a1 . k ) <> ( +infty ))
proof
per cases ;
suppose k = 1;

hence thesis by A24;
end;
suppose k <> 1;

then 1 < k by A94,XXREAL_0:1;
then ( 1 + 1 ) <= k by NAT_1:13;
hence thesis by A25,A26,A29,A77,A78;
end;
end;
then A95: ( a1 . k ) is (Element of ( REAL )) by XXREAL_0:14;
reconsider rr = r as (FinSequence of ( ExtREAL )) by CKB11:1;
A96: (for j being Nat holds (j in ( dom r ) implies ( r . j ) = ( ( a1 . k ) * ( M . ( ( F1 . k ) /\ ( F2 . j ) ) ) )))
proof
let j being Nat;
assume A97: j in ( dom r );
hence ( r . j ) = ( a . (k,j) ) by A81
.= ( ( a1 . k ) * ( M . ( ( F1 . k ) /\ ( F2 . j ) ) ) ) by A68,A75,A78,A79,A97;
end;
A98: (for j being Nat holds (j in ( dom rr ) implies ( rr . j ) = ( ( a1 . k ) * ( ( M * F11 ) . j ) )))
proof
let j being Nat;
assume A99: j in ( dom rr );
hence ( rr . j ) = ( ( a1 . k ) * ( M . ( ( F1 . k ) /\ ( F2 . j ) ) ) ) by A96
.= ( ( a1 . k ) * ( M . ( F11 . j ) ) ) by A92,A99
.= ( ( a1 . k ) * ( ( M * F11 ) . j ) ) by A91,A99,FUNCT_1:13;
end;
( dom rr ) = ( dom ( M * F11 ) ) by A91,CKB8:1;
then ( Sum rr ) = ( ( a1 . k ) * ( Sum ( M * F11 ) ) ) by A98,A95,CKB10:1;
then ( Sum r ) = ( ( a1 . k ) * ( M . ( F1 . k ) ) ) by A93,CKB2:1
.= ( ( a1 . k ) * ( ( M * F1 ) . k ) ) by A26,A77,A78,FUNCT_1:13;
hence thesis by A27,A77,A78,A80;
end;
then A100: ( Sum p ) = ( Sum x1 ) by A77,CKB2:1,FINSEQ_1:13;
(ex q being (FinSequence of ( REAL )) st (( dom q ) = ( Seg m ) & (for j being Nat holds (j in ( dom q ) implies (ex s being (FinSequence of ( REAL )) st ((( dom s ) = ( Seg n ) & ( q . j ) = ( Sum s )) & (for i being Nat holds (i in ( dom s ) implies ( s . i ) = ( a . [ i,j ] )))))))))
proof
defpred P[ Nat,set ]
 means
(ex s being (FinSequence of ( REAL )) st ((( dom s ) = ( Seg n ) & $2 = ( Sum s )) & (for i being Nat holds (i in ( dom s ) implies ( s . i ) = ( a . [ i,$1 ] )))));
A101: (for k being Nat holds (k in ( Seg m ) implies (ex x being set st P[ k,x ])))
proof
let k being Nat;
assume k in ( Seg m );
deffunc G(set) = ( a . [ $1,k ] );
consider s being FinSequence such that A102: ( len s ) = n and A103: (for i being Nat holds (i in ( dom s ) implies ( s . i ) = G(i))) from FINSEQ_1:sch 2;
A104: ( dom s ) = ( Seg n ) by A102,FINSEQ_1:def 3;
(for i being Nat holds (i in ( dom s ) implies ( s . i ) in ( REAL )))
proof
let i being Nat;
A105: ( a . [ i,k ] ) in ( REAL );
assume i in ( dom s );
hence thesis by A103,A105;
end;
then reconsider s as (FinSequence of ( REAL )) by FINSEQ_2:12;
take x = ( Sum s );
thus thesis by A103,A104;
end;
consider p being FinSequence such that A106: (( dom p ) = ( Seg m ) & (for k being Nat holds (k in ( Seg m ) implies P[ k,( p . k ) ]))) from FINSEQ_1:sch 1(A101);
(for i being Nat holds (i in ( dom p ) implies ( p . i ) in ( REAL )))
proof
let i being Nat;
assume i in ( dom p );
then (ex s being (FinSequence of ( REAL )) st ((( dom s ) = ( Seg n ) & ( p . i ) = ( Sum s )) & (for j being Nat holds (j in ( dom s ) implies ( s . j ) = ( a . [ j,i ] ))))) by A106;
hence thesis;
end;
then reconsider p as (FinSequence of ( REAL )) by FINSEQ_2:12;
take p;
thus thesis by A106;
end;
then consider q being (FinSequence of ( REAL )) such that A107: ( dom q ) = ( Seg m ) and A108: (for j being Nat holds (j in ( dom q ) implies (ex s being (FinSequence of ( REAL )) st ((( dom s ) = ( Seg n ) & ( q . j ) = ( Sum s )) & (for i being Nat holds (i in ( dom s ) implies ( s . i ) = ( a . [ i,j ] )))))));
A109: ( dom q ) = ( dom x2 ) by A107,FINSEQ_1:def 3;
A110: (for k being Nat holds (k in ( dom q ) implies ( q . k ) = ( x2 . k )))
proof
let k being Nat;
assume A111: k in ( dom q );
then consider s being (FinSequence of ( REAL )) such that A112: ( dom s ) = ( Seg n ) and A113: ( q . k ) = ( Sum s ) and A114: (for i being Nat holds (i in ( dom s ) implies ( s . i ) = ( a . [ i,k ] ))) by A108;
reconsider ss = s as (FinSequence of ( ExtREAL )) by CKB11:1;
(ex F21 being (Finite_Sep_Sequence of S) st ((( union ( rng F21 ) ) = ( F2 . k ) & ( dom F21 ) = ( dom s )) & (for j being Nat holds (j in ( dom s ) implies ( F21 . j ) = ( ( F1 . j ) /\ ( F2 . k ) )))))
proof
deffunc G(set) = ( ( F2 . k ) /\ ( F1 . $1 ) );
consider F being FinSequence such that A115: ( len F ) = n and A116: (for i being Nat holds (i in ( dom F ) implies ( F . i ) = G(i))) from FINSEQ_1:sch 2;
A117: ( dom F ) = ( Seg n ) by A115,FINSEQ_1:def 3;
A118: (for i being Nat holds (i in ( dom F ) implies ( F . i ) in S))
proof
let i being Nat;
assume A119: i in ( dom F );
then i in ( Seg n ) by A115,FINSEQ_1:def 3;
then i in ( dom F1 ) by A26,FINSEQ_1:def 3;
then A120: ( F1 . i ) in ( rng F1 ) by FUNCT_1:3;
( F2 . k ) in ( rng F2 ) by A13,A109,A111,FUNCT_1:3;
then ( ( F1 . i ) /\ ( F2 . k ) ) in S by A120,MEASURE1:34;
hence thesis by A116,A119;
end;
A121: ( dom F ) = ( Seg n ) by A115,FINSEQ_1:def 3;
reconsider F as (FinSequence of S) by A118,FINSEQ_2:12;
A122: ( dom F ) = ( dom F1 ) by A26,A121,FINSEQ_1:def 3;
then reconsider F as (Finite_Sep_Sequence of S) by A116,CKB5:1;
take F;
( union ( rng F ) ) = ( ( F2 . k ) /\ ( union ( rng F1 ) ) ) by A116,A122,CKB6:1
.= ( ( F2 . k ) /\ ( dom f ) ) by A23,CKB12:def 1
.= ( ( F2 . k ) /\ ( union ( rng F2 ) ) ) by A10,CKB12:def 1
.= ( F2 . k ) by A13,A109,A111,CKB7:1;
hence thesis by A112,A116,A117;
end;
then consider F21 being (Finite_Sep_Sequence of S) such that A123: ( union ( rng F21 ) ) = ( F2 . k ) and A124: ( dom F21 ) = ( dom s ) and A125: (for i being Nat holds (i in ( dom s ) implies ( F21 . i ) = ( ( F1 . i ) /\ ( F2 . k ) )));
A126: ( Sum ( M * F21 ) ) = ( M . ( F2 . k ) ) by A123,CKB9:1;
A127: (for i being Nat holds (i in ( dom s ) implies ( s . i ) = ( ( a1 . i ) * ( M . ( ( F1 . i ) /\ ( F2 . k ) ) ) )))
proof
let i being Nat;
assume A128: i in ( dom s );
hence ( s . i ) = ( a . (i,k) ) by A114
.= ( ( a1 . i ) * ( M . ( ( F1 . i ) /\ ( F2 . k ) ) ) ) by A68,A107,A111,A112,A128;
end;
A129: (for i being Nat holds (i in ( dom s ) implies ( s . i ) = ( ( a2 . k ) * ( M . ( ( F1 . i ) /\ ( F2 . k ) ) ) )))
proof
let i being Nat;
assume A130: i in ( dom s );
now
per cases ;
case A131: ( ( F1 . i ) /\ ( F2 . k ) ) = ( {} );
then ( M . ( ( F1 . i ) /\ ( F2 . k ) ) ) = ( 0. ) by VALUED_0:def 19;
hence ( s . i ) = ( ( a1 . i ) * ( 0. ) ) by A127,A130
.= ( 0. )
.= ( ( a2 . k ) * ( 0. ) )
.= ( ( a2 . k ) * ( M . ( ( F1 . i ) /\ ( F2 . k ) ) ) ) by A131,VALUED_0:def 19;
end;
case ( ( F1 . i ) /\ ( F2 . k ) ) <> ( {} );
then consider x being set such that A132: x in ( ( F1 . i ) /\ ( F2 . k ) ) by XBOOLE_0:def 1;
A133: x in ( F2 . k ) by A132,XBOOLE_0:def 4;
A134: ( dom p ) = ( dom x1 ) by A75,FINSEQ_1:def 3;
x in ( F1 . i ) by A132,XBOOLE_0:def 4;
then ( a1 . i ) = ( f . x ) by A23,A26,A75,A112,A130,A134,CKB12:def 1
.= ( a2 . k ) by A10,A13,A109,A111,A133,CKB12:def 1;
hence thesis by A127,A130;
end;
end;
hence thesis;
end;
A135: (for j being Nat holds (j in ( dom ss ) implies ( ss . j ) = ( ( a2 . k ) * ( ( M * F21 ) . j ) )))
proof
let j being Nat;
assume A136: j in ( dom ss );
hence ( ss . j ) = ( ( a2 . k ) * ( M . ( ( F1 . j ) /\ ( F2 . k ) ) ) ) by A129
.= ( ( a2 . k ) * ( M . ( F21 . j ) ) ) by A125,A136
.= ( ( a2 . k ) * ( ( M * F21 ) . j ) ) by A124,A136,FUNCT_1:13;
end;
k in ( Seg ( len a2 ) ) by A13,A16,A109,A111,FINSEQ_1:def 3;
then A137: 1 <= k by FINSEQ_1:1;
(( a2 . k ) <> ( -infty ) & ( a2 . k ) <> ( +infty ))
proof
per cases ;
suppose k = 1;

hence thesis by A11;
end;
suppose k <> 1;

then 1 < k by A137,XXREAL_0:1;
then ( 1 + 1 ) <= k by NAT_1:13;
hence thesis by A12,A13,A16,A109,A111;
end;
end;
then A138: ( a2 . k ) is (Element of ( REAL )) by XXREAL_0:14;
( dom ss ) = ( dom ( M * F21 ) ) by A124,CKB8:1;
then ( Sum ss ) = ( ( a2 . k ) * ( Sum ( M * F21 ) ) ) by A135,A138,CKB10:1;
then ( Sum s ) = ( ( a2 . k ) * ( M . ( F2 . k ) ) ) by A126,CKB2:1
.= ( ( a2 . k ) * ( ( M * F2 ) . k ) ) by A13,A109,A111,FUNCT_1:13;
hence thesis by A14,A109,A111,A113;
end;
( Sum p ) = ( Sum q ) by A75,A76,A107,A108,CKB1:1;
hence thesis by A28,A15,A100,A109,A110,CKB2:1,FINSEQ_1:13;
end;
end;
hence thesis;
end;

end;
end;
