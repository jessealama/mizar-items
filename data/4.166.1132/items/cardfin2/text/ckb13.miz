environ
vocabularies FUNCT_1,INT_1,ARYTM_1,ARYTM_3,CARD_1,FUNCT_2,NAT_1,CARD_3,FINSET_1,ORDINAL2,RPR_1,CARDFIN2,ABIAN,POWER,COMPLEX1,AFINSQ_1,RELAT_1,XCMPLX_0,SIN_COS,SERIES_1,TAYLOR_1,SUBSET_1,FDIFF_1,FINSEQ_1,TARSKI,REAL_1,FINSOP_1,NEWTON,ORDINAL1,REALSET1,XXREAL_0,XBOOLE_0,XXREAL_1,VALUED_1,NUMBERS,BINOP_2,XREAL_0;
notations TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,RELSET_1,PARTFUN1,FUNCT_2,BINOP_1,FINSET_1,CARD_1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,REAL_1,NAT_1,NAT_D,INT_1,COMPLEX1,BINOP_2,VALUED_1,NEWTON,RCOMP_1,FCONT_1,POWER,SERIES_1,SEQFUNC,SIN_COS,AFINSQ_1,ABIAN,TAYLOR_1,STIRL2_1,CARD_FIN,RPR_1,AFINSQ_2,CKB5,CKB10;
definitions XBOOLE_0,TARSKI,XCMPLX_0,SUBSET_1,SIN_COS,RELAT_1,CKB5,CKB10;
theorems CARD_2,CARD_FIN,FUNCT_2,XBOOLE_0,NEWTON,XREAL_0,XCMPLX_1,RPR_1,XREAL_1,XCMPLX_0,INT_1,ORDINAL1,CARD_1,TAYLOR_1,SIN_COS,TAYLOR_2,XXREAL_1,ABIAN,STIRL2_1,SERIES_1,SEQ_1,SIN_COS2,NAT_1,TARSKI,BINOP_2,IRRAT_1,SEQ_2,FIB_NUM2,SIN_COS7,XXREAL_0,ALTCAT_1,RELAT_1,VALUED_1,VALUED_0,FUNCT_1,AFINSQ_2,XBOOLE_1,POWER,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB12;
schemes RECDEF_2,FIB_NUM,NAT_1;
registrations RELSET_1,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,CARD_1,FINSET_1,NUMBERS,SIN_COS,RCOMP_1,VALUED_0,VALUED_1,FUNCT_2,FCONT_3,FCONT_1,AFINSQ_1,POWER,FUNCT_1,BINOP_2,WSIERP_1,XCMPLX_0,XBOOLE_0,RELAT_1,FRAENKEL,AFINSQ_2,ORDINAL1,NEWTON,CKB1,CKB2,CKB11;
constructors REAL_1,SERIES_1,ABIAN,VALUED_1,CARD_FIN,RCOMP_1,SIN_COS,TAYLOR_1,SEQ_1,FCONT_1,SEQFUNC,RELSET_1,STIRL2_1,SETWISEO,YELLOW20,WELLORD2,NAT_D,BINARITH,RPR_1,AFINSQ_2,AFINSQ_1,NEWTON,CKB5,CKB10;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
theorem
Th8: (for s being non empty  finite set holds (ex c being  real number st (c in ]. ( - 1 ),( 0 ) .[ & ( ( card ( derangements s ) ) - ( ( ( card s ) ! ) / ( number_e ) ) ) = ( - ( ( ( card s ) ! ) * ( ( ( exp_R c ) * ( ( - 1 ) |^ ( ( card s ) + 1 ) ) ) / ( ( ( card s ) + 1 ) ! ) ) ) ))))
proof
let s being non empty  finite set;
set n = ( card s );
consider XF being (XFinSequence of ( INT )) such that A1: ( Sum XF ) = ( card { h where h is (Function of s,s): (h is  one-to-one & (for x holds (x in s implies ( h . x ) <> x))) } ) and A2: ( dom XF ) = ( n + 1 ) and A3: (for m being Nat holds (m in ( dom XF ) implies ( XF . m ) = ( ( ( ( - 1 ) |^ m ) * ( n ! ) ) / ( m ! ) ))) by CARD_FIN:63;
A4: ( Sum XF ) = ( card ( derangements s ) ) by A1,CKB12:1;
set T = ( Taylor (( exp_R ),( [#] ( REAL ) ),( 0 ),( - 1 )) );
consider c being  real number such that A5: (c in ]. ( - 1 ),( 0 ) .[ & ( exp_R ( - 1 ) ) = ( ( ( Partial_Sums T ) . n ) + ( ( ( exp_R c ) * ( ( ( - 1 ) - ( 0 ) ) |^ ( n + 1 ) ) ) / ( ( n + 1 ) ! ) ) )) by CKB8:1;
( Partial_Sums ( ( n ! ) (#) T ) ) = ( ( n ! ) (#) ( Partial_Sums T ) ) by SERIES_1:9;
then A6: ( ( Partial_Sums ( ( n ! ) (#) T ) ) . n ) = ( ( n ! ) * ( ( Partial_Sums T ) . n ) ) by SEQ_1:9;
( ( Partial_Sums ( ( n ! ) (#) T ) ) . n ) = ( Sum XF )
proof
consider f being (Function of ( NAT ),( INT )) such that A7: ( f . ( 0 ) ) = ( XF . ( 0 ) ) and A8: (for n being Nat holds (( n + 1 ) < ( len XF ) implies ( f . ( n + 1 ) ) = ( ( addint ) . (( f . n ),( XF . ( n + 1 ) )) ))) and A9: ( ( addint ) "**" XF ) = ( f . ( ( len XF ) - 1 ) ) by A2,AFINSQ_2:def 8;
A10: ( Sum XF ) = ( f . ( ( len XF ) - 1 ) ) by A9,AFINSQ_2:50;
defpred P[ (Element of ( NAT )) ]
 means
($1 in ( n + 1 ) implies ( ( Partial_Sums ( ( n ! ) (#) T ) ) . $1 ) = ( f . $1 ));
A11: P[ ( 0 ) ]
proof
A12: ( 0 ) in ( dom XF ) by A2,NAT_1:44;
( ( Partial_Sums ( ( n ! ) (#) T ) ) . ( 0 ) ) = ( ( ( n ! ) (#) T ) . ( 0 ) ) by SERIES_1:def 1
.= ( ( n ! ) * ( T . ( 0 ) ) ) by SEQ_1:9
.= ( ( n ! ) * ( ( ( ( ( diff (( exp_R ),( [#] ( REAL ) )) ) . ( 0 ) ) . ( 0 ) ) * ( ( ( - 1 ) - ( 0 ) ) |^ ( 0 ) ) ) / ( ( 0 ) ! ) ) ) by TAYLOR_1:def 7
.= ( ( n ! ) * ( ( 1 * ( ( - 1 ) |^ ( 0 ) ) ) / ( ( 0 ) ! ) ) ) by SIN_COS2:13,TAYLOR_2:7
.= ( ( ( n ! ) * ( ( - 1 ) |^ ( 0 ) ) ) / ( ( 0 ) ! ) )
.= ( f . ( 0 ) ) by A3,A12,A7;
hence thesis;
end;
A13: (for j being (Element of ( NAT )) holds (P[ j ] implies P[ ( j + 1 ) ]))
proof
let j being (Element of ( NAT ));
assume that
A14: P[ j ];
set j1 = ( j + 1 );
assume A15: ( j + 1 ) in ( n + 1 );
then A16: ( j + 1 ) < ( n + 1 ) by NAT_1:44;
then A17: j < ( n + 1 ) by NAT_1:13;
( ( ( n ! ) (#) T ) . j1 ) = ( ( n ! ) * ( T . j1 ) ) by SEQ_1:9
.= ( ( n ! ) * ( ( ( ( ( diff (( exp_R ),( [#] ( REAL ) )) ) . j1 ) . ( 0 ) ) * ( ( ( - 1 ) - ( 0 ) ) |^ j1 ) ) / ( j1 ! ) ) ) by TAYLOR_1:def 7
.= ( ( n ! ) * ( ( 1 * ( ( - 1 ) |^ j1 ) ) / ( j1 ! ) ) ) by SIN_COS2:13,TAYLOR_2:7
.= ( ( ( n ! ) * ( ( - 1 ) |^ j1 ) ) / ( j1 ! ) )
.= ( XF . j1 ) by A3,A15,A2;
hence ( ( Partial_Sums ( ( n ! ) (#) T ) ) . ( j + 1 ) ) = ( ( f . j ) + ( XF . j1 ) ) by A14,A17,NAT_1:44,SERIES_1:def 1
.= ( ( addint ) . (( f . j ),( XF . j1 )) ) by BINOP_2:def 20
.= ( f . j1 ) by A8,A16,A2;
end;
(for j being (Element of ( NAT )) holds P[ j ]) from NAT_1:sch 1(A11,A13);
hence thesis by A10,A2,NAT_1:45;
end;
then A18: ( ( card ( derangements s ) ) + ( ( n ! ) * ( ( ( exp_R c ) * ( ( - 1 ) |^ ( n + 1 ) ) ) / ( ( n + 1 ) ! ) ) ) ) = ( ( n ! ) * ( exp_R ( - 1 ) ) ) by A4,A5,A6
.= ( ( n ! ) * ( 1 / ( exp_R 1 ) ) ) by TAYLOR_1:4
.= ( ( n ! ) / ( number_e ) ) by IRRAT_1:def 7;
take c;
thus c in ]. ( - 1 ),( 0 ) .[ by A5;
thus ( ( card ( derangements s ) ) - ( ( ( card s ) ! ) / ( number_e ) ) ) = ( - ( ( n ! ) * ( ( ( exp_R c ) * ( ( - 1 ) |^ ( n + 1 ) ) ) / ( ( n + 1 ) ! ) ) ) ) by A18;
end;
