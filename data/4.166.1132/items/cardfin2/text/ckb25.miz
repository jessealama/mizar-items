environ
vocabularies FUNCT_1,INT_1,ARYTM_1,ARYTM_3,CARD_1,FUNCT_2,NAT_1,CARD_3,FINSET_1,ORDINAL2,RPR_1,CARDFIN2,ABIAN,POWER,COMPLEX1,AFINSQ_1,RELAT_1,XCMPLX_0,SIN_COS,SERIES_1,TAYLOR_1,SUBSET_1,FDIFF_1,FINSEQ_1,TARSKI,REAL_1,FINSOP_1,NEWTON,ORDINAL1,REALSET1,XXREAL_0,XBOOLE_0,XXREAL_1,VALUED_1,NUMBERS,BINOP_2,XREAL_0,CKB18,CKB19;
notations TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,RELSET_1,PARTFUN1,FUNCT_2,BINOP_1,FINSET_1,CARD_1,NUMBERS,XCMPLX_0,XXREAL_0,XREAL_0,REAL_1,NAT_1,NAT_D,INT_1,COMPLEX1,BINOP_2,VALUED_1,NEWTON,RCOMP_1,FCONT_1,POWER,SERIES_1,SEQFUNC,SIN_COS,AFINSQ_1,ABIAN,TAYLOR_1,STIRL2_1,CARD_FIN,RPR_1,AFINSQ_2,CKB5,CKB10,CKB18,CKB19,CKB20;
definitions XBOOLE_0,TARSKI,XCMPLX_0,SUBSET_1,SIN_COS,RELAT_1,CKB5,CKB10,CKB18,CKB19,CKB20;
theorems CARD_2,CARD_FIN,FUNCT_2,XBOOLE_0,NEWTON,XREAL_0,XCMPLX_1,RPR_1,XREAL_1,XCMPLX_0,INT_1,ORDINAL1,CARD_1,TAYLOR_1,SIN_COS,TAYLOR_2,XXREAL_1,ABIAN,STIRL2_1,SERIES_1,SEQ_1,SIN_COS2,NAT_1,TARSKI,BINOP_2,IRRAT_1,SEQ_2,FIB_NUM2,SIN_COS7,XXREAL_0,ALTCAT_1,RELAT_1,VALUED_1,VALUED_0,FUNCT_1,AFINSQ_2,XBOOLE_1,POWER,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB23,CKB24;
schemes RECDEF_2,FIB_NUM,NAT_1;
registrations RELSET_1,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,CARD_1,FINSET_1,NUMBERS,SIN_COS,RCOMP_1,VALUED_0,VALUED_1,FUNCT_2,FCONT_3,FCONT_1,AFINSQ_1,POWER,FUNCT_1,BINOP_2,WSIERP_1,XCMPLX_0,XBOOLE_0,RELAT_1,FRAENKEL,AFINSQ_2,ORDINAL1,NEWTON,CKB1,CKB2,CKB11,CKB21,CKB22;
constructors REAL_1,SERIES_1,ABIAN,VALUED_1,CARD_FIN,RCOMP_1,SIN_COS,TAYLOR_1,SEQ_1,FCONT_1,SEQFUNC,RELSET_1,STIRL2_1,SETWISEO,YELLOW20,WELLORD2,NAT_D,BINARITH,RPR_1,AFINSQ_2,AFINSQ_1,NEWTON,CKB5,CKB10,CKB18,CKB19,CKB20;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
theorem
(for s being  finite set holds ( ( der_seq ) . ( card s ) ) = ( card ( derangements s ) ))
proof
let s being  finite set;
defpred P[  finite set ]
 means
(for s being  finite set holds (( card s ) = $1 implies ( ( der_seq ) . $1 ) = ( card ( derangements s ) )));
A1: P[ ( 0 ) ]
proof
let s being  finite set;
assume ( card s ) = ( 0 );
then A2: s = ( {} );
thus ( ( der_seq ) . ( 0 ) ) = 1 by CKB20:def 1
.= ( card ( derangements s ) ) by CKB16:1,A2,CARD_1:30;
end;
A3: P[ 1 ]
proof
let s being  finite set;
assume ( card s ) = 1;
then consider x being set such that A4: s = { x } by CARD_2:42;
thus ( ( der_seq ) . 1 ) = ( card ( {} ) ) by CKB20:def 1
.= ( card ( derangements s ) ) by CKB17:1,A4;
end;
A5: (for n being Nat holds ((P[ n ] & P[ ( n + 1 ) ]) implies P[ ( n + 2 ) ]))
proof
let n being Nat;
assume A6: P[ n ];
assume A7: P[ ( n + 1 ) ];
set n1 = ( n + 1 );
A8: (( card n ) = n & ( card n1 ) = ( n + 1 )) by CARD_1:def 2;
then consider XFn being (XFinSequence of ( INT )) such that A9: ( Sum XFn ) = ( card { h where h is (Function of n,n): (h is  one-to-one & (for x holds (x in n implies ( h . x ) <> x))) } ) and A10: ( dom XFn ) = ( n + 1 ) and A11: (for m being Nat holds (m in ( dom XFn ) implies ( XFn . m ) = ( ( ( ( - 1 ) |^ m ) * ( n ! ) ) / ( m ! ) ))) by CARD_FIN:63;
consider XFn1 being (XFinSequence of ( INT )) such that A12: ( Sum XFn1 ) = ( card { h where h is (Function of n1,n1): (h is  one-to-one & (for x holds (x in n1 implies ( h . x ) <> x))) } ) and A13: ( dom XFn1 ) = ( ( n + 1 ) + 1 ) and A14: (for m being Nat holds (m in ( dom XFn1 ) implies ( XFn1 . m ) = ( ( ( ( - 1 ) |^ m ) * ( ( n + 1 ) ! ) ) / ( m ! ) ))) by A8,CARD_FIN:63;
( Sum XFn ) = ( card ( derangements n ) ) by A9,CKB12:1;
then A15: ( ( der_seq ) . n ) = ( Sum XFn ) by A6,A8;
( Sum XFn1 ) = ( card ( derangements n1 ) ) by A12,CKB12:1;
then A16: ( ( der_seq ) . ( n + 1 ) ) = ( Sum XFn1 ) by A7,A8;
let sn2 being  finite set;
assume ( card sn2 ) = ( n + 2 );
then consider XFn2 being (XFinSequence of ( INT )) such that A17: ( Sum XFn2 ) = ( card { h where h is (Function of sn2,sn2): (h is  one-to-one & (for x holds (x in sn2 implies ( h . x ) <> x))) } ) and A18: ( dom XFn2 ) = ( ( n + 2 ) + 1 ) and A19: (for m being Nat holds (m in ( dom XFn2 ) implies ( XFn2 . m ) = ( ( ( ( - 1 ) |^ m ) * ( ( n + 2 ) ! ) ) / ( m ! ) ))) by CARD_FIN:63;
A20: ( Sum XFn2 ) = ( card ( derangements sn2 ) ) by A17,CKB12:1;
A21: ( len XFn1 ) = ( ( len XFn ) + 1 ) by A10,A13;
A22: ( len XFn2 ) = ( ( len XFn1 ) + 1 ) by A13,A18;
( n + 1 ) < ( n + 2 ) by XREAL_1:8;
then A23: ( len XFn ) c= ( dom XFn1 ) by A10,A13,NAT_1:39;
A24: ( dom ( ( n + 1 ) (#) XFn ) ) = ( len XFn ) by VALUED_1:def 5;
A25:now
let x being set;
assume A26: x in ( dom ( XFn1 | ( len XFn ) ) );
then A27: x in ( dom XFn1 ) by RELAT_1:57;
reconsider m = x as (Element of ( NAT )) by A26;
A28: m in ( dom XFn ) by A26,RELAT_1:57;
thus ( ( XFn1 | ( len XFn ) ) . x ) = ( XFn1 . x ) by A26,FUNCT_1:47
.= ( ( ( ( - 1 ) |^ m ) * ( ( n + 1 ) ! ) ) / ( m ! ) ) by A27,A14
.= ( ( ( ( - 1 ) |^ m ) * ( ( n ! ) * ( n + 1 ) ) ) / ( m ! ) ) by NEWTON:15
.= ( ( n + 1 ) * ( ( ( ( - 1 ) |^ m ) * ( n ! ) ) / ( m ! ) ) )
.= ( ( n + 1 ) * ( XFn . m ) ) by A11,A28
.= ( ( ( n + 1 ) (#) XFn ) . x ) by VALUED_1:6;
end;
set a = ( ( - 1 ) |^ ( n + 1 ) );
A29: ( ( - 1 ) * a ) = ( ( - 1 ) |^ ( ( n + 1 ) + 1 ) ) by NEWTON:6;
( ( n + 1 ) + (( 0 ) qua Nat) ) < ( ( n + 1 ) + 1 ) by XREAL_1:8;
then A30: ( n + 1 ) in ( dom XFn1 ) by A13,NAT_1:44;
( ( n + 2 ) + (( 0 ) qua Nat) ) < ( ( n + 2 ) + 1 ) by XREAL_1:8;
then A31: ( n + 2 ) in ( dom XFn2 ) by A18,NAT_1:44;
( XFn1 | ( len XFn ) ) = ( ( n + 1 ) (#) XFn ) by A23,A24,A25,FUNCT_1:2,RELAT_1:62;
then A32: ( Sum XFn1 ) = ( ( ( n + 1 ) * ( Sum XFn ) ) + ( XFn1 . ( len XFn ) ) ) by CKB24:1,A21
.= ( ( ( n + 1 ) * ( Sum XFn ) ) + ( ( a * ( ( n + 1 ) ! ) ) / ( ( n + 1 ) ! ) ) ) by A10,A14,A30
.= ( ( ( n + 1 ) * ( Sum XFn ) ) + ( a * ( ( ( n + 1 ) ! ) / ( ( n + 1 ) ! ) ) ) )
.= ( ( ( n + 1 ) * ( Sum XFn ) ) + ( a * 1 ) ) by XCMPLX_1:60;
A33:now
let x being set;
assume A34: x in ( dom ( XFn2 | ( len XFn1 ) ) );
then A35: x in ( dom XFn2 ) by RELAT_1:57;
reconsider m = x as (Element of ( NAT )) by A34;
A36: m in ( dom XFn1 ) by A34,RELAT_1:57;
thus ( ( XFn2 | ( len XFn1 ) ) . x ) = ( XFn2 . x ) by A34,FUNCT_1:47
.= ( ( ( ( - 1 ) |^ m ) * ( ( ( n + 1 ) + 1 ) ! ) ) / ( m ! ) ) by A35,A19
.= ( ( ( ( - 1 ) |^ m ) * ( ( ( n + 1 ) ! ) * ( ( n + 1 ) + 1 ) ) ) / ( m ! ) ) by NEWTON:15
.= ( ( ( n + 1 ) + 1 ) * ( ( ( ( - 1 ) |^ m ) * ( ( n + 1 ) ! ) ) / ( m ! ) ) )
.= ( ( n + 2 ) * ( XFn1 . m ) ) by A14,A36
.= ( ( ( n + 2 ) (#) XFn1 ) . x ) by VALUED_1:6;
end;
( n + 2 ) < ( n + 3 ) by XREAL_1:8;
then ( len XFn1 ) c= ( dom XFn2 ) by A13,A18,NAT_1:39;
then A37: ( dom ( XFn2 | ( len XFn1 ) ) ) = ( len XFn1 ) by RELAT_1:62;
( dom ( ( n + 2 ) (#) XFn1 ) ) = ( len XFn1 ) by VALUED_1:def 5;
then ( Sum XFn2 ) = ( ( ( n + 2 ) * ( Sum XFn1 ) ) + ( XFn2 . ( len XFn1 ) ) ) by CKB24:1,A22,A37,A33,FUNCT_1:2
.= ( ( ( n + 2 ) * ( Sum XFn1 ) ) + ( ( ( ( - 1 ) |^ ( n + 2 ) ) * ( ( n + 2 ) ! ) ) / ( ( n + 2 ) ! ) ) ) by A19,A31,A13
.= ( ( ( n + 2 ) * ( Sum XFn1 ) ) + ( ( - a ) * ( ( ( n + 2 ) ! ) / ( ( n + 2 ) ! ) ) ) ) by A29
.= ( ( ( n + 2 ) * ( Sum XFn1 ) ) + ( ( - a ) * 1 ) ) by XCMPLX_1:60
.= ( ( n + 1 ) * ( ( Sum XFn ) + ( Sum XFn1 ) ) ) by A32;
hence ( ( der_seq ) . ( n + 2 ) ) = ( card ( derangements sn2 ) ) by A20,CKB20:def 1,A15,A16;
end;
(for n being Nat holds P[ n ]) from FIB_NUM:sch 1(A1,A3,A5);
hence thesis;
end;
