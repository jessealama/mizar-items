environ
vocabularies STRUCT_0,XBOOLE_0,MSUALG_1,FUNCT_1,RELAT_1,PBOOLE,FUNCOP_1,EQREL_1,SUBSET_1,NAT_1,MARGREL1,PARTFUN1,FINSEQ_1,TARSKI,CARD_3,MSUALG_3,WELLORD1,MSUALG_4;
notations TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,RELSET_1,PARTFUN1,EQREL_1,STRUCT_0,NAT_1,FUNCT_2,FINSEQ_1,FINSEQ_2,CARD_3,PBOOLE,FUNCOP_1,MSUALG_1,MSUALG_3,CKB2,CKB4,CKB5,CKB6,CKB7,CKB8,CKB11,CKB13,CKB14,CKB15,CKB16,CKB17,CKB20,CKB21,CKB22,CKB23,CKB24,CKB26,CKB27,CKB28,CKB30,CKB31,CKB33;
definitions TARSKI,MSUALG_3,XBOOLE_0,FUNCOP_1,CKB2,CKB5,CKB8,CKB11,CKB15,CKB16,CKB20,CKB21,CKB22,CKB23,CKB24,CKB26,CKB27,CKB28,CKB30,CKB31,CKB33;
theorems FUNCT_1,FUNCT_2,PBOOLE,CARD_3,MSUALG_1,ZFMISC_1,RELAT_1,RELSET_1,EQREL_1,MSUALG_3,MSAFREE,TARSKI,XBOOLE_0,FUNCOP_1,ORDINAL1,PARTFUN1,FINSEQ_2,CKB2,CKB5,CKB8,CKB10,CKB11,CKB15,CKB16,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB30,CKB31,CKB32,CKB33;
schemes FUNCT_1,CLASSES1,EQREL_1;
registrations RELAT_1,FUNCT_1,PARTFUN1,FUNCOP_1,PBOOLE,STRUCT_0,MSUALG_1,MSUALG_3,CARD_3,RELSET_1,FINSEQ_2,FINSEQ_1,CKB1,CKB3,CKB9,CKB12,CKB18,CKB19,CKB29;
constructors EQREL_1,PRALG_2,MSUALG_3,RELSET_1,CKB2,CKB5,CKB6,CKB8,CKB11,CKB14,CKB15,CKB16,CKB17,CKB20,CKB21,CKB22,CKB23,CKB24,CKB26,CKB27,CKB28,CKB30,CKB31,CKB33;
requirements SUBSET,BOOLE;
begin
reserve S for non  void non  empty ManySortedSign;
reserve U1 for MSAlgebra over S;
reserve o for (OperSymbol of S);
definition
let S;
let U1 being  non-empty MSAlgebra over S;
let U2 being  non-empty MSAlgebra over S;
let F being (ManySortedFunction of U1,U2);
assume A1: F is_homomorphism U1,U2;
func MSCng F -> (MSCongruence of U1) means 
:Def20: (for s being (SortSymbol of S) holds ( it . s ) = ( MSCng (F,s) ));
existence
proof
deffunc F((Element of S)) = ( MSCng (F,$1) );
consider f being Function such that A2: (( dom f ) = (the carrier of S) & (for d being (Element of S) holds ( f . d ) = F(d))) from FUNCT_1:sch 4;
reconsider f as (ManySortedSet of (the carrier of S)) by A2,PARTFUN1:def 2,RELAT_1:def 18;
(for x being set holds (x in ( dom f ) implies ( f . x ) is Relation))
proof
let x being set;
assume x in ( dom f );
then reconsider s = x as (Element of S) by A2;
( f . s ) = ( MSCng (F,s) ) by A2;
hence thesis;
end;
(for i being set holds (i in (the carrier of S) implies ( f . i ) is (Relation of ( (the Sorts of U1) . i ),( (the Sorts of U1) . i ))))
proof
let i being set;
assume i in (the carrier of S);
then reconsider s = i as (Element of S);
( f . i ) = ( MSCng (F,s) ) by A2;
hence thesis;
end;
then reconsider f as (ManySortedRelation of (the Sorts of U1)) by CKB2:def 1;
reconsider f as (ManySortedRelation of U1);
(for i being set holds (for R being (Relation of ( (the Sorts of U1) . i )) holds ((i in (the carrier of S) & ( f . i ) = R) implies R is (Equivalence_Relation of ( (the Sorts of U1) . i )))))
proof
let i being set;
let R being (Relation of ( (the Sorts of U1) . i ));
assume that
A3: i in (the carrier of S)
and
A4: ( f . i ) = R;
reconsider s = i as (Element of S) by A3;
R = ( MSCng (F,s) ) by A2,A4;
hence thesis;
end;
then f is  MSEquivalence_Relation-like by CKB5:def 1;
then reconsider f as  MSEquivalence-like (ManySortedRelation of U1) by CKB8:def 1;
(for o being (OperSymbol of S) holds (for x,y being (Element of ( Args (o,U1) )) holds ((for n being Nat holds (n in ( dom x ) implies [ ( x . n ),( y . n ) ] in ( f . ( ( the_arity_of o ) /. n ) ))) implies [ ( ( Den (o,U1) ) . x ),( ( Den (o,U1) ) . y ) ] in ( f . ( the_result_sort_of o ) ))))
proof
let o being (OperSymbol of S);
let x being (Element of ( Args (o,U1) ));
let y being (Element of ( Args (o,U1) ));
set ao = ( the_arity_of o );
set ro = ( the_result_sort_of o );
set S1 = (the Sorts of U1);
A5: ( dom x ) = ( dom ( the_arity_of o ) ) by MSUALG_3:6;
A6: ( dom y ) = ( dom ( the_arity_of o ) ) by MSUALG_3:6;
assume A7: (for n being Nat holds (n in ( dom x ) implies [ ( x . n ),( y . n ) ] in ( f . ( ( the_arity_of o ) /. n ) )));
A8:now
let n being set;
assume A9: n in ( dom ( the_arity_of o ) );
then reconsider m = n as Nat by ORDINAL1:def 12;
A10: (( ( F # x ) . m ) = ( ( F . ( ao /. m ) ) . ( x . m ) ) & ( ( F # y ) . m ) = ( ( F . ( ao /. m ) ) . ( y . m ) )) by A5,A6,A9,MSUALG_3:def 6;
( ao . m ) in ( rng ao ) by A9,FUNCT_1:def 3;
then reconsider s = ( ao . m ) as (SortSymbol of S);
A11: n in ( dom ( S1 * ao ) ) by A9,PARTFUN1:def 2;
then (( x . m ) in ( ( S1 * ao ) . n ) & ( y . m ) in ( ( S1 * ao ) . n )) by MSUALG_3:6;
then reconsider x1 = ( x . m ),y1 = ( y . m ) as (Element of ( S1 . s )) by A11,FUNCT_1:12;
A12: [ x1,y1 ] in ( f . ( ao /. m ) ) by A7,A5,A9;
A13: ( ao /. m ) = ( ao . m ) by A9,PARTFUN1:def 6;
then ( f . ( ao /. m ) ) = ( MSCng (F,s) ) by A2;
hence ( ( F # x ) . n ) = ( ( F # y ) . n ) by A10,A13,A12,CKB33:def 1;
end;
(( dom ( F # x ) ) = ( dom ( the_arity_of o ) ) & ( dom ( F # y ) ) = ( dom ( the_arity_of o ) )) by MSUALG_3:6;
then A14: ( F # x ) = ( F # y ) by A8,FUNCT_1:2;
reconsider ro as (SortSymbol of S);
A15: ( dom (the ResultSort of S) ) = (the carrier' of S) by FUNCT_2:def 1;
then A16: ( dom ( (the Sorts of U1) * (the ResultSort of S) ) ) = ( dom (the ResultSort of S) ) by PARTFUN1:def 2;
( Result (o,U1) ) = ( ( (the Sorts of U1) * (the ResultSort of S) ) . o ) by MSUALG_1:def 5
.= ( (the Sorts of U1) . ( (the ResultSort of S) . o ) ) by A15,A16,FUNCT_1:12
.= ( (the Sorts of U1) . ro ) by MSUALG_1:def 2;
then reconsider Dx = ( ( Den (o,U1) ) . x ),Dy = ( ( Den (o,U1) ) . y ) as (Element of ( (the Sorts of U1) . ro ));
A17: ( ( F . ro ) . Dy ) = ( ( Den (o,U2) ) . ( F # y ) ) by A1,MSUALG_3:def 7;
(( f . ro ) = ( MSCng (F,ro) ) & ( ( F . ro ) . Dx ) = ( ( Den (o,U2) ) . ( F # x ) )) by A1,A2,MSUALG_3:def 7;
hence thesis by A14,A17,CKB33:def 1;
end;
then reconsider f as (MSCongruence of U1) by CKB11:def 1;
take f;
thus thesis by A2;
end;
uniqueness
proof
let C1 being (MSCongruence of U1);
let C2 being (MSCongruence of U1);
assume that
A18: (for s being (SortSymbol of S) holds ( C1 . s ) = ( MSCng (F,s) ))
and
A19: (for s being (SortSymbol of S) holds ( C2 . s ) = ( MSCng (F,s) ));
now
let i being set;
assume i in (the carrier of S);
then reconsider s = i as (Element of S);
( C1 . s ) = ( MSCng (F,s) ) by A18;
hence ( C1 . i ) = ( C2 . i ) by A19;
end;
hence thesis by PBOOLE:3;
end;
end;
