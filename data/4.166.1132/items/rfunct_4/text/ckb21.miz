environ
vocabularies NUMBERS,REAL_1,PARTFUN1,SUBSET_1,XREAL_0,ORDINAL1,XXREAL_0,FINSEQ_2,RVSUM_1,ORDINAL4,FINSEQ_1,RELAT_1,ARYTM_3,NAT_1,FUNCT_1,CARD_3,CARD_1,TARSKI,ARYTM_1,RFUNCT_3,XXREAL_1,VALUED_1,XBOOLE_0,BINOP_2,MEASURE5,FCONT_1,COMPLEX1,ORDINAL2,RFUNCT_4;
notations TARSKI,XBOOLE_0,SUBSET_1,ORDINAL1,NUMBERS,XCMPLX_0,XREAL_0,RELAT_1,COMPLEX1,NAT_1,FUNCT_1,FINSEQ_1,REAL_1,FINSEQ_2,PARTFUN1,FINSEQOP,BINOP_2,VALUED_1,SEQ_1,RVSUM_1,RCOMP_1,RFUNCT_3,MEASURE5,FCONT_1,XXREAL_0,CKB6;
definitions FINSEQ_2,RVSUM_1,CKB6;
theorems RCOMP_1,RFUNCT_3,TARSKI,PARTFUN1,FINSEQ_1,FINSEQ_2,RVSUM_1,NAT_1,FCONT_1,ABSVALUE,FUNCT_1,XREAL_0,XBOOLE_1,XCMPLX_0,XCMPLX_1,XREAL_1,COMPLEX1,XXREAL_0,FINSEQOP,FUNCOP_1,VALUED_1,XXREAL_2,RELAT_1,CARD_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20;
schemes NAT_1;
registrations RELSET_1,NUMBERS,XXREAL_0,XREAL_0,BINOP_2,MEMBERED,FINSEQ_2,XBOOLE_0,VALUED_0,CARD_1,FINSEQ_1;
constructors BINOP_1,REAL_1,NAT_1,BINOP_2,COMPLEX1,FINSEQOP,RCOMP_1,RVSUM_1,FCONT_1,RFUNCT_3,MEASURE5,SEQ_1,XXREAL_2,RELSET_1,CKB6;
requirements NUMERALS,SUBSET,REAL,BOOLE,ARITHM;
begin
reserve r for Real;
reserve s for Real;
reserve f for (PartFunc of ( REAL ),( REAL ));
theorem
(for f being (PartFunc of ( REAL ),( REAL )) holds (f is  total implies ((for n being (Element of ( NAT )) holds (for P,E,F being (Element of ( n -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) )))) iff f is_convex_on ( REAL ))))
proof
let f being (PartFunc of ( REAL ),( REAL ));
A1: (f is_convex_on ( REAL ) implies (for n being (Element of ( NAT )) holds (for P,E,F being (Element of ( n -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) )))))
proof
assume A2: f is_convex_on ( REAL );
(for n being (Element of ( NAT )) holds (for P,E,F being (Element of ( n -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) ))))
proof
defpred S[ (Element of ( NAT )) ]
 means
(for P,E,F being (Element of ( $1 -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) )));
A3: (for k being (Element of ( NAT )) holds (S[ k ] implies S[ ( k + 1 ) ]))
proof
let k being (Element of ( NAT ));
assume that
A4: (for P,E,F being (Element of ( k -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) )));
(for P,E,F being (Element of ( ( k + 1 ) -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) )))
proof
let P being (Element of ( ( k + 1 ) -tuples_on ( REAL ) ));
let E being (Element of ( ( k + 1 ) -tuples_on ( REAL ) ));
let F being (Element of ( ( k + 1 ) -tuples_on ( REAL ) ));
assume that
A5: ( Sum P ) = 1
and
A6: (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))));
consider E1 being (Element of ( k -tuples_on ( REAL ) )),e1 being Real such that A7: E = ( E1 ^ <* e1 *> ) by FINSEQ_2:117;
consider F1 being (Element of ( k -tuples_on ( REAL ) )),f1 being Real such that A8: F = ( F1 ^ <* f1 *> ) by FINSEQ_2:117;
( ( len F1 ) + 1 ) = ( k + 1 ) by CARD_1:def 7
.= ( len P ) by CARD_1:def 7;
then ( ( len F1 ) + 1 ) in ( Seg ( len P ) ) by FINSEQ_1:4;
then A9: ( ( len F1 ) + 1 ) in ( dom P ) by FINSEQ_1:def 3;
A10: f1 = ( F . ( ( len F1 ) + 1 ) ) by A8,FINSEQ_1:42
.= ( f . ( E . ( ( len F1 ) + 1 ) ) ) by A6,A9
.= ( f . ( E . ( k + 1 ) ) ) by CARD_1:def 7
.= ( f . ( E . ( ( len E1 ) + 1 ) ) ) by CARD_1:def 7
.= ( f . e1 ) by A7,FINSEQ_1:42;
consider P1 being (Element of ( k -tuples_on ( REAL ) )),p1 being Real such that A11: P = ( P1 ^ <* p1 *> ) by FINSEQ_2:117;
( mlt (P,F) ) = ( ( mlt (P1,F1) ) ^ <* ( p1 * f1 ) *> ) by A11,A8,CKB2:1;
then A12: ( Sum ( mlt (P,F) ) ) = ( ( 1 * ( Sum ( mlt (P1,F1) ) ) ) + ( p1 * f1 ) ) by RVSUM_1:74;
( mlt (P,E) ) = ( ( mlt (P1,E1) ) ^ <* ( p1 * e1 ) *> ) by A11,A7,CKB2:1;
then A13: ( Sum ( mlt (P,E) ) ) = ( ( 1 * ( Sum ( mlt (P1,E1) ) ) ) + ( p1 * e1 ) ) by RVSUM_1:74;
A14: (for i being Nat holds (i in ( dom P1 ) implies ( P1 . i ) >= ( 0 )))
proof
let i being Nat;
assume that
A15: i in ( dom P1 );
A16: i in ( Seg ( len P1 ) ) by A15,FINSEQ_1:def 3;
then A17: 1 <= i by FINSEQ_1:1;
i <= ( len P1 ) by A16,FINSEQ_1:1;
then A18: i <= k by CARD_1:def 7;
k <= ( k + 1 ) by NAT_1:11;
then i <= ( k + 1 ) by A18,XXREAL_0:2;
then i in ( Seg ( k + 1 ) ) by A17,FINSEQ_1:1;
then i in ( Seg ( len P ) ) by CARD_1:def 7;
then A19: i in ( dom P ) by FINSEQ_1:def 3;
( P1 . i ) = ( P . i ) by A11,A15,FINSEQ_1:def 7;
hence thesis by A6,A19;
end;
then A20: (for i being (Element of ( NAT )) holds (i in ( dom P1 ) implies ( P1 . i ) >= ( 0 )));
now
per cases ;
suppose A21: ( Sum P1 ) = ( 0 );

then (for i being (Element of ( NAT )) holds (i in ( dom P1 ) implies ( P1 . i ) = ( 0 ))) by A20,CKB3:1;
then A22: P1 = ( k |-> (( 0 ) qua Real) ) by CKB4:1;
then ( mlt (P1,E1) ) = ( k |-> ( 0 ) ) by CKB5:1;
then A23: ( Sum ( mlt (P1,E1) ) ) = ( k * ( 0 ) ) by RVSUM_1:80;
( mlt (P1,F1) ) = ( k |-> ( 0 ) ) by A22,CKB5:1;
then A24: ( Sum ( mlt (P1,F1) ) ) = ( k * ( 0 ) ) by RVSUM_1:80;
( Sum P ) = ( ( 0 ) + p1 ) by A11,A21,RVSUM_1:74;
hence thesis by A5,A13,A12,A10,A23,A24;
end;
suppose A25: ( Sum P1 ) <> ( 0 );

A26: ( 0 ) <= ( Sum P1 ) by A14,RVSUM_1:84;
A27: (for i being (Element of ( NAT )) holds (i in ( dom ( ( ( Sum P1 ) " ) * P1 ) ) implies (( ( ( ( Sum P1 ) " ) * P1 ) . i ) >= ( 0 ) & ( F1 . i ) = ( f . ( E1 . i ) ))))
proof
let i being (Element of ( NAT ));
assume i in ( dom ( ( ( Sum P1 ) " ) * P1 ) );
then A28: i in ( Seg ( len ( ( ( Sum P1 ) " ) * P1 ) ) ) by FINSEQ_1:def 3;
then A29: i in ( Seg k ) by CARD_1:def 7;
then A30: i in ( Seg ( len P1 ) ) by CARD_1:def 7;
then i <= ( len P1 ) by FINSEQ_1:1;
then A31: i <= k by CARD_1:def 7;
A32: 1 <= i by A28,FINSEQ_1:1;
k <= ( k + 1 ) by NAT_1:11;
then i <= ( k + 1 ) by A31,XXREAL_0:2;
then i in ( Seg ( k + 1 ) ) by A32,FINSEQ_1:1;
then i in ( Seg ( len P ) ) by CARD_1:def 7;
then A33: i in ( dom P ) by FINSEQ_1:def 3;
i in ( dom P1 ) by A30,FINSEQ_1:def 3;
then (( ( ( ( Sum P1 ) " ) * P1 ) . i ) = ( ( ( Sum P1 ) " ) * ( P1 . i ) ) & ( P1 . i ) >= ( 0 )) by A14,RVSUM_1:45;
hence ( ( ( ( Sum P1 ) " ) * P1 ) . i ) >= ( 0 ) by A26;
i in ( Seg ( len E1 ) ) by A29,CARD_1:def 7;
then i in ( dom E1 ) by FINSEQ_1:def 3;
then A34: ( E . i ) = ( E1 . i ) by A7,FINSEQ_1:def 7;
i in ( Seg ( len F1 ) ) by A29,CARD_1:def 7;
then i in ( dom F1 ) by FINSEQ_1:def 3;
then ( F . i ) = ( F1 . i ) by A8,FINSEQ_1:def 7;
hence thesis by A6,A33,A34;
end;
A35: ( Sum ( mlt (P,E) ) ) = ( ( ( ( Sum P1 ) * ( ( Sum P1 ) " ) ) * ( Sum ( mlt (P1,E1) ) ) ) + ( p1 * e1 ) ) by A13,A25,XCMPLX_0:def 7
.= ( ( ( Sum P1 ) * ( ( ( Sum P1 ) " ) * ( Sum ( mlt (P1,E1) ) ) ) ) + ( p1 * e1 ) )
.= ( ( ( Sum P1 ) * ( Sum ( ( ( Sum P1 ) " ) * ( mlt (P1,E1) ) ) ) ) + ( p1 * e1 ) ) by RVSUM_1:87
.= ( ( ( Sum P1 ) * ( Sum ( mlt (( ( ( Sum P1 ) " ) * P1 ),E1) ) ) ) + ( p1 * e1 ) ) by FINSEQOP:26;
A36: ( ( ( Sum P1 ) " ) * ( Sum ( mlt (P1,F1) ) ) ) = ( Sum ( ( ( Sum P1 ) " ) * ( mlt (P1,F1) ) ) ) by RVSUM_1:87
.= ( Sum ( mlt (( ( ( Sum P1 ) " ) * P1 ),F1) ) ) by FINSEQOP:26;
( ( len P1 ) + 1 ) = ( len P ) by A11,FINSEQ_2:16;
then ( ( len P1 ) + 1 ) in ( Seg ( len P ) ) by FINSEQ_1:4;
then A37: ( ( len P1 ) + 1 ) in ( dom P ) by FINSEQ_1:def 3;
( ( Sum P1 ) + p1 ) = 1 by A5,A11,RVSUM_1:74;
then A38: p1 = ( 1 - ( Sum P1 ) );
( Sum ( ( ( Sum P1 ) " ) * P1 ) ) = ( ( ( Sum P1 ) " ) * ( Sum P1 ) ) by RVSUM_1:87
.= 1 by A25,XCMPLX_0:def 7;
then ( ( Sum P1 ) * ( f . ( Sum ( mlt (( ( ( Sum P1 ) " ) * P1 ),E1) ) ) ) ) <= ( ( Sum P1 ) * ( ( ( Sum P1 ) " ) * ( Sum ( mlt (P1,F1) ) ) ) ) by A4,A26,A36,A27,XREAL_1:64;
then A39: ( ( ( Sum P1 ) * ( f . ( Sum ( mlt (( ( ( Sum P1 ) " ) * P1 ),E1) ) ) ) ) + ( p1 * ( f . e1 ) ) ) <= ( ( ( Sum P1 ) * ( ( ( Sum P1 ) " ) * ( Sum ( mlt (P1,F1) ) ) ) ) + ( p1 * ( f . e1 ) ) ) by XREAL_1:6;
( P . ( ( len P1 ) + 1 ) ) = p1 by A11,FINSEQ_1:42;
then ( Sum P1 ) <= 1 by A6,A38,A37,XREAL_1:49;
then ( f . ( Sum ( mlt (P,E) ) ) ) <= ( ( ( Sum P1 ) * ( f . ( Sum ( mlt (( ( ( Sum P1 ) " ) * P1 ),E1) ) ) ) ) + ( p1 * ( f . e1 ) ) ) by A2,A35,A38,A26,RFUNCT_3:def 12;
then ( f . ( Sum ( mlt (P,E) ) ) ) <= ( ( ( ( Sum P1 ) * ( ( Sum P1 ) " ) ) * ( Sum ( mlt (P1,F1) ) ) ) + ( p1 * ( f . e1 ) ) ) by A39,XXREAL_0:2;
hence thesis by A12,A10,A25,XCMPLX_0:def 7;
end;
end;
hence thesis;
end;
hence thesis;
end;
A40: S[ ( 0 ) ] by RVSUM_1:79;
(for k being (Element of ( NAT )) holds S[ k ]) from NAT_1:sch 1(A40,A3);
hence thesis;
end;
hence thesis;
end;
assume f is  total;
then A41: ( REAL ) c= ( dom f ) by PARTFUN1:def 2;
((for n being (Element of ( NAT )) holds (for P,E,F being (Element of ( n -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) )))) implies f is_convex_on ( REAL ))
proof
assume A42: (for n being (Element of ( NAT )) holds (for P,E,F being (Element of ( n -tuples_on ( REAL ) )) holds ((( Sum P ) = 1 & (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))) implies ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) ))));
(for p being Real holds ((( 0 ) <= p & p <= 1) implies (for r,s being Real holds (((r in ( REAL ) & s in ( REAL )) & ( ( p * r ) + ( ( 1 - p ) * s ) ) in ( REAL )) implies ( f . ( ( p * r ) + ( ( 1 - p ) * s ) ) ) <= ( ( p * ( f . r ) ) + ( ( 1 - p ) * ( f . s ) ) )))))
proof
let p being Real;
assume that
A43: ( 0 ) <= p
and
A44: p <= 1;
let r being Real;
let s being Real;
assume that
r in ( REAL )
and
s in ( REAL )
and
( ( p * r ) + ( ( 1 - p ) * s ) ) in ( REAL );
reconsider P = <* p,( 1 - p ) *>,E = <* r,s *>,F = <* ( f . r ),( f . s ) *> as (Element of ( 2 -tuples_on ( REAL ) )) by FINSEQ_2:101;
A45: (for i being (Element of ( NAT )) holds (i in ( dom P ) implies (( P . i ) >= ( 0 ) & ( F . i ) = ( f . ( E . i ) ))))
proof
A46: ( dom P ) = ( Seg ( len P ) ) by FINSEQ_1:def 3
.= ( Seg 2 ) by CARD_1:def 7;
let i being (Element of ( NAT ));
assume that
A47: i in ( dom P );
now
per cases  by A47,A46,FINSEQ_1:2,TARSKI:def 2;
suppose A48: i = 1;

then ( E . i ) = r by FINSEQ_1:44;
hence thesis by A43,A48,FINSEQ_1:44;
end;
suppose A49: i = 2;

then (( E . i ) = s & ( P . i ) = ( 1 - p )) by FINSEQ_1:44;
hence thesis by A44,A49,FINSEQ_1:44,XREAL_1:48;
end;
end;
hence thesis;
end;
( Sum P ) = ( p + ( 1 - p ) ) by RVSUM_1:77
.= 1;
then A50: ( f . ( Sum ( mlt (P,E) ) ) ) <= ( Sum ( mlt (P,F) ) ) by A42,A45;
A51: (( P . 1 ) = p & ( P . 2 ) = ( 1 - p )) by FINSEQ_1:44;
( len P ) = 2 by FINSEQ_1:44
.= ( len E ) by FINSEQ_1:44;
then ( len ( ( multreal ) .: (P,E) ) ) = ( len P ) by FINSEQ_2:72;
then A52: ( len ( mlt (P,E) ) ) = 2 by FINSEQ_1:44;
A53: (( ( mlt (P,E) ) . 1 ) = ( ( P . 1 ) * ( E . 1 ) ) & ( ( mlt (P,E) ) . 2 ) = ( ( P . 2 ) * ( E . 2 ) )) by RVSUM_1:60;
(( E . 1 ) = r & ( E . 2 ) = s) by FINSEQ_1:44;
then ( mlt (P,E) ) = <* ( p * r ),( ( 1 - p ) * s ) *> by A51,A52,A53,FINSEQ_1:44;
then A54: ( Sum ( mlt (P,E) ) ) = ( ( p * r ) + ( ( 1 - p ) * s ) ) by RVSUM_1:77;
A55: (( ( mlt (P,F) ) . 1 ) = ( ( P . 1 ) * ( F . 1 ) ) & ( ( mlt (P,F) ) . 2 ) = ( ( P . 2 ) * ( F . 2 ) )) by RVSUM_1:60;
( len P ) = 2 by FINSEQ_1:44
.= ( len F ) by FINSEQ_1:44;
then ( len ( ( multreal ) .: (P,F) ) ) = ( len P ) by FINSEQ_2:72;
then A56: ( len ( mlt (P,F) ) ) = 2 by FINSEQ_1:44;
(( F . 1 ) = ( f . r ) & ( F . 2 ) = ( f . s )) by FINSEQ_1:44;
then ( mlt (P,F) ) = <* ( p * ( f . r ) ),( ( 1 - p ) * ( f . s ) ) *> by A51,A56,A55,FINSEQ_1:44;
hence thesis by A50,A54,RVSUM_1:77;
end;
hence thesis by A41,RFUNCT_3:def 12;
end;
hence thesis by A1;
end;
