environ
vocabularies MSAFREE2,STRUCT_0,XBOOLE_0,MSUALG_1,RELAT_1,PBOOLE,MSAFREE,FUNCOP_1,FUNCT_1,TREES_3,FINSEQ_1,SUBSET_1,TREES_4,MSUALG_3,MARGREL1,FINSEQ_4,TARSKI,DTCONSTR,NAT_1,NUMBERS,TREES_2,CARD_3,PARTFUN1,ZFMISC_1,TDGROUP,CIRCUIT1,FSM_1,FUNCT_4,GLIB_000,UNIALG_2,MSATERM,PRELAMB,REALSET1,CARD_1,XXREAL_0,ARYTM_3,FUNCT_6,TREES_A,FINSET_1,CIRCUIT2;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,CARD_1,NUMBERS,RELAT_1,FUNCT_1,PARTFUN1,FUNCT_2,FUNCT_4,XXREAL_0,NAT_1,FINSEQ_1,FINSEQ_2,FINSET_1,TREES_2,TREES_3,TREES_4,CARD_3,FUNCT_6,LANG1,DTCONSTR,PBOOLE,FUNCOP_1,XXREAL_2,STRUCT_0,PRALG_1,MSUALG_1,MSUALG_2,MSUALG_3,MSAFREE,MSAFREE2,CIRCUIT1,MSATERM,CKB3,CKB4,CKB5;
definitions PBOOLE,MSAFREE2,CKB4,CKB5;
theorems TARSKI,NAT_1,FINSEQ_1,FINSEQ_2,FINSEQ_3,RELAT_1,GRFUNC_1,FUNCT_1,FUNCT_2,FUNCT_4,TREES_3,TREES_4,DTCONSTR,FUNCT_6,ZFMISC_1,CARD_3,MSATERM,PARTFUN2,FUNCOP_1,PBOOLE,PRALG_1,MSUALG_1,MSUALG_2,MSUALG_3,MSAFREE,PRE_CIRC,MSAFREE2,CIRCUIT1,TREES_1,EXTENS_1,RELSET_1,XBOOLE_0,XBOOLE_1,ORDINAL1,XXREAL_0,PARTFUN1,XXREAL_2,CARD_1,CKB1,CKB2,CKB4,CKB5,CKB6,CKB7;
schemes NAT_1,FINSEQ_1,PRE_CIRC,PBOOLE;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FUNCOP_1,FINSET_1,XREAL_0,MEMBERED,FINSEQ_1,CARD_3,TREES_3,PRE_CIRC,STRUCT_0,DTCONSTR,MSUALG_1,MSUALG_3,MSAFREE,MSAFREE2,CIRCUIT1,XXREAL_2,CARD_1,RELSET_1,PBOOLE;
constructors XXREAL_0,NAT_1,PRALG_1,MSUALG_3,MSATERM,CIRCUIT1,SEQ_1,SEQ_4,XXREAL_2,RELSET_1,FUNCT_4,FINSEQ_2,CKB3,CKB4,CKB5;
requirements NUMERALS,BOOLE,SUBSET;
begin
reserve IIG for  monotonic  Circuit-like non void non empty ManySortedSign;
theorem
Th4: (for A being  non-empty (Circuit of IIG) holds (for iv being (InputValues of A) holds (for v being (Vertex of IIG) holds (for e being (Element of ( (the Sorts of ( FreeEnv A )) . v )) holds (for p,q being  DTree-yielding FinSequence holds ((((v in ( InnerVertices IIG ) & e = ( [ ( action_at v ),(the carrier of IIG) ] -tree p )) & ( dom p ) = ( dom q )) & (for k being (Element of ( NAT )) holds (k in ( dom p ) implies ( q . k ) = ( ( ( Fix_inp_ext iv ) . ( ( the_arity_of ( action_at v ) ) /. k ) ) . ( p . k ) )))) implies ( ( ( Fix_inp_ext iv ) . v ) . e ) = ( [ ( action_at v ),(the carrier of IIG) ] -tree q )))))))
proof
let A being  non-empty (Circuit of IIG);
let iv being (InputValues of A);
let v being (Vertex of IIG);
let e being (Element of ( (the Sorts of ( FreeEnv A )) . v ));
let p being  DTree-yielding FinSequence,q being  DTree-yielding FinSequence;
assume that
A1: v in ( InnerVertices IIG )
and
A2: e = ( [ ( action_at v ),(the carrier of IIG) ] -tree p )
and
A3: ( dom p ) = ( dom q )
and
A4: (for k being (Element of ( NAT )) holds (k in ( dom p ) implies ( q . k ) = ( ( ( Fix_inp_ext iv ) . ( ( the_arity_of ( action_at v ) ) /. k ) ) . ( p . k ) )));
set o = ( action_at v );
A5: ( the_result_sort_of o ) = v by A1,MSAFREE2:def 7;
then A6: ( len p ) = ( len ( the_arity_of o ) ) by A2,MSAFREE2:10;
A7:now
let k being Nat;
assume A8: k in ( dom q );
then A9: k in ( dom ( the_arity_of o ) ) by A3,A6,FINSEQ_3:29;
then ( p . k ) in ( (the Sorts of ( FreeEnv A )) . ( ( the_arity_of o ) . k ) ) by A2,A5,MSAFREE2:11;
then A10: ( p . k ) in ( (the Sorts of ( FreeEnv A )) . ( ( the_arity_of o ) /. k ) ) by A9,PARTFUN1:def 6;
( q . k ) = ( ( ( Fix_inp_ext iv ) . ( ( the_arity_of o ) /. k ) ) . ( p . k ) ) by A3,A4,A8;
hence ( q . k ) in ( (the Sorts of ( FreeEnv A )) . ( ( the_arity_of o ) /. k ) ) by A10,FUNCT_2:5;
end;
A11:now
let k being Nat;
assume k in ( dom p );
then A12: k in ( dom ( the_arity_of o ) ) by A6,FINSEQ_3:29;
then ( p . k ) in ( (the Sorts of ( FreeEnv A )) . ( ( the_arity_of o ) . k ) ) by A2,A5,MSAFREE2:11;
hence ( p . k ) in ( (the Sorts of ( FreeEnv A )) . ( ( the_arity_of o ) /. k ) ) by A12,PARTFUN1:def 6;
end;
then reconsider x = p as (Element of ( Args (o,( FreeEnv A )) )) by A6,MSAFREE2:5;
A13: ( FreeEnv A ) = MSAlgebra (# ( FreeSort (the Sorts of A) ),( FreeOper (the Sorts of A) ) #) by MSAFREE:def 14;
then A14: ( Args (o,( FreeEnv A )) ) = ( ( ( ( FreeSort (the Sorts of A) ) # ) * (the Arity of IIG) ) . o ) by MSUALG_1:def 4;
then reconsider pp = p as (FinSequence of ( TS ( DTConMSA (the Sorts of A) ) )) by A6,A11,MSAFREE:8,MSAFREE2:5;
p in ( Args (o,( FreeEnv A )) ) by A6,A11,MSAFREE2:5;
then A15: ( Sym (o,(the Sorts of A)) ) ==> ( roots pp ) by A14,MSAFREE:10;
A16: ( len q ) = ( len ( the_arity_of o ) ) by A3,A6,FINSEQ_3:29;
then reconsider y = q as (Element of ( Args (o,( FreeEnv A )) )) by A7,MSAFREE2:5;
A17: ( Fix_inp_ext iv ) is_homomorphism ( FreeEnv A ),( FreeEnv A ) by CKB5:def 1;
reconsider qq = q as (FinSequence of ( TS ( DTConMSA (the Sorts of A) ) )) by A14,A16,A7,MSAFREE:8,MSAFREE2:5;
q in ( Args (o,( FreeEnv A )) ) by A16,A7,MSAFREE2:5;
then A18: ( Sym (o,(the Sorts of A)) ) ==> ( roots qq ) by A14,MSAFREE:10;
(for k being Nat holds (k in ( dom p ) implies ( q . k ) = ( ( ( Fix_inp_ext iv ) . ( ( the_arity_of ( action_at v ) ) /. k ) ) . ( p . k ) ))) by A4;
then A19: y = ( ( Fix_inp_ext iv ) # x ) by MSUALG_3:def 6;
e = ( ( Sym (( action_at v ),(the Sorts of A)) ) -tree pp ) by A2,MSAFREE:def 9
.= ( ( DenOp (( action_at v ),(the Sorts of A)) ) . x ) by A15,MSAFREE:def 12
.= ( ( (the Charact of ( FreeEnv A )) . o ) . x ) by A13,MSAFREE:def 13
.= ( ( Den (( action_at v ),( FreeEnv A )) ) . x ) by MSUALG_1:def 6;
hence ( ( ( Fix_inp_ext iv ) . v ) . e ) = ( ( Den (( action_at v ),( FreeEnv A )) ) . q ) by A5,A19,A17,MSUALG_3:def 7
.= ( ( ( FreeOper (the Sorts of A) ) . o ) . q ) by A13,MSUALG_1:def 6
.= ( ( DenOp (( action_at v ),(the Sorts of A)) ) . q ) by MSAFREE:def 13
.= ( ( Sym (( action_at v ),(the Sorts of A)) ) -tree qq ) by A18,MSAFREE:def 12
.= ( [ ( action_at v ),(the carrier of IIG) ] -tree q ) by MSAFREE:def 9;
end;
