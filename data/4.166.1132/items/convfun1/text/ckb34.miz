environ
vocabularies NUMBERS,XBOOLE_0,RLVECT_1,BINOP_1,ZFMISC_1,STRUCT_0,SUBSET_1,FUNCT_1,ALGSTR_0,REAL_1,SUPINF_2,RELAT_1,ARYTM_3,XREAL_0,ORDINAL1,FINSEQ_1,CARD_3,CARD_1,XXREAL_0,TARSKI,PARTFUN1,ORDINAL4,BINOP_2,ARYTM_1,SUPINF_1,NAT_1,FUNCT_2,RFINSEQ,MEASURE6,CONVEX1,RFUNCT_3,FINSET_1,CLASSES1,CONVFUN1;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,ORDINAL1,NUMBERS,XXREAL_0,XREAL_0,REAL_1,FUNCT_1,RELSET_1,PARTFUN1,SUPINF_1,ZFMISC_1,MEASURE6,BINOP_1,FUNCT_2,SUPINF_2,SEQ_1,DOMAIN_1,BINOP_2,FINSET_1,CLASSES1,RFINSEQ,RFUNCT_3,NAT_1,RVSUM_1,EXTREAL1,FINSEQ_1,FINSEQ_4,STRUCT_0,ALGSTR_0,RLVECT_1,CONVEX1,CKB1,CKB2,CKB3,CKB13,CKB26,CKB27;
definitions BINOP_1,RLVECT_1,RVSUM_1,STRUCT_0,ALGSTR_0,MEASURE6,CKB1,CKB2,CKB3,CKB13,CKB26,CKB27;
theorems ZFMISC_1,BINOP_1,FUNCT_2,CONVEX1,SUPINF_2,EXTREAL1,RLVECT_1,RFUNCT_3,RVSUM_1,FINSEQ_1,FINSEQ_2,FINSEQ_3,FINSEQ_4,FINSEQ_5,NAT_1,TARSKI,FUNCT_1,CARD_2,INT_1,XCMPLX_1,XBOOLE_0,RFINSEQ,RLVECT_2,RELAT_1,XBOOLE_1,BINOP_2,XREAL_1,XXREAL_0,XREAL_0,FINSOP_1,PARTFUN1,ALGSTR_0,VALUED_1,XXREAL_3,CKB1,CKB2,CKB3,CKB5,CKB6,CKB12,CKB13,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33;
schemes BINOP_1,DOMAIN_1,FINSEQ_2,FRAENKEL,NAT_1,RECDEF_1;
registrations XBOOLE_0,SUBSET_1,ORDINAL1,RELSET_1,FUNCT_2,FINSET_1,NUMBERS,XXREAL_0,XREAL_0,NAT_1,MEMBERED,FINSEQ_1,STRUCT_0,RLVECT_1,VALUED_0,ALGSTR_0,CARD_1,XXREAL_3,CKB4,CKB7,CKB8,CKB9,CKB10,CKB11,CKB14;
constructors BINOP_1,DOMAIN_1,REAL_1,FINSEQ_4,FINSOP_1,RVSUM_1,SUPINF_2,RFINSEQ,RFUNCT_3,MEASURE6,EXTREAL1,CONVEX1,SEQ_1,BINOP_2,SUPINF_1,CLASSES1,RELSET_1,CKB1,CKB2,CKB3,CKB13,CKB26,CKB27;
requirements REAL,NUMERALS,BOOLE,SUBSET,ARITHM;
begin
theorem
Th13: (for X being RealLinearSpace holds (for f being (Function of (the carrier of X),( ExtREAL )) holds ((for x being (VECTOR of X) holds ( f . x ) <> ( -infty )) implies (f is  convex iff (for n being non empty (Element of ( NAT )) holds (for p being (FinSequence of ( REAL )) holds (for F being (FinSequence of ( ExtREAL )) holds (for y,z being (FinSequence of (the carrier of X)) holds ((((((( len p ) = n & ( len F ) = n) & ( len y ) = n) & ( len z ) = n) & ( Sum p ) = 1) & (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( z . i ) = ( ( p . i ) * ( y /. i ) )) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ))))) implies ( f . ( Sum z ) ) <= ( Sum F ))))))))))
proof
let X being RealLinearSpace;
let f being (Function of (the carrier of X),( ExtREAL ));
assume A1: (for x being (VECTOR of X) holds ( f . x ) <> ( -infty ));
thus (f is  convex implies (for n being non empty (Element of ( NAT )) holds (for p being (FinSequence of ( REAL )) holds (for F being (FinSequence of ( ExtREAL )) holds (for y,z being (FinSequence of (the carrier of X)) holds ((((((( len p ) = n & ( len F ) = n) & ( len y ) = n) & ( len z ) = n) & ( Sum p ) = 1) & (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( z . i ) = ( ( p . i ) * ( y /. i ) )) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ))))) implies ( f . ( Sum z ) ) <= ( Sum F )))))))
proof
assume A2: f is  convex;
let n being non empty (Element of ( NAT ));
let p being (FinSequence of ( REAL ));
let F being (FinSequence of ( ExtREAL ));
let y being (FinSequence of (the carrier of X)),z being (FinSequence of (the carrier of X));
assume that
A3: ( len p ) = n
and
A4: ( len F ) = n
and
( len y ) = n
and
A5: ( len z ) = n
and
A6: ( Sum p ) = 1
and
A7: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( z . i ) = ( ( p . i ) * ( y /. i ) )) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ))));
(for i being (Element of ( NAT )) holds (i in ( Seg n ) implies (( p . i ) >= ( 0 ) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) )))) by A7;
then A8: (not ( -infty ) in ( rng F )) by A1,A4,CKB33:1;
per cases ;
suppose A9: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ( f . ( y /. i ) ) <> ( +infty )));

defpred P[ set,set ]
 means
$2 = [ ( y /. $1 ),( f . ( y /. $1 ) ) ];
reconsider V = ( Prod_of_RLS (X,( RLS_Real )) ) as RealLinearSpace;
A10: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ( f . ( y /. i ) ) in ( REAL )))
proof
let i being (Element of ( NAT ));
assume i in ( Seg n );
then ( f . ( y /. i ) ) <> ( +infty ) by A9;
hence thesis by A1,XXREAL_0:14;
end;
A11: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies (ex v being (Element of V) st P[ i,v ])))
proof
let i being (Element of ( NAT ));
assume i in ( Seg n );
then reconsider w = ( f . ( y /. i ) ) as Real by A10;
set v = [ ( y /. i ),w ];
reconsider v as (Element of V);
take v;
thus thesis;
end;
consider g being (FinSequence of (the carrier of V)) such that A12: ( dom g ) = ( Seg n ) and A13: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies P[ i,( g /. i ) ])) from RECDEF_1:sch 17(A11);
A14: ( len g ) = n by A12,FINSEQ_1:def 3;
defpred P[ set,set ]
 means
$2 = ( F . $1 );
A15: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies (ex w being (Element of ( RLS_Real )) st P[ i,w ])))
proof
let i being (Element of ( NAT ));
assume A16: i in ( Seg n );
then reconsider a = ( f . ( y /. i ) ) as Real by A10;
( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ) by A7,A16;
then ( F . i ) = ( ( p . i ) * a ) by EXTREAL1:1;
then reconsider w = ( F . i ) as (Element of ( RLS_Real ));
take w;
thus thesis;
end;
consider F1 being (FinSequence of (the carrier of ( RLS_Real ))) such that A17: ( dom F1 ) = ( Seg n ) and A18: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies P[ i,( F1 /. i ) ])) from RECDEF_1:sch 17(A15);
A19: ( len F1 ) = n by A17,FINSEQ_1:def 3;
reconsider M = ( epigraph f ) as (Subset of V);
deffunc f(Nat) = ( ( p . $1 ) * ( g /. $1 ) );
consider G being (FinSequence of (the carrier of V)) such that A20: ( len G ) = n and A21: (for i being Nat holds (i in ( dom G ) implies ( G . i ) = f(i))) from FINSEQ_2:sch 1;
A22: ( dom G ) = ( Seg n ) by A20,FINSEQ_1:def 3;
A23: (for i being Nat holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( G . i ) = ( ( p . i ) * ( g /. i ) )) & ( g /. i ) in M)))
proof
let i being Nat;
assume A24: i in ( Seg n );
hence ( p . i ) > ( 0 ) by A7;
thus ( G . i ) = ( ( p . i ) * ( g /. i ) ) by A21,A22,A24;
reconsider w = ( f . ( y /. i ) ) as Real by A10,A24;
( f . ( y /. i ) ) = ( R_EAL w );
then [ ( y /. i ),w ] in { [ x,a ] where x is (Element of X),a is (Element of ( REAL )): ( f . x ) <= ( R_EAL a ) };
hence thesis by A13,A24;
end;
M is  convex by A2,CKB27:def 1;
then A25: ( Sum G ) in M by A3,A6,A14,A20,A23,CKB32:1;
A26: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ( F1 . i ) = ( F . i )))
proof
let i being (Element of ( NAT ));
assume A27: i in ( Seg n );
then ( F1 /. i ) = ( F1 . i ) by A17,PARTFUN1:def 6;
hence thesis by A18,A27;
end;
(for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ( G . i ) = [ ( z . i ),( F1 . i ) ]))
proof
let i being (Element of ( NAT ));
assume A28: i in ( Seg n );
then reconsider a = ( f . ( y /. i ) ) as Real by A10;
( g /. i ) = [ ( y /. i ),a ] by A13,A28;
then ( ( p . i ) * ( g /. i ) ) = [ ( ( p . i ) * ( y /. i ) ),( ( p . i ) * a ) ] by CKB15:1;
then ( G . i ) = [ ( ( p . i ) * ( y /. i ) ),( ( p . i ) * a ) ] by A21,A22,A28;
then A29: ( G . i ) = [ ( z . i ),( ( p . i ) * a ) ] by A7,A28;
( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ) by A7,A28;
then ( F . i ) = ( ( p . i ) * a ) by EXTREAL1:1;
hence thesis by A26,A28,A29;
end;
then ( Sum G ) = [ ( Sum z ),( Sum F1 ) ] by A5,A20,A19,CKB12:1;
then [ ( Sum z ),( Sum F ) ] in M by A4,A25,A26,A19,CKB22:1;
then consider x being (Element of X),w being (Element of ( REAL )) such that A30: [ ( Sum z ),( Sum F ) ] = [ x,w ] and A31: ( f . x ) <= ( R_EAL w );
x = ( Sum z ) by A30,ZFMISC_1:27;
hence thesis by A30,A31,ZFMISC_1:27;
end;
suppose (ex i being (Element of ( NAT )) st (i in ( Seg n ) & ( f . ( y /. i ) ) = ( +infty )));

then consider i being (Element of ( NAT )) such that A32: i in ( Seg n ) and A33: ( f . ( y /. i ) ) = ( +infty );
A34: ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ) by A7,A32;
A35: i in ( dom F ) by A4,A32,FINSEQ_1:def 3;
( p . i ) > ( 0 ) by A7,A32;
then ( F . i ) = ( +infty ) by A33,A34,XXREAL_3:def 5;
then ( Sum F ) = ( +infty ) by A8,A35,CKB20:1,FUNCT_1:3;
hence thesis by XXREAL_0:4;
end;
end;

thus ((for n being non empty (Element of ( NAT )) holds (for p being (FinSequence of ( REAL )) holds (for F being (FinSequence of ( ExtREAL )) holds (for y,z being (FinSequence of (the carrier of X)) holds ((((((( len p ) = n & ( len F ) = n) & ( len y ) = n) & ( len z ) = n) & ( Sum p ) = 1) & (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( z . i ) = ( ( p . i ) * ( y /. i ) )) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ))))) implies ( f . ( Sum z ) ) <= ( Sum F )))))) implies f is  convex)
proof
assume A36: (for n being non empty (Element of ( NAT )) holds (for p being (FinSequence of ( REAL )) holds (for F being (FinSequence of ( ExtREAL )) holds (for y,z being (FinSequence of (the carrier of X)) holds ((((((( len p ) = n & ( len F ) = n) & ( len y ) = n) & ( len z ) = n) & ( Sum p ) = 1) & (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( z . i ) = ( ( p . i ) * ( y /. i ) )) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ))))) implies ( f . ( Sum z ) ) <= ( Sum F ))))));
(for x1,x2 being (VECTOR of X) holds (for q being Real holds ((( 0 ) < q & q < 1) implies ( f . ( ( q * x1 ) + ( ( 1 - q ) * x2 ) ) ) <= ( ( ( R_EAL q ) * ( f . x1 ) ) + ( ( R_EAL ( 1 - q ) ) * ( f . x2 ) ) ))))
proof
set n = 2;
let x1 being (VECTOR of X),x2 being (VECTOR of X);
let q being Real;
assume that
A37: ( 0 ) < q
and
A38: q < 1;
reconsider F = <* ( ( R_EAL q ) * ( f . x1 ) ),( ( R_EAL ( 1 - q ) ) * ( f . x2 ) ) *> as (FinSequence of ( ExtREAL ));
reconsider z = <* ( q * x1 ),( ( 1 - q ) * x2 ) *> as (FinSequence of (the carrier of X));
reconsider y = <* x1,x2 *> as (FinSequence of (the carrier of X));
reconsider p = <* q,( 1 - q ) *> as (FinSequence of ( REAL ));
A39: (for i being (Element of ( NAT )) holds (i in ( Seg n ) implies ((( p . i ) > ( 0 ) & ( z . i ) = ( ( p . i ) * ( y /. i ) )) & ( F . i ) = ( ( R_EAL ( p . i ) ) * ( f . ( y /. i ) ) ))))
proof
let i being (Element of ( NAT ));
assume A40: i in ( Seg n );
per cases  by A40,FINSEQ_1:2,TARSKI:def 2;
suppose A41: i = 1;

then A42: ( y /. i ) = x1 by FINSEQ_4:17;
( p . i ) = q by A41,FINSEQ_1:44;
hence thesis by A37,A41,A42,FINSEQ_1:44;
end;
suppose A43: i = 2;

then A44: ( y /. i ) = x2 by FINSEQ_4:17;
( p . i ) = ( 1 - q ) by A43,FINSEQ_1:44;
hence thesis by A38,A43,A44,FINSEQ_1:44,XREAL_1:50;
end;
end;
A45: ( len p ) = n by FINSEQ_1:44;
A46: ( Sum p ) = ( q + ( 1 - q ) ) by RVSUM_1:77
.= 1;
A47: ( len z ) = n by FINSEQ_1:44;
A48: ( Sum z ) = ( ( q * x1 ) + ( ( 1 - q ) * x2 ) ) by RLVECT_1:45;
A49: ( len y ) = n by FINSEQ_1:44;
A50: ( len F ) = n by FINSEQ_1:44;
( Sum F ) = ( ( ( R_EAL q ) * ( f . x1 ) ) + ( ( R_EAL ( 1 - q ) ) * ( f . x2 ) ) ) by EXTREAL1:9;
hence thesis by A36,A45,A50,A49,A47,A46,A39,A48;
end;
hence thesis by A1,CKB29:1;
end;

end;
