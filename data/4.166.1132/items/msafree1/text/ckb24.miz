environ
vocabularies FUNCT_1,CARD_3,RELAT_1,TARSKI,XBOOLE_0,LANG1,SUBSET_1,DTCONSTR,TREES_4,FINSEQ_1,TDGROUP,TREES_3,TREES_2,STRUCT_0,MSUALG_1,PBOOLE,MSAFREE,ZFMISC_1,MARGREL1,PROB_2,NAT_1,PARTFUN1,MCART_1,MSUALG_3,MSAFREE1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NAT_1,RELAT_1,FUNCT_1,PARTFUN1,FUNCT_2,FINSEQ_2,STRUCT_0,MCART_1,FINSEQ_1,MULTOP_1,PROB_2,CARD_3,TREES_2,TREES_3,TREES_4,LANG1,DTCONSTR,PBOOLE,MSUALG_1,MSAFREE,MSUALG_3,CKB8,CKB10,CKB11;
definitions TARSKI,MSUALG_1,PBOOLE,PROB_2,CKB8,CKB10,CKB11;
theorems MSAFREE,MSUALG_3,LANG1,FINSEQ_1,CARD_3,PBOOLE,FUNCT_1,FUNCT_2,DTCONSTR,TARSKI,ZFMISC_1,PROB_2,CARD_5,RELAT_1,DOMAIN_1,MCART_1,XBOOLE_0,XBOOLE_1,PARTFUN1,FINSEQ_2,CKB1,CKB3,CKB4,CKB8,CKB9,CKB10,CKB11,CKB12,CKB16;
schemes DTCONSTR,FUNCT_2,MULTOP_1,PBOOLE,CKB2,CKB18;
registrations XBOOLE_0,FUNCT_1,RELSET_1,FINSEQ_1,RELAT_1,TREES_3,STRUCT_0,DTCONSTR,MSUALG_1,MSUALG_3,MSAFREE,ORDINAL1,PBOOLE,PRE_POLY,CKB5,CKB6,CKB7,CKB13,CKB14,CKB15,CKB17,CKB19,CKB20,CKB21,CKB22,CKB23;
constructors MULTOP_1,PROB_2,MSUALG_3,MSAFREE,RELSET_1,CAT_3,FINSEQ_2,CKB8,CKB10,CKB11;
requirements BOOLE,SUBSET;
begin
scheme ExtFreeGen { S() -> non  void non  empty ManySortedSign,X() ->  non-empty (ManySortedSet of (the carrier of S())),MSA() ->  non-empty MSAlgebra over S(),P[set,set,set],IT1,IT2() -> (ManySortedFunction of ( FreeMSA X() ),MSA()) } : IT1() = IT2()
provided
A1: IT1() is_homomorphism ( FreeMSA X() ),MSA()
and
A2: (for s being (SortSymbol of S()) holds (for x,y being set holds (y in ( FreeGen (s,X()) ) implies (( ( IT1() . s ) . y ) = x iff P[ s,x,y ]))))
and
A3: IT2() is_homomorphism ( FreeMSA X() ),MSA()
and
A4: (for s being (SortSymbol of S()) holds (for x,y being set holds (y in ( FreeGen (s,X()) ) implies (( ( IT2() . s ) . y ) = x iff P[ s,x,y ]))))
proof
defpred Z[ set,set ]
 means
(for s being (SortSymbol of S()) holds ($1 in ( FreeGen (s,X()) ) implies P[ s,$2,$1 ]));
A5: ( FreeMSA X() ) = MSAlgebra (# ( FreeSort X() ),( FreeOper X() ) #) by MSAFREE:def 14;
then reconsider f1 = IT1(),f2 = IT2() as (ManySortedFunction of ( FreeSort X() ),(the Sorts of MSA()));
A6: (for x being set holds (x in ( Union ( FreeGen X() ) ) implies (ex y being set st (y in ( Union (the Sorts of MSA()) ) & Z[ x,y ]))))
proof
let e being set;
A7: ( dom (the Sorts of MSA()) ) = (the carrier of S()) by PARTFUN1:def 2;
assume e in ( Union ( FreeGen X() ) );
then consider s being set such that A8: s in ( dom ( FreeGen X() ) ) and A9: e in ( ( FreeGen X() ) . s ) by CARD_5:2;
reconsider s as (SortSymbol of S()) by A8,PARTFUN1:def 2;
A10: e in ( FreeGen (s,X()) ) by A9,MSAFREE:def 16;
take u = ( ( IT1() . s ) . e );
( f1 . s ) is (Function of ( ( FreeSort X() ) . s ),( (the Sorts of MSA()) . s ));
then u in ( (the Sorts of MSA()) . s ) by A10,FUNCT_2:5;
hence u in ( Union (the Sorts of MSA()) ) by A7,CARD_5:2;
let s9 being (SortSymbol of S());
assume A11: e in ( FreeGen (s9,X()) );
then ( ( ( FreeSort X() ) . s9 ) /\ ( ( FreeSort X() ) . s ) ) <> ( {} ) by A10,XBOOLE_0:def 4;
then ( ( FreeSort X() ) . s9 ) meets ( ( FreeSort X() ) . s ) by XBOOLE_0:def 7;
then s = s9 by MSAFREE:12;
hence thesis by A2,A11;
end;
consider G being (Function of ( Union ( FreeGen X() ) ),( Union (the Sorts of MSA()) )) such that A12: (for e being set holds (e in ( Union ( FreeGen X() ) ) implies Z[ e,( G . e ) ])) from FUNCT_2:sch 1(A6);
deffunc Gf(set) = ( G /. $1 );
defpred P[ set,set ]
 means
(for o being (OperSymbol of S()) holds (for a being (Element of ( Args (o,MSA()) )) holds ($1 = [ o,a ] implies $2 = ( ( Den (o,MSA()) ) . a ))));
consider R being set such that A13: R = { [ o,a ] where o is (Element of (the carrier' of S())),a is (Element of ( Args (o,MSA()) )): (not contradiction) };
A14: (for s being (SortSymbol of S()) holds (for y being set holds (y in ( FreeGen (s,X()) ) implies ( ( f1 . s ) . y ) = Gf(y))))
proof
let s being (SortSymbol of S());
let y being set;
A15: ( dom ( FreeGen X() ) ) = (the carrier of S()) by PARTFUN1:def 2;
assume A16: y in ( FreeGen (s,X()) );
then y in ( ( FreeGen X() ) . s ) by MSAFREE:def 16;
then A17: y in ( Union ( FreeGen X() ) ) by A15,CARD_5:2;
then P[ s,( G . y ),y ] by A12,A16;
hence ( ( f1 . s ) . y ) = ( G . y ) by A2,A16
.= ( G /. y ) by A17,FUNCT_2:def 13;
end;
A18: (for x being set holds (x in R implies (ex y being set st (y in ( Union (the Sorts of MSA()) ) & P[ x,y ]))))
proof
let e being set;
assume e in R;
then consider o being (OperSymbol of S()),a being (Element of ( Args (o,MSA()) )) such that A19: e = [ o,a ] by A13;
reconsider u = ( ( Den (o,MSA()) ) . a ) as set;
take u;
u in ( union ( rng (the Sorts of MSA()) ) ) by TARSKI:def 4;
hence u in ( Union (the Sorts of MSA()) ) by CARD_3:def 4;
let o9 being (OperSymbol of S());
let x9 being (Element of ( Args (o9,MSA()) ));
assume A20: e = [ o9,x9 ];
then o = o9 by A19,ZFMISC_1:27;
hence thesis by A19,A20,ZFMISC_1:27;
end;
consider H being (Function of R,( Union (the Sorts of MSA()) )) such that A21: (for e being set holds (e in R implies P[ e,( H . e ) ])) from FUNCT_2:sch 1(A18);
A22: (for s being (SortSymbol of S()) holds (for y being set holds (y in ( FreeGen (s,X()) ) implies ( ( f2 . s ) . y ) = Gf(y))))
proof
let s being (SortSymbol of S());
let y being set;
A23: ( dom ( FreeGen X() ) ) = (the carrier of S()) by PARTFUN1:def 2;
assume A24: y in ( FreeGen (s,X()) );
then y in ( ( FreeGen X() ) . s ) by MSAFREE:def 16;
then A25: y in ( Union ( FreeGen X() ) ) by A23,CARD_5:2;
then P[ s,( G . y ),y ] by A12,A24;
hence ( ( f2 . s ) . y ) = ( G . y ) by A4,A24
.= ( G /. y ) by A25,FUNCT_2:def 13;
end;
deffunc Hf(set,set,set) = ( H /. [ $1,$3 ] );
A26: (for o being (OperSymbol of S()) holds (for ts being (Element of ( Args (o,( FreeMSA X() )) )) holds (for x being (Element of ( ( Union (the Sorts of MSA()) ) * )) holds (x = ( ( Flatten f2 ) * ts ) implies ( ( f2 . ( the_result_sort_of o ) ) . ( ( Den (o,( FreeMSA X() )) ) . ts ) ) = Hf(o,ts,x)))))
proof
let o being (OperSymbol of S());
let ts being (Element of ( Args (o,( FreeMSA X() )) ));
let x being (Element of ( ( Union (the Sorts of MSA()) ) * ));
assume A27: x = ( ( Flatten f2 ) * ts );
A28: ( ( Flatten f2 ) * ts ) = ( IT2() # ts ) by A5,CKB16:1;
then reconsider a = x as (Element of ( Args (o,MSA()) )) by A27;
A29: [ o,a ] in R by A13;
thus ( ( f2 . ( the_result_sort_of o ) ) . ( ( Den (o,( FreeMSA X() )) ) . ts ) ) = ( ( Den (o,MSA()) ) . a ) by A3,A28,A27,MSUALG_3:def 7
.= ( H . [ o,x ] ) by A21,A29
.= ( H /. [ o,x ] ) by A29,FUNCT_2:def 13;
end;
A30: (for o being (OperSymbol of S()) holds (for ts being (Element of ( Args (o,( FreeMSA X() )) )) holds (for x being (Element of ( ( Union (the Sorts of MSA()) ) * )) holds (x = ( ( Flatten f1 ) * ts ) implies ( ( f1 . ( the_result_sort_of o ) ) . ( ( Den (o,( FreeMSA X() )) ) . ts ) ) = Hf(o,ts,x)))))
proof
let o being (OperSymbol of S());
let ts being (Element of ( Args (o,( FreeMSA X() )) ));
let x being (Element of ( ( Union (the Sorts of MSA()) ) * ));
assume A31: x = ( ( Flatten f1 ) * ts );
A32: ( ( Flatten f1 ) * ts ) = ( IT1() # ts ) by A5,CKB16:1;
then reconsider a = x as (Element of ( Args (o,MSA()) )) by A31;
A33: [ o,a ] in R by A13;
thus ( ( f1 . ( the_result_sort_of o ) ) . ( ( Den (o,( FreeMSA X() )) ) . ts ) ) = ( ( Den (o,MSA()) ) . a ) by A1,A32,A31,MSUALG_3:def 7
.= ( H . [ o,x ] ) by A21,A33
.= ( H /. [ o,x ] ) by A33,FUNCT_2:def 13;
end;
f1 = f2 from CKB18:sch 1(A30,A14,A26,A22);
hence thesis;
end;
