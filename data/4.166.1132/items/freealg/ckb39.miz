environ
vocabularies NUMBERS,SUBSET_1,XBOOLE_0,ARYTM_1,CARD_1,RELAT_1,FINSEQ_1,QUANTAL1,UNIALG_1,UNIALG_2,FUNCT_1,MSAFREE,TARSKI,STRUCT_0,FINSEQ_2,PRELAMB,CQC_SIM1,MSUALG_3,FUNCOP_1,PARTFUN1,FUNCT_2,NAT_1,LANG1,TDGROUP,DTCONSTR,TREES_3,TREES_4,CARD_3,TREES_2,QC_LANG1,FREEALG;
notations TARSKI,XBOOLE_0,SUBSET_1,NUMBERS,XCMPLX_0,NAT_1,RELAT_1,RELSET_1,FUNCT_1,PARTFUN1,FINSEQ_1,FUNCT_2,FUNCOP_1,FINSEQ_2,CARD_3,TREES_2,TREES_3,TREES_4,MARGREL1,STRUCT_0,UNIALG_1,UNIALG_2,LANG1,DTCONSTR,PRE_POLY,ALG_1,CKB1,CKB4,CKB5,CKB6,CKB9,CKB10,CKB13,CKB14,CKB18,CKB19,CKB26,CKB27,CKB28,CKB29,CKB31,CKB33,CKB34,CKB35,CKB38;
definitions TARSKI,UNIALG_2,DTCONSTR,XBOOLE_0,FINSEQ_2,FUNCOP_1,MARGREL1,CKB1,CKB6,CKB9,CKB10,CKB13,CKB14,CKB18,CKB19,CKB26,CKB27,CKB28,CKB29,CKB31,CKB34,CKB35;
theorems FINSEQ_1,FINSEQ_2,PARTFUN1,FUNCT_1,FUNCT_2,NAT_1,ZFMISC_1,UNIALG_1,ALG_1,TARSKI,FUNCOP_1,UNIALG_2,LANG1,DTCONSTR,RELAT_1,XBOOLE_0,XBOOLE_1,TREES_3,MARGREL1,FINSEQ_3,CARD_1,CKB1,CKB3,CKB6,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB17,CKB18,CKB19,CKB21,CKB22,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB34,CKB35,CKB36;
schemes PARTFUN1,FINSEQ_1,RELSET_1,DTCONSTR;
registrations XBOOLE_0,SUBSET_1,RELAT_1,ORDINAL1,PARTFUN1,XREAL_0,FINSEQ_1,FINSEQ_2,TREES_3,STRUCT_0,UNIALG_1,UNIALG_2,DTCONSTR,CARD_1,RELSET_1,MARGREL1,FUNCT_1,CKB2,CKB7,CKB8,CKB15,CKB16,CKB20,CKB23,CKB24,CKB25,CKB37;
constructors DOMAIN_1,XCMPLX_0,XXREAL_0,XREAL_0,FINSEQOP,DTCONSTR,ALG_1,RELSET_1,PRE_POLY,CKB1,CKB9,CKB10,CKB13,CKB14,CKB18,CKB19,CKB26,CKB27,CKB28,CKB29,CKB31,CKB33,CKB34,CKB35,CKB38;
requirements REAL,NUMERALS,BOOLE,SUBSET,ARITHM;
begin
reserve x for set;
reserve y for set;
definition
let f being  with_zero non empty (FinSequence of ( NAT ));
let D being  disjoint_with_NAT set;
let n being Nat;
assume A1: n in ( dom f );
func FreeOpZAO (n,f,D) ->  homogeneous  quasi_total non empty (PartFunc of ( ( TS ( DTConUA (f,D) ) ) * ),( TS ( DTConUA (f,D) ) ))
means
:Def17: (( dom it ) = ( ( f /. n ) -tuples_on ( TS ( DTConUA (f,D) ) ) ) & (for p being (FinSequence of ( TS ( DTConUA (f,D) ) )) holds (p in ( dom it ) implies ( it . p ) = ( ( Sym (n,f,D) ) -tree p ))));
existence
proof
set A = ( DTConUA (f,D) );
set i = ( f /. n );
set Y = ( ( dom f ) \/ D );
set smm = ( Sym (n,f,D) );
defpred P[ set,set ]
 means
($1 in ( i -tuples_on ( TS A ) ) & (for p being (FinSequence of ( TS A )) holds (p = $1 implies $2 = ( smm -tree p ))));
set tu = { s where s is (Element of ( ( TS A ) * )): ( len s ) = ( f /. n ) };
A2: i = ( f . n ) by A1,PARTFUN1:def 6;
A3: (for x holds (for y holds ((x in ( ( TS A ) * ) & P[ x,y ]) implies y in ( TS A ))))
proof
reconsider sm = ( Sym (n,f,D) ) as (Element of Y);
let x;
let y;
assume that
x in ( ( TS A ) * )
and
A4: P[ x,y ];
consider s being (Element of ( ( TS A ) * )) such that A5: s = x and A6: ( len s ) = i by A4;
A7: y = ( ( Sym (n,f,D) ) -tree s ) by A4,A5;
reconsider s as (FinSequence of ( TS A ));
(( dom ( roots s ) ) = ( dom s ) & ( Seg ( len ( roots s ) ) ) = ( dom ( roots s ) )) by FINSEQ_1:def 3,TREES_3:def 18;
then A8: ( len ( roots s ) ) = i by A6,FINSEQ_1:def 3;
reconsider s as (FinSequence of ( FinTrees (the carrier of A) ));
reconsider rs = ( roots s ) as (Element of ( Y * )) by FINSEQ_1:def 11;
sm = n by A1,CKB26:def 1;
then [ sm,rs ] in ( REL (f,D) ) by A1,A2,A8,CKB18:def 1;
then ( Sym (n,f,D) ) ==> ( roots s ) by LANG1:def 1;
hence thesis by A7,DTCONSTR:def 1;
end;
A9: (for x,y1,y2 being set holds (((x in ( ( TS A ) * ) & P[ x,y1 ]) & P[ x,y2 ]) implies y1 = y2))
proof
let x being set,y1 being set,y2 being set;
assume that
x in ( ( TS A ) * )
and
A10: P[ x,y1 ]
and
A11: P[ x,y2 ];
consider s being (Element of ( ( TS A ) * )) such that A12: s = x and ( len s ) = i by A10;
y1 = ( ( Sym (n,f,D) ) -tree s ) by A10,A12;
hence thesis by A11,A12;
end;
consider F being (PartFunc of ( ( TS A ) * ),( TS A )) such that A13: (for x being set holds (x in ( dom F ) iff (x in ( ( TS A ) * ) & (ex y st P[ x,y ])))) and A14: (for x being set holds (x in ( dom F ) implies P[ x,( F . x ) ])) from PARTFUN1:sch 2(A3,A9);
A15: ( dom F ) = ( i -tuples_on ( TS A ) )
proof
thus ( dom F ) c= ( i -tuples_on ( TS A ) )
proof
let x;
assume x in ( dom F );
then (ex y st P[ x,y ]) by A13;
hence thesis;
end;

reconsider sm = smm as (Symbol of A);
let x;
assume x in ( i -tuples_on ( TS A ) );
then consider s being (Element of ( ( TS A ) * )) such that A16: s = x and A17: ( len s ) = i;
P[ s,( sm -tree s ) ] by A17;
hence thesis by A13,A16;
end;
A18: (for x,y being (FinSequence of ( TS A )) holds ((( len x ) = ( len y ) & x in ( dom F )) implies y in ( dom F )))
proof
let x being (FinSequence of ( TS A )),y being (FinSequence of ( TS A ));
assume that
A19: ( len x ) = ( len y )
and
A20: x in ( dom F );
reconsider sy = y as (Element of ( ( TS A ) * )) by FINSEQ_1:def 11;
(ex sx being (Element of ( ( TS A ) * )) st (sx = x & ( len sx ) = ( f /. n ))) by A15,A20;
then sy in tu by A19;
hence thesis by A15;
end;
A21: (ex x being FinSequence st x in ( dom F ))
proof
set a = the (Element of ( i -tuples_on ( TS A ) ));
a in ( dom F ) by A15;
hence (ex x being FinSequence st x in ( dom F ));
end;
( dom F ) is  with_common_domain
proof
let x being FinSequence,y being FinSequence;
assume (x in ( dom F ) & y in ( dom F ));
then ((ex sx being (Element of ( ( TS A ) * )) st (sx = x & ( len sx ) = ( f /. n ))) & (ex sy being (Element of ( ( TS A ) * )) st (sy = y & ( len sy ) = ( f /. n )))) by A15;
hence thesis;
end;
then reconsider F as  homogeneous  quasi_total non empty (PartFunc of ( ( TS A ) * ),( TS A )) by A18,A21,MARGREL1:def 21,MARGREL1:def 22;
take F;
thus ( dom F ) = ( i -tuples_on ( TS A ) ) by A15;
let p being (FinSequence of ( TS A ));
assume p in ( dom F );
hence thesis by A14;
end;
uniqueness
proof
set A = ( TS ( DTConUA (f,D) ) );
let f1 being  homogeneous  quasi_total non empty (PartFunc of ( A * ),A),f2 being  homogeneous  quasi_total non empty (PartFunc of ( A * ),A);
assume that
A22: ( dom f1 ) = ( ( f /. n ) -tuples_on A )
and
A23: (for p being (FinSequence of A) holds (p in ( dom f1 ) implies ( f1 . p ) = ( ( Sym (n,f,D) ) -tree p )))
and
A24: ( dom f2 ) = ( ( f /. n ) -tuples_on A )
and
A25: (for p being (FinSequence of A) holds (p in ( dom f2 ) implies ( f2 . p ) = ( ( Sym (n,f,D) ) -tree p )));
now
let x;
assume A26: x in ( ( f /. n ) -tuples_on A );
then consider s being (Element of ( A * )) such that A27: s = x and ( len s ) = ( f /. n );
( f1 . s ) = ( ( Sym (n,f,D) ) -tree s ) by A22,A23,A26,A27;
hence ( f1 . x ) = ( f2 . x ) by A24,A25,A26,A27;
end;
hence thesis by A22,A24,FUNCT_1:2;
end;
end;
