environ
vocabularies NUMBERS,REAL_1,ZFMISC_1,NORMSP_1,PRE_TOPC,PARTFUN1,FUNCT_1,FUNCT_4,NAT_1,FDIFF_1,SUBSET_1,SEQ_4,RELAT_1,GLIB_000,LOPBAN_1,ORDINAL4,RFINSEQ,RCOMP_1,TARSKI,SEQ_1,ARYTM_3,VALUED_1,FUNCT_2,ARYTM_1,SEQ_2,ORDINAL2,SUPINF_2,FCONT_1,COMPLEX1,STRUCT_0,CARD_1,VALUED_0,XXREAL_0,GROUP_2,FUNCOP_1,XREAL_0,ORDINAL1,MEMBERED,FINSEQ_5,XXREAL_2,XBOOLE_0,CARD_3,FINSEQ_1,FINSEQ_2,AFINSQ_1,RLVECT_1,SQUARE_1,RVSUM_1,XXREAL_1,PDIFF_1,PRVECT_1,PRVECT_2,ALGSTR_0,EUCLID,CFCONT_1,RFINSEQ2,NORMSP_0,NFCONT_1,MONOID_0,RLTOPSP1;
notations TARSKI,XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,RELSET_1,PARTFUN1,FUNCT_2,FUNCOP_1,FUNCT_4,CARD_1,NUMBERS,XXREAL_0,XREAL_0,REAL_1,SQUARE_1,NAT_1,MEMBERED,VALUED_0,COMPLEX1,NAT_D,BINOP_2,XXREAL_2,CARD_3,FINSEQ_1,VALUED_1,FINSEQ_2,SEQ_1,SEQ_2,RVSUM_1,RFINSEQ,SEQ_4,RCOMP_1,FCONT_1,FDIFF_1,FINSEQ_5,FINSEQ_7,RFINSEQ2,STRUCT_0,MONOID_0,ALGSTR_0,PRE_TOPC,RLVECT_1,NORMSP_0,NORMSP_1,VFUNCT_1,EUCLID,LOPBAN_1,PRVECT_1,NFCONT_1,NDIFF_1,PRVECT_2,NFCONT_3,NDIFF_3,RLTOPSP1,FUNCT_7;
definitions TARSKI,FUNCT_2,RLVECT_1,LOPBAN_1,EUCLID,RFINSEQ2,FINSEQ_1,FINSEQ_2,STRUCT_0,MONOID_0,ALGSTR_0,NORMSP_0,RCOMP_1,XCMPLX_0,PRVECT_2;
theorems TARSKI,ABSVALUE,XBOOLE_0,XBOOLE_1,RLVECT_1,XCMPLX_0,XCMPLX_1,ZFMISC_1,SEQ_1,SEQ_2,NAT_1,RELAT_1,FUNCT_1,VFUNCT_1,FUNCT_2,FUNCT_3,FINSEQ_4,RLVECT_2,FINSEQ_3,ORDINAL1,FINSEQ_1,CARD_3,FUNCT_4,SEQ_4,NORMSP_1,LOPBAN_1,PARTFUN1,PARTFUN2,NFCONT_1,FDIFF_1,NDIFF_1,FUNCOP_1,XREAL_1,COMPLEX1,XXREAL_0,VALUED_1,VALUED_0,GRCAT_1,NORMSP_0,XREAL_0,RCOMP_1,FINSEQ_2,FINSEQ_7,RVSUM_1,SQUARE_1,PRVECT_1,PRVECT_2,PDIFF_7,EUCLID,TOPREAL7,XXREAL_2,FINSEQ_5,NAT_D,RFINSEQ2,INTEGRA5,FCONT_1,NAT_2,NFCONT_3,NDIFF_2,NDIFF_3,CARD_1,ROLLE,XXREAL_1,RLTOPSP1,FUNCT_7,CKB1,CKB2,CKB3,CKB4,CKB5;
schemes FUNCT_2,SEQ_1,FINSEQ_1,NAT_1,FINSEQ_2;
registrations RELSET_1,STRUCT_0,ORDINAL1,XREAL_0,MEMBERED,FUNCT_1,NDIFF_1,FUNCT_2,NUMBERS,XBOOLE_0,VALUED_0,PRVECT_2,FINSEQ_2,FINSEQ_1,CARD_3,NORMSP_0,NORMSP_1,RELAT_1,XXREAL_0,LOPBAN_1,LOPBAN_2,PRVECT_3,FUNCOP_1,NAT_1,FINSEQ_5,XXREAL_2,RCOMP_1,VALUED_1,FDIFF_1,NFCONT_3,FINSET_1,XCMPLX_0,PARTFUN1,CARD_1,MONOID_0;
constructors REAL_1,SQUARE_1,SEQ_2,FDIFF_1,NFCONT_1,RSSPACE,VFUNCT_1,NDIFF_1,SEQ_1,RELSET_1,FINSEQ_7,FINSEQ_5,RVSUM_1,BINOP_2,PRVECT_2,RLVECT_2,NAT_D,FINSEQOP,RFINSEQ,RFINSEQ2,SEQ_4,FCONT_1,NFCONT_3,NDIFF_3,MONOID_0,RLTOPSP1,FUNCT_7;
requirements SUBSET,REAL,BOOLE,NUMERALS,ARITHM;
begin
reserve p for Real;
reserve r for Real;
reserve S for non  trivial RealNormSpace;
reserve T for non  trivial RealNormSpace;
reserve F for non  trivial RealNormSpace;
reserve x0 for (Point of S);
reserve g for (PartFunc of S,T);
reserve G for RealNormSpace-Sequence;
reserve f for (PartFunc of ( product G ),F);
reserve x for (Element of ( product G ));
theorem
NDIFF213: (for x0 being (Element of ( REAL )) holds (for g being (PartFunc of ( REAL ),(the carrier of S)) holds (g is_differentiable_in x0 implies (for f being (PartFunc of (the carrier of S),(the carrier of T)) holds (f is_differentiable_in ( g /. x0 ) implies (( f * g ) is_differentiable_in x0 & ( diff (( f * g ),x0) ) = ( ( diff (f,( g /. x0 )) ) . ( diff (g,x0) ) )))))))
proof
let x0 being (Element of ( REAL ));
let g being (PartFunc of ( REAL ),(the carrier of S));
assume that
A1: g is_differentiable_in x0;
consider N1 being (Neighbourhood of x0) such that A2: N1 c= ( dom g ) and A3: (ex L1 being (LINEAR of S) st (ex R1 being (REST of S) st (( diff (g,x0) ) = ( L1 . 1 ) & (for x being Real holds (x in N1 implies ( ( g /. x ) - ( g /. x0 ) ) = ( ( L1 . ( x - x0 ) ) + ( R1 /. ( x - x0 ) ) )))))) by A1,NDIFF_3:def 4;
let f being (PartFunc of (the carrier of S),(the carrier of T));
assume f is_differentiable_in ( g /. x0 );
then consider N2 being (Neighbourhood of ( g /. x0 )) such that A4: N2 c= ( dom f ) and A5: (ex R2 being (REST of S,T) st ((( R2 /. ( 0. S ) ) = ( 0. T ) & R2 is_continuous_in ( 0. S )) & (for y being (Point of S) holds (y in N2 implies ( ( f /. y ) - ( f /. ( g /. x0 ) ) ) = ( ( ( diff (f,( g /. x0 )) ) . ( y - ( g /. x0 ) ) ) + ( R2 /. ( y - ( g /. x0 ) ) ) ))))) by NDIFF_1:47;
consider R2 being (REST of S,T) such that A6: ( R2 /. ( 0. S ) ) = ( 0. T ) and A7: (for y being (Point of S) holds (y in N2 implies ( ( f /. y ) - ( f /. ( g /. x0 ) ) ) = ( ( ( diff (f,( g /. x0 )) ) . ( y - ( g /. x0 ) ) ) + ( R2 /. ( y - ( g /. x0 ) ) ) ))) by A5;
reconsider L2 = ( diff (f,( g /. x0 )) ) as  bounded (LinearOperator of S,T) by LOPBAN_1:def 9;
consider L1 being (LINEAR of S),R1 being (REST of S) such that A9: (( diff (g,x0) ) = ( L1 . 1 ) & (for x being Real holds (x in N1 implies ( ( g /. x ) - ( g /. x0 ) ) = ( ( L1 . ( x - x0 ) ) + ( R1 /. ( x - x0 ) ) )))) by A3;
consider r being (Point of S) such that B9: (for p being Real holds ( L1 . p ) = ( p * r )) by NDIFF_3:def 2;
reconsider p0 = ( 0 ) as (Element of ( REAL ));
( ( g /. x0 ) - ( g /. x0 ) ) = ( ( L1 . ( x0 - x0 ) ) + ( R1 /. ( x0 - x0 ) ) ) by A9,RCOMP_1:16;
then ( 0. S ) = ( ( L1 . ( 0 ) ) + ( R1 /. ( 0 ) ) ) by RLVECT_1:15;
then ( 0. S ) = ( ( p0 * r ) + ( R1 /. ( 0 ) ) ) by B9;
then ( 0. S ) = ( ( 0. S ) + ( R1 /. ( 0 ) ) ) by RLVECT_1:10;
then ( R1 /. ( 0 ) ) = ( 0. S ) by RLVECT_1:4;
then reconsider R0 = ( ( L2 * R1 ) + ( R2 * ( L1 + R1 ) ) ) as (REST of T) by A6,CKB5:1;
B11: ( dom ( L2 * L1 ) ) = ( REAL ) by FUNCT_2:def 1;
reconsider q = ( L2 . r ) as (Point of T);
now
let p being Real;
( L2 . ( L1 . p ) ) = ( L2 . ( p * r ) ) by B9;
then ( L2 . ( L1 . p ) ) = ( p * q ) by LOPBAN_1:def 5;
hence ( ( L2 * L1 ) . p ) = ( p * q ) by B11,FUNCT_1:12;
end;
then reconsider L0 = ( L2 * L1 ) as (LINEAR of T) by NDIFF_3:def 2;
g is_continuous_in x0 by A1,NDIFF_3:22;
then consider N3 being (Neighbourhood of x0) such that A10: ( g .: N3 ) c= N2 by NFCONT_3:10;
consider N being (Neighbourhood of x0) such that A11: N c= N1 and A12: N c= N3 by RCOMP_1:17;
now
let x being set;
assume A14: x in N;
then reconsider x9 = x as Real;
A15: x in N1 by A11,A14;
then ( g . x9 ) in ( g .: N3 ) by A2,A12,A14,FUNCT_1:def 6;
then ( g . x9 ) in N2 by A10;
hence x in ( dom ( f * g ) ) by A2,A4,A15,FUNCT_1:11;
end;
then A13: N c= ( dom ( f * g ) ) by TARSKI:def 3;
A17:now
let x being Real;
assume that
A18: x in N;
A19: ( ( g /. x ) - ( g /. x0 ) ) = ( ( L1 . ( x - x0 ) ) + ( R1 /. ( x - x0 ) ) ) by A9,A11,A18;
A20: x in N1 by A11,A18;
then ( g . x ) in ( g .: N3 ) by A2,A12,A18,FUNCT_1:def 6;
then ( g . x ) in N2 by A10;
then A21: ( g /. x ) in N2 by A2,A20,PARTFUN1:def 6;
A23: x0 in N by RCOMP_1:16;
A24: R1 is  total by NDIFF_3:def 1;
then A25: ( dom R1 ) = ( REAL ) by PARTFUN1:def 2;
( dom L2 ) = (the carrier of S) by FUNCT_2:def 1;
then A26: ( rng R1 ) c= ( dom L2 );
A27: ( dom ( L2 * R1 ) ) = ( REAL ) by A24,PARTFUN1:def 2;
( L1 + R1 ) is  total by A24,VFUNCT_1:32;
then A29: ( dom ( L1 + R1 ) ) = ( REAL ) by PARTFUN1:def 2;
R2 is  total by NDIFF_1:def 5;
then ( dom R2 ) = (the carrier of S) by PARTFUN1:def 2;
then A30: ( rng ( L1 + R1 ) ) c= ( dom R2 );
then ( dom ( R2 * ( L1 + R1 ) ) ) = ( dom ( L1 + R1 ) ) by RELAT_1:27;
then A31: ( dom ( ( L2 * R1 ) + ( R2 * ( L1 + R1 ) ) ) ) = ( ( REAL ) /\ ( REAL ) ) by A27,A29,VFUNCT_1:def 1;
( L2 . ( R1 /. ( x - x0 ) ) ) = ( L2 /. ( R1 /. ( x - x0 ) ) );
then A32: ( L2 . ( R1 /. ( x - x0 ) ) ) = ( ( L2 * R1 ) /. ( x - x0 ) ) by A25,A26,PARTFUN2:5;
A33: ( R2 /. ( ( L1 . ( x - x0 ) ) + ( R1 /. ( x - x0 ) ) ) ) = ( R2 /. ( ( L1 /. ( x - x0 ) ) + ( R1 /. ( x - x0 ) ) ) )
.= ( R2 /. ( ( L1 + R1 ) /. ( x - x0 ) ) ) by A29,VFUNCT_1:def 1
.= ( ( R2 * ( L1 + R1 ) ) /. ( x - x0 ) ) by A29,A30,PARTFUN2:5;
B33: ( ( L2 * L1 ) . ( x - x0 ) ) = ( L2 . ( L1 . ( x - x0 ) ) ) by B11,FUNCT_1:12;
thus ( ( ( f * g ) /. x ) - ( ( f * g ) /. x0 ) ) = ( ( f /. ( g /. x ) ) - ( ( f * g ) /. x0 ) ) by A13,A18,PARTFUN2:3
.= ( ( f /. ( g /. x ) ) - ( f /. ( g /. x0 ) ) ) by A13,A23,PARTFUN2:3
.= ( ( ( diff (f,( g /. x0 )) ) . ( ( g /. x ) - ( g /. x0 ) ) ) + ( R2 /. ( ( g /. x ) - ( g /. x0 ) ) ) ) by A7,A21
.= ( ( ( L2 . ( L1 . ( x - x0 ) ) ) + ( L2 . ( R1 /. ( x - x0 ) ) ) ) + ( ( R2 * ( L1 + R1 ) ) /. ( x - x0 ) ) ) by A19,A33,GRCAT_1:def 8
.= ( ( L2 . ( L1 . ( x - x0 ) ) ) + ( ( ( L2 * R1 ) /. ( x - x0 ) ) + ( ( R2 * ( L1 + R1 ) ) /. ( x - x0 ) ) ) ) by A32,RLVECT_1:def 3
.= ( ( L0 . ( x - x0 ) ) + ( R0 /. ( x - x0 ) ) ) by B33,A31,VFUNCT_1:def 1;
end;
hence A34: ( f * g ) is_differentiable_in x0 by A13,NDIFF_3:def 3;
( ( L2 * L1 ) . 1 ) = ( ( diff (f,( g /. x0 )) ) . ( diff (g,x0) ) ) by A9,B11,FUNCT_1:12;
hence thesis by A34,A13,A17,NDIFF_3:def 4;
end;
