environ
vocabularies PARTFUN1,NUMBERS,REAL_1,SEQ_1,SUBSET_1,FCONT_1,ARYTM_3,RELAT_1,LIMFUNC3,SEQ_2,ORDINAL2,TARSKI,XBOOLE_0,FUNCT_2,FUNCT_1,LIMFUNC2,LIMFUNC1,RCOMP_1,XREAL_0,ORDINAL1,CARD_1,XXREAL_1,ARYTM_1,FDIFF_1,VALUED_1,FUNCOP_1,XXREAL_0,NAT_1;
notations TARSKI,XBOOLE_0,SUBSET_1,ORDINAL1,NUMBERS,XREAL_0,REAL_1,NAT_1,FUNCT_2,FUNCOP_1,VALUED_0,VALUED_1,SEQ_1,SEQ_2,RELSET_1,PARTFUN1,RFUNCT_1,RCOMP_1,FCONT_1,FDIFF_1,LIMFUNC1,LIMFUNC2,LIMFUNC3,XXREAL_0;
definitions TARSKI,PROB_1,LIMFUNC1;
theorems TARSKI,NAT_1,RFUNCT_1,RCOMP_1,FCONT_1,FDIFF_1,ROLLE,SEQ_2,SEQ_4,LIMFUNC2,LIMFUNC1,LIMFUNC3,ZFMISC_1,FUNCT_1,XREAL_0,XBOOLE_0,XBOOLE_1,XCMPLX_0,XCMPLX_1,FUNCOP_1,XREAL_1,XXREAL_0,VALUED_1,XXREAL_1,XXREAL_2,FUNCT_2,VALUED_0,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9;
schemes FUNCT_2;
registrations ORDINAL1,RELSET_1,NUMBERS,XREAL_0,MEMBERED,RCOMP_1,VALUED_0,XXREAL_2,FUNCOP_1,XBOOLE_0,SEQ_4,FUNCT_2;
constructors PARTFUN1,FUNCOP_1,REAL_1,NAT_1,SEQ_2,SEQM_3,PROB_1,RCOMP_1,RFUNCT_1,RFUNCT_2,FCONT_1,LIMFUNC1,FDIFF_1,LIMFUNC2,LIMFUNC3,VALUED_1,SEQ_1,XXREAL_2,RELSET_1,SEQ_4;
requirements SUBSET,BOOLE,ARITHM;
begin
reserve f for (PartFunc of ( REAL ),( REAL ));
reserve g for (PartFunc of ( REAL ),( REAL ));
reserve r1 for Real;
reserve r2 for Real;
reserve g1 for Real;
reserve g2 for Real;
reserve g3 for Real;
reserve x for Real;
reserve x0 for Real;
reserve t for Real;
reserve c for Real;
reserve a for Real_Sequence;
reserve b for Real_Sequence;
reserve n for (Element of ( NAT ));
reserve k for (Element of ( NAT ));
theorem
((ex N being (Neighbourhood of x0) st ((((((((N c= ( dom f ) & N c= ( dom g )) & f is_differentiable_on N) & g is_differentiable_on N) & ( N \ { x0 } ) c= ( dom ( f / g ) )) & N c= ( dom ( ( f `| N ) / ( g `| N ) ) )) & ( f . x0 ) = ( 0 )) & ( g . x0 ) = ( 0 )) & ( ( f `| N ) / ( g `| N ) ) is_continuous_in x0)) implies (( f / g ) is_convergent_in x0 & ( lim (( f / g ),x0) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) )))
proof
given N being (Neighbourhood of x0) such that
A1: N c= ( dom f )
and
A2: N c= ( dom g )
and
A3: f is_differentiable_on N
and
A4: g is_differentiable_on N
and
A5: ( N \ { x0 } ) c= ( dom ( f / g ) )
and
A6: N c= ( dom ( ( f `| N ) / ( g `| N ) ) )
and
A7: (( f . x0 ) = ( 0 ) & ( g . x0 ) = ( 0 ))
and
A8: ( ( f `| N ) / ( g `| N ) ) is_continuous_in x0;

consider r being  real number such that A9: ( 0 ) < r and A10: N = ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 6;
A11: r is Real by XREAL_0:def 1;
A12: (for x holds ((( x0 - r ) < x & x < x0) implies (ex c st (c in ]. x,x0 .[ & ( ( f / g ) . x ) = ( ( ( f `| N ) / ( g `| N ) ) . c )))))
proof
A13: ( x0 + ( 0 ) ) < ( x0 + r ) by A9,XREAL_1:8;
( x0 - r ) < x0 by A9,XREAL_1:44;
then x0 in { g1: (( x0 - r ) < g1 & g1 < ( x0 + r )) } by A13;
then A14: x0 in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
A15: ( ( dom ( f `| N ) ) /\ ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) ) c= ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) by XBOOLE_1:17;
A16: ( ( dom f ) /\ ( ( dom g ) \ ( g " { ( 0 ) } ) ) ) c= ( ( dom g ) \ ( g " { ( 0 ) } ) ) by XBOOLE_1:17;
let x;
assume that
A17: ( x0 - r ) < x
and
A18: x < x0;
set f1 = ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) );
A19: (( dom ( ( f . x ) (#) g ) ) = ( dom g ) & ( dom ( ( g . x ) (#) f ) ) = ( dom f )) by VALUED_1:def 5;
then A20: ( dom ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) ) = ( ( dom f ) /\ ( dom g ) ) by VALUED_1:12;
x < ( x0 + r ) by A18,A13,XXREAL_0:2;
then x in { g1: (( x0 - r ) < g1 & g1 < ( x0 + r )) } by A17;
then x in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
then A21: [. x,x0 .] c= N by A10,A14,XXREAL_2:def 12;
then A22: ([. x,x0 .] c= ( dom f ) & [. x,x0 .] c= ( dom g )) by A1,A2,XBOOLE_1:1;
then A23: [. x,x0 .] c= ( dom f1 ) by A20,XBOOLE_1:19;
( g | N ) is  continuous by A4,FDIFF_1:25;
then ( g | [. x,x0 .] ) is  continuous by A21,FCONT_1:16;
then A24: ( ( ( f . x ) (#) g ) | [. x,x0 .] ) is  continuous by A2,A21,FCONT_1:20,XBOOLE_1:1;
( f | N ) is  continuous by A3,FDIFF_1:25;
then ( f | [. x,x0 .] ) is  continuous by A21,FCONT_1:16;
then A25: ( ( ( g . x ) (#) f ) | [. x,x0 .] ) is  continuous by A1,A21,FCONT_1:20,XBOOLE_1:1;
[. x,x0 .] c= ( dom ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) ) by A22,A20,XBOOLE_1:19;
then A26: ( ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) | [. x,x0 .] ) is  continuous by A19,A20,A25,A24,FCONT_1:18;
A27: ]. x,x0 .[ c= [. x,x0 .] by XXREAL_1:25;
then A28: ]. x,x0 .[ c= N by A21,XBOOLE_1:1;
A29: x in [. x,x0 .] by A18,XXREAL_1:1;
then x in ( dom f1 ) by A23;
then A30: x in ( ( dom ( ( f . x ) (#) g ) ) /\ ( dom ( ( g . x ) (#) f ) ) ) by VALUED_1:12;
then A31: x in ( dom ( ( f . x ) (#) g ) ) by XBOOLE_0:def 4;
A32: x0 in [. x,x0 .] by A18,XXREAL_1:1;
then x0 in ( dom f1 ) by A23;
then A33: x0 in ( ( dom ( ( f . x ) (#) g ) ) /\ ( dom ( ( g . x ) (#) f ) ) ) by VALUED_1:12;
then A34: x0 in ( dom ( ( f . x ) (#) g ) ) by XBOOLE_0:def 4;
A35: x in ( dom ( ( g . x ) (#) f ) ) by A30,XBOOLE_0:def 4;
A36: ( f1 . x ) = ( ( ( ( f . x ) (#) g ) . x ) - ( ( ( g . x ) (#) f ) . x ) ) by A23,A29,VALUED_1:13
.= ( ( ( f . x ) * ( g . x ) ) - ( ( ( g . x ) (#) f ) . x ) ) by A31,VALUED_1:def 5
.= ( ( ( g . x ) * ( f . x ) ) - ( ( g . x ) * ( f . x ) ) ) by A35,VALUED_1:def 5
.= ( 0 );
A37: x0 in ( dom ( ( g . x ) (#) f ) ) by A33,XBOOLE_0:def 4;
(not x in { x0 }) by A18,TARSKI:def 1;
then A38: x in ( [. x,x0 .] \ { x0 } ) by A29,XBOOLE_0:def 5;
N c= ( dom ( ( f . x ) (#) g ) ) by A2,VALUED_1:def 5;
then A39: ]. x,x0 .[ c= ( dom ( ( f . x ) (#) g ) ) by A28,XBOOLE_1:1;
N c= ( dom ( ( g . x ) (#) f ) ) by A1,VALUED_1:def 5;
then A40: ]. x,x0 .[ c= ( dom ( ( g . x ) (#) f ) ) by A28,XBOOLE_1:1;
then ]. x,x0 .[ c= ( ( dom ( ( f . x ) (#) g ) ) /\ ( dom ( ( g . x ) (#) f ) ) ) by A39,XBOOLE_1:19;
then A41: ]. x,x0 .[ c= ( dom ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) ) by VALUED_1:12;
f is_differentiable_on ]. x,x0 .[ by A3,A21,A27,FDIFF_1:26,XBOOLE_1:1;
then A42: ( ( g . x ) (#) f ) is_differentiable_on ]. x,x0 .[ by A40,FDIFF_1:20;
g is_differentiable_on ]. x,x0 .[ by A4,A21,A27,FDIFF_1:26,XBOOLE_1:1;
then A43: ( ( f . x ) (#) g ) is_differentiable_on ]. x,x0 .[ by A39,FDIFF_1:20;
( f1 . x0 ) = ( ( ( ( f . x ) (#) g ) . x0 ) - ( ( ( g . x ) (#) f ) . x0 ) ) by A23,A32,VALUED_1:13
.= ( ( ( f . x ) * ( g . x0 ) ) - ( ( ( g . x ) (#) f ) . x0 ) ) by A34,VALUED_1:def 5
.= ( ( 0 ) - ( ( g . x ) * ( 0 ) ) ) by A7,A37,VALUED_1:def 5
.= ( 0 );
then consider t such that A44: t in ]. x,x0 .[ and A45: ( diff (f1,t) ) = ( 0 ) by A18,A26,A42,A41,A43,A23,A36,FDIFF_1:19,ROLLE:1;
A46: ( ( g . x ) (#) f ) is_differentiable_in t by A42,A44,FDIFF_1:9;
A47: f is_differentiable_in t by A3,A28,A44,FDIFF_1:9;
( ( f . x ) (#) g ) is_differentiable_in t by A43,A44,FDIFF_1:9;
then ( 0 ) = ( ( diff (( ( f . x ) (#) g ),t) ) - ( diff (( ( g . x ) (#) f ),t) ) ) by A45,A46,FDIFF_1:14;
then A48: ( 0 ) = ( ( diff (( ( f . x ) (#) g ),t) ) - ( ( g . x ) * ( diff (f,t) ) ) ) by A47,FDIFF_1:15;
take t;
A49: t in [. x,x0 .] by A27,A44;
( [. x,x0 .] \ { x0 } ) c= ( N \ { x0 } ) by A21,XBOOLE_1:33;
then A50: ( [. x,x0 .] \ { x0 } ) c= ( dom ( f / g ) ) by A5,XBOOLE_1:1;
then ( [. x,x0 .] \ { x0 } ) c= ( ( dom f ) /\ ( ( dom g ) \ ( g " { ( 0 ) } ) ) ) by RFUNCT_1:def 1;
then ( [. x,x0 .] \ { x0 } ) c= ( ( dom g ) \ ( g " { ( 0 ) } ) ) by A16,XBOOLE_1:1;
then A51: (x in ( dom g ) & (not x in ( g " { ( 0 ) } ))) by A38,XBOOLE_0:def 5;
A52:now
assume ( g . x ) = ( 0 );
then ( g . x ) in { ( 0 ) } by TARSKI:def 1;
hence contradiction by A51,FUNCT_1:def 7;
end;
A53: [. x,x0 .] c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by A6,A21,XBOOLE_1:1;
then [. x,x0 .] c= ( ( dom ( f `| N ) ) /\ ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) ) by RFUNCT_1:def 1;
then [. x,x0 .] c= ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) by A15,XBOOLE_1:1;
then A54: (t in ( dom ( g `| N ) ) & (not t in ( ( g `| N ) " { ( 0 ) } ))) by A49,XBOOLE_0:def 5;
A55:now
assume ( diff (g,t) ) = ( 0 );
then ( ( g `| N ) . t ) = ( 0 ) by A4,A21,A49,FDIFF_1:def 7;
then ( ( g `| N ) . t ) in { ( 0 ) } by TARSKI:def 1;
hence contradiction by A54,FUNCT_1:def 7;
end;
g is_differentiable_in t by A4,A28,A44,FDIFF_1:9;
then ( 0 ) = ( ( ( f . x ) * ( diff (g,t) ) ) - ( ( g . x ) * ( diff (f,t) ) ) ) by A48,FDIFF_1:15;
then ( ( f . x ) / ( g . x ) ) = ( ( diff (f,t) ) / ( diff (g,t) ) ) by A52,A55,XCMPLX_1:94;
then ( ( f . x ) * ( ( g . x ) " ) ) = ( ( diff (f,t) ) / ( diff (g,t) ) ) by XCMPLX_0:def 9;
then ( ( f . x ) * ( ( g . x ) " ) ) = ( ( diff (f,t) ) * ( ( diff (g,t) ) " ) ) by XCMPLX_0:def 9;
then ( ( f / g ) . x ) = ( ( diff (f,t) ) * ( ( diff (g,t) ) " ) ) by A50,A38,RFUNCT_1:def 1;
then ( ( f / g ) . x ) = ( ( ( f `| N ) . t ) * ( ( diff (g,t) ) " ) ) by A3,A21,A49,FDIFF_1:def 7;
then ( ( f / g ) . x ) = ( ( ( f `| N ) . t ) * ( ( ( g `| N ) . t ) " ) ) by A4,A21,A49,FDIFF_1:def 7;
hence thesis by A44,A53,A49,RFUNCT_1:def 1;
end;
A56: (for a holds (((a is  convergent & ( lim a ) = x0) & ( rng a ) c= ( ( dom ( f / g ) ) /\ ( left_open_halfline x0 ) )) implies (( ( f / g ) /* a ) is  convergent & ( lim ( ( f / g ) /* a ) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) ))))
proof
reconsider d = ( ( NAT ) --> x0 ) as Real_Sequence;
let a;
assume that
A57: a is  convergent
and
A58: ( lim a ) = x0
and
A59: ( rng a ) c= ( ( dom ( f / g ) ) /\ ( left_open_halfline x0 ) );
consider k such that A60: (for n holds (k <= n implies (( x0 - r ) < ( a . n ) & ( a . n ) < ( x0 + r )))) by A9,A11,A57,A58,LIMFUNC3:7;
set a1 = ( a ^\ k );
defpred X[ (Element of ( NAT )), real number ]
 means
($2 in ]. ( a1 . $1 ),x0 .[ & ( ( ( ( f / g ) /* a ) ^\ k ) . $1 ) = ( ( ( f `| N ) / ( g `| N ) ) . $2 ));
A61:now
let n;
( a . ( n + k ) ) in ( rng a ) by VALUED_0:28;
then ( a . ( n + k ) ) in ( left_open_halfline x0 ) by A59,XBOOLE_0:def 4;
then ( a . ( n + k ) ) in { g1: g1 < x0 } by XXREAL_1:229;
then (ex g1 st (( a . ( n + k ) ) = g1 & g1 < x0));
hence ( a1 . n ) < x0 by NAT_1:def 3;
(( a1 . n ) = ( a . ( n + k ) ) & k <= ( n + k )) by NAT_1:12,NAT_1:def 3;
hence ( x0 - r ) < ( a1 . n ) by A60;
end;
A62: (for n holds (ex c being Real st X[ n,c ]))
proof
let n;
A63: ( rng a1 ) c= ( rng a ) by VALUED_0:21;
(( x0 - r ) < ( a1 . n ) & ( a1 . n ) < x0) by A61;
then consider c such that A64: c in ]. ( a1 . n ),x0 .[ and A65: ( ( f / g ) . ( a1 . n ) ) = ( ( ( f `| N ) / ( g `| N ) ) . c ) by A12;
take c;
A66: ( ( dom ( f / g ) ) /\ ( left_open_halfline x0 ) ) c= ( dom ( f / g ) ) by XBOOLE_1:17;
then ( rng a ) c= ( dom ( f / g ) ) by A59,XBOOLE_1:1;
then ( ( ( f / g ) /* ( a ^\ k ) ) . n ) = ( ( ( f `| N ) / ( g `| N ) ) . c ) by A65,A63,FUNCT_2:108,XBOOLE_1:1;
hence thesis by A59,A64,A66,VALUED_0:27,XBOOLE_1:1;
end;
consider b such that A67: (for n holds X[ n,( b . n ) ]) from FUNCT_2:sch 3(A62);
A68: x0 < ( x0 + r ) by A9,XREAL_1:29;
( x0 - r ) < x0 by A9,XREAL_1:44;
then x0 in { g2: (( x0 - r ) < g2 & g2 < ( x0 + r )) } by A68;
then A69: x0 in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
A70: ( rng b ) c= ( ( dom ( ( f `| N ) / ( g `| N ) ) ) /\ ( left_open_halfline x0 ) )
proof
let x being set;
assume x in ( rng b );
then consider n such that A71: x = ( b . n ) by FUNCT_2:113;
( a1 . n ) < x0 by A61;
then A72: ( a1 . n ) < ( x0 + r ) by A68,XXREAL_0:2;
( x0 - r ) < ( a1 . n ) by A61;
then ( a1 . n ) in { g3: (( x0 - r ) < g3 & g3 < ( x0 + r )) } by A72;
then ( a1 . n ) in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
then (]. ( a1 . n ),x0 .[ c= [. ( a1 . n ),x0 .] & [. ( a1 . n ),x0 .] c= ]. ( x0 - r ),( x0 + r ) .[) by A69,XXREAL_1:25,XXREAL_2:def 12;
then ]. ( a1 . n ),x0 .[ c= ]. ( x0 - r ),( x0 + r ) .[ by XBOOLE_1:1;
then A73: ]. ( a1 . n ),x0 .[ c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by A6,A10,XBOOLE_1:1;
A74: x in ]. ( a1 . n ),x0 .[ by A67,A71;
then x in { g1: (( a1 . n ) < g1 & g1 < x0) } by RCOMP_1:def 2;
then (ex g1 st ((g1 = x & ( a1 . n ) < g1) & g1 < x0));
then x in { g2: g2 < x0 };
then x in ( left_open_halfline x0 ) by XXREAL_1:229;
hence thesis by A74,A73,XBOOLE_0:def 4;
end;
A75:now
let n;
( b . n ) in ]. ( a1 . n ),x0 .[ by A67;
then ( b . n ) in { g1: (( a1 . n ) < g1 & g1 < x0) } by RCOMP_1:def 2;
then (ex g1 st ((g1 = ( b . n ) & ( a1 . n ) < g1) & g1 < x0));
hence (( a1 . n ) <= ( b . n ) & ( b . n ) <= ( d . n )) by FUNCOP_1:7;
end;
A76: ( lim d ) = ( d . ( 0 ) ) by SEQ_4:26
.= x0 by FUNCOP_1:7;
( lim a1 ) = x0 by A57,A58,SEQ_4:20;
then A77: (b is  convergent & ( lim b ) = x0) by A57,A76,A75,SEQ_2:19,SEQ_2:20;
A78: ( ( dom ( ( f `| N ) / ( g `| N ) ) ) /\ ( left_open_halfline x0 ) ) c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by XBOOLE_1:17;
then A79: ( rng b ) c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by A70,XBOOLE_1:1;
then A80: ( ( ( f `| N ) / ( g `| N ) ) /* b ) is  convergent by A8,A77,FCONT_1:def 1;
A81:now
take m = ( 0 );
let n;
assume that
m <= n;
( ( ( ( f / g ) /* a ) ^\ k ) . n ) = ( ( ( f `| N ) / ( g `| N ) ) . ( b . n ) ) by A67;
hence ( ( ( ( f / g ) /* a ) ^\ k ) . n ) = ( ( ( ( f `| N ) / ( g `| N ) ) /* b ) . n ) by A70,A78,FUNCT_2:108,XBOOLE_1:1;
end;
( lim ( ( ( f `| N ) / ( g `| N ) ) /* b ) ) = ( ( ( f `| N ) / ( g `| N ) ) . x0 ) by A8,A77,A79,FCONT_1:def 1;
then ( lim ( ( ( f `| N ) / ( g `| N ) ) /* b ) ) = ( ( ( f `| N ) . x0 ) * ( ( ( g `| N ) . x0 ) " ) ) by A6,A10,A69,RFUNCT_1:def 1
.= ( ( diff (f,x0) ) * ( ( ( g `| N ) . x0 ) " ) ) by A3,A10,A69,FDIFF_1:def 7
.= ( ( diff (f,x0) ) * ( ( diff (g,x0) ) " ) ) by A4,A10,A69,FDIFF_1:def 7;
then ( lim ( ( ( f / g ) /* a ) ^\ k ) ) = ( ( diff (f,x0) ) * ( ( diff (g,x0) ) " ) ) by A80,A81,SEQ_4:19;
then A82: ( lim ( ( ( f / g ) /* a ) ^\ k ) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) ) by XCMPLX_0:def 9;
( ( ( f / g ) /* a ) ^\ k ) is  convergent by A80,A81,SEQ_4:18;
hence thesis by A82,SEQ_4:21,SEQ_4:22;
end;
A83: (for r1 holds (for r2 holds ((r1 < x0 & x0 < r2) implies (ex g1 st (ex g2 st (((((r1 < g1 & g1 < x0) & g1 in ( dom ( f / g ) )) & g2 < r2) & x0 < g2) & g2 in ( dom ( f / g ) ))))))) by A5,CKB4:1;
then (for r1 holds (r1 < x0 implies (ex t st ((r1 < t & t < x0) & t in ( dom ( f / g ) ))))) by LIMFUNC3:8;
then A84: (( f / g ) is_left_convergent_in x0 & ( lim_left (( f / g ),x0) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) )) by A56,CKB3:1;
A85: (for x holds ((x0 < x & x < ( x0 + r )) implies (ex c st (c in ]. x0,x .[ & ( ( f / g ) . x ) = ( ( ( f `| N ) / ( g `| N ) ) . c )))))
proof
A86: ( x0 - r ) < x0 by A9,XREAL_1:44;
( x0 + ( 0 ) ) < ( x0 + r ) by A9,XREAL_1:8;
then x0 in { g1: (( x0 - r ) < g1 & g1 < ( x0 + r )) } by A86;
then A87: x0 in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
A88: ( ( dom ( f `| N ) ) /\ ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) ) c= ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) by XBOOLE_1:17;
A89: ( ( dom f ) /\ ( ( dom g ) \ ( g " { ( 0 ) } ) ) ) c= ( ( dom g ) \ ( g " { ( 0 ) } ) ) by XBOOLE_1:17;
let x;
assume that
A90: x0 < x
and
A91: x < ( x0 + r );
set f1 = ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) );
A92: (( dom ( ( f . x ) (#) g ) ) = ( dom g ) & ( dom ( ( g . x ) (#) f ) ) = ( dom f )) by VALUED_1:def 5;
then A93: ( dom ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) ) = ( ( dom f ) /\ ( dom g ) ) by VALUED_1:12;
( x0 - r ) < x by A90,A86,XXREAL_0:2;
then x in { g1: (( x0 - r ) < g1 & g1 < ( x0 + r )) } by A91;
then x in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
then A94: [. x0,x .] c= N by A10,A87,XXREAL_2:def 12;
then A95: ([. x0,x .] c= ( dom f ) & [. x0,x .] c= ( dom g )) by A1,A2,XBOOLE_1:1;
then A96: [. x0,x .] c= ( dom f1 ) by A93,XBOOLE_1:19;
( g | N ) is  continuous by A4,FDIFF_1:25;
then ( g | [. x0,x .] ) is  continuous by A94,FCONT_1:16;
then A97: ( ( ( f . x ) (#) g ) | [. x0,x .] ) is  continuous by A2,A94,FCONT_1:20,XBOOLE_1:1;
( f | N ) is  continuous by A3,FDIFF_1:25;
then ( f | [. x0,x .] ) is  continuous by A94,FCONT_1:16;
then A98: ( ( ( g . x ) (#) f ) | [. x0,x .] ) is  continuous by A1,A94,FCONT_1:20,XBOOLE_1:1;
[. x0,x .] c= ( dom ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) ) by A95,A93,XBOOLE_1:19;
then A99: ( ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) | [. x0,x .] ) is  continuous by A92,A93,A98,A97,FCONT_1:18;
A100: ]. x0,x .[ c= [. x0,x .] by XXREAL_1:25;
then A101: ]. x0,x .[ c= N by A94,XBOOLE_1:1;
A102: x in [. x0,x .] by A90,XXREAL_1:1;
then x in ( dom f1 ) by A96;
then A103: x in ( ( dom ( ( f . x ) (#) g ) ) /\ ( dom ( ( g . x ) (#) f ) ) ) by VALUED_1:12;
then A104: x in ( dom ( ( f . x ) (#) g ) ) by XBOOLE_0:def 4;
A105: x0 in [. x0,x .] by A90,XXREAL_1:1;
then x0 in ( dom f1 ) by A96;
then A106: x0 in ( ( dom ( ( f . x ) (#) g ) ) /\ ( dom ( ( g . x ) (#) f ) ) ) by VALUED_1:12;
then A107: x0 in ( dom ( ( f . x ) (#) g ) ) by XBOOLE_0:def 4;
A108: x in ( dom ( ( g . x ) (#) f ) ) by A103,XBOOLE_0:def 4;
A109: ( f1 . x ) = ( ( ( ( f . x ) (#) g ) . x ) - ( ( ( g . x ) (#) f ) . x ) ) by A96,A102,VALUED_1:13
.= ( ( ( f . x ) * ( g . x ) ) - ( ( ( g . x ) (#) f ) . x ) ) by A104,VALUED_1:def 5
.= ( ( ( g . x ) * ( f . x ) ) - ( ( g . x ) * ( f . x ) ) ) by A108,VALUED_1:def 5
.= ( 0 );
A110: x0 in ( dom ( ( g . x ) (#) f ) ) by A106,XBOOLE_0:def 4;
(not x in { x0 }) by A90,TARSKI:def 1;
then A111: x in ( [. x0,x .] \ { x0 } ) by A102,XBOOLE_0:def 5;
N c= ( dom ( ( f . x ) (#) g ) ) by A2,VALUED_1:def 5;
then A112: ]. x0,x .[ c= ( dom ( ( f . x ) (#) g ) ) by A101,XBOOLE_1:1;
N c= ( dom ( ( g . x ) (#) f ) ) by A1,VALUED_1:def 5;
then A113: ]. x0,x .[ c= ( dom ( ( g . x ) (#) f ) ) by A101,XBOOLE_1:1;
then ]. x0,x .[ c= ( ( dom ( ( f . x ) (#) g ) ) /\ ( dom ( ( g . x ) (#) f ) ) ) by A112,XBOOLE_1:19;
then A114: ]. x0,x .[ c= ( dom ( ( ( f . x ) (#) g ) - ( ( g . x ) (#) f ) ) ) by VALUED_1:12;
f is_differentiable_on ]. x0,x .[ by A3,A94,A100,FDIFF_1:26,XBOOLE_1:1;
then A115: ( ( g . x ) (#) f ) is_differentiable_on ]. x0,x .[ by A113,FDIFF_1:20;
g is_differentiable_on ]. x0,x .[ by A4,A94,A100,FDIFF_1:26,XBOOLE_1:1;
then A116: ( ( f . x ) (#) g ) is_differentiable_on ]. x0,x .[ by A112,FDIFF_1:20;
( f1 . x0 ) = ( ( ( ( f . x ) (#) g ) . x0 ) - ( ( ( g . x ) (#) f ) . x0 ) ) by A96,A105,VALUED_1:13
.= ( ( ( f . x ) * ( g . x0 ) ) - ( ( ( g . x ) (#) f ) . x0 ) ) by A107,VALUED_1:def 5
.= ( ( 0 ) - ( ( g . x ) * ( 0 ) ) ) by A7,A110,VALUED_1:def 5
.= ( 0 );
then consider t such that A117: t in ]. x0,x .[ and A118: ( diff (f1,t) ) = ( 0 ) by A90,A99,A115,A114,A116,A96,A109,FDIFF_1:19,ROLLE:1;
A119: ( ( g . x ) (#) f ) is_differentiable_in t by A115,A117,FDIFF_1:9;
A120: f is_differentiable_in t by A3,A101,A117,FDIFF_1:9;
( ( f . x ) (#) g ) is_differentiable_in t by A116,A117,FDIFF_1:9;
then ( 0 ) = ( ( diff (( ( f . x ) (#) g ),t) ) - ( diff (( ( g . x ) (#) f ),t) ) ) by A118,A119,FDIFF_1:14;
then A121: ( 0 ) = ( ( diff (( ( f . x ) (#) g ),t) ) - ( ( g . x ) * ( diff (f,t) ) ) ) by A120,FDIFF_1:15;
take t;
A122: t in [. x0,x .] by A100,A117;
( [. x0,x .] \ { x0 } ) c= ( N \ { x0 } ) by A94,XBOOLE_1:33;
then A123: ( [. x0,x .] \ { x0 } ) c= ( dom ( f / g ) ) by A5,XBOOLE_1:1;
then ( [. x0,x .] \ { x0 } ) c= ( ( dom f ) /\ ( ( dom g ) \ ( g " { ( 0 ) } ) ) ) by RFUNCT_1:def 1;
then ( [. x0,x .] \ { x0 } ) c= ( ( dom g ) \ ( g " { ( 0 ) } ) ) by A89,XBOOLE_1:1;
then A124: (x in ( dom g ) & (not x in ( g " { ( 0 ) } ))) by A111,XBOOLE_0:def 5;
A125:now
assume ( g . x ) = ( 0 );
then ( g . x ) in { ( 0 ) } by TARSKI:def 1;
hence contradiction by A124,FUNCT_1:def 7;
end;
A126: [. x0,x .] c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by A6,A94,XBOOLE_1:1;
then [. x0,x .] c= ( ( dom ( f `| N ) ) /\ ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) ) by RFUNCT_1:def 1;
then [. x0,x .] c= ( ( dom ( g `| N ) ) \ ( ( g `| N ) " { ( 0 ) } ) ) by A88,XBOOLE_1:1;
then A127: (t in ( dom ( g `| N ) ) & (not t in ( ( g `| N ) " { ( 0 ) } ))) by A122,XBOOLE_0:def 5;
A128:now
assume ( diff (g,t) ) = ( 0 );
then ( ( g `| N ) . t ) = ( 0 ) by A4,A94,A122,FDIFF_1:def 7;
then ( ( g `| N ) . t ) in { ( 0 ) } by TARSKI:def 1;
hence contradiction by A127,FUNCT_1:def 7;
end;
g is_differentiable_in t by A4,A101,A117,FDIFF_1:9;
then ( 0 ) = ( ( ( f . x ) * ( diff (g,t) ) ) - ( ( g . x ) * ( diff (f,t) ) ) ) by A121,FDIFF_1:15;
then ( ( f . x ) / ( g . x ) ) = ( ( diff (f,t) ) / ( diff (g,t) ) ) by A125,A128,XCMPLX_1:94;
then ( ( f . x ) * ( ( g . x ) " ) ) = ( ( diff (f,t) ) / ( diff (g,t) ) ) by XCMPLX_0:def 9;
then ( ( f . x ) * ( ( g . x ) " ) ) = ( ( diff (f,t) ) * ( ( diff (g,t) ) " ) ) by XCMPLX_0:def 9;
then ( ( f / g ) . x ) = ( ( diff (f,t) ) * ( ( diff (g,t) ) " ) ) by A123,A111,RFUNCT_1:def 1;
then ( ( f / g ) . x ) = ( ( ( f `| N ) . t ) * ( ( diff (g,t) ) " ) ) by A3,A94,A122,FDIFF_1:def 7;
then ( ( f / g ) . x ) = ( ( ( f `| N ) . t ) * ( ( ( g `| N ) . t ) " ) ) by A4,A94,A122,FDIFF_1:def 7;
hence thesis by A117,A126,A122,RFUNCT_1:def 1;
end;
A129: (for a holds (((a is  convergent & ( lim a ) = x0) & ( rng a ) c= ( ( dom ( f / g ) ) /\ ( right_open_halfline x0 ) )) implies (( ( f / g ) /* a ) is  convergent & ( lim ( ( f / g ) /* a ) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) ))))
proof
reconsider d = ( ( NAT ) --> x0 ) as Real_Sequence;
let a;
assume that
A130: a is  convergent
and
A131: ( lim a ) = x0
and
A132: ( rng a ) c= ( ( dom ( f / g ) ) /\ ( right_open_halfline x0 ) );
consider k such that A133: (for n holds (k <= n implies (( x0 - r ) < ( a . n ) & ( a . n ) < ( x0 + r )))) by A9,A11,A130,A131,LIMFUNC3:7;
set a1 = ( a ^\ k );
defpred X[ (Element of ( NAT )), real number ]
 means
($2 in ]. x0,( a1 . $1 ) .[ & ( ( ( ( f / g ) /* a ) ^\ k ) . $1 ) = ( ( ( f `| N ) / ( g `| N ) ) . $2 ));
A134:now
let n;
( a . ( n + k ) ) in ( rng a ) by VALUED_0:28;
then ( a . ( n + k ) ) in ( right_open_halfline x0 ) by A132,XBOOLE_0:def 4;
then ( a . ( n + k ) ) in { g1: x0 < g1 } by XXREAL_1:230;
then (ex g1 st (( a . ( n + k ) ) = g1 & x0 < g1));
hence x0 < ( a1 . n ) by NAT_1:def 3;
(( a1 . n ) = ( a . ( n + k ) ) & k <= ( n + k )) by NAT_1:12,NAT_1:def 3;
hence ( a1 . n ) < ( x0 + r ) by A133;
end;
A135: (for n holds (ex c being Real st X[ n,c ]))
proof
let n;
A136: ( rng a1 ) c= ( rng a ) by VALUED_0:21;
(x0 < ( a1 . n ) & ( a1 . n ) < ( x0 + r )) by A134;
then consider c such that A137: c in ]. x0,( a1 . n ) .[ and A138: ( ( f / g ) . ( a1 . n ) ) = ( ( ( f `| N ) / ( g `| N ) ) . c ) by A85;
take c;
A139: ( ( dom ( f / g ) ) /\ ( right_open_halfline x0 ) ) c= ( dom ( f / g ) ) by XBOOLE_1:17;
then ( rng a ) c= ( dom ( f / g ) ) by A132,XBOOLE_1:1;
then ( ( ( f / g ) /* ( a ^\ k ) ) . n ) = ( ( ( f `| N ) / ( g `| N ) ) . c ) by A138,A136,FUNCT_2:108,XBOOLE_1:1;
hence thesis by A132,A137,A139,VALUED_0:27,XBOOLE_1:1;
end;
consider b such that A140: (for n holds X[ n,( b . n ) ]) from FUNCT_2:sch 3(A135);
A141: ( x0 - r ) < x0 by A9,XREAL_1:44;
x0 < ( x0 + r ) by A9,XREAL_1:29;
then x0 in { g2: (( x0 - r ) < g2 & g2 < ( x0 + r )) } by A141;
then A142: x0 in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
A143: ( rng b ) c= ( ( dom ( ( f `| N ) / ( g `| N ) ) ) /\ ( right_open_halfline x0 ) )
proof
let x being set;
assume x in ( rng b );
then consider n such that A144: x = ( b . n ) by FUNCT_2:113;
x0 < ( a1 . n ) by A134;
then A145: ( x0 - r ) < ( a1 . n ) by A141,XXREAL_0:2;
( a1 . n ) < ( x0 + r ) by A134;
then ( a1 . n ) in { g3: (( x0 - r ) < g3 & g3 < ( x0 + r )) } by A145;
then ( a1 . n ) in ]. ( x0 - r ),( x0 + r ) .[ by RCOMP_1:def 2;
then (]. x0,( a1 . n ) .[ c= [. x0,( a1 . n ) .] & [. x0,( a1 . n ) .] c= ]. ( x0 - r ),( x0 + r ) .[) by A142,XXREAL_1:25,XXREAL_2:def 12;
then ]. x0,( a1 . n ) .[ c= ]. ( x0 - r ),( x0 + r ) .[ by XBOOLE_1:1;
then A146: ]. x0,( a1 . n ) .[ c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by A6,A10,XBOOLE_1:1;
A147: x in ]. x0,( a1 . n ) .[ by A140,A144;
then x in { g1: (x0 < g1 & g1 < ( a1 . n )) } by RCOMP_1:def 2;
then (ex g1 st ((g1 = x & x0 < g1) & g1 < ( a1 . n )));
then x in { g2: x0 < g2 };
then x in ( right_open_halfline x0 ) by XXREAL_1:230;
hence thesis by A147,A146,XBOOLE_0:def 4;
end;
A148:now
let n;
( b . n ) in ]. x0,( a1 . n ) .[ by A140;
then ( b . n ) in { g1: (x0 < g1 & g1 < ( a1 . n )) } by RCOMP_1:def 2;
then (ex g1 st ((g1 = ( b . n ) & x0 < g1) & g1 < ( a1 . n )));
hence (( d . n ) <= ( b . n ) & ( b . n ) <= ( a1 . n )) by FUNCOP_1:7;
end;
A149: ( lim d ) = ( d . ( 0 ) ) by SEQ_4:26
.= x0 by FUNCOP_1:7;
( lim a1 ) = x0 by A130,A131,SEQ_4:20;
then A150: (b is  convergent & ( lim b ) = x0) by A130,A149,A148,SEQ_2:19,SEQ_2:20;
A151: ( ( dom ( ( f `| N ) / ( g `| N ) ) ) /\ ( right_open_halfline x0 ) ) c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by XBOOLE_1:17;
then A152: ( rng b ) c= ( dom ( ( f `| N ) / ( g `| N ) ) ) by A143,XBOOLE_1:1;
then A153: ( ( ( f `| N ) / ( g `| N ) ) /* b ) is  convergent by A8,A150,FCONT_1:def 1;
A154:now
take m = ( 0 );
let n;
assume that
m <= n;
( ( ( ( f / g ) /* a ) ^\ k ) . n ) = ( ( ( f `| N ) / ( g `| N ) ) . ( b . n ) ) by A140;
hence ( ( ( ( f / g ) /* a ) ^\ k ) . n ) = ( ( ( ( f `| N ) / ( g `| N ) ) /* b ) . n ) by A143,A151,FUNCT_2:108,XBOOLE_1:1;
end;
( lim ( ( ( f `| N ) / ( g `| N ) ) /* b ) ) = ( ( ( f `| N ) / ( g `| N ) ) . x0 ) by A8,A150,A152,FCONT_1:def 1;
then ( lim ( ( ( f `| N ) / ( g `| N ) ) /* b ) ) = ( ( ( f `| N ) . x0 ) * ( ( ( g `| N ) . x0 ) " ) ) by A6,A10,A142,RFUNCT_1:def 1
.= ( ( diff (f,x0) ) * ( ( ( g `| N ) . x0 ) " ) ) by A3,A10,A142,FDIFF_1:def 7
.= ( ( diff (f,x0) ) * ( ( diff (g,x0) ) " ) ) by A4,A10,A142,FDIFF_1:def 7;
then ( lim ( ( ( f / g ) /* a ) ^\ k ) ) = ( ( diff (f,x0) ) * ( ( diff (g,x0) ) " ) ) by A153,A154,SEQ_4:19;
then A155: ( lim ( ( ( f / g ) /* a ) ^\ k ) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) ) by XCMPLX_0:def 9;
( ( ( f / g ) /* a ) ^\ k ) is  convergent by A153,A154,SEQ_4:18;
hence thesis by A155,SEQ_4:21,SEQ_4:22;
end;
(for r1 holds (x0 < r1 implies (ex t st ((t < r1 & x0 < t) & t in ( dom ( f / g ) ))))) by A83,LIMFUNC3:8;
then (( f / g ) is_right_convergent_in x0 & ( lim_right (( f / g ),x0) ) = ( ( diff (f,x0) ) / ( diff (g,x0) ) )) by A129,CKB2:1;
hence thesis by A84,LIMFUNC3:30;
end;
