environ
vocabularies NUMBERS,XBOOLE_0,SUBSET_1,FINSEQ_1,RELAT_1,PARTFUN1,CARD_1,FUNCT_1,TARSKI,XXREAL_0,ARYTM_1,ARYTM_3,NAT_1,ORDERS_1,RELAT_2,GROUP_1,BINOP_1,ALGSTR_0,RLVECT_1,VECTSP_1,LATTICES,ZFMISC_1,FINSET_1,ALGSTR_1,STRUCT_0,SUPINF_2,CARD_3,FINSOP_1,ORDINAL4,PRE_POLY,FINSEQ_5,FUNCT_4,FUNCOP_1,ORDINAL1,WELLORD2,MESFUNC1,RFINSEQ,POLYNOM1,ALGSEQ_1,QC_LANG1,MSSUBFAM,QUOFIELD,POLYNOM2;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,CARD_1,NUMBERS,RELAT_1,FINSOP_1,RELAT_2,RELSET_1,FUNCT_1,FINSET_1,ORDINAL1,PARTFUN1,FUNCT_2,BINOP_1,FUNCT_4,FUNCT_7,REAL_1,NAT_1,ALGSTR_1,ORDERS_1,FINSEQ_1,STRUCT_0,ALGSTR_0,RLVECT_1,FUNCOP_1,VFUNCT_1,VECTSP_1,GROUP_1,GROUP_4,QUOFIELD,FINSEQ_5,GRCAT_1,RFINSEQ,YELLOW_1,GROUP_6,XXREAL_0,RECDEF_1,PRE_POLY,POLYNOM1,CKB20,CKB22,CKB24,CKB25;
definitions QUOFIELD,GROUP_1,BINOP_1,FUNCOP_1,ALGSTR_0,CKB20,CKB25;
theorems TARSKI,FINSEQ_1,FUNCT_1,FUNCT_2,ORDINAL1,RELAT_1,ZFMISC_1,VECTSP_1,POLYNOM1,RELAT_2,WELLORD2,FUNCT_7,FUNCT_4,FUNCOP_1,ORDERS_1,NAT_1,FINSEQ_4,GRCAT_1,INT_1,FINSEQ_3,RLVECT_1,GROUP_4,PARTFUN2,CARD_1,RFINSEQ,FINSOP_1,FINSEQ_5,CARD_2,FINSEQ_2,ALGSTR_1,GROUP_1,XBOOLE_0,XBOOLE_1,PARTFUN1,XREAL_1,GROUP_6,XXREAL_0,VALUED_0,PRE_POLY,CKB1,CKB2,CKB3,CKB4,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB23,CKB25,CKB26,CKB27,CKB28;
schemes FUNCT_2,NAT_1,RECDEF_1,INT_1;
registrations XBOOLE_0,ORDINAL1,RELSET_1,FUNCOP_1,FINSET_1,XXREAL_0,XREAL_0,NAT_1,INT_1,FINSEQ_1,STRUCT_0,VECTSP_1,ALGSTR_1,MONOID_0,POLYNOM1,VALUED_0,CARD_1,SUBSET_1,PRE_POLY,RELAT_1,VFUNCT_1,FUNCT_2,FUNCT_1,CKB5,CKB21;
constructors XXREAL_0,REAL_1,FINSOP_1,RFINSEQ,BINARITH,FINSEQ_5,GROUP_4,GRCAT_1,GROUP_6,MONOID_0,TRIANG_1,YELLOW_1,QUOFIELD,POLYNOM1,RECDEF_1,ALGSTR_1,RELSET_1,FUNCT_7,FVSUM_1,VFUNCT_1,CKB20,CKB22,CKB24,CKB25;
requirements NUMERALS,BOOLE,SUBSET,REAL,ARITHM;
begin
theorem
Lm8: (for n being Ordinal holds (for L being  right_zeroed  add-associative  right_complementable  well-unital  distributive non  trivial  commutative  associative non  empty doubleLoopStr holds (for b1,b2 being (bag of n) holds (for u being set holds ((((not u in ( support b1 )) & ( support b2 ) = ( ( support b1 ) \/ { u } )) & (for u9 being set holds (u9 <> u implies ( b2 . u9 ) = ( b1 . u9 )))) implies (for x being (Function of n,L) holds (for a being (Element of L) holds (a = ( ( power L ) . (( x . u ),( b2 . u )) ) implies ( eval (b2,x) ) = ( a * ( eval (b1,x) ) )))))))))
proof
let n being Ordinal;
let L being  right_zeroed  add-associative  right_complementable  well-unital  distributive  commutative  associative non  trivial doubleLoopStr;
let b1 being (bag of n);
let b2 being (bag of n);
let u being set;
assume that
A1: (not u in ( support b1 ))
and
A2: ( support b2 ) = ( ( support b1 ) \/ { u } )
and
A3: (for u9 being set holds (u9 <> u implies ( b2 . u9 ) = ( b1 . u9 )));
u in { u } by TARSKI:def 1;
then A4: u in ( support b2 ) by A2,XBOOLE_0:def 3;
set sb2 = ( SgmX (( RelIncl n ),( support b2 )) );
set sb1 = ( SgmX (( RelIncl n ),( support b1 )) );
let x being (Function of n,L);
A5: n = ( dom x ) by FUNCT_2:def 1;
let a being (Element of L);
assume A6: a = ( ( power L ) . (( x . u ),( b2 . u )) );
( RelIncl n ) linearly_orders ( support b2 ) by CKB23:1;
then u in ( rng sb2 ) by A4,PRE_POLY:def 2;
then consider k being Nat such that A7: k in ( dom sb2 ) and A8: ( sb2 . k ) = u by FINSEQ_2:10;
A9: ( sb2 /. k ) = u by A7,A8,PARTFUN1:def 6;
reconsider u as (Element of n) by A4;
A10: ( dom sb2 ) = ( Seg ( len sb2 ) ) by FINSEQ_1:def 3;
then A11: k <= ( len sb2 ) by A7,FINSEQ_1:1;
A12: 1 <= k by A7,A10,FINSEQ_1:1;
then ( 1 - 1 ) <= ( k - 1 ) by XREAL_1:9;
then reconsider k9 = ( k - 1 ) as (Element of ( NAT )) by INT_1:3;
A13: ( k9 + 1 ) = ( k + ( 0 ) );
A14: ( RelIncl n ) linearly_orders ( support b1 ) by CKB23:1;
per cases ;
suppose A15: n = ( {} );

A16: b2 in ( Bags n ) by PRE_POLY:def 12;
u in { u } by TARSKI:def 1;
then u in ( support b2 ) by A2,XBOOLE_0:def 3;
then A17: ( b2 . u ) <> ( 0 ) by PRE_POLY:def 7;
( Bags n ) = { ( EmptyBag n ) } by A15,PRE_POLY:51,TARSKI:def 1;
then b2 = ( EmptyBag n ) by A16,TARSKI:def 1;
hence thesis by A17,PRE_POLY:52;
end;
suppose n <> ( {} );

then reconsider n9 = n as non  empty Ordinal;
reconsider x9 = x as (Function of n9,L);
reconsider b1,b2 as (bag of n9);
reconsider sb2,sb1 as (FinSequence of n9);
reconsider u as (Element of n9);
consider yb2 being (FinSequence of (the carrier of L)) such that A18: ( len yb2 ) = ( len sb2 ) and A19: ( eval (b2,x9) ) = ( Product yb2 ) and A20: (for i being (Element of ( NAT )) holds ((1 <= i & i <= ( len yb2 )) implies ( yb2 /. i ) = ( ( power L ) . (( ( x * sb2 ) /. i ),( ( b2 * sb2 ) /. i )) ))) by CKB25:def 1;
consider yb1 being (FinSequence of (the carrier of L)) such that A21: ( len yb1 ) = ( len sb1 ) and A22: ( eval (b1,x9) ) = ( Product yb1 ) and A23: (for i being (Element of ( NAT )) holds ((1 <= i & i <= ( len yb1 )) implies ( yb1 /. i ) = ( ( power L ) . (( ( x * sb1 ) /. i ),( ( b1 * sb1 ) /. i )) ))) by CKB25:def 1;
set ytmp = ( Ins (yb1,k9,a) );
A24: ( ( len sb1 ) + 1 ) = ( ( card ( support b1 ) ) + 1 ) by CKB23:1,PRE_POLY:11
.= ( card ( support b2 ) ) by A1,A2,CARD_2:41
.= ( len sb2 ) by CKB23:1,PRE_POLY:11;
then A25: ( len yb2 ) = ( len ytmp ) by A18,A21,FINSEQ_5:69;
A26: sb2 = ( Ins (sb1,k9,u) ) by A1,A2,A7,A9,A13,CKB17:1,CKB23:1;
A27: (for i being Nat holds ((1 <= i & i <= ( len yb2 )) implies ( yb2 . i ) = ( ytmp . i )))
proof
let i being Nat;
assume that
A28: 1 <= i
and
A29: i <= ( len yb2 );
A30: i in ( Seg ( len yb2 ) ) by A28,A29,FINSEQ_1:1;
then A31: ( yb2 /. i ) = ( ( power L ) . (( ( x * ( Ins (sb1,k9,u) ) ) /. i ),( ( b2 * ( Ins (sb1,k9,u) ) ) /. i )) ) by A26,A20,A28,A29;
A32: i in ( dom yb2 ) by A30,FINSEQ_1:def 3;
i in ( Seg ( len ytmp ) ) by A25,A28,A29,FINSEQ_1:1;
then A33: i in ( dom ytmp ) by FINSEQ_1:def 3;
A34: ( 1 - 1 ) <= ( i - 1 ) by A28,XREAL_1:9;
then A35: ( i - 1 ) is (Element of ( NAT )) by INT_1:3;
now
per cases ;
case A36: i = k;
A37: ( sb2 . k ) in { u } by A8,TARSKI:def 1;
then A38: k in ( dom ( x * sb2 ) ) by A5,A7,A8,FUNCT_1:11;
then A39: ( ( x * sb2 ) /. k ) = ( ( x * sb2 ) . k ) by PARTFUN1:def 6
.= ( x . u ) by A8,A38,FUNCT_1:12;
A40: ( support b2 ) c= ( dom b2 ) by PRE_POLY:37;
( sb2 . k ) in ( support b2 ) by A2,A37,XBOOLE_0:def 3;
then A41: k in ( dom ( b2 * sb2 ) ) by A7,A40,FUNCT_1:11;
then ( ( b2 * sb2 ) /. k ) = ( ( b2 * sb2 ) . k ) by PARTFUN1:def 6
.= ( b2 . u ) by A8,A41,FUNCT_1:12;
then A42: ( yb2 /. i ) = ( ( power L ) . (( x . u ),( b2 . u )) ) by A20,A28,A29,A30,A36,A39;
A43: k9 <= ( len yb1 ) by A13,A18,A21,A24,A29,A36,XREAL_1:6;
thus ( ytmp . i ) = ( ytmp /. i ) by A33,PARTFUN1:def 6
.= ( yb2 /. i ) by A6,A13,A36,A43,A42,FINSEQ_5:73
.= ( yb2 . i ) by A32,PARTFUN1:def 6;
end;
case A44: i <> k;
( len ( Ins (sb1,k9,u) ) ) = ( ( len sb1 ) + 1 ) by FINSEQ_5:69;
then A45: ( dom ( Ins (sb1,k9,u) ) ) = ( Seg ( ( len sb1 ) + 1 ) ) by FINSEQ_1:def 3;
now
per cases  by A44,XXREAL_0:1;
case A46: i < k;
then A47: i <= k9 by A13,NAT_1:13;
then A48: i in ( Seg k9 ) by A28,FINSEQ_1:1;
A49: ( yb1 | ( Seg k9 ) ) is FinSequence by FINSEQ_1:15;
k9 <= ( len yb1 ) by A11,A13,A21,A24,XREAL_1:6;
then i in ( dom ( yb1 | ( Seg k9 ) ) ) by A48,A49,FINSEQ_1:17;
then A50: i in ( dom ( yb1 | k9 ) ) by FINSEQ_1:def 15;
A51: ( sb1 | ( Seg k9 ) ) is FinSequence by FINSEQ_1:15;
A52: ( rng sb1 ) c= n by FINSEQ_1:def 4;
A53: i < ( len yb2 ) by A11,A18,A46,XXREAL_0:2;
then A54: i <= ( len yb1 ) by A18,A21,A24,NAT_1:13;
i <= ( len sb1 ) by A18,A24,A53,NAT_1:13;
then i in ( Seg ( len sb1 ) ) by A28,FINSEQ_1:1;
then A55: i in ( dom sb1 ) by FINSEQ_1:def 3;
then A56: ( sb1 . i ) in ( rng sb1 ) by FUNCT_1:def 3;
then A57: i in ( dom ( x * sb1 ) ) by A5,A55,A52,FUNCT_1:11;
A58:now
assume ( sb1 /. i ) = u;
then ( sb1 . i ) = u by A55,PARTFUN1:def 6;
then u in ( rng sb1 ) by A55,FUNCT_1:def 3;
hence contradiction by A1,A14,PRE_POLY:def 2;
end;
A59: ( k - 1 ) <= ( ( ( len sb1 ) + 1 ) - 1 ) by A11,A24,XREAL_1:9;
A60: ( rng ( Ins (sb1,k9,u) ) ) c= n by FINSEQ_1:def 4;
( sb1 . i ) in n by A56,A52;
then ( sb1 . i ) in ( dom b1 ) by PARTFUN1:def 2;
then A61: i in ( dom ( b1 * sb1 ) ) by A55,FUNCT_1:11;
i in ( Seg k9 ) by A28,A47,FINSEQ_1:1;
then i in ( dom ( sb1 | ( Seg k9 ) ) ) by A59,A51,FINSEQ_1:17;
then A62: i in ( dom ( sb1 | k9 ) ) by FINSEQ_1:def 15;
i <= ( ( len sb1 ) + 1 ) by A11,A24,A46,XXREAL_0:2;
then A63: i in ( dom ( Ins (sb1,k9,u) ) ) by A28,A45,FINSEQ_1:1;
then A64: ( ( Ins (sb1,k9,u) ) . i ) in ( rng ( Ins (sb1,k9,u) ) ) by FUNCT_1:def 3;
then A65: i in ( dom ( x * ( Ins (sb1,k9,u) ) ) ) by A5,A63,A60,FUNCT_1:11;
then A66: ( ( x * ( Ins (sb1,k9,u) ) ) /. i ) = ( ( x * ( Ins (sb1,k9,u) ) ) . i ) by PARTFUN1:def 6
.= ( x . ( ( Ins (sb1,k9,u) ) . i ) ) by A65,FUNCT_1:12
.= ( x . ( ( Ins (sb1,k9,u) ) /. i ) ) by A63,PARTFUN1:def 6
.= ( x . ( sb1 /. i ) ) by A62,FINSEQ_5:72
.= ( x . ( sb1 . i ) ) by A55,PARTFUN1:def 6
.= ( ( x * sb1 ) . i ) by A57,FUNCT_1:12
.= ( ( x * sb1 ) /. i ) by A57,PARTFUN1:def 6;
( dom b2 ) = n by PARTFUN1:def 2;
then A67: i in ( dom ( b2 * ( Ins (sb1,k9,u) ) ) ) by A63,A64,A60,FUNCT_1:11;
then ( ( b2 * ( Ins (sb1,k9,u) ) ) /. i ) = ( ( b2 * ( Ins (sb1,k9,u) ) ) . i ) by PARTFUN1:def 6
.= ( b2 . ( ( Ins (sb1,k9,u) ) . i ) ) by A67,FUNCT_1:12
.= ( b2 . ( ( Ins (sb1,k9,u) ) /. i ) ) by A63,PARTFUN1:def 6
.= ( b2 . ( sb1 /. i ) ) by A62,FINSEQ_5:72
.= ( b1 . ( sb1 /. i ) ) by A3,A58
.= ( b1 . ( sb1 . i ) ) by A55,PARTFUN1:def 6
.= ( ( b1 * sb1 ) . i ) by A61,FUNCT_1:12
.= ( ( b1 * sb1 ) /. i ) by A61,PARTFUN1:def 6;
then A68: ( yb2 /. i ) = ( yb1 /. i ) by A23,A28,A30,A31,A54,A66
.= ( ytmp /. i ) by A50,FINSEQ_5:72;
thus ( yb2 . i ) = ( yb2 /. i ) by A32,PARTFUN1:def 6
.= ( ytmp . i ) by A33,A68,PARTFUN1:def 6;
end;
case A69: i > k;
reconsider i1 = ( i - 1 ) as (Element of ( NAT )) by A34,INT_1:3;
A70: ( ( i - 1 ) + 1 ) = ( i + ( 0 ) );
A71: ( rng sb1 ) c= n by FINSEQ_1:def 4;
A72: ( i - 1 ) <= ( ( len sb2 ) - 1 ) by A18,A29,XREAL_1:9;
1 < i by A12,A69,XXREAL_0:2;
then A73: 1 <= ( i - 1 ) by A35,A70,NAT_1:13;
then i1 in ( Seg ( len sb1 ) ) by A24,A72,FINSEQ_1:1;
then A74: i1 in ( dom sb1 ) by FINSEQ_1:def 3;
then A75: ( sb1 . i1 ) in ( rng sb1 ) by FUNCT_1:def 3;
then A76: i1 in ( dom ( x * sb1 ) ) by A5,A74,A71,FUNCT_1:11;
( dom b1 ) = n by PARTFUN1:def 2;
then A77: i1 in ( dom ( b1 * sb1 ) ) by A74,A75,A71,FUNCT_1:11;
A78:now
assume ( sb1 /. i1 ) = u;
then ( sb1 . i1 ) = u by A74,PARTFUN1:def 6;
then u in ( rng sb1 ) by A74,FUNCT_1:def 3;
hence contradiction by A1,A14,PRE_POLY:def 2;
end;
A79: i = ( i1 + 1 );
A80: ( rng ( Ins (sb1,k9,u) ) ) c= n by FINSEQ_1:def 4;
A81: ( i1 + 1 ) = ( i + ( 0 ) );
then A82: ( k9 + 1 ) <= i1 by A69,NAT_1:13;
A83: i in ( dom ( Ins (sb1,k9,u) ) ) by A18,A24,A28,A29,A45,FINSEQ_1:1;
then A84: ( ( Ins (sb1,k9,u) ) . i ) in ( rng ( Ins (sb1,k9,u) ) ) by FUNCT_1:def 3;
then A85: i in ( dom ( x * ( Ins (sb1,k9,u) ) ) ) by A5,A83,A80,FUNCT_1:11;
then A86: ( ( x * ( Ins (sb1,k9,u) ) ) /. i ) = ( ( x * ( Ins (sb1,k9,u) ) ) . i ) by PARTFUN1:def 6
.= ( x . ( ( Ins (sb1,k9,u) ) . i ) ) by A85,FUNCT_1:12
.= ( x . ( ( Ins (sb1,k9,u) ) /. i ) ) by A83,PARTFUN1:def 6
.= ( x . ( sb1 /. i1 ) ) by A24,A72,A81,A82,FINSEQ_5:74
.= ( x . ( sb1 . i1 ) ) by A74,PARTFUN1:def 6
.= ( ( x * sb1 ) . i1 ) by A76,FUNCT_1:12
.= ( ( x * sb1 ) /. i1 ) by A76,PARTFUN1:def 6;
( dom b2 ) = n by PARTFUN1:def 2;
then A87: i in ( dom ( b2 * ( Ins (sb1,k9,u) ) ) ) by A83,A84,A80,FUNCT_1:11;
then ( ( b2 * ( Ins (sb1,k9,u) ) ) /. i ) = ( ( b2 * ( Ins (sb1,k9,u) ) ) . i ) by PARTFUN1:def 6
.= ( b2 . ( ( Ins (sb1,k9,u) ) . i ) ) by A87,FUNCT_1:12
.= ( b2 . ( ( Ins (sb1,k9,u) ) /. i ) ) by A83,PARTFUN1:def 6
.= ( b2 . ( sb1 /. i1 ) ) by A24,A72,A81,A82,FINSEQ_5:74
.= ( b1 . ( sb1 /. i1 ) ) by A3,A78
.= ( b1 . ( sb1 . i1 ) ) by A74,PARTFUN1:def 6
.= ( ( b1 * sb1 ) . i1 ) by A77,FUNCT_1:12
.= ( ( b1 * sb1 ) /. i1 ) by A77,PARTFUN1:def 6;
then A88: ( yb2 /. i ) = ( yb1 /. i1 ) by A21,A23,A24,A31,A73,A72,A86
.= ( ytmp /. i ) by A21,A24,A72,A79,A82,FINSEQ_5:74;
thus ( yb2 . i ) = ( yb2 /. i ) by A32,PARTFUN1:def 6
.= ( ytmp . i ) by A33,A88,PARTFUN1:def 6;
end;
end;
hence thesis;
end;
end;
hence thesis;
end;
( Product ( ( ( yb1 | k9 ) ^ <* a *> ) ^ ( yb1 /^ k9 ) ) ) = ( ( Product ( ( yb1 | k9 ) ^ <* a *> ) ) * ( Product ( yb1 /^ k9 ) ) ) by GROUP_4:5
.= ( ( ( Product ( yb1 | k9 ) ) * ( Product <* a *> ) ) * ( Product ( yb1 /^ k9 ) ) ) by GROUP_4:5
.= ( ( ( Product ( yb1 | k9 ) ) * ( Product ( yb1 /^ k9 ) ) ) * ( Product <* a *> ) ) by GROUP_1:def 3
.= ( ( Product ( ( yb1 | k9 ) ^ ( yb1 /^ k9 ) ) ) * ( Product <* a *> ) ) by GROUP_4:5
.= ( ( Product yb1 ) * ( Product <* a *> ) ) by RFINSEQ:8
.= ( ( eval (b1,x9) ) * a ) by A22,GROUP_4:9;
then ( Product ytmp ) = ( ( eval (b1,x9) ) * a ) by FINSEQ_5:def 4;
hence thesis by A19,A25,A27,FINSEQ_1:14;
end;
end;
