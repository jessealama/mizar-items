environ
vocabularies FINSEQ_1,RELAT_1,SUBSET_1,NUMBERS,ARYTM_3,XXREAL_0,NAT_1,CARD_1,FUNCT_1,TARSKI,STRUCT_0,XBOOLE_0,MSUALG_1,PBOOLE,TREES_3,MSAFREE,DTCONSTR,LANG1,ZFMISC_1,TREES_4,TDGROUP,CARD_3,TREES_2,FINSET_1,MARGREL1,PARTFUN1,TREES_9,ORDINAL4,ORDINAL1,TREES_1,MCART_1,FUNCT_6,TREES_A,QC_LANG1,MSATERM;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,NAT_1,MCART_1,RELAT_1,STRUCT_0,FUNCT_1,PARTFUN1,FINSEQ_1,FINSEQ_2,FUNCT_2,FINSET_1,TREES_1,TREES_2,CARD_3,FUNCT_6,LANG1,TREES_3,TREES_4,TREES_9,PBOOLE,MSUALG_1,DTCONSTR,MSUALG_3,MSAFREE,XXREAL_0,CKB2,CKB4,CKB5,CKB6,CKB9,CKB10,CKB12,CKB23,CKB24,CKB25,CKB31,CKB47,CKB48,CKB52,CKB53,CKB55;
definitions TARSKI,PBOOLE,XBOOLE_0,CKB2,CKB6,CKB23,CKB24,CKB31,CKB47,CKB48,CKB53,CKB55;
theorems TARSKI,NAT_1,ZFMISC_1,MCART_1,CARD_3,FUNCT_1,FINSEQ_1,FUNCT_2,FINSEQ_3,FINSEQ_4,CARD_5,FUNCT_6,TREES_1,TREES_2,MODAL_1,TREES_3,TREES_4,LANG1,DTCONSTR,TREES_9,PBOOLE,MSUALG_1,MSAFREE,DOMAIN_1,RELAT_1,XBOOLE_0,FINSET_1,XREAL_1,ORDINAL1,PARTFUN1,FINSEQ_2,CKB1,CKB2,CKB6,CKB7,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB53,CKB54,CKB55,CKB56,CKB57;
schemes TREES_2,CLASSES1,DTCONSTR,PBOOLE,CKB8,CKB11,CKB26;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,XREAL_0,FINSEQ_1,PBOOLE,TREES_2,TREES_3,TREES_9,STRUCT_0,DTCONSTR,MSUALG_1,MSUALG_2,MSAFREE,FINSET_1,TREES_1,RELSET_1,CKB3,CKB13;
constructors XXREAL_0,NAT_1,NAT_D,TREES_9,MSUALG_3,MSAFREE,RELSET_1,FINSEQ_2,CKB2,CKB5,CKB6,CKB12,CKB23,CKB24,CKB25,CKB31,CKB47,CKB48,CKB52,CKB53,CKB55;
requirements NUMERALS,BOOLE,SUBSET,ARITHM;
begin
Lm2:now
let n being (Element of ( NAT ));
let x being set;
let p being (FinSequence of x);
n >= ( 0 ) by NAT_1:2;
then A1: ( n + 1 ) >= ( ( 0 ) + 1 ) by XREAL_1:7;
assume n < ( len p );
then ( n + 1 ) <= ( len p ) by NAT_1:13;
then ( n + 1 ) in ( dom p ) by A1,FINSEQ_3:25;
then A2: ( p . ( n + 1 ) ) in ( rng p ) by FUNCT_1:def 3;
( rng p ) c= x by FINSEQ_1:def 4;
hence ( p . ( n + 1 ) ) in x by A2;
end;
reserve S for non  void non  empty ManySortedSign;
reserve A for  non-empty MSAlgebra over S;
reserve V for (Variables of A);
reserve f for (ManySortedFunction of V,(the Sorts of A));
theorem
Th33: (for o being (OperSymbol of S) holds (for p being (ArgumentSeq of o,A,V) holds (for q being  DTree-yielding FinSequence holds ((( len q ) = ( len p ) & (for i being Nat holds (for t being (c-Term of A,V) holds ((i in ( dom p ) & t = ( p . i )) implies (ex vt being  finite DecoratedTree st (vt = ( q . i ) & vt is_an_evaluation_of t,f)))))) implies (ex vt being  finite DecoratedTree st (vt = ( ( ( Den (o,A) ) . ( roots q ) ) -tree q ) & vt is_an_evaluation_of (( ( Sym (o,( (the Sorts of A) \/ V )) ) -tree p ) qua (c-Term of A,V)),f))))))
proof
let o being (OperSymbol of S);
let p being (ArgumentSeq of o,A,V);
A1: ( Sym (o,( (the Sorts of A) \/ V )) ) = [ o,(the carrier of S) ] by MSAFREE:def 9;
A2: ( dom ( doms p ) ) = ( dom p ) by TREES_3:37;
A3: ( tree ( doms p ) ) = ( dom ( [ o,(the carrier of S) ] -tree p ) ) by TREES_4:10;
A4: ( dom p ) = ( Seg ( len p ) ) by FINSEQ_1:def 3;
let q being  DTree-yielding FinSequence;
assume that
A5: ( len q ) = ( len p )
and
A6: (for i being Nat holds (for t being (c-Term of A,V) holds ((i in ( dom p ) & t = ( p . i )) implies (ex vt being  finite DecoratedTree st (vt = ( q . i ) & vt is_an_evaluation_of t,f)))));
A7: ( dom q ) = ( Seg ( len q ) ) by FINSEQ_1:def 3;
now
let x being set;
A8: ( rng p ) c= ( S -Terms ( (the Sorts of A) \/ V ) ) by FINSEQ_1:def 4;
assume A9: x in ( dom ( doms q ) );
then A10: x in ( dom q ) by TREES_3:37;
then ( p . x ) in ( rng p ) by A5,A4,A7,FUNCT_1:def 3;
then reconsider t = ( p . x ) as (c-Term of A,V) by A8;
reconsider i = x as Nat by A9;
consider vt being  finite DecoratedTree such that A11: vt = ( q . i ) and vt is_an_evaluation_of t,f by A5,A6,A4,A7,A10;
( ( doms q ) . x ) = ( dom vt ) by A10,A11,FUNCT_6:22;
hence ( ( doms q ) . x ) is  finite  finite Tree;
end;
then reconsider r = ( doms q ) as  FinTree-yielding FinSequence by TREES_3:23;
A12:now
let i being Nat;
A13: ( rng p ) c= ( S -Terms ( (the Sorts of A) \/ V ) ) by FINSEQ_1:def 4;
assume A14: i in ( dom p );
then ( p . i ) in ( rng p ) by FUNCT_1:def 3;
then reconsider t = ( p . i ) as (c-Term of A,V) by A13;
consider vt being  finite DecoratedTree such that A15: vt = ( q . i ) and A16: vt is_an_evaluation_of t,f by A6,A14;
thus ( r . i ) = ( dom vt ) by A5,A4,A7,A14,A15,FUNCT_6:22
.= ( dom t ) by A16,CKB55:def 1
.= ( ( doms p ) . i ) by A14,FUNCT_6:22;
end;
set vt = ( ( ( Den (o,A) ) . ( roots q ) ) -tree q );
A17: ( len ( doms q ) ) = ( len q ) by TREES_3:38;
A18: ( dom vt ) = ( tree r ) by TREES_4:10;
then reconsider vt as  finite DecoratedTree by FINSET_1:10;
take vt;
thus vt = ( ( ( Den (o,A) ) . ( roots q ) ) -tree q );
( dom ( doms q ) ) = ( dom q ) by TREES_3:37;
hence ( dom vt ) = ( dom ( ( Sym (o,( (the Sorts of A) \/ V )) ) -tree p ) ) by A1,A5,A4,A7,A18,A3,A2,A12,FINSEQ_1:13;
let n being (Node of vt);
A19: ( ( [ o,(the carrier of S) ] -tree p ) . ( {} ) ) = [ o,(the carrier of S) ] by TREES_4:def 4;
hereby
let s being (SortSymbol of S);
let v being (Element of ( V . s ));
assume A20: ( ( ( Sym (o,( (the Sorts of A) \/ V )) ) -tree p ) . n ) = [ v,s ];
now
assume n = ( {} );
then s = (the carrier of S) by A1,A19,A20,ZFMISC_1:27;
hence contradiction by CKB30:1;
end;
then consider w being (FinSequence of ( NAT )),i being (Element of ( NAT )) such that A21: n = ( <* i *> ^ w ) by FINSEQ_2:130;
A22: w in ( ( doms q ) . ( i + 1 ) ) by A18,A21,TREES_3:48;
A23: i < ( len p ) by A5,A18,A17,A21,TREES_3:48;
then reconsider t = ( p . ( i + 1 ) ) as (c-Term of A,V) by Lm2;
consider e being  finite DecoratedTree such that A24: e = ( q . ( i + 1 ) ) and A25: e is_an_evaluation_of t,f by A6,A23,CKB50:1;
( i + 1 ) in ( dom p ) by A23,CKB50:1;
then reconsider w as (Node of e) by A5,A4,A7,A22,A24,FUNCT_6:22;
( dom e ) = ( dom t ) by A25,CKB55:def 1;
then A26: ( t . w ) = [ v,s ] by A20,A21,A23,TREES_4:12;
thus ( vt . n ) = ( e . w ) by A5,A21,A23,A24,TREES_4:12
.= ( ( f . s ) . v ) by A25,A26,CKB55:def 1;
end;
hereby
let s being (SortSymbol of S);
let x being (Element of ( (the Sorts of A) . s ));
assume A27: ( ( ( Sym (o,( (the Sorts of A) \/ V )) ) -tree p ) . n ) = [ x,s ];
now
assume n = ( {} );
then s = (the carrier of S) by A1,A19,A27,ZFMISC_1:27;
hence contradiction by CKB30:1;
end;
then consider w being (FinSequence of ( NAT )),i being (Element of ( NAT )) such that A28: n = ( <* i *> ^ w ) by FINSEQ_2:130;
A29: w in ( ( doms q ) . ( i + 1 ) ) by A18,A28,TREES_3:48;
A30: i < ( len p ) by A5,A18,A17,A28,TREES_3:48;
then reconsider t = ( p . ( i + 1 ) ) as (c-Term of A,V) by Lm2;
consider e being  finite DecoratedTree such that A31: e = ( q . ( i + 1 ) ) and A32: e is_an_evaluation_of t,f by A6,A30,CKB50:1;
( i + 1 ) in ( dom p ) by A30,CKB50:1;
then reconsider w as (Node of e) by A5,A4,A7,A29,A31,FUNCT_6:22;
( dom e ) = ( dom t ) by A32,CKB55:def 1;
then A33: ( t . w ) = [ x,s ] by A27,A28,A30,TREES_4:12;
thus ( vt . n ) = ( e . w ) by A5,A28,A30,A31,TREES_4:12
.= x by A32,A33,CKB55:def 1;
end;
let o1 being (OperSymbol of S);
assume A34: ( ( ( Sym (o,( (the Sorts of A) \/ V )) ) -tree p ) . n ) = [ o1,(the carrier of S) ];
per cases ;
suppose A35: n = ( {} );

then ( ( ( Sym (o,( (the Sorts of A) \/ V )) ) -tree p ) . n ) = ( Sym (o,( (the Sorts of A) \/ V )) ) by TREES_4:def 4
.= [ o,(the carrier of S) ] by MSAFREE:def 9;
then A36: o = o1 by A34,ZFMISC_1:27;
( succ (vt,n) ) = ( roots q ) by A35,TREES_9:30;
hence thesis by A35,A36,TREES_4:def 4;
end;
suppose n <> ( {} );

then consider w being (FinSequence of ( NAT )),i being (Element of ( NAT )) such that A37: n = ( <* i *> ^ w ) by FINSEQ_2:130;
reconsider ii = <* i *> as (Node of vt) by A37,TREES_1:21;
A38: w in ( ( doms q ) . ( i + 1 ) ) by A18,A37,TREES_3:48;
A39: i < ( len p ) by A5,A18,A17,A37,TREES_3:48;
then reconsider t = ( p . ( i + 1 ) ) as (c-Term of A,V) by Lm2;
consider e being  finite DecoratedTree such that A40: e = ( q . ( i + 1 ) ) and A41: e is_an_evaluation_of t,f by A6,A39,CKB50:1;
A42: e = ( vt | ii ) by A5,A39,A40,TREES_4:def 4;
( i + 1 ) in ( dom p ) by A39,CKB50:1;
then reconsider w as (Node of e) by A5,A4,A7,A38,A40,FUNCT_6:22;
( dom e ) = ( dom t ) by A41,CKB55:def 1;
then ( t . w ) = [ o1,(the carrier of S) ] by A34,A37,A39,TREES_4:12;
then ( e . w ) = ( ( Den (o1,A) ) . ( succ (e,w) ) ) by A41,CKB55:def 1
.= ( ( Den (o1,A) ) . ( succ (vt,n) ) ) by A37,A42,TREES_9:31;
hence thesis by A5,A37,A39,A40,TREES_4:12;
end;
end;
