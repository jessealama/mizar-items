environ
vocabularies NUMBERS,NAT_1,XBOOLE_0,VECTSP_1,SUBSET_1,MATRIX_2,FUNCT_2,FINSEQ_1,FUNCT_1,ARYTM_3,SGRAPH1,XXREAL_0,TARSKI,CARD_1,FINSET_1,ORDINAL1,RELAT_1,ALGSTR_0,SETWISEO,BINOP_1,STRUCT_0,GROUP_1,ARYTM_1,FINSUB_1,INT_1,SUPINF_2,ABSVALUE,FINSEQ_2,CARD_3,ORDINAL4,FINSOP_1,ABIAN,MATRIX_1,TREES_1,ZFMISC_1,INCSP_1,AFINSQ_1,PARTFUN1,MATRIX_3,RLVECT_1,RVSUM_1,FVSUM_1,FUNCT_5,FUNCT_4,MATRIX11;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,XCMPLX_0,XXREAL_0,FINSET_1,RELAT_1,FUNCT_1,PARTFUN1,FUNCT_2,FINSEQ_1,BINOP_1,STRUCT_0,ALGSTR_0,NAT_D,RLVECT_1,GROUP_1,VECTSP_1,SETWISEO,SETWOP_2,FINSEQ_2,FINSEQOP,MATRIX_1,FINSUB_1,MATRIX_2,NAT_1,FVSUM_1,CAT_2,FINSOP_1,GROUP_4,MATRIX_3,CARD_1,FINSEQ_7,FUNCT_4,ORDINAL1,SGRAPH1,MATRIX_6,CKB1,CKB9,CKB18,CKB39,CKB40,CKB54,CKB74;
definitions BINOP_1,FINSEQ_2,FINSEQ_1,TARSKI,XBOOLE_0,MATRIX_1,MATRIX_3,FVSUM_1,RELAT_1,ALGSTR_0,CKB9,CKB18,CKB39,CKB54,CKB74;
theorems FINSEQ_1,FINSEQ_2,TARSKI,FUNCT_2,NAT_1,BINOP_1,FUNCT_1,SETWISEO,VECTSP_1,ZFMISC_1,FVSUM_1,SETWOP_2,MATRIX_1,MATRIX_2,FUNCOP_1,FINSUB_1,FINSEQ_3,RLVECT_1,RELAT_1,FINSOP_1,XBOOLE_0,XBOOLE_1,GROUP_1,MATRIX_3,FINSEQ_5,FINSET_1,GROUP_4,XREAL_1,MATRIX_7,ORDINAL1,MATRIX_4,CARD_1,CARD_2,MATRIX_9,STIRL2_1,RADIX_1,REWRITE1,FINSEQ_7,SGRAPH1,WELLORD2,FRAENKEL,FUNCT_5,FUNCT_4,NAT_D,XXREAL_0,PARTFUN1,CKB2,CKB3,CKB4,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB39,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67,CKB68,CKB69,CKB70,CKB71,CKB72,CKB73,CKB74,CKB75,CKB78,CKB79,CKB80,CKB81,CKB82,CKB83,CKB84;
schemes FUNCT_2,NAT_1,FINSEQ_1,FINSEQ_2,MATRIX_1,BINOP_1,FUNCT_1,SETWISEO;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,PARTFUN1,FUNCT_2,FINSET_1,FINSUB_1,XXREAL_0,XREAL_0,NAT_1,FINSEQ_1,STRUCT_0,GROUP_1,VECTSP_1,MATRIX_2,FVSUM_1,CARD_1,RELSET_1,FINSEQ_2,CKB5,CKB6,CKB7,CKB8,CKB38,CKB76,CKB77;
constructors RELAT_2,WELLORD2,SETWISEO,XXREAL_0,NAT_1,NAT_D,FINSOP_1,SETWOP_2,FINSEQ_7,CAT_2,ALGSTR_1,GROUP_4,FVSUM_1,SGRAPH1,MATRIX_6,MATRIX_7,RELSET_1,CKB9,CKB18,CKB39,CKB54,CKB74;
requirements ARITHM,NUMERALS,REAL,BOOLE,SUBSET;
begin
reserve x for set;
reserve i for Nat;
reserve n for Nat;
reserve K for Field;
reserve perm for (Element of ( Permutations n ));
reserve s for (Element of ( 2Set ( Seg ( n + 2 ) ) ));
reserve A for (Matrix of n,K);
theorem
Th61: (for A,B being (Matrix of n,K) holds (( 0 ) < n implies (ex P being (Function of ( Permutations n ),(the carrier of K)) st (( Det ( A * B ) ) = ( (the addF of K) $$ (( FinOmega ( Permutations n ) ),P) ) & (for perm being (Element of ( Permutations n )) holds ( P . perm ) = ( ( (the multF of K) $$ ( Path_matrix (perm,A) ) ) * ( - (( Det B ),perm) ) ))))))
proof
let A being (Matrix of n,K);
let B being (Matrix of n,K);
assume that
A1: ( 0 ) < n;
set P = ( Permutations n );
A2: ( dom ( id P ) ) = P by RELAT_1:45;
set KK = (the carrier of K);
set mm = (the multF of K);
set aa = (the addF of K);
set AB = ( A * B );
set X = ( Seg n );
set F = ( Funcs (X,X) );
consider SUM1 being (Function of F,KK) such that A3: (for F being (Function of X,X) holds (ex Path being (FinSequence of K) st ((( len Path ) = n & (for Fj,j being Nat holds ((j in ( Seg n ) & Fj = ( F . j )) implies ( Path . j ) = ( A * (j,Fj) )))) & ( SUM1 . F ) = ( ( mm $$ Path ) * ( Det ( B * F ) ) )))) and A4: ( Det AB ) = ( aa $$ (( FinOmega F ),SUM1) ) by A1,CKB84:1;
A5: F is  finite by FRAENKEL:6;
then reconsider FP = ( F \ P ) as (Element of ( Fin F )) by FINSUB_1:def 5;
A6: P c= F
proof
let x;
assume x in P;
then reconsider p = x as (Permutation of X) by MATRIX_2:def 9;
p is (Element of F) by FUNCT_2:9;
hence thesis;
end;
then reconsider P9 = P as (Element of ( Fin F )) by A5,FINSUB_1:def 5;
A7: P = ( FinOmega P ) by MATRIX_2:26,MATRIX_2:def 14;
A8: ( FinOmega F ) = F by FRAENKEL:6,MATRIX_2:def 14;
A9:now
per cases ;
suppose FP = ( {} );

then F c= P by XBOOLE_1:37;
hence ( Det AB ) = ( aa $$ (P9,SUM1) ) by A4,A8,A6,XBOOLE_0:def 10;
end;
suppose A10: FP <> ( {} );

A11: ( 0. K ) = ( the_unity_wrt aa ) by FVSUM_1:7;
A12: ( SUM1 .: FP ) c= { ( 0. K ) }
proof
let s being set;
assume s in ( SUM1 .: FP );
then consider x such that x in ( dom SUM1 ) and A13: x in FP and A14: s = ( SUM1 . x ) by FUNCT_1:def 6;
reconsider f = x as (Function of X,X) by A13,FUNCT_2:66;
(not f in P) by A13,XBOOLE_0:def 5;
then A15: ( Det ( B * f ) ) = ( 0. K ) by CKB73:1;
(ex Path being (FinSequence of K) st ((( len Path ) = n & (for Fj,j being Nat holds ((j in ( Seg n ) & Fj = ( f . j )) implies ( Path . j ) = ( A * (j,Fj) )))) & ( SUM1 . f ) = ( ( mm $$ Path ) * ( Det ( B * f ) ) ))) by A3;
then ( SUM1 . f ) = ( 0. K ) by A15,VECTSP_1:6;
hence thesis by A14,TARSKI:def 1;
end;
( dom SUM1 ) = F by FUNCT_2:def 1;
then ( SUM1 .: FP ) = { ( 0. K ) } by A10,A12,ZFMISC_1:33;
then A16: ( aa $$ (FP,SUM1) ) = ( 0. K ) by A11,FVSUM_1:8,SETWOP_2:8;
A17: FP misses P by XBOOLE_1:79;
A18: ( FP \/ P ) = ( F \/ P ) by XBOOLE_1:39;
( F \/ P ) = F by A6,XBOOLE_1:12;
hence ( Det AB ) = ( ( aa $$ (P9,SUM1) ) + ( 0. K ) ) by A4,A8,A16,A17,A18,FVSUM_1:8,SETWOP_2:4
.= ( aa $$ (P9,SUM1) ) by RLVECT_1:4;
end;
end;
( dom SUM1 ) = F by FUNCT_2:def 1;
then A19: ( dom ( SUM1 | P ) ) = P by A6,RELAT_1:62;
( rng ( SUM1 | P ) ) c= KK by RELAT_1:def 19;
then reconsider SP = ( SUM1 | P ) as (Function of P,KK) by A19,FUNCT_2:2;
take SP;
A20: ( rng ( id P ) ) = P by RELAT_1:45;
( SP * ( id P ) ) = SP by A19,RELAT_1:52;
hence ( Det AB ) = ( aa $$ (( FinOmega P ),SP) ) by A9,A2,A20,A7,SETWOP_2:5;
let perm being (Element of P);
reconsider Perm = perm as (Permutation of X) by MATRIX_2:def 9;
( SUM1 . Perm ) = ( SP . Perm ) by A19,FUNCT_1:47;
then consider Path being (FinSequence of K) such that A21: ( len Path ) = n and A22: (for Fj,j being Nat holds ((j in ( Seg n ) & Fj = ( Perm . j )) implies ( Path . j ) = ( A * (j,Fj) ))) and A23: ( SP . Perm ) = ( ( mm $$ Path ) * ( Det ( B * Perm ) ) ) by A3;
set PM = ( Path_matrix (perm,A) );
A24: ( len PM ) = n by MATRIX_3:def 7;
now
A25: X = ( dom Perm ) by FUNCT_2:52;
let i being Nat;
assume that
A26: 1 <= i
and
A27: i <= ( len Path );
A28: i in ( NAT ) by ORDINAL1:def 12;
then A29: i in X by A21,A26,A27;
i in X by A21,A26,A27,A28;
then A30: ( Perm . i ) in ( rng Perm ) by A25,FUNCT_1:def 3;
( rng Perm ) c= X by RELAT_1:def 19;
then ( Perm . i ) in X by A30;
then reconsider Pi = ( Perm . i ) as (Element of ( NAT ));
( dom PM ) = X by A24,FINSEQ_1:def 3;
then ( PM . i ) = ( A * (i,Pi) ) by A29,MATRIX_3:def 7;
hence ( Path . i ) = ( PM . i ) by A22,A29;
end;
then Path = PM by A21,A24,FINSEQ_1:14;
hence thesis by A23,CKB64:1;
end;
