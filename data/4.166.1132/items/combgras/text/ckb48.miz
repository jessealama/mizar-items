environ
vocabularies NUMBERS,INCSP_1,SUBSET_1,CARD_1,XBOOLE_0,ARYTM_3,TARSKI,ORDINAL1,FINSET_1,RELAT_1,ARYTM_1,NAT_1,FUNCT_1,XXREAL_0,FDIFF_1,WELLORD2,ZFMISC_1,ANPROJ_2,AFF_2,MOD_4,FUNCT_2,PRE_POLY,SETFAM_1,COMBGRAS;
notations TARSKI,XBOOLE_0,SUBSET_1,ORDINAL1,ENUMSET1,ZFMISC_1,SETFAM_1,DOMAIN_1,FINSET_1,RELAT_1,RELSET_1,WELLORD2,CARD_1,NUMBERS,INCSP_1,XXREAL_0,REAL_1,FUNCT_1,FUNCT_2,INCPROJ,NAT_1,CKB11,CKB12,CKB17,CKB18,CKB19,CKB20,CKB23,CKB24,CKB25,CKB27,CKB29,CKB30,CKB31,CKB32,CKB33,CKB40;
definitions TARSKI,INCSP_1,INCPROJ,FUNCT_1,RELAT_1,CKB12,CKB17,CKB18,CKB19,CKB20,CKB24,CKB25,CKB27,CKB29,CKB30,CKB31,CKB32,CKB33,CKB40;
theorems ENUMSET1,TARSKI,ZFMISC_1,XBOOLE_0,XBOOLE_1,XREAL_1,SETFAM_1,PENCIL_1,INCSP_1,WELLORD2,CARD_1,CARD_2,NAT_1,ORDINAL1,CARD_FIL,STIRL2_1,CARD_FIN,XXREAL_0,INCPROJ,FUNCT_1,FUNCT_2,RELAT_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47;
schemes FUNCT_1,NAT_1,CLASSES1;
registrations XBOOLE_0,SUBSET_1,FUNCT_1,ORDINAL1,FUNCT_2,FINSET_1,XXREAL_0,XREAL_0,NAT_1,CARD_1,INCSP_1,RELSET_1,CKB10,CKB23;
constructors SETFAM_1,WELLORD2,DOMAIN_1,XXREAL_0,REAL_1,NAT_1,BINOP_2,INCPROJ,RELSET_1,CKB12,CKB17,CKB18,CKB19,CKB20,CKB23,CKB24,CKB25,CKB27,CKB29,CKB30,CKB31,CKB32,CKB33,CKB40;
requirements BOOLE,SUBSET,NUMERALS,ARITHM,REAL;
begin
reserve x for set;
reserve y for set;
theorem
Th31: (for k being (Element of ( NAT )) holds (for X being non empty set holds ((( 0 ) < k & ( k + 3 ) c= ( card X )) implies (for F being IncProjMap over ( G_ (( k + 1 ),X) ),( G_ (( k + 1 ),X) ) holds (F is  automorphism implies (ex H being IncProjMap over ( G_ (k,X) ),( G_ (k,X) ) st ((H is  automorphism & (the line-map of H) = (the point-map of F)) & (for A being (POINT of ( G_ (k,X) )) holds (for B being  finite set holds (B = A implies ( H . A ) = ( meet ( F .: ( ^^ (B,X,( k + 1 )) ) ) )))))))))))
proof
let k being (Element of ( NAT ));
let X being non empty set;
assume that
A1: ( 0 ) < k
and
A2: ( k + 3 ) c= ( card X );
let F being IncProjMap over ( G_ (( k + 1 ),X) ),( G_ (( k + 1 ),X) );
assume that
A3: F is  automorphism;
( ( 0 ) + 2 ) < ( k + ( 1 + 1 ) ) by A1,XREAL_1:6;
then ( ( 0 ) + 2 ) < ( ( k + 1 ) + 1 );
then A4: 2 <= ( k + 1 ) by NAT_1:13;
defpred P[ set,set ]
 means
(ex B being  finite set st (B = $1 & $2 = ( meet ( F .: ( ^^ (B,X,( k + 1 )) ) ) )));
( ( k + 1 ) + ( 0 ) ) <= ( ( k + 1 ) + 2 ) by XREAL_1:6;
then ( k + 1 ) c= ( k + 3 ) by NAT_1:39;
then A5: ( k + 1 ) c= ( card X ) by A2,XBOOLE_1:1;
then A6: (the Points of ( G_ (k,X) )) = { A where A is (Subset of X): ( card A ) = k } by A1,CKB12:def 1;
A7: (for e being set holds (e in (the Points of ( G_ (k,X) )) implies (ex u being set st P[ e,u ])))
proof
let e being set;
assume e in (the Points of ( G_ (k,X) ));
then (ex B being (Subset of X) st (B = e & ( card B ) = k)) by A6;
then reconsider B = e as  finite (Subset of X);
take ( meet ( F .: ( ^^ (B,X,( k + 1 )) ) ) );
thus thesis;
end;
consider Hp being Function such that A8: ( dom Hp ) = (the Points of ( G_ (k,X) )) and A9: (for e being set holds (e in (the Points of ( G_ (k,X) )) implies P[ e,( Hp . e ) ])) from CLASSES1:sch 1(A7);
A10: (the Lines of ( G_ (k,X) )) = { L where L is (Subset of X): ( card L ) = ( k + 1 ) } by A1,A5,CKB12:def 1;
( ( k + 1 ) + 1 ) <= ( ( k + 1 ) + 2 ) by XREAL_1:6;
then ( k + 2 ) c= ( k + 3 ) by NAT_1:39;
then A11: ( ( k + 1 ) + 1 ) c= ( card X ) by A2,XBOOLE_1:1;
then A12: (the Points of ( G_ (( k + 1 ),X) )) = { A where A is (Subset of X): ( card A ) = ( k + 1 ) } by CKB12:def 1;
then reconsider Hl = (the point-map of F) as (Function of (the Lines of ( G_ (k,X) )),(the Lines of ( G_ (k,X) ))) by A10;
A13: ( ( k + 1 ) + 2 ) c= ( card X ) by A2;
( rng Hp ) c= (the Points of ( G_ (k,X) ))
proof
let y being set;
assume y in ( rng Hp );
then consider x being set such that A14: x in ( dom Hp ) and A15: y = ( Hp . x ) by FUNCT_1:def 3;
consider B being  finite set such that A16: B = x and A17: y = ( meet ( F .: ( ^^ (B,X,( k + 1 )) ) ) ) by A8,A9,A14,A15;
A18: (ex x1 being (Subset of X) st (x = x1 & ( card x1 ) = k)) by A6,A8,A14;
then ( card B ) = ( ( k + 1 ) - 1 ) by A16;
then ( ^^ (B,X,( k + 1 )) ) is  STAR by A11,A16,A18,CKB46:1;
then ( F .: ( ^^ (B,X,( k + 1 )) ) ) is  STAR by A3,A4,A13,CKB39:1;
then consider S being (Subset of X) such that A19: ( card S ) = ( ( k + 1 ) - 1 ) and A20: ( F .: ( ^^ (B,X,( k + 1 )) ) ) = { C where C is (Subset of X): (( card C ) = ( k + 1 ) & S c= C) } by CKB19:def 1;
S = ( meet ( F .: ( ^^ (B,X,( k + 1 )) ) ) ) by A11,A19,A20,CKB43:1;
hence thesis by A6,A17,A19;
end;
then reconsider Hp as (Function of (the Points of ( G_ (k,X) )),(the Points of ( G_ (k,X) ))) by A8,FUNCT_2:2;
A21: (the point-map of F) is  bijective by A3,CKB29:def 1;
A22: Hp is  one-to-one
proof
let x1 being set,x2 being set;
assume that
A23: x1 in ( dom Hp )
and
A24: x2 in ( dom Hp )
and
A25: ( Hp . x1 ) = ( Hp . x2 );
consider X2 being  finite set such that A26: X2 = x2 and A27: ( Hp . x2 ) = ( meet ( F .: ( ^^ (X2,X,( k + 1 )) ) ) ) by A9,A24;
A28: (ex x12 being (Subset of X) st (x2 = x12 & ( card x12 ) = k)) by A6,A8,A24;
then A29: ( card X2 ) = ( ( k + 1 ) - 1 ) by A26;
then A30: ( meet ( ^^ (X2,X,( k + 1 )) ) ) = X2 by A11,A26,A28,CKB47:1;
( ^^ (X2,X,( k + 1 )) ) is  STAR by A11,A26,A28,A29,CKB46:1;
then A31: ( F .: ( ^^ (X2,X,( k + 1 )) ) ) is  STAR by A3,A4,A13,CKB39:1;
consider X1 being  finite set such that A32: X1 = x1 and A33: ( Hp . x1 ) = ( meet ( F .: ( ^^ (X1,X,( k + 1 )) ) ) ) by A9,A23;
A34: (ex x11 being (Subset of X) st (x1 = x11 & ( card x11 ) = k)) by A6,A8,A23;
then ( card X1 ) = ( ( k + 1 ) - 1 ) by A32;
then ( ^^ (X1,X,( k + 1 )) ) is  STAR by A11,A32,A34,CKB46:1;
then A35: ( F .: ( ^^ (X1,X,( k + 1 )) ) ) is  STAR by A3,A4,A13,CKB39:1;
( meet ( ^^ (X1,X,( k + 1 )) ) ) = X1 by A11,A32,A34,A29,CKB47:1;
hence thesis by A11,A21,A25,A32,A33,A26,A27,A35,A31,A30,CKB6:1,CKB45:1;
end;
take H = IncProjMap (# Hp,Hl #);
A36: ( dom (the point-map of F) ) = (the Points of ( G_ (( k + 1 ),X) )) by FUNCT_2:52;
A37: H is  incidence_preserving
proof
let A1 being (POINT of ( G_ (k,X) ));
let L1 being (LINE of ( G_ (k,X) ));
A38: P[ A1,( Hp . A1 ) ] by A9;
L1 in (the Lines of ( G_ (k,X) ));
then A39: (ex l1 being (Subset of X) st (l1 = L1 & ( card l1 ) = ( k + 1 ))) by A10;
A1 in (the Points of ( G_ (k,X) ));
then consider a1 being (Subset of X) such that A40: a1 = A1 and A41: ( card a1 ) = k by A6;
consider L11 being (POINT of ( G_ (( k + 1 ),X) )) such that A42: L11 = L1 by A10,A12;
reconsider a1 as  finite (Subset of X) by A41;
A43: ( card a1 ) = ( ( k + 1 ) - 1 ) by A41;
A44: (( H . A1 ) on ( H . L1 ) implies A1 on L1)
proof
(( F " ( F .: ( ^^ (a1,X,( k + 1 )) ) ) ) c= ( ^^ (a1,X,( k + 1 )) ) & ( ^^ (a1,X,( k + 1 )) ) c= ( F " ( F .: ( ^^ (a1,X,( k + 1 )) ) ) )) by A21,A36,FUNCT_1:76,FUNCT_1:82;
then A45: ( F " ( F .: ( ^^ (a1,X,( k + 1 )) ) ) ) = ( ^^ (a1,X,( k + 1 )) ) by XBOOLE_0:def 10;
( H . L1 ) in (the Lines of ( G_ (k,X) ));
then A46: (ex hl1 being (Subset of X) st (hl1 = ( H . L1 ) & ( card hl1 ) = ( k + 1 ))) by A10;
( ^^ (a1,X,( k + 1 )) ) is  STAR by A11,A43,CKB46:1;
then ( F .: ( ^^ (a1,X,( k + 1 )) ) ) is  STAR by A3,A4,A13,CKB39:1;
then consider S being (Subset of X) such that A47: ( card S ) = ( ( k + 1 ) - 1 ) and A48: ( F .: ( ^^ (a1,X,( k + 1 )) ) ) = { A where A is (Subset of X): (( card A ) = ( k + 1 ) & S c= A) } by CKB19:def 1;
( H . A1 ) in (the Points of ( G_ (k,X) ));
then consider ha1 being (Subset of X) such that A49: ha1 = ( H . A1 ) and A50: ( card ha1 ) = k by A6;
reconsider ha1,S as  finite (Subset of X) by A50,A47;
A51: ( ^^ (ha1,X,( k + 1 )) ) = ( ^^ (ha1,X) ) by A11,A50,A47,CKB33:def 1;
assume ( H . A1 ) on ( H . L1 );
then ( H . A1 ) c= ( H . L1 ) by A1,A5,CKB13:1;
then ( F . L11 ) in ( ^^ (ha1,X,( k + 1 )) ) by A42,A49,A50,A46,A51;
then L1 in ( F " ( ^^ (ha1,X,( k + 1 )) ) ) by A36,A42,FUNCT_1:def 7;
then A52: ( meet ( F " ( ^^ (ha1,X,( k + 1 )) ) ) ) c= L1 by SETFAM_1:3;
( ^^ (S,X,( k + 1 )) ) = ( ^^ (S,X) ) by A11,A47,CKB33:def 1;
then A53: S = ( meet ( F .: ( ^^ (a1,X,( k + 1 )) ) ) ) by A11,A47,A48,CKB47:1;
( meet ( ^^ (a1,X,( k + 1 )) ) ) = a1 by A11,A41,A47,CKB47:1;
hence thesis by A1,A5,A40,A38,A49,A50,A48,A51,A53,A52,A45,CKB13:1;
end;
A54: ( ^^ (a1,X,( k + 1 )) ) = ( ^^ (a1,X) ) by A11,A43,CKB33:def 1;
(A1 on L1 implies ( H . A1 ) on ( H . L1 ))
proof
assume A1 on L1;
then A1 c= L1 by A1,A5,CKB13:1;
then L1 in ( ^^ (a1,X,( k + 1 )) ) by A40,A41,A39,A54;
then ( F . L11 ) in ( F .: ( ^^ (a1,X,( k + 1 )) ) ) by A36,A42,FUNCT_1:def 6;
then ( meet ( F .: ( ^^ (a1,X,( k + 1 )) ) ) ) c= ( F . L11 ) by SETFAM_1:3;
hence thesis by A1,A5,A40,A42,A38,CKB13:1;
end;
hence thesis by A44;
end;
A55: ( rng (the point-map of F) ) = (the Points of ( G_ (( k + 1 ),X) )) by A21,FUNCT_2:def 3;
(for y holds (y in (the Points of ( G_ (k,X) )) implies (ex x st (x in (the Points of ( G_ (k,X) )) & y = ( Hp . x )))))
proof
let y being set;
assume y in (the Points of ( G_ (k,X) ));
then A56: (ex Y1 being (Subset of X) st (y = Y1 & ( card Y1 ) = k)) by A6;
then reconsider y as  finite (Subset of X);
A57: ( card y ) = ( ( k + 1 ) - 1 ) by A56;
then ( ^^ (y,X,( k + 1 )) ) is  STAR by A11,CKB46:1;
then ( F " ( ^^ (y,X,( k + 1 )) ) ) is  STAR by A3,A4,A13,CKB39:1;
then consider S being (Subset of X) such that A58: ( card S ) = ( ( k + 1 ) - 1 ) and A59: ( F " ( ^^ (y,X,( k + 1 )) ) ) = { A where A is (Subset of X): (( card A ) = ( k + 1 ) & S c= A) } by CKB19:def 1;
A60: S in (the Points of ( G_ (k,X) )) by A6,A58;
reconsider S as  finite (Subset of X) by A58;
A61: P[ S,( Hp . S ) ] by A9,A60;
( ^^ (S,X,( k + 1 )) ) = ( ^^ (S,X) ) by A11,A58,CKB33:def 1;
then ( Hp . S ) = ( meet ( ^^ (y,X,( k + 1 )) ) ) by A55,A58,A59,A61,FUNCT_1:77;
then y = ( Hp . S ) by A11,A57,CKB47:1;
hence thesis by A60;
end;
then ( rng Hp ) = (the Points of ( G_ (k,X) )) by FUNCT_2:10;
then A62: Hp is  onto by FUNCT_2:def 3;
A63: (for A being (POINT of ( G_ (k,X) )) holds (for B being  finite set holds (B = A implies ( Hp . A ) = ( meet ( F .: ( ^^ (B,X,( k + 1 )) ) ) ))))
proof
let A being (POINT of ( G_ (k,X) ));
A64: P[ A,( Hp . A ) ] by A9;
let B being  finite set;
assume A = B;
hence thesis by A64;
end;
(the line-map of H) is  bijective by A3,A10,A12,CKB29:def 1;
hence thesis by A63,A22,A62,A37,CKB29:def 1;
end;
