environ
vocabularies NUMBERS,SUBSET_1,QC_LANG1,CQC_LANG,FINSEQ_1,PARTFUN1,XBOOLE_0,FUNCT_1,RELAT_1,XXREAL_0,NAT_1,TARSKI,FINSET_1,ZFMISC_1,ZF_LANG,CLASSES2,CARD_1,BVFUNC_2,ORDINAL4,REALSET1,XBOOLEAN,MARGREL1,MCART_1,ARYTM_3,SUBSTUT1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,RELAT_1,FUNCT_1,CARD_1,NUMBERS,FINSEQ_1,NAT_1,QC_LANG1,QC_LANG3,PARTFUN1,SEQ_4,CQC_LANG,FINSET_1,RELSET_1,FUNCT_2,DOMAIN_1,MCART_1,XXREAL_0,CKB1,CKB3,CKB5,CKB7,CKB8,CKB9,CKB10,CKB12,CKB13,CKB14,CKB22,CKB23,CKB24,CKB25;
definitions TARSKI,FUNCT_1,QC_LANG1,QC_LANG3,CKB1,CKB5,CKB7,CKB8,CKB9,CKB12,CKB13,CKB14,CKB22,CKB23,CKB24,CKB25;
theorems TARSKI,FINSEQ_1,FUNCT_1,MCART_1,CQC_SIM1,XBOOLE_0,CQC_LANG,QC_LANG1,ZFMISC_1,RELAT_1,XBOOLE_1,CARD_2,CARD_3,FUNCT_2,PARTFUN1,RELSET_1,NAT_1,QC_LANG2,FINSEQ_3,CARD_1,XXREAL_0,ORDINAL1,CKB1,CKB5,CKB6,CKB7,CKB8,CKB9,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB22,CKB23,CKB24,CKB25;
schemes FUNCT_1,FUNCT_2,QC_LANG1,QC_LANG3,NAT_1,XBOOLE_0,FRAENKEL,FINSEQ_1,CLASSES1;
registrations XBOOLE_0,SUBSET_1,FUNCT_1,ORDINAL1,RELSET_1,PARTFUN1,FINSET_1,MEMBERED,FINSEQ_1,RFINSEQ,QC_LANG1,CQC_LANG,XXREAL_0,CARD_1,CKB2,CKB4,CKB11,CKB21;
constructors PARTFUN1,DOMAIN_1,XXREAL_0,NAT_1,SEQ_4,QC_LANG3,CQC_SIM1,RELSET_1,CKB1,CKB5,CKB7,CKB8,CKB9,CKB10,CKB12,CKB13,CKB14,CKB22,CKB23,CKB24,CKB25;
requirements REAL,NUMERALS,SUBSET,BOOLE;
begin
reserve a for set;
reserve x for bound_QC-variable;
reserve y for bound_QC-variable;
reserve p for QC-formula;
reserve Sub for CQC_Substitution;
reserve finSub for  finite CQC_Substitution;
definition
let x;
let p;
let finSub;
assume A1: (ex Sub st finSub = ( RestrictSub (x,( All (x,p) ),Sub) ));
func ExpandSub (x,p,finSub) -> CQC_Substitution equals 
( finSub \/ { [ x,( x. ( upVar (finSub,p) ) ) ] } ) if x in ( rng finSub ) otherwise ( finSub \/ { [ x,x ] } );
coherence
proof
A2:now
reconsider Z = { [ x,x ] } as  Relation-like set;
assume (not x in ( rng finSub ));
A3:now
consider Sub such that A4: finSub = ( RestrictSub (x,( All (x,p) ),Sub) ) by A1;
set X = { y: (((y in ( still_not-bound_in ( All (x,p) ) ) & y is (Element of ( dom Sub ))) & y <> x) & y <> ( Sub . y )) };
A5: ( dom finSub ) c= X by A4,RELAT_1:58;
given a such that
A6: a in ( ( dom finSub ) /\ ( dom Z ) );

a in ( dom finSub ) by A6,XBOOLE_0:def 4;
then a in X by A5;
then A7: (( dom Z ) = { x } & (ex y st ((((a = y & y in ( still_not-bound_in ( All (x,p) ) )) & y is (Element of ( dom Sub ))) & y <> x) & y <> ( Sub . y )))) by RELAT_1:9;
a in ( dom Z ) by A6,XBOOLE_0:def 4;
hence contradiction by A7,TARSKI:def 1;
end;
reconsider Z as Function;
(for a holds (a in ( ( dom ( @ finSub ) ) /\ ( dom Z ) ) implies ( ( @ finSub ) . a ) = ( Z . a ))) by A3;
then consider h being Function such that A8: ( ( @ finSub ) \/ Z ) = h by PARTFUN1:1;
reconsider Z as (Relation of ( bound_QC-variables ),( bound_QC-variables ));
( ( @ finSub ) \/ Z ) = h by A8;
hence ( finSub \/ { [ x,x ] } ) is CQC_Substitution by PARTFUN1:45;
end;
now
reconsider Z = { [ x,( x. ( upVar (finSub,p) ) ) ] } as  Relation-like set;
assume x in ( rng finSub );
A9:now
consider Sub such that A10: finSub = ( RestrictSub (x,( All (x,p) ),Sub) ) by A1;
set X = { y: (((y in ( still_not-bound_in ( All (x,p) ) ) & y is (Element of ( dom Sub ))) & y <> x) & y <> ( Sub . y )) };
A11: ( dom finSub ) c= X by A10,RELAT_1:58;
given a such that
A12: a in ( ( dom finSub ) /\ ( dom Z ) );

a in ( dom finSub ) by A12,XBOOLE_0:def 4;
then a in X by A11;
then A13: (( dom Z ) = { x } & (ex y st ((((a = y & y in ( still_not-bound_in ( All (x,p) ) )) & y is (Element of ( dom Sub ))) & y <> x) & y <> ( Sub . y )))) by RELAT_1:9;
a in ( dom Z ) by A12,XBOOLE_0:def 4;
hence contradiction by A13,TARSKI:def 1;
end;
reconsider Z as Function;
(for a holds (a in ( ( dom ( @ finSub ) ) /\ ( dom Z ) ) implies ( ( @ finSub ) . a ) = ( Z . a ))) by A9;
then consider h being Function such that A14: ( ( @ finSub ) \/ Z ) = h by PARTFUN1:1;
reconsider Z as (Relation of ( bound_QC-variables ),( bound_QC-variables ));
( ( @ finSub ) \/ Z ) = h by A14;
hence ( finSub \/ { [ x,( x. ( upVar (finSub,p) ) ) ] } ) is CQC_Substitution by PARTFUN1:45;
end;
hence thesis by A2;
end;
consistency;
end;
