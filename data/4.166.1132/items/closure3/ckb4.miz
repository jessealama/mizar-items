environ
vocabularies XBOOLE_0,STRUCT_0,PBOOLE,FUNCT_4,RELAT_1,CLOSURE2,SETFAM_1,MSUALG_1,TARSKI,MSUALG_2,UNIALG_2,MSSUBFAM,FUNCT_1,MARGREL1,SUBSET_1,FINSET_1,FUNCOP_1,WAYBEL_8,RELAT_2,MSAFREE2,BINOP_1,ZFMISC_1,CARD_3,FUNCT_2,CLOSURE3;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,SETFAM_1,RELAT_1,FUNCT_1,STRUCT_0,PARTFUN1,FUNCT_2,FINSET_1,FUNCT_4,FUNCOP_1,PBOOLE,FINSEQ_2,MSUALG_1,MSUALG_2,CARD_3,CLOSURE2,MSSUBFAM,MBOOLEAN;
definitions XBOOLE_0,TARSKI,PBOOLE,CLOSURE2,MSUALG_2,SETFAM_1;
theorems FUNCT_4,FUNCT_1,TARSKI,PBOOLE,MSUALG_1,MBOOLEAN,FUNCOP_1,MSUALG_2,CLOSURE2,ZFMISC_1,RELAT_1,CARD_3,MSSUBFAM,FUNCT_2,XBOOLE_0,XBOOLE_1,SETFAM_1,PARTFUN1,FINSET_1,CKB2,CKB3;
schemes CLASSES1;
registrations XBOOLE_0,SUBSET_1,FUNCT_1,RELSET_1,FUNCT_2,FINSET_1,PBOOLE,STRUCT_0,MSUALG_1,CLOSURE2,CKB1;
constructors SETFAM_1,FUNCT_4,MSSUBFAM,MSUALG_2,PRALG_2,CLOSURE2,RELSET_1,FINSEQ_2;
requirements SUBSET,BOOLE;
begin
theorem
Th3: (for S being non void non empty ManySortedSign holds (for MA being  strict  non-empty MSAlgebra over S holds (for F being (SubsetFamily of (the Sorts of MA)) holds (F c= ( SubSort MA ) implies (for B being (MSSubset of MA) holds (B = ( meet |: F :| ) implies B is  opers_closed))))))
proof
let S being non void non empty ManySortedSign;
let MA being  strict  non-empty MSAlgebra over S;
let F being (SubsetFamily of (the Sorts of MA));
assume that
A1: F c= ( SubSort MA );
let B being (MSSubset of MA);
assume that
A2: B = ( meet |: F :| );
per cases ;
suppose A3: F = ( {} );

set Q = (the Sorts of MA);
reconsider FF = |: F :| as (MSSubsetFamily of (the Sorts of MA));
set I = (the carrier of S);
FF = ( [[0]] I ) by A3,CLOSURE2:def 3;
then A4: Q = B by A2,MSSUBFAM:41;
reconsider Q as (MSSubset of MA) by PBOOLE:def 18;
(for o being (OperSymbol of S) holds Q is_closed_on o)
proof
let o being (OperSymbol of S);
A5: (( (the ResultSort of S) . o ) = ( the_result_sort_of o ) & ( dom (the ResultSort of S) ) = (the carrier' of S)) by FUNCT_2:def 1,MSUALG_1:def 2;
( Result (o,MA) ) = ( ( Q * (the ResultSort of S) ) . o ) by MSUALG_1:def 5
.= ( Q . ( the_result_sort_of o ) ) by A5,FUNCT_1:13;
then A6: ( rng ( ( Den (o,MA) ) | ( ( Q # ) . ( the_arity_of o ) ) ) ) c= ( Q . ( the_result_sort_of o ) ) by RELAT_1:def 19;
(( (the Arity of S) . o ) = ( the_arity_of o ) & ( dom (the Arity of S) ) = (the carrier' of S)) by FUNCT_2:def 1,MSUALG_1:def 1;
then A7: ( ( ( Q # ) * (the Arity of S) ) . o ) = ( ( Q # ) . ( the_arity_of o ) ) by FUNCT_1:13;
( ( Q * (the ResultSort of S) ) . o ) = ( Q . ( the_result_sort_of o ) ) by A5,FUNCT_1:13;
hence thesis by A7,A6,MSUALG_2:def 5;
end;
hence thesis by A4,MSUALG_2:def 6;
end;
suppose A8: F <> ( {} );

set SS = S;
let o being (OperSymbol of SS);
set i = ( the_result_sort_of o );
A9: ( (the ResultSort of SS) . o ) = ( the_result_sort_of o ) by MSUALG_1:def 2;
A10: ( dom (the ResultSort of SS) ) = (the carrier' of SS) by FUNCT_2:def 1;
(( (the Arity of SS) . o ) = ( the_arity_of o ) & ( dom (the Arity of SS) ) = (the carrier' of SS)) by FUNCT_2:def 1,MSUALG_1:def 1;
then A11: ( ( ( B # ) * (the Arity of SS) ) . o ) = ( ( B # ) . ( the_arity_of o ) ) by FUNCT_1:13;
( Result (o,MA) ) = ( ( (the Sorts of MA) * (the ResultSort of SS) ) . o ) by MSUALG_1:def 5
.= ( (the Sorts of MA) . ( the_result_sort_of o ) ) by A9,A10,FUNCT_1:13;
then A12: ( rng ( ( Den (o,MA) ) | ( ( B # ) . ( the_arity_of o ) ) ) ) c= ( (the Sorts of MA) . ( the_result_sort_of o ) ) by RELAT_1:def 19;
A13: ( rng ( ( Den (o,MA) ) | ( ( B # ) . ( the_arity_of o ) ) ) ) c= ( B . ( the_result_sort_of o ) )
proof
consider Q being (Subset-Family of ( (the Sorts of MA) . i )) such that A14: Q = ( |: F :| . i ) and A15: ( B . i ) = ( Intersect Q ) by A2,MSSUBFAM:def 1;
let v being set;
assume A16: v in ( rng ( ( Den (o,MA) ) | ( ( B # ) . ( the_arity_of o ) ) ) );
then consider p being set such that A17: p in ( dom ( ( Den (o,MA) ) | ( ( B # ) . ( the_arity_of o ) ) ) ) and A18: v = ( ( ( Den (o,MA) ) | ( ( B # ) . ( the_arity_of o ) ) ) . p ) by FUNCT_1:def 3;
(for Y being set holds (Y in Q implies v in Y))
proof
A19: ( |: F :| . i ) = { ( xx . i ) where xx is (Element of ( Bool (the Sorts of MA) )): xx in F } by A8,CLOSURE2:14;
let Y being set;
assume Y in Q;
then consider xx being (Element of ( Bool (the Sorts of MA) )) such that A20: Y = ( xx . i ) and A21: xx in F by A14,A19;
reconsider xx as (MSSubset of MA);
xx is  opers_closed by A1,A21,MSUALG_2:14;
then xx is_closed_on o by MSUALG_2:def 6;
then A22: ( rng ( ( Den (o,MA) ) | ( ( ( xx # ) * (the Arity of SS) ) . o ) ) ) c= ( ( xx * (the ResultSort of SS) ) . o ) by MSUALG_2:def 5;
B c= xx by A2,A21,CLOSURE2:21,MSSUBFAM:43;
then ( ( Den (o,MA) ) | ( ( ( B # ) * (the Arity of SS) ) . o ) ) c= ( ( Den (o,MA) ) | ( ( ( xx # ) * (the Arity of SS) ) . o ) ) by MSUALG_2:2,RELAT_1:75;
then A23: ( dom ( ( Den (o,MA) ) | ( ( ( B # ) * (the Arity of SS) ) . o ) ) ) c= ( dom ( ( Den (o,MA) ) | ( ( ( xx # ) * (the Arity of SS) ) . o ) ) ) by RELAT_1:11;
A24: v = ( ( Den (o,MA) ) . p ) by A17,A18,FUNCT_1:47;
then v = ( ( ( Den (o,MA) ) | ( ( ( xx # ) * (the Arity of SS) ) . o ) ) . p ) by A11,A17,A23,FUNCT_1:47;
then v in ( rng ( ( Den (o,MA) ) | ( ( ( xx # ) * (the Arity of SS) ) . o ) ) ) by A11,A17,A23,FUNCT_1:def 3;
then ( ( Den (o,MA) ) . p ) in ( ( xx * (the ResultSort of SS) ) . o ) by A22,A24;
then ( ( Den (o,MA) ) . p ) in ( xx . ( (the ResultSort of SS) . o ) ) by A10,FUNCT_1:13;
then ( ( Den (o,MA) ) . p ) in ( xx . i ) by MSUALG_1:def 2;
hence thesis by A17,A18,A20,FUNCT_1:47;
end;
hence thesis by A12,A16,A15,SETFAM_1:43;
end;
( ( B * (the ResultSort of SS) ) . o ) = ( B . ( the_result_sort_of o ) ) by A9,A10,FUNCT_1:13;
hence thesis by A11,A13,MSUALG_2:def 5;
end;
end;
