environ
vocabularies NUMBERS,FINSEQ_1,ORDINAL1,XBOOLE_0,ARYTM_3,CARD_1,XXREAL_0,ARYTM_1,NAT_1,SUBSET_1,TARSKI,RELAT_1,ORDINAL4,FUNCT_1,FINSET_1,FINSEQ_2,FUNCT_2,CARD_3,FUNCOP_1,FINSEQ_3,EQREL_1,ALG_1,FUNCT_6,SETFAM_1,FINSEQ_4,ZFMISC_1,FUNCT_5,PARTFUN1;
notations TARSKI,XBOOLE_0,ENUMSET1,SUBSET_1,SETFAM_1,CARD_1,NUMBERS,ORDINAL1,XCMPLX_0,RELAT_1,FUNCT_1,FINSEQ_1,RELSET_1,PARTFUN1,FUNCT_2,BINOP_1,FUNCOP_1,FINSEQ_2,FINSET_1,NAT_1,FINSEQOP,XXREAL_0,CARD_3,FUNCT_3,FUNCT_5,FUNCT_6,EQREL_1,CKB61;
definitions FUNCT_1,TARSKI,WELLORD2,XBOOLE_0,FINSEQ_2,CARD_3,FUNCOP_1,EQREL_1,FUNCT_6,CKB61;
theorems CARD_1,CARD_2,ENUMSET1,FINSEQ_1,FINSEQ_2,FINSET_1,FUNCT_1,INT_1,NAT_1,TARSKI,WELLORD2,ZFMISC_1,RELAT_1,XREAL_1,XBOOLE_0,XBOOLE_1,FUNCT_2,GRFUNC_1,SUBSET_1,XXREAL_0,ORDINAL1,NUMBERS,CARD_3,FUNCOP_1,EQREL_1,FUNCT_6,SETFAM_1,FUNCT_5,FUNCT_3,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67,CKB68,CKB69,CKB70,CKB71,CKB72,CKB73,CKB74,CKB75,CKB76,CKB77,CKB78,CKB79,CKB80,CKB81,CKB82,CKB83,CKB84,CKB85,CKB86,CKB87,CKB88,CKB89,CKB90,CKB91,CKB92;
schemes FINSEQ_1,FUNCT_1,NAT_1,CLASSES1,RELSET_1;
registrations XBOOLE_0,RELAT_1,FUNCT_1,ORDINAL1,FINSET_1,XXREAL_0,XREAL_0,NAT_1,INT_1,FINSEQ_1,CARD_1,FINSEQ_2,FUNCOP_1,CARD_3,SUBSET_1,FUNCT_2,CARD_2,EQREL_1,RELSET_1,FUNCT_4;
constructors ENUMSET1,PARTFUN1,WELLORD2,XXREAL_0,REAL_1,NAT_1,INT_1,FINSEQOP,RELSET_1,CARD_3,DOMAIN_1,CARD_2,EQREL_1,FUNCT_6,BINOP_1,FUNCT_3,FUNCT_5,CKB61;
requirements NUMERALS,REAL,SUBSET,BOOLE,ARITHM;
begin
reserve p for FinSequence;
reserve x for set;
reserve A for set;
reserve l for  natural number;
reserve n for  natural number;
theorem
Lm12: (for l holds ((for p holds (for A holds (( len p ) = l implies (for n holds (n in ( dom p ) implies (for B being  finite set holds (B = { k where k is (Element of ( NAT )): ((k in ( dom p ) & k <= n) & ( p . k ) in A) } implies (( p . n ) in A or ( ( p - A ) . ( n - ( card B ) ) ) = ( p . n ))))))))) implies (for p holds (for A holds (( len p ) = ( l + 1 ) implies (for n holds (n in ( dom p ) implies (for C being  finite set holds (C = { m where m is (Element of ( NAT )): ((m in ( dom p ) & m <= n) & ( p . m ) in A) } implies (( p . n ) in A or ( ( p - A ) . ( n - ( card C ) ) ) = ( p . n )))))))))))
proof
let l;
assume A1: (for p holds (for A holds (( len p ) = l implies (for n holds (n in ( dom p ) implies (for B being  finite set holds (B = { k where k is (Element of ( NAT )): ((k in ( dom p ) & k <= n) & ( p . k ) in A) } implies (( p . n ) in A or ( ( p - A ) . ( n - ( card B ) ) ) = ( p . n )))))))));
let p;
let A;
reconsider q = ( p | ( Seg l ) ) as FinSequence by FINSEQ_1:15;
assume A2: ( len p ) = ( l + 1 );
then A3: ( len q ) = l by CKB55:1;
let n;
set B = { k where k is (Element of ( NAT )): ((k in ( dom q ) & k <= n) & ( q . k ) in A) };
B c= ( dom q )
proof
let x being set;
assume x in B;
then (ex k being (Element of ( NAT )) st (((x = k & k in ( dom q )) & k <= n) & ( q . k ) in A));
hence thesis;
end;
then reconsider B as  finite set;
assume A4: n in ( dom p );
let C being  finite set;
assume that
A5: C = { m where m is (Element of ( NAT )): ((m in ( dom p ) & m <= n) & ( p . m ) in A) };
assume A6: (not ( p . n ) in A);
now
per cases ;
suppose A7: ( p . ( l + 1 ) ) in A;

A8: n in ( Seg ( l + 1 ) ) by A2,A4,FINSEQ_1:def 3;
(not n in { ( l + 1 ) }) by A6,A7,TARSKI:def 1;
then n in ( ( Seg ( l + 1 ) ) \ { ( l + 1 ) } ) by A8,XBOOLE_0:def 5;
then A9: n in ( Seg l ) by FINSEQ_1:10;
A10: B = C
proof
thus B c= C
proof
let x;
A11: ( dom q ) c= ( dom p ) by RELAT_1:60;
assume x in B;
then consider k being (Element of ( NAT )) such that A12: x = k and A13: k in ( dom q ) and A14: k <= n and A15: ( q . k ) in A;
( p . k ) in A by A13,A15,FUNCT_1:47;
hence thesis by A5,A12,A13,A14,A11;
end;

let x;
assume x in C;
then consider m being (Element of ( NAT )) such that A16: x = m and A17: m in ( dom p ) and A18: m <= n and A19: ( p . m ) in A by A5;
m in ( Seg ( len p ) ) by A17,FINSEQ_1:def 3;
then A20: 1 <= m by FINSEQ_1:1;
n <= l by A9,FINSEQ_1:1;
then m <= l by A18,XXREAL_0:2;
then m in ( Seg l ) by A20,FINSEQ_1:1;
then A21: m in ( dom q ) by A3,FINSEQ_1:def 3;
then ( q . m ) in A by A19,FUNCT_1:47;
hence thesis by A16,A18,A21;
end;
A22: ( q - A ) = ( p - A ) by A2,A7,CKB91:1;
A23: n in ( dom q ) by A3,A9,FINSEQ_1:def 3;
then ( p . n ) = ( q . n ) by FUNCT_1:47;
hence thesis by A1,A6,A3,A23,A22,A10;
end;
suppose (not ( p . ( l + 1 ) ) in A);

then A24: ( p - A ) = ( ( q - A ) ^ <* ( p . ( l + 1 ) ) *> ) by A2,CKB92:1;
now
per cases ;
suppose A25: n = ( l + 1 );

( p " A ) = C
proof
thus ( p " A ) c= C
proof
let x;
assume A26: x in ( p " A );
then A27: x in ( dom p ) by FUNCT_1:def 7;
then reconsider z = x as (Element of ( NAT ));
A28: ( p . x ) in A by A26,FUNCT_1:def 7;
z in ( Seg n ) by A2,A25,A27,FINSEQ_1:def 3;
then z <= n by FINSEQ_1:1;
hence thesis by A5,A27,A28;
end;

let x;
assume x in C;
then (ex m being (Element of ( NAT )) st (((x = m & m in ( dom p )) & m <= n) & ( p . m ) in A)) by A5;
hence thesis by FUNCT_1:def 7;
end;
then A29: ( len ( p - A ) ) = ( n - ( card C ) ) by A2,A25,CKB62:1;
( len <* ( p . ( l + 1 ) ) *> ) = 1 by FINSEQ_1:39;
then ( ( p - A ) . ( n - ( card C ) ) ) = ( ( p - A ) . ( ( len ( q - A ) ) + 1 ) ) by A24,A29,FINSEQ_1:22
.= ( p . ( l + 1 ) ) by A24,FINSEQ_1:42;
hence thesis by A25;
end;
suppose n <> ( l + 1 );

then A30: (not n in { ( l + 1 ) }) by TARSKI:def 1;
n in ( Seg ( l + 1 ) ) by A2,A4,FINSEQ_1:def 3;
then n in ( ( Seg ( l + 1 ) ) \ { ( l + 1 ) } ) by A30,XBOOLE_0:def 5;
then A31: n in ( Seg l ) by FINSEQ_1:10;
then 1 <= n by FINSEQ_1:1;
then n in ( Seg n ) by FINSEQ_1:1;
then A32: { n } c= ( Seg n ) by ZFMISC_1:31;
A33: ( ( Seg n ) \ B ) c= ( ( Seg l ) \ ( q " A ) )
proof
let x;
assume A34: x in ( ( Seg n ) \ B );
then reconsider z = x as (Element of ( NAT ));
A35: x in ( Seg n ) by A34,XBOOLE_0:def 5;
then A36: 1 <= z by FINSEQ_1:1;
A37: z <= n by A35,FINSEQ_1:1;
A38:now
assume A39: z in ( q " A );
then A40: z in ( dom q ) by FUNCT_1:def 7;
( q . z ) in A by A39,FUNCT_1:def 7;
then z in B by A37,A40;
hence contradiction by A34,XBOOLE_0:def 5;
end;
n <= l by A31,FINSEQ_1:1;
then z <= l by A37,XXREAL_0:2;
then z in ( Seg l ) by A36,FINSEQ_1:1;
hence thesis by A38,XBOOLE_0:def 5;
end;
A41: B = C
proof
thus B c= C
proof
let x;
A42: ( dom q ) c= ( dom p ) by RELAT_1:60;
assume x in B;
then consider k being (Element of ( NAT )) such that A43: x = k and A44: k in ( dom q ) and A45: k <= n and A46: ( q . k ) in A;
( p . k ) in A by A44,A46,FUNCT_1:47;
hence thesis by A5,A43,A44,A45,A42;
end;

let x;
assume x in C;
then consider m being (Element of ( NAT )) such that A47: x = m and A48: m in ( dom p ) and A49: m <= n and A50: ( p . m ) in A by A5;
m in ( Seg ( len p ) ) by A48,FINSEQ_1:def 3;
then A51: 1 <= m by FINSEQ_1:1;
n <= l by A31,FINSEQ_1:1;
then m <= l by A49,XXREAL_0:2;
then m in ( Seg l ) by A51,FINSEQ_1:1;
then A52: m in ( dom q ) by A3,FINSEQ_1:def 3;
then ( q . m ) in A by A50,FUNCT_1:47;
hence thesis by A47,A49,A52;
end;
( q " A ) c= ( dom q ) by RELAT_1:132;
then A53: ( q " A ) c= ( Seg l ) by A3,FINSEQ_1:def 3;
( ( q " A ) \/ ( ( Seg l ) \ ( q " A ) ) ) = ( ( q " A ) \/ ( Seg l ) ) by XBOOLE_1:39
.= ( Seg l ) by A53,XBOOLE_1:12;
then ( card ( Seg l ) ) = ( ( card ( q " A ) ) + ( card ( ( Seg l ) \ ( q " A ) ) ) ) by CARD_2:40,XBOOLE_1:79;
then A54: ( len q ) = ( ( card ( q " A ) ) + ( card ( ( Seg ( len q ) ) \ ( q " A ) ) ) ) by A3,FINSEQ_1:57;
set b = ( card B );
set a = ( n - ( card B ) );
A55: ( card ( Seg n ) ) = n by FINSEQ_1:57;
A56: n in ( dom q ) by A3,A31,FINSEQ_1:def 3;
then A57: (not ( q . n ) in A) by A6,FUNCT_1:47;
A58: B c= ( ( Seg n ) \ { n } )
proof
let x;
assume x in B;
then consider k being (Element of ( NAT )) such that A59: x = k and A60: k in ( dom q ) and A61: k <= n and A62: ( q . k ) in A;
k in ( Seg ( len q ) ) by A60,FINSEQ_1:def 3;
then 1 <= k by FINSEQ_1:1;
then A63: k in ( Seg n ) by A61,FINSEQ_1:1;
(not k in { n }) by A57,A62,TARSKI:def 1;
hence thesis by A59,A63,XBOOLE_0:def 5;
end;
then ( card B ) <= ( card ( ( Seg n ) \ { n } ) ) by NAT_1:43;
then ( card B ) <= ( ( card ( Seg n ) ) - ( card { n } ) ) by A32,CARD_2:44;
then b <= ( ( card ( Seg n ) ) - 1 ) by CARD_1:30;
then b <= ( n - 1 ) by FINSEQ_1:57;
then ( b + 1 ) <= n by XREAL_1:19;
then A64: ( ( 0 ) + b ) < ( a + b ) by NAT_1:13;
then ( 0 ) <= a by XREAL_1:6;
then reconsider a as (Element of ( NAT )) by INT_1:3;
( ( Seg n ) \ { n } ) c= ( Seg n ) by XBOOLE_1:36;
then a = ( card ( ( Seg n ) \ B ) ) by A58,A55,CARD_2:44,XBOOLE_1:1;
then a <= ( ( len q ) - ( card ( q " A ) ) ) by A3,A54,A33,NAT_1:43;
then A65: a <= ( len ( q - A ) ) by CKB62:1;
1 <= a by A64,NAT_1:14;
then a in ( Seg ( len ( q - A ) ) ) by A65,FINSEQ_1:1;
then A66: a in ( dom ( q - A ) ) by FINSEQ_1:def 3;
( p . n ) = ( q . n ) by A56,FUNCT_1:47;
then ( ( q - A ) . ( n - ( card B ) ) ) = ( p . n ) by A1,A6,A3,A56;
hence thesis by A24,A41,A66,FINSEQ_1:def 7;
end;
end;
hence thesis;
end;
end;
hence thesis;
end;
