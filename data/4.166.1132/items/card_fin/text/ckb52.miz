environ
vocabularies NUMBERS,SUBSET_1,FUNCT_1,NAT_1,TARSKI,FINSET_1,RELAT_1,AFINSQ_1,ARYTM_1,ARYTM_3,FINSEQ_1,XXREAL_0,CARD_1,XBOOLE_0,ORDINAL4,CARD_3,BINOP_1,FINSOP_1,FUNCOP_1,BINOP_2,FUNCT_2,INT_1,VALUED_1,NEWTON,REALSET1,ZFMISC_1,FUNCT_4,EQREL_1,SETFAM_1,STIRL2_1,CARD_FIN;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,NUMBERS,RELAT_1,FUNCT_1,NAT_1,FINSET_1,ORDINAL1,XXREAL_0,NAT_D,AFINSQ_1,VALUED_1,RELSET_1,PARTFUN1,DOMAIN_1,FUNCT_2,FUNCT_4,FUNCOP_1,INT_1,ENUMSET1,BINOP_1,BINOP_2,RECDEF_1,AFINSQ_2,ZFMISC_1,NEWTON,STIRL2_1,YELLOW20,CKB9,CKB21,CKB41;
definitions TARSKI,XBOOLE_0,FUNCT_1,FUNCOP_1,FINSET_1,RELAT_1,CKB9,CKB21,CKB41;
theorems AFINSQ_1,TARSKI,FUNCT_1,XBOOLE_0,ZFMISC_1,RELAT_1,XBOOLE_1,NAT_1,FUNCT_2,FINSET_1,XCMPLX_1,CARD_2,INT_1,WELLORD2,SUBSET_1,ENUMSET1,CARD_1,BINOP_2,NEWTON,XREAL_1,FUNCOP_1,STIRL2_1,ALTCAT_1,FUNCT_5,IRRAT_1,FUNCT_4,YELLOW20,XXREAL_0,NAT_D,XREAL_0,PRE_POLY,AFINSQ_2,ORDINAL1,VALUED_1,VALUED_0,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB48,CKB49,CKB50,CKB51;
schemes FUNCT_2,NAT_1,XBOOLE_0,STIRL2_1;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCT_2,FUNCOP_1,FUNCT_4,FINSET_1,FRAENKEL,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,BINOP_2,CARD_1,WSIERP_1,AFINSQ_1,RELSET_1,VALUED_1,VALUED_0,AFINSQ_2,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47;
constructors PARTFUN3,BINOM,WELLORD2,DOMAIN_1,SETWISEO,REAL_1,NAT_D,YELLOW20,RECDEF_1,BINOP_2,RELSET_1,ORDINAL4,SEQ_1,AFINSQ_1,SEQ_4,AFINSQ_2,STIRL2_1,CKB9,CKB21;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
reserve x1 for set;
reserve x2 for set;
reserve y for set;
reserve z for set;
reserve X for  finite set;
reserve k for Nat;
reserve f for Function;
reserve F for Function;
definition
let k;
let F being  finite-yielding Function;
assume A1: ( dom F ) is  finite;
func Card_Intersection (F,k) -> (Element of ( NAT )) means 
:Def4: (for x,y being set holds (for X being  finite set holds (for P being (Function of ( card ( Choose (X,k,x,y) ) ),( Choose (X,k,x,y) )) holds (((( dom F ) = X & P is  one-to-one) & x <> y) implies (ex XFS being (XFinSequence of ( NAT )) st ((( dom XFS ) = ( dom P ) & (for z holds (for f holds ((z in ( dom XFS ) & f = ( P . z )) implies ( XFS . z ) = ( card ( Intersection (F,f,x) ) ))))) & it = ( Sum XFS )))))));
existence
proof
reconsider D = ( dom F ) as  finite set by A1;
set Ch1 = ( Choose (D,k,( 0 ),1) );
( card Ch1 ),Ch1 are_equipotent  by CARD_1:def 2;
then consider P1 being Function such that A2: P1 is  one-to-one and A3: ( dom P1 ) = ( card Ch1 ) and A4: ( rng P1 ) = Ch1 by WELLORD2:def 4;
reconsider P1 as (Function of ( card Ch1 ),Ch1) by A3,A4,FUNCT_2:1;
defpred xfs1[ set,set ]
 means
(for f holds (f = ( P1 . $1 ) implies $2 = ( card ( Intersection (F,f,( 0 )) ) )));
A5: (for x holds (x in ( card Ch1 ) implies (ex y st (y in ( NAT ) & xfs1[ x,y ]))))
proof
let x;
assume x in ( card Ch1 );
then x in ( dom P1 ) by CARD_1:27,FUNCT_2:def 1;
then ( P1 . x ) in ( rng P1 ) by FUNCT_1:def 3;
then consider f being (Function of D,{ ( 0 ),1 }) such that A6: f = ( P1 . x ) and ( card ( f " { ( 0 ) } ) ) = k by CKB9:def 1;
( union ( rng F ) ) is  finite by A1,CKB49:1;
then reconsider I = ( Intersection (F,f,( 0 )) ) as  finite set;
take ( card I );
thus thesis by A6;
end;
consider XFS1 being (Function of ( card Ch1 ),( NAT )) such that A7: (for x holds (x in ( card Ch1 ) implies xfs1[ x,( XFS1 . x ) ])) from FUNCT_2:sch 1(A5);
A8: ( dom XFS1 ) = ( card Ch1 ) by FUNCT_2:def 1;
then reconsider XFS1 as XFinSequence by AFINSQ_1:5;
reconsider XFS1 as (XFinSequence of ( NAT ));
reconsider S = ( Sum XFS1 ) as (Element of ( NAT )) by ORDINAL1:def 12;
take S;
let x being set;
let y being set;
let X being  finite set;
let P being (Function of ( card ( Choose (X,k,x,y) ) ),( Choose (X,k,x,y) ));
assume that
A9: ( dom F ) = X
and
A10: P is  one-to-one
and
A11: x <> y;
defpred perm[ set,set ]
 means
(for f1 being (Function of D,{ ( 0 ),1 }) holds (for f being (Function of X,{ x,y }) holds ((f1 = ( P1 . $1 ) & f = ( P . $2 )) implies (( f1 " { ( 0 ) } ) = ( f " { x } ) & (for z holds (z in X implies ((( f1 . z ) = ( 0 ) iff ( f . z ) = x) & (( f1 . z ) = 1 iff ( f . z ) = y))))))));
set Ch = ( Choose (X,k,x,y) );
A12: (for x1 holds (x1 in ( card Ch1 ) implies (ex x2 st (x2 in ( card Ch1 ) & perm[ x1,x2 ]))))
proof
( card ( card ( Choose (X,k,x,y) ) ) ) = ( card ( Choose (X,k,x,y) ) );
then P is  onto by A10,STIRL2_1:60;
then A13: ( rng P ) = Ch by FUNCT_2:def 3;
let x1;
assume x1 in ( card Ch1 );
then ( P1 . x1 ) in ( rng P1 ) by A3,FUNCT_1:def 3;
then consider f1 being (Function of D,{ ( 0 ),1 }) such that A14: f1 = ( P1 . x1 ) and A15: ( card ( f1 " { ( 0 ) } ) ) = k by CKB9:def 1;
defpred pf[ set,set ]
 means
((( f1 . $1 ) = ( 0 ) iff $2 = x) & (( f1 . $1 ) = 1 iff $2 = y));
A16: (for d being set holds (d in X implies (ex fd being set st (fd in { x,y } & pf[ d,fd ]))))
proof
let d being set;
assume d in X;
then d in ( dom f1 ) by A9,FUNCT_2:def 1;
then ( f1 . d ) in ( rng f1 ) by FUNCT_1:def 3;
then A17: (( f1 . d ) = ( 0 ) or ( f1 . d ) = 1) by TARSKI:def 2;
(x in { x,y } & y in { x,y }) by TARSKI:def 2;
hence thesis by A11,A17;
end;
consider f being (Function of X,{ x,y }) such that A18: (for d being set holds (d in X implies pf[ d,( f . d ) ])) from FUNCT_2:sch 1(A16);
A19: ( dom f1 ) = D by FUNCT_2:def 1;
A20: ( f1 " { ( 0 ) } ) c= ( f " { x } )
proof
let z;
assume A21: z in ( f1 " { ( 0 ) } );
then ( f1 . z ) in { ( 0 ) } by FUNCT_1:def 7;
then A22: ( f1 . z ) = ( 0 ) by TARSKI:def 1;
A23: ( dom f1 ) = ( dom f ) by A9,A19,FUNCT_2:def 1;
then z in ( dom f ) by A19,A21;
then ( f . z ) = x by A18,A22;
then ( f . z ) in { x } by TARSKI:def 1;
hence thesis by A19,A21,A23,FUNCT_1:def 7;
end;
A24: ( f " { x } ) c= ( f1 " { ( 0 ) } )
proof
let z;
assume A25: z in ( f " { x } );
then ( f . z ) in { x } by FUNCT_1:def 7;
then ( f . z ) = x by TARSKI:def 1;
then ( f1 . z ) = ( 0 ) by A18,A25;
then ( f1 . z ) in { ( 0 ) } by TARSKI:def 1;
hence thesis by A9,A19,A25,FUNCT_1:def 7;
end;
then ( f " { x } ) = ( f1 " { ( 0 ) } ) by A20,XBOOLE_0:def 10;
then f in Ch by A15,CKB9:def 1;
then consider x2 such that A26: x2 in ( dom P ) and A27: ( P . x2 ) = f by A13,FUNCT_1:def 3;
take x2;
(( card Ch ) = ( ( card X ) choose k ) & ( card Ch1 ) = ( ( card D ) choose k )) by A11,CKB18:1;
hence x2 in ( card Ch1 ) by A9,A26;
let f19 being (Function of D,{ ( 0 ),1 });
let f9 being (Function of X,{ x,y });
assume that
A28: (f19 = ( P1 . x1 ) & f9 = ( P . x2 ));
thus ( f9 " { x } ) = ( f19 " { ( 0 ) } ) by A14,A24,A20,A27,A28,XBOOLE_0:def 10;
let z;
assume z in X;
hence thesis by A14,A18,A27,A28;
end;
consider Perm being (Function of ( card Ch1 ),( card Ch1 )) such that A29: (for x1 holds (x1 in ( card Ch1 ) implies perm[ x1,( Perm . x1 ) ])) from FUNCT_2:sch 1(A12);
now
A30: (Ch = ( {} ) implies ( card Ch ) = ( {} ));
let z1 being set;
let z2 being set;
assume that
A31: z1 in ( dom Perm )
and
A32: z2 in ( dom Perm )
and
A33: ( Perm . z1 ) = ( Perm . z2 );
(( card Ch ) = ( ( card X ) choose k ) & ( card Ch1 ) = ( ( card D ) choose k )) by A11,CKB18:1;
then ( Perm . z1 ) in ( card Ch ) by A9,A31;
then ( Perm . z1 ) in ( dom P ) by A30,FUNCT_2:def 1;
then ( P . ( Perm . z1 ) ) in ( rng P ) by FUNCT_1:def 3;
then consider PPermz1 being (Function of X,{ x,y }) such that A34: PPermz1 = ( P . ( Perm . z1 ) ) and ( card ( PPermz1 " { x } ) ) = k by CKB9:def 1;
( P1 . z2 ) in ( rng P1 ) by A3,A32,FUNCT_1:def 3;
then consider P1z2 being (Function of D,{ ( 0 ),1 }) such that A35: ( P1 . z2 ) = P1z2 and ( card ( P1z2 " { ( 0 ) } ) ) = k by CKB9:def 1;
( P1 . z1 ) in ( rng P1 ) by A3,A31,FUNCT_1:def 3;
then consider P1z1 being (Function of D,{ ( 0 ),1 }) such that A36: ( P1 . z1 ) = P1z1 and ( card ( P1z1 " { ( 0 ) } ) ) = k by CKB9:def 1;
A37: (for z holds (z in ( dom P1z1 ) implies ( P1z1 . z ) = ( P1z2 . z )))
proof
let z;
assume that
A38: z in ( dom P1z1 );
A39: ( P1z1 . z ) in ( rng P1z1 ) by A38,FUNCT_1:def 3;
per cases  by A39,TARSKI:def 2;
suppose A40: ( P1z1 . z ) = ( 0 );

then ( PPermz1 . z ) = x by A9,A29,A31,A36,A34,A38;
hence thesis by A9,A29,A32,A33,A35,A34,A38,A40;
end;
suppose A41: ( P1z1 . z ) = 1;

then ( PPermz1 . z ) = y by A9,A29,A31,A36,A34,A38;
hence thesis by A9,A29,A32,A33,A35,A34,A38,A41;
end;
end;
(( dom P1z1 ) = D & ( dom P1z2 ) = D) by FUNCT_2:def 1;
then P1z1 = P1z2 by A37,FUNCT_1:def 11;
hence z1 = z2 by A2,A3,A31,A32,A36,A35,FUNCT_1:def 4;
end;
then A42: Perm is  one-to-one by FUNCT_1:def 4;
( card ( card Ch1 ) ) = ( card ( card Ch1 ) );
then A43: Perm is  one-to-one  onto by A42,STIRL2_1:60;
defpred xfs[ set,set ]
 means
(for f holds (f = ( P . $1 ) implies $2 = ( card ( Intersection (F,f,x) ) )));
A44: (for x1 holds (x1 in ( card Ch ) implies (ex x2 st (x2 in ( NAT ) & xfs[ x1,x2 ]))))
proof
let x1;
assume x1 in ( card Ch );
then x1 in ( dom P ) by CARD_1:27,FUNCT_2:def 1;
then ( P . x1 ) in ( rng P ) by FUNCT_1:def 3;
then consider f being (Function of X,{ x,y }) such that A45: f = ( P . x1 ) and ( card ( f " { x } ) ) = k by CKB9:def 1;
( union ( rng F ) ) is  finite by A1,CKB49:1;
then reconsider I = ( Intersection (F,f,x) ) as  finite set;
take ( card I );
thus thesis by A45;
end;
consider XFS being (Function of ( card Ch ),( NAT )) such that A46: (for x1 holds (x1 in ( card Ch ) implies xfs[ x1,( XFS . x1 ) ])) from FUNCT_2:sch 1(A44);
A47: ( dom XFS ) = ( card Ch ) by FUNCT_2:def 1;
then reconsider XFS as XFinSequence by AFINSQ_1:5;
reconsider XFS as (XFinSequence of ( NAT ));
take XFS;
(Ch = ( {} ) implies ( card Ch ) = ( {} ));
then ( dom P ) = ( card Ch ) by FUNCT_2:def 1;
hence A48: ( dom XFS ) = ( dom P ) by FUNCT_2:def 1;
hence (for z holds (for f holds ((z in ( dom XFS ) & f = ( P . z )) implies ( XFS . z ) = ( card ( Intersection (F,f,x) ) )))) by A46;
A49: ( card Ch1 ) = ( ( card D ) choose k ) by CKB18:1;
A50: ( card Ch ) = ( ( card X ) choose k ) by A11,CKB18:1;
then ( card Ch1 ) = ( dom XFS ) by A9,A49,FUNCT_2:def 1;
then reconsider Perm as (Permutation of ( dom XFS )) by A43;
A51: ( dom XFS ) = ( dom XFS1 ) by A9,A47,A49,A50,FUNCT_2:def 1;
A52: (for z holds (z in ( dom XFS1 ) implies ( XFS1 . z ) = ( ( XFS * Perm ) . z )))
proof
let z;
assume that
A53: z in ( dom XFS1 );
A54: z in ( dom Perm ) by A8,A53,FUNCT_2:52;
( P . ( Perm . z ) ) in ( rng P ) by A48,A51,A53,FUNCT_1:def 3;
then consider p being (Function of X,{ x,y }) such that A55: p = ( P . ( Perm . z ) ) and ( card ( p " { x } ) ) = k by CKB9:def 1;
A56: ( XFS . ( Perm . z ) ) = ( card ( Intersection (F,p,x) ) ) by A46,A47,A51,A53,A55;
( P1 . z ) in ( rng P1 ) by A3,A8,A53,FUNCT_1:def 3;
then consider p1 being (Function of D,{ ( 0 ),1 }) such that A57: p1 = ( P1 . z ) and ( card ( p1 " { ( 0 ) } ) ) = k by CKB9:def 1;
( p1 " { ( 0 ) } ) = ( p " { x } ) by A8,A29,A53,A55,A57;
then A58: ( Intersection (F,p1,( 0 )) ) = ( Intersection (F,p,x) ) by CKB36:1;
( XFS1 . z ) = ( card ( Intersection (F,p1,( 0 )) ) ) by A7,A8,A53,A57;
hence thesis by A58,A56,A54,FUNCT_1:13;
end;
(( rng Perm ) c= ( dom XFS ) & ( dom Perm ) = ( dom XFS )) by FUNCT_2:52;
then ( dom XFS1 ) = ( dom ( XFS * Perm ) ) by A51,RELAT_1:27;
then XFS1 = ( XFS * Perm ) by A52,FUNCT_1:def 11;
then A59: ( ( addnat ) "**" XFS ) = ( ( addnat ) "**" XFS1 ) by AFINSQ_2:45;
( ( addnat ) "**" XFS1 ) = ( Sum XFS1 ) by AFINSQ_2:51;
hence thesis by A59,AFINSQ_2:51;
end;
uniqueness
proof
reconsider D = ( dom F ) as  finite set by A1;
let n1 being (Element of ( NAT ));
let n2 being (Element of ( NAT ));
assume that
A60: (for x,y being set holds (for X being  finite set holds (for P being (Function of ( card ( Choose (X,k,x,y) ) ),( Choose (X,k,x,y) )) holds (((( dom F ) = X & P is  one-to-one) & x <> y) implies (ex XFS being (XFinSequence of ( NAT )) st ((( dom XFS ) = ( dom P ) & (for z holds (for f holds ((z in ( dom XFS ) & f = ( P . z )) implies ( XFS . z ) = ( card ( Intersection (F,f,x) ) ))))) & n1 = ( Sum XFS )))))))
and
A61: (for x,y being set holds (for X being  finite set holds (for P being (Function of ( card ( Choose (X,k,x,y) ) ),( Choose (X,k,x,y) )) holds (((( dom F ) = X & P is  one-to-one) & x <> y) implies (ex XFS being (XFinSequence of ( NAT )) st ((( dom XFS ) = ( dom P ) & (for z holds (for f holds ((z in ( dom XFS ) & f = ( P . z )) implies ( XFS . z ) = ( card ( Intersection (F,f,x) ) ))))) & n2 = ( Sum XFS )))))));
set Ch1 = ( Choose (D,k,( 0 ),1) );
( card Ch1 ),Ch1 are_equipotent  by CARD_1:def 2;
then consider P being Function such that A62: P is  one-to-one and A63: (( dom P ) = ( card Ch1 ) & ( rng P ) = Ch1) by WELLORD2:def 4;
reconsider P as (Function of ( card Ch1 ),Ch1) by A63,FUNCT_2:1;
consider XFS1 being (XFinSequence of ( NAT )) such that A64: ( dom XFS1 ) = ( dom P ) and A65: (for z holds (for f holds ((z in ( dom XFS1 ) & f = ( P . z )) implies ( XFS1 . z ) = ( card ( Intersection (F,f,( 0 )) ) )))) and A66: n1 = ( Sum XFS1 ) by A60,A62;
consider XFS2 being (XFinSequence of ( NAT )) such that A67: ( dom XFS2 ) = ( dom P ) and A68: (for z holds (for f holds ((z in ( dom XFS2 ) & f = ( P . z )) implies ( XFS2 . z ) = ( card ( Intersection (F,f,( 0 )) ) )))) and A69: n2 = ( Sum XFS2 ) by A61,A62;
now
let z;
assume that
A70: z in ( dom XFS1 );
( P . z ) in ( rng P ) by A64,A70,FUNCT_1:def 3;
then consider Pz being (Function of D,{ ( 0 ),1 }) such that A71: Pz = ( P . z ) and ( card ( Pz " { ( 0 ) } ) ) = k by CKB9:def 1;
( XFS2 . z ) = ( card ( Intersection (F,Pz,( 0 )) ) ) by A64,A67,A68,A70,A71;
hence ( XFS2 . z ) = ( XFS1 . z ) by A65,A70,A71;
end;
hence thesis by A64,A66,A67,A69,FUNCT_1:2;
end;
end;
