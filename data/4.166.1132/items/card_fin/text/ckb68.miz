environ
vocabularies NUMBERS,SUBSET_1,FUNCT_1,NAT_1,TARSKI,FINSET_1,RELAT_1,AFINSQ_1,ARYTM_1,ARYTM_3,FINSEQ_1,XXREAL_0,CARD_1,XBOOLE_0,ORDINAL4,CARD_3,BINOP_1,FINSOP_1,FUNCOP_1,BINOP_2,FUNCT_2,INT_1,VALUED_1,NEWTON,REALSET1,ZFMISC_1,FUNCT_4,EQREL_1,SETFAM_1,STIRL2_1,CARD_FIN;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,NUMBERS,RELAT_1,FUNCT_1,NAT_1,FINSET_1,ORDINAL1,XXREAL_0,NAT_D,AFINSQ_1,VALUED_1,RELSET_1,PARTFUN1,DOMAIN_1,FUNCT_2,FUNCT_4,FUNCOP_1,INT_1,ENUMSET1,BINOP_1,BINOP_2,RECDEF_1,AFINSQ_2,ZFMISC_1,NEWTON,STIRL2_1,YELLOW20,CKB9,CKB21,CKB41,CKB52;
definitions TARSKI,XBOOLE_0,FUNCT_1,FUNCOP_1,FINSET_1,RELAT_1,CKB9,CKB21,CKB41,CKB52;
theorems AFINSQ_1,TARSKI,FUNCT_1,XBOOLE_0,ZFMISC_1,RELAT_1,XBOOLE_1,NAT_1,FUNCT_2,FINSET_1,XCMPLX_1,CARD_2,INT_1,WELLORD2,SUBSET_1,ENUMSET1,CARD_1,BINOP_2,NEWTON,XREAL_1,FUNCOP_1,STIRL2_1,ALTCAT_1,FUNCT_5,IRRAT_1,FUNCT_4,YELLOW20,XXREAL_0,NAT_D,XREAL_0,PRE_POLY,AFINSQ_2,ORDINAL1,VALUED_1,VALUED_0,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67;
schemes FUNCT_2,NAT_1,XBOOLE_0,STIRL2_1;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCT_2,FUNCOP_1,FUNCT_4,FINSET_1,FRAENKEL,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,BINOP_2,CARD_1,WSIERP_1,AFINSQ_1,RELSET_1,VALUED_1,VALUED_0,AFINSQ_2,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47;
constructors PARTFUN3,BINOM,WELLORD2,DOMAIN_1,SETWISEO,REAL_1,NAT_D,YELLOW20,RECDEF_1,BINOP_2,RELSET_1,ORDINAL4,SEQ_1,AFINSQ_1,SEQ_4,AFINSQ_2,STIRL2_1,CKB9,CKB21,CKB52;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
reserve x1 for set;
reserve X for  finite set;
reserve n for Nat;
reserve k for Nat;
theorem
Th67: (for Fy being  finite-yielding Function holds (for X holds (( dom Fy ) = X implies (for XFS being (XFinSequence of ( INT )) holds ((( dom XFS ) = ( card X ) & (for n holds (n in ( dom XFS ) implies ( XFS . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (Fy,( n + 1 )) ) )))) implies ( card ( union ( rng Fy ) ) ) = ( Sum XFS ))))))
proof
defpred P[ Nat ]
 means
(for Fy being  finite-yielding Function holds (for X holds ((( dom Fy ) = X & ( card X ) = $1) implies (for XFS being (XFinSequence of ( INT )) holds ((( dom XFS ) = ( card X ) & (for n holds (n in ( dom XFS ) implies ( XFS . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (Fy,( n + 1 )) ) )))) implies ( card ( union ( rng Fy ) ) ) = ( Sum XFS ))))));
A1: (for k holds (P[ k ] implies P[ ( k + 1 ) ]))
proof
let k;
assume that
A2: P[ k ];
let Fy being  finite-yielding Function;
let X;
assume that
A3: ( dom Fy ) = X
and
A4: ( card X ) = ( k + 1 );
(( rng Fy ) is  finite & (for x holds (x in ( rng Fy ) implies x is  finite)))
proof
thus ( rng Fy ) is  finite by A3,FINSET_1:8;
let x;
assume x in ( rng Fy );
then (ex x1 st (x1 in ( dom Fy ) & ( Fy . x1 ) = x)) by FUNCT_1:def 3;
hence thesis;
end;
then reconsider urngFy = ( union ( rng Fy ) ) as  finite set by FINSET_1:7;
let XFS being (XFinSequence of ( INT ));
assume that
A5: ( dom XFS ) = ( card X )
and
A6: (for n holds (n in ( dom XFS ) implies ( XFS . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (Fy,( n + 1 )) ) )));
per cases ;
suppose A7: k = ( 0 );

then ( len XFS ) = 1 by A4,A5;
then A8: XFS = <% ( XFS . ( 0 ) ) %> by AFINSQ_1:34;
( XFS . ( 0 ) ) is (Element of ( INT )) by INT_1:def 2;
then A9: ( ( addint ) "**" XFS ) = ( XFS . ( 0 ) ) by A8,AFINSQ_2:37;
( 0 ) in ( dom XFS ) by A4,A5,A7,CARD_1:49,TARSKI:def 1;
then A10: ( XFS . ( 0 ) ) = ( ( ( - 1 ) |^ ( 0 ) ) * ( Card_Intersection (Fy,( ( 0 ) + 1 )) ) ) by A6;
consider x such that A11: ( dom Fy ) = { x } by A3,A4,A7,CARD_2:42;
A12: ( rng Fy ) = { ( Fy . x ) } by A11,FUNCT_1:4;
then A13: ( union ( rng Fy ) ) = ( Fy . x ) by ZFMISC_1:25;
(( ( - 1 ) |^ ( 0 ) ) = 1 & Fy = ( x .--> ( Fy . x ) )) by A11,A12,FUNCOP_1:9,NEWTON:4;
then ( XFS . ( 0 ) ) = ( card ( union ( rng Fy ) ) ) by CKB58:1,A13,A10;
hence thesis by A9,AFINSQ_2:50;
end;
suppose A14: k > ( 0 );

consider x such that A15: x in ( dom Fy ) by A3,A4,CARD_1:27,XBOOLE_0:def 1;
set Xx = ( X \ { x } );
A16: ( card Xx ) = k by A3,A4,A15,STIRL2_1:55;
set FyX = ( Fy | Xx );
urngFy = ( ( union ( rng FyX ) ) \/ ( Fy . x ) ) by A3,A15,CKB66:1;
then reconsider urngFyX = ( union ( rng FyX ) ) as  finite set by FINSET_1:1,XBOOLE_1:7;
set Fyx = ( Fy . x );
set I = ( Intersect (FyX,( ( dom FyX ) --> ( Fy . x ) )) );
consider XFyX being (XFinSequence of ( INT )) such that A17: ( dom XFyX ) = ( card Xx ) and A18: (for n holds (n in ( dom XFyX ) implies ( XFyX . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (FyX,( n + 1 )) ) ))) by CKB67:1;
( urngFyX /\ ( Fy . x ) ) = ( union ( rng I ) ) by CKB62:1;
then reconsider urngI = ( union ( rng I ) ) as  finite set;
consider XI being (XFinSequence of ( INT )) such that A19: ( dom XI ) = ( card Xx ) and A20: (for n holds (n in ( dom XI ) implies ( XI . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (I,( n + 1 )) ) ))) by CKB67:1;
set XI1 = ( ( - 1 ) (#) XI );
A21: ( rng XI1 ) c= ( INT ) by VALUED_0:def 5;
then reconsider XI1 as (XFinSequence of ( INT )) by RELAT_1:def 19;
A22: ( card Fyx ) is (Element of ( INT )) by INT_1:def 2;
then (( rng <% ( card Fyx ) %> ) = { ( card Fyx ) } & { ( card Fyx ) } is (Subset of ( INT ))) by AFINSQ_1:33,SUBSET_1:33;
then ( ( rng <% ( card Fyx ) %> ) \/ ( rng XI1 ) ) c= ( INT ) by A21,XBOOLE_1:8;
then A23: ( rng ( <% ( card Fyx ) %> ^ XI1 ) ) c= ( INT ) by AFINSQ_1:26;
A24: ( 0 ) is (Element of ( INT )) by INT_1:def 2;
then A25: (( rng <% ( 0 ) %> ) = { ( 0 ) } & { ( 0 ) } is (Subset of ( INT ))) by AFINSQ_1:33,SUBSET_1:33;
reconsider XcF = <% ( card Fyx ) %>,X0 = <% ( 0 ) %> as (XFinSequence of ( INT )) by A22,A24;
( rng XFyX ) c= ( INT ) by RELAT_1:def 19;
then ( ( rng XFyX ) \/ ( rng <% ( 0 ) %> ) ) c= ( INT ) by A25,XBOOLE_1:8;
then ( rng ( XFyX ^ <% ( 0 ) %> ) ) c= ( INT ) by AFINSQ_1:26;
then reconsider F1 = ( <% ( card Fyx ) %> ^ XI1 ),F2 = ( XFyX ^ <% ( 0 ) %> ) as (XFinSequence of ( INT )) by A23,RELAT_1:def 19;
A26: ( card Xx ) = k by A3,A4,A15,STIRL2_1:55;
( 0 ) is (Element of ( INT )) by INT_1:def 2;
then A27: ( ( addint ) "**" X0 ) = ( 0 ) by AFINSQ_2:37;
( card Fyx ) is (Element of ( INT )) by INT_1:def 2;
then A28: ( ( addint ) "**" XcF ) = ( card Fyx ) by AFINSQ_2:37;
A29: ( ( - 1 ) * ( Sum XI ) ) = ( Sum XI1 ) by AFINSQ_2:64;
A30: ( ( addint ) "**" F1 ) = ( ( addint ) . (( card Fyx ),( ( addint ) "**" XI1 )) ) by A28,AFINSQ_2:42
.= ( ( card Fyx ) + ( ( addint ) "**" XI1 ) ) by BINOP_2:def 20
.= ( ( card Fyx ) + ( Sum XI1 ) ) by AFINSQ_2:50;
A31: ( ( addint ) "**" F2 ) = ( ( addint ) . (( ( addint ) "**" XFyX ),( 0 )) ) by A27,AFINSQ_2:42
.= ( ( ( addint ) "**" XFyX ) + ( 0 ) ) by BINOP_2:def 20
.= ( Sum XFyX ) by AFINSQ_2:50;
A32: ( Sum ( F1 ^ F2 ) ) = ( ( Sum F1 ) + ( Sum F2 ) ) by AFINSQ_2:55
.= ( ( ( addint ) "**" F1 ) + ( Sum F2 ) ) by AFINSQ_2:50
.= ( ( ( card Fyx ) + ( ( - 1 ) * ( Sum XI ) ) ) + ( Sum XFyX ) ) by A29,A30,A31,AFINSQ_2:50;
A33: ( urngFyX \/ Fyx ) = urngFy by A3,A15,CKB66:1;
A34: ( urngFyX /\ Fyx ) = urngI by CKB62:1;
A35: ( dom FyX ) = Xx by A3,RELAT_1:62;
then ( dom I ) = Xx by CKB61:1;
then A36: ( card urngI ) = ( Sum XI ) by A2,A19,A20,A26;
(( len <% ( card Fyx ) %> ) = 1 & ( len XI1 ) = ( card Xx )) by A19,AFINSQ_1:33,VALUED_1:def 5;
then A37: ( len F1 ) = ( k + 1 ) by A16,AFINSQ_1:17;
A38: (for n being Nat holds (n in ( dom XFS ) implies ( XFS . n ) = ( ( addint ) . (( F1 . n ),( F2 . n )) )))
proof
let n being Nat;
assume that
A39: n in ( dom XFS );
reconsider N = n as (Element of ( NAT )) by ORDINAL1:def 12;
per cases ;
suppose A40: n = ( 0 );

(( 0 ) in k & k = ( dom XFyX )) by A3,A4,A14,A15,A17,NAT_1:44,STIRL2_1:55;
then A41: (( F2 . ( 0 ) ) = ( XFyX . ( 0 ) ) & ( XFyX . ( 0 ) ) = ( ( ( - 1 ) |^ ( 0 ) ) * ( Card_Intersection (FyX,( ( 0 ) + 1 )) ) )) by A18,AFINSQ_1:def 3;
(( F1 . ( 0 ) ) = ( card Fyx ) & ( ( - 1 ) |^ ( 0 ) ) = 1) by AFINSQ_1:35,NEWTON:4;
then A42: ( ( addint ) . (( F1 . ( 0 ) ),( F2 . ( 0 ) )) ) = ( ( card Fyx ) + ( Card_Intersection (FyX,( ( 0 ) + 1 )) ) ) by A41,BINOP_2:def 20;
A43: ( ( - 1 ) |^ ( 0 ) ) = 1 by NEWTON:4;
( XFS . ( 0 ) ) = ( ( ( - 1 ) |^ ( 0 ) ) * ( Card_Intersection (Fy,( ( 0 ) + 1 )) ) ) by A6,A39,A40;
hence thesis by A3,A15,A40,A42,A43,CKB60:1;
end;
suppose A44: n > ( 0 );

then reconsider n1 = ( n - 1 ) as (Element of ( NAT )) by NAT_1:20;
A45: ( len <% ( card Fyx ) %> ) = 1 by AFINSQ_1:33;
A46: ( card Xx ) = k by A3,A4,A15,STIRL2_1:55;
A47: n < ( k + 1 ) by A4,A5,A39,NAT_1:44;
then A48: n <= k by NAT_1:13;
A49: n1 < ( n1 + 1 ) by NAT_1:13;
then n1 < k by A48,XXREAL_0:2;
then n1 in ( dom XI ) by A19,A46,NAT_1:44;
then A50: (( XI1 . n1 ) = ( ( - 1 ) * ( XI . n1 ) ) & ( XI . n1 ) = ( ( ( - 1 ) |^ n1 ) * ( Card_Intersection (I,( n1 + 1 )) ) )) by A20,VALUED_1:6;
( ( 0 ) + 1 ) <= n by A49,NAT_1:13;
then ( F1 . n ) = ( ( ( - 1 ) * ( ( - 1 ) |^ n1 ) ) * ( Card_Intersection (I,( n1 + 1 )) ) ) by A37,A47,A45,A50,AFINSQ_1:19;
then A51: ( F1 . n ) = ( ( ( - 1 ) |^ ( n1 + 1 ) ) * ( Card_Intersection (I,( n1 + 1 )) ) ) by NEWTON:6;
A52: ( XFS . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (Fy,( n + 1 )) ) ) by A6,A39;
( Card_Intersection (Fy,( n + 1 )) ) = ( ( Card_Intersection (FyX,( n + 1 )) ) + ( Card_Intersection (I,N) ) ) by A3,A15,A35,A44,CKB65:1;
then A53: ( XFS . n ) = ( ( ( ( - 1 ) |^ n ) * ( Card_Intersection (FyX,( n + 1 )) ) ) + ( ( ( - 1 ) |^ n ) * ( Card_Intersection (I,N) ) ) ) by A52;
per cases  by A48,XXREAL_0:1;
suppose n < k;

then A54: n in k by NAT_1:44;
( card Xx ) = k by A3,A4,A15,STIRL2_1:55;
then (( XFyX . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (FyX,( n + 1 )) ) ) & ( F2 . n ) = ( XFyX . n )) by A17,A18,A54,AFINSQ_1:def 3;
hence thesis by A53,A51,BINOP_2:def 20;
end;
suppose A55: n = k;

then n = ( card Xx ) by A3,A4,A15,STIRL2_1:55;
then ( n + 1 ) > ( card Xx ) by NAT_1:13;
then A56: ( Card_Intersection (FyX,( n + 1 )) ) = ( 0 ) by A35,CKB55:1;
n = ( len XFyX ) by A3,A4,A15,A17,A55,STIRL2_1:55;
then ( F2 . n ) = ( 0 ) by AFINSQ_1:36;
hence thesis by A53,A51,A56,BINOP_2:def 20;
end;
end;
end;
( card urngFyX ) = ( Sum XFyX ) by A2,A35,A17,A18,A26;
then A57: ( card urngFy ) = ( ( ( Sum XFyX ) + ( card Fyx ) ) - ( Sum XI ) ) by A36,A33,A34,CARD_2:45;
A58: ( len <% ( 0 ) %> ) = 1 by AFINSQ_1:33;
( len XFyX ) = ( card Xx ) by A17;
then A59: ( len F2 ) = ( k + 1 ) by A58,A16,AFINSQ_1:17;
A60: ( len XFS ) = ( k + 1 ) by A4,A5;
( Sum XFS ) = ( ( addint ) "**" XFS ) by AFINSQ_2:50
.= ( ( addint ) "**" ( F1 ^ F2 ) ) by A37,A59,A38,A60,AFINSQ_2:46
.= ( Sum ( F1 ^ F2 ) ) by AFINSQ_2:50;
hence thesis by A32,A57;
end;
end;
A61: P[ ( 0 ) ]
proof
let Fy being  finite-yielding Function;
let X;
assume that
A62: ( dom Fy ) = X
and
A63: ( card X ) = ( 0 );
( dom Fy ) = ( {} ) by A62,A63;
then A64: ( rng Fy ) = ( {} ) by RELAT_1:42;
let XFS being (XFinSequence of ( INT ));
assume that
A65: ( dom XFS ) = ( card X )
and
(for n holds (n in ( dom XFS ) implies ( XFS . n ) = ( ( ( - 1 ) |^ n ) * ( Card_Intersection (Fy,( n + 1 )) ) )));
( len XFS ) = ( 0 ) by A63,A65;
then ( ( addint ) "**" XFS ) = ( the_unity_wrt ( addint ) ) by AFINSQ_2:def 8
.= ( 0 ) by BINOP_2:4;
hence thesis by A64,A63,AFINSQ_2:50,ZFMISC_1:2;
end;
(for k holds P[ k ]) from NAT_1:sch 2(A61,A1);
hence thesis;
end;
