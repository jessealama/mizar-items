environ
vocabularies NUMBERS,SUBSET_1,FUNCT_1,NAT_1,TARSKI,FINSET_1,RELAT_1,AFINSQ_1,ARYTM_1,ARYTM_3,FINSEQ_1,XXREAL_0,CARD_1,XBOOLE_0,ORDINAL4,CARD_3,BINOP_1,FINSOP_1,FUNCOP_1,BINOP_2,FUNCT_2,INT_1,VALUED_1,NEWTON,REALSET1,ZFMISC_1,FUNCT_4,EQREL_1,SETFAM_1,STIRL2_1,CARD_FIN;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,NUMBERS,RELAT_1,FUNCT_1,NAT_1,FINSET_1,ORDINAL1,XXREAL_0,NAT_D,AFINSQ_1,VALUED_1,RELSET_1,PARTFUN1,DOMAIN_1,FUNCT_2,FUNCT_4,FUNCOP_1,INT_1,ENUMSET1,BINOP_1,BINOP_2,RECDEF_1,AFINSQ_2,ZFMISC_1,NEWTON,STIRL2_1,YELLOW20,CKB9,CKB21,CKB41,CKB52;
definitions TARSKI,XBOOLE_0,FUNCT_1,FUNCOP_1,FINSET_1,RELAT_1,CKB9,CKB21,CKB41,CKB52;
theorems AFINSQ_1,TARSKI,FUNCT_1,XBOOLE_0,ZFMISC_1,RELAT_1,XBOOLE_1,NAT_1,FUNCT_2,FINSET_1,XCMPLX_1,CARD_2,INT_1,WELLORD2,SUBSET_1,ENUMSET1,CARD_1,BINOP_2,NEWTON,XREAL_1,FUNCOP_1,STIRL2_1,ALTCAT_1,FUNCT_5,IRRAT_1,FUNCT_4,YELLOW20,XXREAL_0,NAT_D,XREAL_0,PRE_POLY,AFINSQ_2,ORDINAL1,VALUED_1,VALUED_0,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67,CKB68,CKB69,CKB70,CKB71,CKB72;
schemes FUNCT_2,NAT_1,XBOOLE_0,STIRL2_1;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCT_2,FUNCOP_1,FUNCT_4,FINSET_1,FRAENKEL,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,BINOP_2,CARD_1,WSIERP_1,AFINSQ_1,RELSET_1,VALUED_1,VALUED_0,AFINSQ_2,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47;
constructors PARTFUN3,BINOM,WELLORD2,DOMAIN_1,SETWISEO,REAL_1,NAT_D,YELLOW20,RECDEF_1,BINOP_2,RELSET_1,ORDINAL4,SEQ_1,AFINSQ_1,SEQ_4,AFINSQ_2,STIRL2_1,CKB9,CKB21,CKB52;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
reserve x1 for set;
reserve x2 for set;
reserve y for set;
reserve n for Nat;
reserve k for Nat;
reserve m for Nat;
theorem
(for n holds (for k holds (k <= n implies (ex F being (XFinSequence of ( INT )) st ((( n block k ) = ( ( 1 / ( k ! ) ) * ( Sum F ) ) & ( dom F ) = ( k + 1 )) & (for m holds (m in ( dom F ) implies ( F . m ) = ( ( ( ( - 1 ) |^ m ) * ( k choose m ) ) * ( ( k - m ) |^ n ) ))))))))
proof
let n;
let k;
assume that
A1: k <= n;
now
per cases ;
suppose A2: (n = ( 0 ) & k = ( 0 ));

reconsider I = 1 as (Element of ( INT )) by INT_1:def 2;
set F = <% I %>;
take F;
( ( addint ) "**" <% I %> ) = 1 by AFINSQ_2:37;
then ( Sum F ) = 1 by AFINSQ_2:50;
hence ( n block k ) = ( ( 1 / ( k ! ) ) * ( Sum F ) ) by A2,NEWTON:12,STIRL2_1:26;
thus ( dom F ) = ( k + 1 ) by A2,AFINSQ_1:33;
let m;
assume m in ( dom F );
then A3: m in { ( 0 ) } by AFINSQ_1:33,CARD_1:49;
then m = ( 0 ) by TARSKI:def 1;
then A4: ( ( - 1 ) |^ m ) = 1 by NEWTON:4;
A5: ( ( k - m ) |^ n ) = 1 by A2,NEWTON:4;
A6: ( ( 0 ) choose ( 0 ) ) = 1 by NEWTON:19;
m = ( 0 ) by A3,TARSKI:def 1;
hence ( F . m ) = ( ( ( ( - 1 ) |^ m ) * ( k choose m ) ) * ( ( k - m ) |^ n ) ) by A2,A4,A5,A6,AFINSQ_1:34;
end;
suppose A7: (n <> ( 0 ) & k = ( 0 ));

set F = ( ( k + 1 ) --> ( 0 ) );
( 0 ) is (Element of ( INT )) by INT_1:def 2;
then (( rng F ) c= { ( 0 ) } & { ( 0 ) } c= ( INT )) by FUNCOP_1:13,ZFMISC_1:31;
then ( rng F ) c= ( INT ) by XBOOLE_1:1;
then reconsider Fi = F as (XFinSequence of ( INT )) by RELAT_1:def 19;
reconsider Fn = F as (XFinSequence of ( NAT ));
take Fi;
(( rng F ) c= { ( 0 ) } & { ( 0 ) } c= { ( 0 ),( 0 ) }) by ENUMSET1:29,FUNCOP_1:13;
then ( Sum Fn ) = ( ( 0 ) * ( card ( Fn " { ( 0 ) } ) ) ) by AFINSQ_2:68,XBOOLE_1:1;
hence (( n block k ) = ( ( 1 / ( k ! ) ) * ( Sum Fi ) ) & ( dom Fi ) = ( k + 1 )) by A7,FUNCOP_1:13,STIRL2_1:31;
let m;
assume that
A8: m in ( dom Fi );
now
per cases ;
suppose m = ( 0 );

then ( ( k - m ) |^ n ) = ( 0 ) by A7,NAT_1:14,NEWTON:11;
hence ( ( k choose m ) * ( ( k - m ) |^ n ) ) = ( 0 );
end;
suppose m > ( 0 );

then ( k choose m ) = ( 0 ) by A7,NEWTON:def 3;
hence ( ( k choose m ) * ( ( k - m ) |^ n ) ) = ( 0 );
end;
end;
then A9: ( ( ( - 1 ) |^ m ) * ( ( k choose m ) * ( ( k - m ) |^ n ) ) ) = ( 0 );
m in ( k + 1 ) by A8,FUNCOP_1:13;
hence ( Fi . m ) = ( ( ( ( - 1 ) |^ m ) * ( k choose m ) ) * ( ( k - m ) |^ n ) ) by A9,FUNCOP_1:7;
end;
suppose A10: (n <> ( 0 ) & k <> ( 0 ));

set Perm = { p where p is (Function of k,k): p is (Permutation of k) };
( card Perm ) = ( ( card k ) ! ) by CKB8:1;
then reconsider Perm as  finite set;
reconsider Bloc = { f where f is (Function of n,k): f is  onto  "increasing } as  finite set by STIRL2_1:24;
set Onto = { f where f is (Function of n,k): f is  onto };
defpred P[ set,set ]
 means
(for p being (Function of k,k) holds (for f being (Function of n,k) holds ($1 = [ p,f ] implies $2 = ( p * f ))));
reconsider N = n,K = k as non empty (Subset of ( NAT )) by A10,STIRL2_1:8;
A11: ( card [: Perm,Bloc :] ) = ( ( card Perm ) * ( card Bloc ) ) by CARD_2:46;
A12: (for x holds (x in [: Perm,Bloc :] implies (ex y st (y in Onto & P[ x,y ]))))
proof
let x;
assume x in [: Perm,Bloc :];
then consider p9 being set,f9 being set such that A13: p9 in Perm and A14: f9 in Bloc and A15: x = [ p9,f9 ] by ZFMISC_1:def 2;
consider f being (Function of n,k) such that A16: f = f9 and A17: f is  onto  "increasing by A14;
A18: ( rng f ) = k by A17,FUNCT_2:def 3;
consider p being (Function of k,k) such that A19: p = p9 and A20: p is (Permutation of k) by A13;
reconsider pf = ( p * f ) as (Function of n,k);
take pf;
A21: ( dom p ) = k by A10,FUNCT_2:def 1;
( rng p ) = k by A20,FUNCT_2:def 3;
then ( rng ( p * f ) ) = k by A18,A21,RELAT_1:28;
then pf is  onto by FUNCT_2:def 3;
hence pf in Onto;
let p1 being (Function of k,k);
let f1 being (Function of n,k);
assume that
A22: x = [ p1,f1 ];
p1 = p by A15,A19,A22,ZFMISC_1:27;
hence thesis by A15,A16,A22,ZFMISC_1:27;
end;
consider FP being (Function of [: Perm,Bloc :],Onto) such that A23: (for x holds (x in [: Perm,Bloc :] implies P[ x,( FP . x ) ])) from FUNCT_2:sch 1(A12);
A24: FP is  one-to-one
proof
let x1;
let x2;
assume that
A25: x1 in ( dom FP )
and
A26: x2 in ( dom FP )
and
A27: ( FP . x1 ) = ( FP . x2 );
consider p19 being set,f19 being set such that A28: p19 in Perm and A29: f19 in Bloc and A30: x1 = [ p19,f19 ] by A25,ZFMISC_1:def 2;
consider p1 being (Function of k,k) such that A31: p19 = p1 and A32: p1 is (Permutation of k) by A28;
consider p29 being set,f29 being set such that A33: p29 in Perm and A34: f29 in Bloc and A35: x2 = [ p29,f29 ] by A26,ZFMISC_1:def 2;
( FP . x1 ) in ( rng FP ) by A25,FUNCT_1:def 3;
then ( FP . x1 ) in Onto;
then consider fp being (Function of N,K) such that A36: ( FP . x1 ) = fp and A37: fp is  onto;
A38: ( rng fp ) = K by A37,FUNCT_2:def 3;
consider p2 being (Function of k,k) such that A39: p29 = p2 and A40: p2 is (Permutation of k) by A33;
consider f2 being (Function of n,k) such that A41: f29 = f2 and A42: f2 is  onto  "increasing by A34;
( rng fp ) = K by A37,FUNCT_2:def 3;
then reconsider p199 = p1,p299 = p2 as (Permutation of ( rng fp )) by A32,A40;
consider f1 being (Function of n,k) such that A43: f19 = f1 and A44: f1 is  onto  "increasing by A29;
reconsider f199 = f1,f299 = f2 as (Function of N,K);
A45: ( rng f2 ) = K by A42,FUNCT_2:def 3;
(for l,m being Nat holds (((l in ( rng f1 ) & m in ( rng f1 )) & l < m) implies ( min* ( f1 " { l } ) ) < ( min* ( f1 " { m } ) ))) by A44,STIRL2_1:def 1;
then A46: f199 is  "increasing by STIRL2_1:def 3;
(for l,m being Nat holds (((l in ( rng f2 ) & m in ( rng f2 )) & l < m) implies ( min* ( f2 " { l } ) ) < ( min* ( f2 " { m } ) ))) by A42,STIRL2_1:def 1;
then A47: f299 is  "increasing by STIRL2_1:def 3;
A48: fp = ( p199 * f199 ) by A23,A25,A30,A31,A43,A36;
A49: ( rng f1 ) = K by A44,FUNCT_2:def 3;
A50: fp = ( p299 * f299 ) by A23,A26,A27,A35,A39,A41,A36;
then p199 = p299 by A46,A47,A49,A45,A48,A38,STIRL2_1:65;
hence thesis by A30,A31,A43,A35,A39,A41,A46,A47,A49,A45,A48,A50,A38,STIRL2_1:65;
end;
consider h being (Function of n,k) such that A51: h is  onto  "increasing by A1,A10,STIRL2_1:23;
Onto c= ( rng FP )
proof
let x;
assume x in Onto;
then consider f being (Function of n,k) such that A52: f = x and A53: f is  onto;
( rng f ) = K by A53,FUNCT_2:def 3;
then consider I being (Function of N,K),P being (Permutation of K) such that A54: f = ( P * I ) and A55: K = ( rng I ) and A56: I is  "increasing by STIRL2_1:63;
set p = P;
reconsider i = I as (Function of n,k);
(for l,m being Nat holds (((l in ( rng I ) & m in ( rng I )) & l < m) implies ( min* ( I " { l } ) ) < ( min* ( I " { m } ) ))) by A56,STIRL2_1:def 3;
then A57: i is  "increasing by STIRL2_1:def 1;
i is  onto by A55,FUNCT_2:def 3;
then (p in Perm & i in Bloc) by A57;
then A58: [ p,i ] in [: Perm,Bloc :] by ZFMISC_1:def 2;
h in Onto by A51;
then A59: [ p,i ] in ( dom FP ) by A58,FUNCT_2:def 1;
( FP . [ p,i ] ) = f by A23,A54,A58;
hence thesis by A52,A59,FUNCT_1:def 3;
end;
then A60: ( rng FP ) = Onto by XBOOLE_0:def 10;
h in Onto by A51;
then ( dom FP ) = [: Perm,Bloc :] by FUNCT_2:def 1;
then Onto,[: Perm,Bloc :] are_equipotent  by A24,A60,WELLORD2:def 4;
then A61: ( card Onto ) = ( ( card Perm ) * ( card Bloc ) ) by A11,CARD_1:5;
( k ! ) > ( 0 ) by NEWTON:17;
then A62: (( ( ( k ! ) * ( card Bloc ) ) / ( k ! ) ) = ( ( card Bloc ) * ( ( k ! ) / ( k ! ) ) ) & ( ( k ! ) / ( k ! ) ) = 1) by XCMPLX_1:60,XCMPLX_1:74;
consider F being (XFinSequence of ( INT )) such that A63: ( dom F ) = ( ( card k ) + 1 ) and A64: ( Sum F ) = ( card { f where f is (Function of n,k): f is  onto } ) and A65: (for m holds (m in ( dom F ) implies ( F . m ) = ( ( ( ( - 1 ) |^ m ) * ( ( card k ) choose m ) ) * ( ( ( card k ) - m ) |^ ( card n ) ) ))) by A10,CKB72:1;
take F;
( card Perm ) = ( ( card k ) ! ) by CKB8:1;
then ( Sum F ) = ( ( k ! ) * ( card Bloc ) ) by A64,A61,CARD_1:def 2;
then ( n block k ) = ( ( ( Sum F ) * 1 ) / ( k ! ) ) by A62,STIRL2_1:def 2;
hence ( n block k ) = ( ( 1 / ( k ! ) ) * ( Sum F ) ) by XCMPLX_1:74;
thus ( dom F ) = ( k + 1 ) by A63,CARD_1:def 2;
A66: (( card k ) = k & ( card n ) = n) by CARD_1:def 2;
let m;
assume m in ( dom F );
hence ( F . m ) = ( ( ( ( - 1 ) |^ m ) * ( k choose m ) ) * ( ( k - m ) |^ n ) ) by A65,A66;
end;
suppose (n = ( 0 ) & k <> ( 0 ));

hence thesis by A1;
end;
end;
hence thesis;
end;
