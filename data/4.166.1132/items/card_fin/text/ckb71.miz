environ
vocabularies NUMBERS,SUBSET_1,FUNCT_1,NAT_1,TARSKI,FINSET_1,RELAT_1,AFINSQ_1,ARYTM_1,ARYTM_3,FINSEQ_1,XXREAL_0,CARD_1,XBOOLE_0,ORDINAL4,CARD_3,BINOP_1,FINSOP_1,FUNCOP_1,BINOP_2,FUNCT_2,INT_1,VALUED_1,NEWTON,REALSET1,ZFMISC_1,FUNCT_4,EQREL_1,SETFAM_1,STIRL2_1,CARD_FIN;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,NUMBERS,RELAT_1,FUNCT_1,NAT_1,FINSET_1,ORDINAL1,XXREAL_0,NAT_D,AFINSQ_1,VALUED_1,RELSET_1,PARTFUN1,DOMAIN_1,FUNCT_2,FUNCT_4,FUNCOP_1,INT_1,ENUMSET1,BINOP_1,BINOP_2,RECDEF_1,AFINSQ_2,ZFMISC_1,NEWTON,STIRL2_1,YELLOW20,CKB9,CKB21,CKB41,CKB52;
definitions TARSKI,XBOOLE_0,FUNCT_1,FUNCOP_1,FINSET_1,RELAT_1,CKB9,CKB21,CKB41,CKB52;
theorems AFINSQ_1,TARSKI,FUNCT_1,XBOOLE_0,ZFMISC_1,RELAT_1,XBOOLE_1,NAT_1,FUNCT_2,FINSET_1,XCMPLX_1,CARD_2,INT_1,WELLORD2,SUBSET_1,ENUMSET1,CARD_1,BINOP_2,NEWTON,XREAL_1,FUNCOP_1,STIRL2_1,ALTCAT_1,FUNCT_5,IRRAT_1,FUNCT_4,YELLOW20,XXREAL_0,NAT_D,XREAL_0,PRE_POLY,AFINSQ_2,ORDINAL1,VALUED_1,VALUED_0,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB48,CKB49,CKB50,CKB51,CKB52,CKB53,CKB54,CKB55,CKB56,CKB57,CKB58,CKB59,CKB60,CKB61,CKB62,CKB63,CKB64,CKB65,CKB66,CKB67,CKB68,CKB69,CKB70;
schemes FUNCT_2,NAT_1,XBOOLE_0,STIRL2_1;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCT_2,FUNCOP_1,FUNCT_4,FINSET_1,FRAENKEL,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,BINOP_2,CARD_1,WSIERP_1,AFINSQ_1,RELSET_1,VALUED_1,VALUED_0,AFINSQ_2,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47;
constructors PARTFUN3,BINOM,WELLORD2,DOMAIN_1,SETWISEO,REAL_1,NAT_D,YELLOW20,RECDEF_1,BINOP_2,RELSET_1,ORDINAL4,SEQ_1,AFINSQ_1,SEQ_4,AFINSQ_2,STIRL2_1,CKB9,CKB21,CKB52;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve x for set;
reserve x1 for set;
reserve y for set;
reserve z for set;
reserve n for Nat;
reserve f for Function;
theorem
Lm3: (for X,Y being  finite set holds ((X is non empty & Y is non empty) implies (ex F being (XFinSequence of ( INT )) st ((( dom F ) = ( card Y ) & ( ( ( card Y ) |^ ( card X ) ) - ( Sum F ) ) = ( card { f where f is (Function of X,Y): f is  onto } )) & (for n holds (n in ( dom F ) implies ( F . n ) = ( ( ( ( - 1 ) |^ n ) * ( ( card Y ) choose ( n + 1 ) ) ) * ( ( ( ( card Y ) - n ) - 1 ) |^ ( card X ) ) )))))))
proof
let X being  finite set,Y being  finite set;
assume that
A1: X is non empty
and
A2: Y is non empty;
defpred xf[ set,set ]
 means
(for n holds (n = $1 implies $2 = ( ( ( ( card Y ) - n ) - 1 ) |^ ( card X ) )));
A3: (for x holds (x in ( card Y ) implies (ex y st (y in ( NAT ) & xf[ x,y ]))))
proof
let x;
assume that
A4: x in ( card Y );
( card Y ) is (Subset of ( NAT )) by STIRL2_1:8;
then reconsider n = x as (Element of ( NAT )) by A4;
n < ( card Y ) by A4,NAT_1:44;
then ( n + 1 ) <= ( card Y ) by NAT_1:13;
then reconsider k = ( ( card Y ) - ( n + 1 ) ) as (Element of ( NAT )) by NAT_1:21;
xf[ n,( k |^ ( card X ) ) ];
hence thesis;
end;
consider XF being (Function of ( card Y ),( NAT )) such that A5: (for x holds (x in ( card Y ) implies xf[ x,( XF . x ) ])) from FUNCT_2:sch 1(A3);
set Onto = { f where f is (Function of X,Y): f is  onto };
deffunc fy(set) = { f where f is (Function of X,Y): (not $1 in ( rng f )) };
A6: (for x holds (x in Y implies fy(x) in ( bool ( Funcs (X,Y) ) )))
proof
let x;
assume that
A7: x in Y;
fy(x) c= ( Funcs (X,Y) )
proof
let y;
assume y in fy(x);
then (ex f being (Function of X,Y) st (y = f & (not x in ( rng f ))));
hence thesis by A7,FUNCT_2:8;
end;
hence thesis;
end;
consider Fy9 being (Function of Y,( bool ( Funcs (X,Y) ) )) such that A8: (for x holds (x in Y implies ( Fy9 . x ) = fy(x))) from FUNCT_2:sch 2(A6);
(for y holds ( Fy9 . y ) is  finite)
proof
let y;
per cases ;
suppose y in ( dom Fy9 );

then ( Fy9 . y ) in ( rng Fy9 ) by FUNCT_1:def 3;
hence thesis;
end;
suppose (not y in ( dom Fy9 ));

hence thesis by FUNCT_1:def 2;
end;
end;
then reconsider Fy = Fy9 as  finite-yielding Function by CKB41:def 1;
( union ( rng Fy9 ) ) c= ( union ( bool ( Funcs (X,Y) ) ) ) by ZFMISC_1:77;
then A9: ( union ( rng Fy ) ) c= ( Funcs (X,Y) ) by ZFMISC_1:81;
then reconsider u = ( union ( rng Fy ) ) as  finite set;
A10: ( dom XF ) = ( card Y ) by FUNCT_2:def 1;
then reconsider XF as XFinSequence by AFINSQ_1:5;
reconsider XF as (XFinSequence of ( NAT ));
A11: (for n holds (n in ( dom XF ) implies (ex x st (ex y st (x <> y & (for f holds (f in ( Choose (Y,( n + 1 ),x,y) ) implies ( card ( Intersection (Fy,f,x) ) ) = ( XF . n ))))))))
proof
let n;
assume that
A12: n in ( dom XF );
take ( 0 );
take 1;
thus ( 0 ) <> 1;
let f9 being Function;
assume f9 in ( Choose (Y,( n + 1 ),( 0 ),1) );
then consider f being (Function of Y,{ ( 0 ),1 }) such that A13: f = f9 and A14: ( card ( f " { ( 0 ) } ) ) = ( n + 1 ) by CKB9:def 1;
A15: ( Intersection (Fy,f,( 0 )) ) c= ( Funcs (X,( Y \ ( f " { ( 0 ) } ) )) )
proof
let z;
assume that
A16: z in ( Intersection (Fy,f,( 0 )) );
( 0 ) in ( rng f ) by A14,CARD_1:27,FUNCT_1:72;
then consider x1 such that A17: x1 in ( dom f ) and ( f . x1 ) = ( 0 ) and A18: z in ( Fy . x1 ) by A16,CKB25:1;
z in fy(x1) by A8,A17,A18;
then consider g being (Function of X,Y) such that A19: z = g and (not x1 in ( rng g ));
A20: ( rng g ) c= ( Y \ ( f " { ( 0 ) } ) )
proof
let gy being set;
assume that
A21: gy in ( rng g );
assume (not gy in ( Y \ ( f " { ( 0 ) } ) ));
then A22: gy in ( f " { ( 0 ) } ) by A21,XBOOLE_0:def 5;
then ( f . gy ) in { ( 0 ) } by FUNCT_1:def 7;
then A23: ( f . gy ) = ( 0 ) by TARSKI:def 1;
gy in ( dom f ) by A22,FUNCT_1:def 7;
then g in ( Fy . gy ) by A16,A19,A23,CKB21:def 1;
then g in fy(gy) by A8,A21;
then (ex h being (Function of X,Y) st (g = h & (not gy in ( rng h ))));
hence contradiction by A21;
end;
( dom g ) = X by A17,FUNCT_2:def 1;
hence thesis by A19,A20,FUNCT_2:def 2;
end;
then reconsider I = ( Intersection (Fy,f,( 0 )) ) as  finite set;
A24: ( card ( Y \ ( f " { ( 0 ) } ) ) ) = ( ( card Y ) - ( n + 1 ) ) by A14,CARD_2:44;
( Funcs (X,( Y \ ( f " { ( 0 ) } ) )) ) c= ( Intersection (Fy,f,( 0 )) )
proof
let g9 being set;
assume g9 in ( Funcs (X,( Y \ ( f " { ( 0 ) } ) )) );
then consider g being Function such that A25: g9 = g and A26: ( dom g ) = X and A27: ( rng g ) c= ( Y \ ( f " { ( 0 ) } ) ) by FUNCT_2:def 2;
reconsider gg = g as (Function of X,Y) by A26,A27,FUNCT_2:2,XBOOLE_1:1;
consider y such that A28: y in ( f " { ( 0 ) } ) by A14,CARD_1:27,XBOOLE_0:def 1;
(not y in ( rng g )) by A27,A28,XBOOLE_0:def 5;
then A29: gg in fy(y);
( dom Fy ) = Y by FUNCT_2:def 1;
then A30: ( Fy9 . y ) in ( rng Fy9 ) by A28,FUNCT_1:def 3;
A31: (for z holds ((z in ( dom f ) & ( f . z ) = ( 0 )) implies g in ( Fy . z )))
proof
let z;
assume that
A32: z in ( dom f )
and
A33: ( f . z ) = ( 0 );
( f . z ) in { ( 0 ) } by A33,TARSKI:def 1;
then z in ( f " { ( 0 ) } ) by A32,FUNCT_1:def 7;
then A34: (not z in ( rng gg )) by A27,XBOOLE_0:def 5;
( Fy . z ) = fy(z) by A8,A32;
hence thesis by A34;
end;
fy(y) = ( Fy9 . y ) by A8,A28;
then g in ( union ( rng Fy ) ) by A30,A29,TARSKI:def 4;
hence thesis by A25,A31,CKB21:def 1;
end;
then A35: ( Funcs (X,( Y \ ( f " { ( 0 ) } ) )) ) = ( Intersection (Fy,f,( 0 )) ) by A15,XBOOLE_0:def 10;
now
per cases ;
suppose ( Y \ ( f " { ( 0 ) } ) ) = ( {} );

then (( card I ) = ( 0 ) & ( ( ( ( card Y ) - n ) - 1 ) |^ ( card X ) ) = ( 0 )) by A1,A15,A24,CARD_1:27,NAT_1:14,NEWTON:11;
hence thesis by A5,A10,A12,A13;
end;
suppose A36: ( Y \ ( f " { ( 0 ) } ) ) <> ( {} );

( XF . n ) = ( ( ( ( card Y ) - n ) - 1 ) |^ ( card X ) ) by A5,A10,A12;
hence thesis by A13,A35,A24,A36,CKB4:1;
end;
end;
hence thesis;
end;
(( dom XF ) = ( card Y ) & ( dom Fy ) = Y) by FUNCT_2:def 1;
then consider F being (XFinSequence of ( INT )) such that A37: ( dom F ) = ( card Y ) and A38: ( card ( union ( rng Fy ) ) ) = ( Sum F ) and A39: (for n holds (n in ( dom F ) implies ( F . n ) = ( ( ( ( - 1 ) |^ n ) * ( XF . n ) ) * ( ( card Y ) choose ( n + 1 ) ) ))) by A11,CKB70:1;
take F;
thus ( dom F ) = ( card Y ) by A37;
A40: ( card ( ( Funcs (X,Y) ) \ u ) ) = ( ( card ( Funcs (X,Y) ) ) - ( card u ) ) by A9,CARD_2:44;
A41: Onto c= ( ( Funcs (X,Y) ) \ ( union ( rng Fy ) ) )
proof
let x;
assume x in Onto;
then consider f being (Function of X,Y) such that A42: x = f and A43: f is  onto;
assume A44: (not x in ( ( Funcs (X,Y) ) \ ( union ( rng Fy ) ) ));
f in ( Funcs (X,Y) ) by A2,FUNCT_2:8;
then f in ( union ( rng Fy ) ) by A42,A44,XBOOLE_0:def 5;
then consider Fyy being set such that A45: f in Fyy and A46: Fyy in ( rng Fy ) by TARSKI:def 4;
consider y such that A47: y in ( dom Fy ) and A48: ( Fy . y ) = Fyy by A46,FUNCT_1:def 3;
y in Y by A47,FUNCT_2:def 1;
then f in fy(y) by A8,A45,A48;
then A49: (ex g being (Function of X,Y) st (f = g & (not y in ( rng g ))));
y in Y by A47,FUNCT_2:def 1;
hence contradiction by A43,A49,FUNCT_2:def 3;
end;
A50: ( ( Funcs (X,Y) ) \ ( union ( rng Fy ) ) ) c= Onto
proof
let x;
assume that
A51: x in ( ( Funcs (X,Y) ) \ ( union ( rng Fy ) ) );
consider f such that A52: x = f and A53: (( dom f ) = X & ( rng f ) c= Y) by A51,FUNCT_2:def 2;
reconsider f as (Function of X,Y) by A53,FUNCT_2:2;
assume (not x in Onto);
then (not f is  onto) by A52;
then ( rng f ) <> Y by FUNCT_2:def 3;
then (not Y c= ( rng f )) by XBOOLE_0:def 10;
then consider y such that A54: y in Y and A55: (not y in ( rng f )) by TARSKI:def 3;
y in ( dom Fy9 ) by A54,FUNCT_2:def 1;
then ( Fy9 . y ) in ( rng Fy9 ) by FUNCT_1:def 3;
then A56: fy(y) in ( rng Fy9 ) by A8,A54;
f in fy(y) by A55;
then f in ( union ( rng Fy ) ) by A56,TARSKI:def 4;
hence thesis by A51,A52,XBOOLE_0:def 5;
end;
( card ( Funcs (X,Y) ) ) = ( ( card Y ) |^ ( card X ) ) by A2,CKB4:1;
hence ( card Onto ) = ( ( ( card Y ) |^ ( card X ) ) - ( Sum F ) ) by A38,A50,A41,A40,XBOOLE_0:def 10;
let n;
assume that
A57: n in ( dom F );
A58: ( F . n ) = ( ( ( ( - 1 ) |^ n ) * ( XF . n ) ) * ( ( card Y ) choose ( n + 1 ) ) ) by A39,A57;
( XF . n ) = ( ( ( ( card Y ) - n ) - 1 ) |^ ( card X ) ) by A5,A37,A57;
hence thesis by A58;
end;
