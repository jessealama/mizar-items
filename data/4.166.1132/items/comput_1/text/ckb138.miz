environ
vocabularies NUMBERS,SUBSET_1,XBOOLE_0,RELAT_1,FUNCT_1,FINSEQ_1,FUNCT_4,FINSEQ_3,XXREAL_0,NAT_1,ARYTM_3,CARD_1,FINSEQ_2,PARTFUN1,SETFAM_1,FUNCT_6,TARSKI,MSUALG_6,RFUNCT_3,VALUED_0,UNIALG_1,CARD_3,FUNCOP_1,FUNCT_2,PRALG_3,ORDINAL1,ORDINAL4,ZFMISC_1,FINSET_1,VALUED_2,REALSET1,NEWTON,ARYTM_1,COMPUT_1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,XCMPLX_0,XXREAL_0,RELAT_1,RELSET_1,FUNCT_1,FINSEQ_1,FINSEQ_2,SETFAM_1,FUNCT_2,MARGREL1,FUNCOP_1,XXREAL_2,VALUED_0,FUNCT_4,CARD_3,PROB_1,FINSEQ_3,FINSEQ_4,PARTFUN1,RFUNCT_3,FUNCT_6,FUNCT_7,MIDSP_3,FINSET_1,NEWTON,NAT_D,NAT_1,RECDEF_1,CKB11,CKB21,CKB23,CKB45,CKB49,CKB51,CKB59,CKB64,CKB68,CKB80,CKB88,CKB89,CKB96,CKB100,CKB110,CKB111,CKB112,CKB123,CKB127,CKB133,CKB134,CKB135,CKB136;
definitions PARTFUN1,RFUNCT_3,FUNCT_1,RELAT_1,TARSKI,FINSEQ_2,FUNCOP_1,CARD_3,MARGREL1,CKB11,CKB23,CKB45,CKB49,CKB51,CKB59,CKB64,CKB68,CKB88,CKB89,CKB96,CKB110,CKB111,CKB112,CKB123,CKB127,CKB133,CKB134,CKB135,CKB136;
theorems TARSKI,NAT_1,ZFMISC_1,RELAT_1,RELSET_1,FINSEQ_1,FUNCOP_1,PARTFUN1,FINSEQ_2,FINSEQ_4,FUNCT_6,FUNCT_1,RFUNCT_3,FUNCT_2,GRFUNC_1,FUNCT_7,FUNCT_4,FINSEQ_3,SUBSET_1,SETFAM_1,CARD_5,FUNCT_5,CARD_1,CARD_3,NEWTON,WSIERP_1,XBOOLE_0,XBOOLE_1,ORDINAL1,XXREAL_0,VALUED_0,XXREAL_2,XREAL_0,NAT_D,XREAL_1,MARGREL1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB14,CKB16,CKB17,CKB18,CKB20,CKB23,CKB24,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB49,CKB50,CKB51,CKB52,CKB56,CKB57,CKB58,CKB59,CKB60,CKB62,CKB64,CKB65,CKB67,CKB68,CKB69,CKB70,CKB72,CKB73,CKB75,CKB76,CKB77,CKB79,CKB82,CKB83,CKB84,CKB85,CKB86,CKB87,CKB88,CKB89,CKB90,CKB91,CKB92,CKB93,CKB94,CKB95,CKB96,CKB97,CKB98,CKB99,CKB101,CKB102,CKB103,CKB104,CKB105,CKB106,CKB107,CKB108,CKB109,CKB110,CKB111,CKB112,CKB113,CKB115,CKB116,CKB117,CKB118,CKB119,CKB120,CKB121,CKB122,CKB123,CKB124,CKB127,CKB133,CKB134,CKB135,CKB136,CKB137;
schemes NAT_1,FUNCT_2,RECDEF_1,MONOID_1,PARTFUN2;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,PARTFUN1,FUNCOP_1,FINSET_1,XXREAL_0,XREAL_0,NAT_1,MEMBERED,FINSEQ_1,FINSEQ_2,FUNCT_7,FUNCT_2,VALUED_0,XXREAL_2,CARD_1,RELSET_1,CARD_3,FINSEQ_3,MARGREL1,CKB12,CKB13,CKB15,CKB19,CKB22,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB46,CKB47,CKB48,CKB53,CKB54,CKB55,CKB61,CKB63,CKB66,CKB71,CKB74,CKB78,CKB81,CKB114,CKB125,CKB126,CKB128,CKB129,CKB130,CKB131,CKB132;
constructors SETFAM_1,DOMAIN_1,FUNCT_4,REAL_1,PROB_1,FINSEQ_3,FINSEQ_4,NEWTON,RFUNCT_3,NAT_D,RECDEF_1,XXREAL_2,MIDSP_3,RELSET_1,FUNCT_6,MARGREL1,XXREAL_1,CKB11,CKB23,CKB45,CKB49,CKB51,CKB59,CKB64,CKB68,CKB80,CKB88,CKB89,CKB96,CKB100,CKB110,CKB111,CKB112,CKB123,CKB127,CKB133,CKB134,CKB135,CKB136;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve i for (Element of ( NAT ));
reserve k for (Element of ( NAT ));
reserve m for (Element of ( NAT ));
reserve n for (Element of ( NAT ));
reserve x for set;
reserve f for Function;
reserve g for Function;
reserve f1 for non  empty  homogeneous  to-naturals ( ( NAT ) * ) -defined Function;
reserve f2 for non  empty  homogeneous  to-naturals ( ( NAT ) * ) -defined Function;
theorem
Th80: ( Union ( PrimRec-Approximation ) ) is  primitive-recursively_closed
proof
set PROJ = { ( n proj i ) where n is (Element of ( NAT )),i is (Element of ( NAT )): (1 <= i & i <= n) };
set prd = ( PrimRec-Approximation );
set UP = ( Union prd );
A1: ( dom prd ) = ( NAT ) by FUNCT_2:def 1;
A2: ( prd . ( 0 ) ) = ( { ( ( 0 ) const ( 0 ) ),( 1 succ 1 ) } \/ PROJ ) by CKB136:def 1;
( ( 0 ) const ( 0 ) ) in { ( ( 0 ) const ( 0 ) ),( 1 succ 1 ) } by TARSKI:def 2;
then ( ( 0 ) const ( 0 ) ) in ( prd . ( 0 ) ) by A2,XBOOLE_0:def 3;
hence ( ( 0 ) const ( 0 ) ) in UP by A1,CARD_5:2;
( 1 succ 1 ) in { ( ( 0 ) const ( 0 ) ),( 1 succ 1 ) } by TARSKI:def 2;
then ( 1 succ 1 ) in ( prd . ( 0 ) ) by A2,XBOOLE_0:def 3;
hence ( 1 succ 1 ) in UP by A1,CARD_5:2;
hereby
let n being (Element of ( NAT ));
let i being (Element of ( NAT ));
assume that
A3: 1 <= i
and
A4: i <= n;
( n proj i ) in PROJ by A3,A4;
then ( n proj i ) in ( prd . ( 0 ) ) by A2,XBOOLE_0:def 3;
hence ( n proj i ) in UP by A1,CARD_5:2;
end;
hereby
deffunc mcocl((Element of ( NAT ))) = { ( f * <: F :> ) where f is (Element of ( HFuncs ( NAT ) )),F is  with_the_same_arity (Element of ( ( HFuncs ( NAT ) ) * )): ((f in ( prd . $1 ) & ( arity f ) = ( len F )) & ( rng F ) c= ( prd . $1 )) };
let f being (Element of ( HFuncs ( NAT ) ));
let F being  with_the_same_arity (FinSequence of ( HFuncs ( NAT ) ));
assume that
A5: f in UP
and
A6: ( arity f ) = ( len F )
and
A7: ( rng F ) c= UP;
consider kf being set such that A8: kf in ( dom prd ) and A9: f in ( prd . kf ) by A5,CARD_5:2;
reconsider kf as (Element of ( NAT )) by A8;
per cases ;
suppose ( arity f ) = ( 0 );

then F = ( {} ) by A6;
then A10: ( rng F ) c= ( prd . kf ) by RELAT_1:38,XBOOLE_1:2;
F is  with_the_same_arity  with_the_same_arity (Element of ( ( HFuncs ( NAT ) ) * )) by FINSEQ_1:def 11;
then ( f * <: F :> ) in mcocl(kf) by A6,A9,A10;
then ( f * <: F :> ) in ( ( prd . kf ) \/ mcocl(kf) ) by XBOOLE_0:def 3;
then ( f * <: F :> ) in ( ( PR-closure ( prd . kf ) ) \/ ( composition-closure ( prd . kf ) ) ) by XBOOLE_0:def 3;
then ( f * <: F :> ) in ( prd . ( kf + 1 ) ) by CKB136:def 1;
hence ( f * <: F :> ) in UP by A1,CARD_5:2;
end;
suppose A11: ( arity f ) <> ( 0 );

defpred B[ set,set ]
 means
(ex k being (Element of ( NAT )) st (( F . $1 ) in ( prd . k ) & $2 = k));
A12: (for x holds (x in ( Seg ( len F ) ) implies (ex y being (Element of ( NAT )) st B[ x,y ])))
proof
let x being set;
assume x in ( Seg ( len F ) );
then x in ( dom F ) by FINSEQ_1:def 3;
then ( F . x ) in ( rng F ) by FUNCT_1:def 3;
then consider k being set such that A13: k in ( dom prd ) and A14: ( F . x ) in ( prd . k ) by A7,CARD_5:2;
reconsider k as (Element of ( NAT )) by A13;
take k;
take k1 = k;
thus ( F . x ) in ( prd . k1 ) by A14;
thus thesis;
end;
consider fKF being (Function of ( Seg ( len F ) ),( NAT )) such that A15: (for x being set holds (x in ( Seg ( len F ) ) implies B[ x,( fKF . x ) ])) from MONOID_1:sch 1(A12);
set KF = ( rng fKF );
reconsider KF as non  empty  finite (Subset of ( NAT )) by A6,A11,RELAT_1:def 19;
set K = ( max KF );
set k = ( max (kf,K) );
reconsider k as (Element of ( NAT )) by ORDINAL1:def 12;
A16: ( dom fKF ) = ( Seg ( len F ) ) by FUNCT_2:def 1;
A17: ( rng F ) c= ( prd . k )
proof
let x being set;
A18: K <= k by XXREAL_0:25;
assume x in ( rng F );
then consider d being set such that A19: d in ( dom F ) and A20: x = ( F . d ) by FUNCT_1:def 3;
A21: d in ( Seg ( len F ) ) by A19,FINSEQ_1:def 3;
then consider m being (Element of ( NAT )) such that A22: ( F . d ) in ( prd . m ) and A23: ( fKF . d ) = m by A15;
m in KF by A16,A21,A23,FUNCT_1:3;
then m <= K by XXREAL_2:def 8;
then ( prd . m ) c= ( prd . k ) by A18,CKB137:1,XXREAL_0:2;
hence thesis by A20,A22;
end;
A24: F is  with_the_same_arity  with_the_same_arity (Element of ( ( HFuncs ( NAT ) ) * )) by FINSEQ_1:def 11;
( prd . kf ) c= ( prd . k ) by CKB137:1,XXREAL_0:25;
then ( f * <: F :> ) in mcocl(k) by A6,A9,A17,A24;
then ( f * <: F :> ) in ( ( prd . k ) \/ mcocl(k) ) by XBOOLE_0:def 3;
then ( f * <: F :> ) in ( ( PR-closure ( prd . k ) ) \/ ( composition-closure ( prd . k ) ) ) by XBOOLE_0:def 3;
then ( f * <: F :> ) in ( prd . ( k + 1 ) ) by CKB136:def 1;
hence ( f * <: F :> ) in UP by A1,CARD_5:2;
end;
end;
deffunc mprcl((Element of ( NAT ))) = { g where g is (Element of ( HFuncs ( NAT ) )): (ex f1,f2 being (Element of ( HFuncs ( NAT ) )) st (ex i being (Element of ( NAT )) st ((f1 in ( prd . $1 ) & f2 in ( prd . $1 )) & g is_primitive-recursively_expressed_by f1,f2,i))) };
let g being (Element of ( HFuncs ( NAT ) ));
let f1 being (Element of ( HFuncs ( NAT ) ));
let f2 being (Element of ( HFuncs ( NAT ) ));
let i being (Element of ( NAT ));
assume that
A25: g is_primitive-recursively_expressed_by f1,f2,i
and
A26: f1 in UP
and
A27: f2 in UP;
consider k2 being set such that A28: k2 in ( dom prd ) and A29: f2 in ( prd . k2 ) by A27,CARD_5:2;
reconsider k2 as (Element of ( NAT )) by A28;
consider k1 being set such that A30: k1 in ( dom prd ) and A31: f1 in ( prd . k1 ) by A26,CARD_5:2;
reconsider k1 as (Element of ( NAT )) by A30;
per cases ;
suppose k1 <= k2;

then ( prd . k1 ) c= ( prd . k2 ) by CKB137:1;
then g in mprcl(k2) by A25,A31,A29;
then g in ( ( prd . k2 ) \/ mprcl(k2) ) by XBOOLE_0:def 3;
then g in ( ( PR-closure ( prd . k2 ) ) \/ ( composition-closure ( prd . k2 ) ) ) by XBOOLE_0:def 3;
then g in ( prd . ( k2 + 1 ) ) by CKB136:def 1;
hence thesis by A1,CARD_5:2;
end;
suppose k2 <= k1;

then ( prd . k2 ) c= ( prd . k1 ) by CKB137:1;
then g in mprcl(k1) by A25,A31,A29;
then g in ( ( prd . k1 ) \/ mprcl(k1) ) by XBOOLE_0:def 3;
then g in ( ( PR-closure ( prd . k1 ) ) \/ ( composition-closure ( prd . k1 ) ) ) by XBOOLE_0:def 3;
then g in ( prd . ( k1 + 1 ) ) by CKB136:def 1;
hence thesis by A1,CARD_5:2;
end;
end;
