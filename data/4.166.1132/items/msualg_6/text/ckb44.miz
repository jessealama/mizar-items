environ
vocabularies NUMBERS,XBOOLE_0,MSUALG_1,SUBSET_1,FUNCT_1,PBOOLE,MEMBER_1,RELAT_1,STRUCT_0,CARD_3,MARGREL1,PARTFUN1,MOD_4,MSUALG_3,NAT_1,FUNCT_4,RLTOPSP1,TARSKI,REWRITE1,FUNCOP_1,FINSEQ_1,ARYTM_3,FUNCT_7,CARD_1,XXREAL_0,ORDINAL4,MSUALG_4,CIRCUIT2,MCART_1,ZFMISC_1,EQREL_1,RELAT_2,MSUALG_5,MSUALG_6;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,NAT_1,MCART_1,STRUCT_0,RELAT_1,RELAT_2,RELSET_1,EQREL_1,REWRITE1,FUNCT_1,PBOOLE,PARTFUN1,FUNCT_2,FINSEQ_1,CARD_3,FUNCOP_1,MSUALG_1,MSUALG_3,MSUALG_4,MSUALG_5,FUNCT_7,XXREAL_0,CKB1,CKB2,CKB5,CKB9,CKB13,CKB14,CKB18,CKB20,CKB25,CKB39,CKB40,CKB41;
definitions TARSKI,RELAT_1,REWRITE1,FUNCT_1,PBOOLE,MSUALG_3,MSUALG_4,FUNCT_7,FUNCOP_1,CKB5,CKB9,CKB14,CKB18,CKB20,CKB25,CKB39,CKB40,CKB41;
theorems TARSKI,NAT_1,MCART_1,ZFMISC_1,RELAT_1,RELSET_1,EQREL_1,FUNCT_1,FINSEQ_1,FINSEQ_3,FUNCT_2,CARD_3,FUNCT_7,REWRITE1,PBOOLE,PRALG_2,MSUALG_3,MSUALG_4,MSUALG_5,FINSEQ_5,XBOOLE_0,PARTFUN1,RELAT_2,ORDERS_1,XREAL_1,XXREAL_0,ORDINAL1,CKB3,CKB4,CKB5,CKB6,CKB9,CKB10,CKB11,CKB12,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43;
schemes NAT_1,RECDEF_1,RELSET_1,FUNCT_1,FINSEQ_1,CARD_3,CLASSES1,PBOOLE,PUA2MSS1,CKB32;
registrations XBOOLE_0,RELAT_1,FUNCT_1,PARTFUN1,FUNCT_2,FUNCOP_1,XXREAL_0,XREAL_0,NAT_1,FINSEQ_1,PBOOLE,REWRITE1,FUNCT_7,STRUCT_0,MSUALG_1,MSUALG_3,MSUALG_4,MSUALG_5,ORDINAL1,CARD_1,RELSET_1,CKB7,CKB8;
constructors XXREAL_0,NAT_1,NAT_D,REWRITE1,FUNCT_7,MSUALG_3,MSUALG_5,RELSET_1,CKB2,CKB5,CKB9,CKB13,CKB14,CKB18,CKB20,CKB25,CKB39,CKB40,CKB41;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve S for non  empty non  void ManySortedSign;
reserve A for  non-empty MSAlgebra over S;
registration
let S being non  empty non  void ManySortedSign;
let A being  non-empty MSAlgebra over S;
cluster  invariant ->  compatible for  MSEquivalence-like  MSEquivalence-like (ManySortedRelation of A);
coherence
proof
let R being  MSEquivalence-like (ManySortedRelation of A);
assume that
A1: (for s1,s2 being (SortSymbol of S) holds (for t being Function holds (t is_e.translation_of A,s1,s2 implies (for a,b being set holds ([ a,b ] in ( R . s1 ) implies [ ( t . a ),( t . b ) ] in ( R . s2 ))))));
let o being (OperSymbol of S);
let a being Function;
let b being Function;
assume that
A2: a in ( Args (o,A) )
and
A3: b in ( Args (o,A) )
and
A4: (for n being (Element of ( NAT )) holds (n in ( dom ( the_arity_of o ) ) implies [ ( a . n ),( b . n ) ] in ( R . ( ( the_arity_of o ) /. n ) )));
A5: ( dom ( the_arity_of o ) ) = ( Seg ( len ( the_arity_of o ) ) ) by FINSEQ_1:def 3;
reconsider a9 = a as (Element of ( Args (o,A) )) by A2;
defpred P[ set,set,set ]
 means
(ex c being (Element of ( Args (o,A) )) st (c = $2 & $3 = ( c +* ($1,( b . $1 )) )));
A6: (for n being (Element of ( NAT )) holds ((1 <= n & n < ( ( len ( the_arity_of o ) ) + 1 )) implies (for x being (Element of ( Args (o,A) )) holds (ex y being (Element of ( Args (o,A) )) st P[ n,x,y ]))))
proof
let n being (Element of ( NAT ));
assume that
A7: 1 <= n
and
A8: n < ( ( len ( the_arity_of o ) ) + 1 );
let x being (Element of ( Args (o,A) ));
n <= ( len ( the_arity_of o ) ) by A8,NAT_1:13;
then n in ( dom ( the_arity_of o ) ) by A7,FINSEQ_3:25;
then ( b . n ) in ( (the Sorts of A) . ( ( the_arity_of o ) /. n ) ) by A3,CKB4:1;
then ( x +* (n,( b . n )) ) in ( Args (o,A) ) by CKB15:1;
hence thesis;
end;
consider p being (FinSequence of ( Args (o,A) )) such that A9: ( len p ) = ( ( len ( the_arity_of o ) ) + 1 ) and A10: (( p . 1 ) = a9 or ( ( len ( the_arity_of o ) ) + 1 ) = ( 0 )) and A11: (for i being (Element of ( NAT )) holds ((1 <= i & i < ( ( len ( the_arity_of o ) ) + 1 )) implies P[ i,( p . i ),( p . ( i + 1 ) ) ])) from RECDEF_1:sch 4(A6);
( ( len ( the_arity_of o ) ) + 1 ) >= 1 by NAT_1:11;
then A12: ( ( len ( the_arity_of o ) ) + 1 ) in ( dom p ) by A9,FINSEQ_3:25;
defpred P[ (Element of ( NAT )) ]
 means
($1 <= ( len ( the_arity_of o ) ) implies (ex c being (Element of ( Args (o,A) )) st ((c = ( p . ( $1 + 1 ) ) & (for j being (Element of ( NAT )) holds ((j in ( dom ( the_arity_of o ) ) & j > $1) implies ( c . j ) = ( a . j )))) & (for j being Nat holds (j in ( Seg $1 ) implies ( c . j ) = ( b . j ))))));
A13: ( dom ( the_arity_of o ) ) = ( Seg ( len ( the_arity_of o ) ) ) by FINSEQ_1:def 3;
A14: (for n being (Element of ( NAT )) holds (P[ n ] implies P[ ( n + 1 ) ]))
proof
let i being (Element of ( NAT ));
assume that
A15: (i <= ( len ( the_arity_of o ) ) implies (ex c being (Element of ( Args (o,A) )) st ((c = ( p . ( i + 1 ) ) & (for j being (Element of ( NAT )) holds ((j in ( dom ( the_arity_of o ) ) & j > i) implies ( c . j ) = ( a . j )))) & (for j being Nat holds (j in ( Seg i ) implies ( c . j ) = ( b . j ))))))
and
A16: ( i + 1 ) <= ( len ( the_arity_of o ) );
( i + 1 ) < ( ( len ( the_arity_of o ) ) + 1 ) by A16,NAT_1:13;
then consider c being (Element of ( Args (o,A) )) such that A17: c = ( p . ( i + 1 ) ) and A18: ( p . ( ( i + 1 ) + 1 ) ) = ( c +* (( i + 1 ),( b . ( i + 1 ) )) ) by A11,NAT_1:11;
( i + 1 ) >= 1 by NAT_1:11;
then ( i + 1 ) in ( dom ( the_arity_of o ) ) by A16,FINSEQ_3:25;
then ( b . ( i + 1 ) ) in ( (the Sorts of A) . ( ( the_arity_of o ) /. ( i + 1 ) ) ) by A3,CKB4:1;
then reconsider d = ( p . ( ( i + 1 ) + 1 ) ) as (Element of ( Args (o,A) )) by A18,CKB15:1;
take d;
thus d = ( p . ( ( i + 1 ) + 1 ) );
( Seg ( i + 1 ) ) c= ( dom ( the_arity_of o ) ) by A13,A16,FINSEQ_1:5;
then A19: ( Seg ( i + 1 ) ) c= ( dom c ) by MSUALG_3:6;
i <= ( i + 1 ) by NAT_1:11;
then consider ci being (Element of ( Args (o,A) )) such that A20: ci = ( p . ( i + 1 ) ) and A21: (for j being (Element of ( NAT )) holds ((j in ( dom ( the_arity_of o ) ) & j > i) implies ( ci . j ) = ( a . j ))) and A22: (for j being Nat holds (j in ( Seg i ) implies ( ci . j ) = ( b . j ))) by A15,A16,XXREAL_0:2;
hereby
let j being (Element of ( NAT ));
assume that
A23: j in ( dom ( the_arity_of o ) )
and
A24: j > ( i + 1 );
j > i by A24,NAT_1:13;
then ( ci . j ) = ( a . j ) by A21,A23;
hence ( d . j ) = ( a . j ) by A20,A17,A18,A24,FUNCT_7:32;
end;
let j being Nat;
assume A25: j in ( Seg ( i + 1 ) );
then j in ( ( Seg i ) \/ { ( i + 1 ) } ) by FINSEQ_1:9;
then A26: (j in ( Seg i ) or j in { ( i + 1 ) }) by XBOOLE_0:def 3;
per cases ;
suppose j = ( i + 1 );

hence thesis by A18,A25,A19,FUNCT_7:31;
end;
suppose A27: j <> ( i + 1 );

then ( d . j ) = ( c . j ) by A18,FUNCT_7:32;
hence thesis by A20,A22,A17,A26,A27,TARSKI:def 1;
end;
end;
A28: P[ ( 0 ) ]
proof
assume ( 0 ) <= ( len ( the_arity_of o ) );
take a9;
thus thesis by A10;
end;
A29: (for i being (Element of ( NAT )) holds P[ i ]) from NAT_1:sch 1(A28,A14);
then consider c being (Element of ( Args (o,A) )) such that A30: c = ( p . ( ( len ( the_arity_of o ) ) + 1 ) ) and (for j being (Element of ( NAT )) holds ((j in ( dom ( the_arity_of o ) ) & j > ( len ( the_arity_of o ) )) implies ( c . j ) = ( a . j ))) and A31: (for j being Nat holds (j in ( Seg ( len ( the_arity_of o ) ) ) implies ( c . j ) = ( b . j )));
defpred P[ (Element of ( NAT )) ]
 means
($1 in ( dom p ) implies [ ( ( Den (o,A) ) . a9 ),( ( Den (o,A) ) . ( p . $1 ) ) ] in ( R . ( the_result_sort_of o ) ));
A32: (for k being (Element of ( NAT )) holds (P[ k ] implies P[ ( k + 1 ) ]))
proof
A33: ( Result (o,A) ) = ( (the Sorts of A) . ( the_result_sort_of o ) ) by PRALG_2:3;
let i being (Element of ( NAT ));
assume that
A34: (i in ( dom p ) implies [ ( ( Den (o,A) ) . a9 ),( ( Den (o,A) ) . ( p . i ) ) ] in ( R . ( the_result_sort_of o ) ))
and
A35: ( i + 1 ) in ( dom p );
A36: ( i + 1 ) <= ( len p ) by A35,FINSEQ_3:25;
i <= ( i + 1 ) by NAT_1:11;
then A37: i <= ( len p ) by A36,XXREAL_0:2;
per cases ;
suppose i = ( 0 );

hence thesis by A10,A33,EQREL_1:5;
end;
suppose i > ( 0 );

then A38: i >= ( ( 0 ) + 1 ) by NAT_1:13;
then consider j being Nat such that A39: i = ( 1 + j ) by NAT_1:10;
reconsider j as (Element of ( NAT )) by ORDINAL1:def 12;
i < ( ( len ( the_arity_of o ) ) + 1 ) by A9,A36,NAT_1:13;
then consider c being (Element of ( Args (o,A) )) such that A40: c = ( p . i ) and A41: ( p . ( i + 1 ) ) = ( c +* (i,( b . i )) ) by A11,A38;
A42: i <= ( len ( the_arity_of o ) ) by A9,A36,XREAL_1:6;
then A43: i in ( dom ( the_arity_of o ) ) by A38,FINSEQ_3:25;
then reconsider bi = ( b . i ),ci = ( c . i ) as (Element of A,( ( the_arity_of o ) /. i )) by A3,CKB4:1;
j <= i by A39,NAT_1:11;
then A44: (ex c being (Element of ( Args (o,A) )) st ((c = ( p . ( j + 1 ) ) & (for k being (Element of ( NAT )) holds ((k in ( dom ( the_arity_of o ) ) & k > j) implies ( c . k ) = ( a . k )))) & (for k being Nat holds (k in ( Seg j ) implies ( c . k ) = ( b . k ))))) by A29,A42,XXREAL_0:2;
j < i by A39,NAT_1:13;
then ( c . i ) = ( a . i ) by A40,A43,A39,A44;
then A45: [ ci,bi ] in ( R . ( ( the_arity_of o ) /. i ) ) by A4,A43;
reconsider d = ( c +* (i,bi) ) as (Element of ( Args (o,A) )) by CKB15:1;
A46: ( ( Den (o,A) ) . d ) = ( ( transl (o,i,c,A) ) . bi ) by CKB18:def 1;
c = ( c +* (i,ci) ) by FUNCT_7:35;
then A47: ( ( Den (o,A) ) . c ) = ( ( transl (o,i,c,A) ) . ci ) by CKB18:def 1;
( transl (o,i,c,A) ) is_e.translation_of A,( ( the_arity_of o ) /. i ),( the_result_sort_of o ) by A43,CKB20:def 1;
then [ ( ( Den (o,A) ) . c ),( ( Den (o,A) ) . d ) ] in ( R . ( the_result_sort_of o ) ) by A1,A46,A47,A45;
hence thesis by A34,A37,A38,A40,A41,EQREL_1:7,FINSEQ_3:25;
end;
end;
A48: ( dom b ) = ( dom ( the_arity_of o ) ) by A3,MSUALG_3:6;
then A49: b is FinSequence by A5,FINSEQ_1:def 2;
A50: P[ ( 0 ) ] by FINSEQ_3:25;
A51: (for i being (Element of ( NAT )) holds P[ i ]) from NAT_1:sch 1(A50,A32);
A52: ( dom c ) = ( dom ( the_arity_of o ) ) by MSUALG_3:6;
then c is FinSequence by A5,FINSEQ_1:def 2;
then c = b by A31,A52,A48,A5,A49,FINSEQ_1:13;
hence [ ( ( Den (o,A) ) . a ),( ( Den (o,A) ) . b ) ] in ( R . ( the_result_sort_of o ) ) by A51,A30,A12;
end;
end;
