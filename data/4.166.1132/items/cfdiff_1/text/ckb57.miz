environ
vocabularies NUMBERS,SUBSET_1,REAL_1,XREAL_0,ORDINAL1,CFUNCT_1,COMSEQ_1,PARTFUN1,ORDINAL2,NAT_1,FDIFF_1,VALUED_0,SEQ_2,CARD_1,SEQ_1,FUNCT_1,COMPLEX1,RELAT_1,ARYTM_3,XXREAL_0,ARYTM_1,FUNCOP_1,VALUED_1,FUNCT_2,TARSKI,RCOMP_1,XBOOLE_0,FCONT_1,CFCONT_1,XXREAL_2,CFDIFF_1;
notations TARSKI,SUBSET_1,ORDINAL1,FUNCT_1,NUMBERS,XCMPLX_0,XREAL_0,COMPLEX1,REAL_1,NAT_1,PARTFUN1,FUNCT_2,FUNCOP_1,VALUED_0,VALUED_1,SEQ_1,RELSET_1,SEQ_2,CFUNCT_1,COMSEQ_1,COMSEQ_2,COMSEQ_3,CFCONT_1,XXREAL_0,CKB1,CKB3,CKB13,CKB15,CKB16,CKB18,CKB29,CKB33,CKB34,CKB35,CKB36,CKB38,CKB39,CKB49;
definitions XCMPLX_0,XBOOLE_0,TARSKI,RELAT_1,COMSEQ_2,SEQM_3,CFCONT_1,SUBSET_1,FINSEQ_4,VALUED_0,VALUED_1,SEQ_2,COMPLEX1,FUNCT_2,CKB1,CKB3,CKB13,CKB16,CKB29,CKB33,CKB34,CKB35,CKB36,CKB38,CKB39,CKB49;
theorems TARSKI,NAT_1,FUNCT_1,FUNCT_2,ZFMISC_1,COMPLEX1,SEQ_1,SEQ_2,SEQ_4,NUMBERS,COMSEQ_1,COMSEQ_2,COMSEQ_3,CFUNCT_1,CFCONT_1,RELAT_1,XBOOLE_0,XBOOLE_1,PARTFUN1,PARTFUN2,XCMPLX_0,XCMPLX_1,XREAL_1,XXREAL_0,ORDINAL1,ABSVALUE,XREAL_0,FUNCOP_1,SUBSET_1,VALUED_1,VALUED_0,CKB1,CKB2,CKB3,CKB4,CKB6,CKB11,CKB12,CKB13,CKB16,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB47,CKB48,CKB49,CKB50,CKB53,CKB54,CKB55,CKB56;
schemes SEQ_1,COMSEQ_1,FUNCT_2;
registrations FUNCT_1,RELSET_1,FUNCT_2,MEMBERED,NUMBERS,ORDINAL1,XREAL_0,XXREAL_0,COMSEQ_2,NAT_1,VALUED_0,SEQ_4,VALUED_1,FUNCOP_1,CKB5,CKB7,CKB8,CKB9,CKB10,CKB14,CKB17,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB46,CKB51,CKB52;
constructors PARTFUN1,REAL_1,NAT_1,VALUED_0,VALUED_1,SEQ_1,SEQ_2,FINSEQ_4,SEQM_3,PARTFUN2,SQUARE_1,COMSEQ_2,COMSEQ_3,CFCONT_1,XXREAL_0,CFUNCT_1,RELSET_1,CKB1,CKB3,CKB13,CKB16,CKB29,CKB33,CKB34,CKB35,CKB36,CKB38,CKB39,CKB49;
requirements REAL,NUMERALS,SUBSET,BOOLE,ARITHM;
begin
reserve k for (Element of ( NAT ));
reserve n for (Element of ( NAT ));
reserve n1 for (Element of ( NAT ));
reserve m for (Element of ( NAT ));
reserve y for set;
reserve r for  real number;
reserve b1 for Complex;
reserve x for Complex;
reserve x0 for Complex;
reserve s1 for Complex_Sequence;
reserve f for (PartFunc of ( COMPLEX ),( COMPLEX ));
reserve h for  convergent_to_0 Complex_Sequence;
reserve c for  constant Complex_Sequence;
reserve R for C_REST;
reserve L for C_LINEAR;
theorem
Th22: (for x0 being Complex holds (for N being (Neighbourhood of x0) holds ((f is_differentiable_in x0 & N c= ( dom f )) implies (for h holds (for c holds ((( rng c ) = { x0 } & ( rng ( h + c ) ) c= N) implies (( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent & ( diff (f,x0) ) = ( lim ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) ))))))))
proof
let x0 being Complex;
let N being (Neighbourhood of x0);
assume that
A1: f is_differentiable_in x0
and
A2: N c= ( dom f );
consider N1 being (Neighbourhood of x0) such that N1 c= ( dom f ) and A3: (ex L st (ex R st (for x holds (x in N1 implies ( ( f /. x ) - ( f /. x0 ) ) = ( ( L /. ( x - x0 ) ) + ( R /. ( x - x0 ) ) ))))) by A1,CKB33:def 1;
consider N2 being (Neighbourhood of x0) such that A4: N2 c= N and A5: N2 c= N1 by CKB32:1;
A6: N2 c= ( dom f ) by A2,A4,XBOOLE_1:1;
let h;
let c;
assume that
A7: ( rng c ) = { x0 }
and
A8: ( rng ( h + c ) ) c= N;
consider g being Real such that A9: ( 0 ) < g and A10: { y where y is Complex: |. ( y - x0 ) .| < g } c= N2 by CKB29:def 1;
|. ( x0 - x0 ) .| = ( 0 ) by COMPLEX1:44;
then x0 in { y where y is Complex: |. ( y - x0 ) .| < g } by A9;
then A11: x0 in N2 by A10;
A12: ( rng c ) c= ( dom f )
proof
let y;
assume y in ( rng c );
then y = x0 by A7,TARSKI:def 1;
then y in N by A4,A11;
hence thesis by A2;
end;
(ex n st (( rng ( c ^\ n ) ) c= N2 & ( rng ( ( h + c ) ^\ n ) ) c= N2))
proof
x0 in ( rng c ) by A7,TARSKI:def 1;
then A13: ( lim c ) = x0 by CFCONT_1:27;
A14: c is  convergent by CFCONT_1:26;
then A15: ( h + c ) is  convergent;
( lim h ) = ( 0 ) by CKB1:def 1;
then ( lim ( h + c ) ) = ( ( 0 ) + x0 ) by A14,A13,COMSEQ_2:14
.= x0;
then consider n such that A16: (for m being (Element of ( NAT )) holds (n <= m implies |. ( ( ( h + c ) . m ) - x0 ) .| < g)) by A9,A15,COMSEQ_2:def 5;
take n;
A17: ( rng ( c ^\ n ) ) = { x0 } by A7,VALUED_0:26;
thus ( rng ( c ^\ n ) ) c= N2
proof
let y;
assume y in ( rng ( c ^\ n ) );
hence thesis by A11,A17,TARSKI:def 1;
end;

let y;
assume y in ( rng ( ( h + c ) ^\ n ) );
then consider m such that A18: y = ( ( ( h + c ) ^\ n ) . m ) by FUNCT_2:113;
reconsider y1 = y as Complex by A18;
( n + ( 0 ) ) <= ( n + m ) by XREAL_1:7;
then |. ( ( ( h + c ) . ( n + m ) ) - x0 ) .| < g by A16;
then |. ( ( ( ( h + c ) ^\ n ) . m ) - x0 ) .| < g by NAT_1:def 3;
then y1 in { z where z is Complex: |. ( z - x0 ) .| < g } by A18;
hence thesis by A10;
end;
then consider n such that ( rng ( c ^\ n ) ) c= N2 and A19: ( rng ( ( h + c ) ^\ n ) ) c= N2;
consider L,R such that A20: (for x holds (x in N1 implies ( ( f /. x ) - ( f /. x0 ) ) = ( ( L /. ( x - x0 ) ) + ( R /. ( x - x0 ) ) ))) by A3;
A21: ( rng ( c ^\ n ) ) c= ( dom f )
proof
let y;
assume A22: y in ( rng ( c ^\ n ) );
( rng ( c ^\ n ) ) = ( rng c ) by VALUED_0:26;
then y = x0 by A7,A22,TARSKI:def 1;
then y in N by A4,A11;
hence thesis by A2;
end;
A23: (( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) is  convergent & ( lim ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) ) = ( L /. ( 1r ) ))
proof
deffunc F((Element of ( NAT ))) = ( ( L /. ( 1r ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . $1 ) );
consider s1 such that A24: (for k holds ( s1 . k ) = F(k)) from COMSEQ_1:sch 1;
A25:now
A26: (( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) is  convergent & ( lim ( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) ) = ( 0 )) by CKB13:def 1;
let r being Real;
assume ( 0 ) < r;
then consider m being (Element of ( NAT )) such that A27: (for k holds (m <= k implies ( abs ( ( ( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) . k ) - ( 0c ) ) ) < r)) by A26,COMSEQ_2:def 5;
take n1 = m;
let k;
assume that
A28: n1 <= k;
( abs ( ( s1 . k ) - ( L /. ( 1r ) ) ) ) = ( abs ( ( ( L /. ( 1r ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . k ) ) - ( L /. ( 1r ) ) ) ) by A24
.= ( abs ( ( ( ( ( h ^\ n ) " ) (#) ( R /* ( h ^\ n ) ) ) . k ) - ( 0c ) ) );
hence ( abs ( ( s1 . k ) - ( L /. ( 1r ) ) ) ) < r by A27,A28;
end;
consider x such that A29: (for b1 holds ( L /. b1 ) = ( x * b1 )) by CKB16:def 1;
A30: ( L /. ( 1r ) ) = ( x * ( 1r ) ) by A29
.= x;
now
let m;
A31: ( ( h ^\ n ) . m ) <> ( 0c ) by COMSEQ_1:4;
thus ( ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) . m ) = ( ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) by VALUED_1:5
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) + ( ( R /* ( h ^\ n ) ) . m ) ) * ( ( ( h ^\ n ) " ) . m ) ) by VALUED_1:1
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) + ( ( ( R /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) )
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) " ) . m ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by VALUED_1:5
.= ( ( ( ( L /* ( h ^\ n ) ) . m ) * ( ( ( h ^\ n ) . m ) " ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by VALUED_1:10
.= ( ( ( L /. ( ( h ^\ n ) . m ) ) * ( ( ( h ^\ n ) . m ) " ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by FUNCT_2:115
.= ( ( ( x * ( ( h ^\ n ) . m ) ) * ( ( ( h ^\ n ) . m ) " ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by A29
.= ( ( x * ( ( ( h ^\ n ) . m ) * ( ( ( h ^\ n ) . m ) " ) ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) )
.= ( ( x * ( 1r ) ) + ( ( ( R /* ( h ^\ n ) ) (#) ( ( h ^\ n ) " ) ) . m ) ) by A31,XCMPLX_0:def 7
.= ( s1 . m ) by A24,A30;
end;
then A32: ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) = s1 by FUNCT_2:63;
hence ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) is  convergent by A25,COMSEQ_2:def 4;
hence thesis by A32,A25,COMSEQ_2:def 5;
end;
A33: (for k holds ( ( f /. ( ( ( h + c ) ^\ n ) . k ) ) - ( f /. ( ( c ^\ n ) . k ) ) ) = ( ( L /. ( ( h ^\ n ) . k ) ) + ( R /. ( ( h ^\ n ) . k ) ) ))
proof
let k;
( ( ( h + c ) ^\ n ) . k ) in ( rng ( ( h + c ) ^\ n ) ) by FUNCT_2:112;
then A34: ( ( ( h + c ) ^\ n ) . k ) in N2 by A19;
(( ( c ^\ n ) . k ) in ( rng ( c ^\ n ) ) & ( rng ( c ^\ n ) ) = ( rng c )) by FUNCT_2:112,VALUED_0:26;
then A35: ( ( c ^\ n ) . k ) = x0 by A7,TARSKI:def 1;
( ( ( ( h + c ) ^\ n ) . k ) - ( ( c ^\ n ) . k ) ) = ( ( ( h + c ) . ( k + n ) ) - ( ( c ^\ n ) . k ) ) by NAT_1:def 3
.= ( ( ( h . ( k + n ) ) + ( c . ( k + n ) ) ) - ( ( c ^\ n ) . k ) ) by VALUED_1:1
.= ( ( ( ( h ^\ n ) . k ) + ( c . ( k + n ) ) ) - ( ( c ^\ n ) . k ) ) by NAT_1:def 3
.= ( ( ( ( h ^\ n ) . k ) + ( ( c ^\ n ) . k ) ) - ( ( c ^\ n ) . k ) ) by NAT_1:def 3
.= ( ( h ^\ n ) . k );
hence thesis by A20,A5,A34,A35;
end;
A36: ( rng ( h + c ) ) c= ( dom f )
proof
let y;
assume y in ( rng ( h + c ) );
then y in N by A8;
hence thesis by A2;
end;
A37: ( rng ( ( h + c ) ^\ n ) ) c= ( dom f )
proof
let y;
assume y in ( rng ( ( h + c ) ^\ n ) );
then y in N2 by A19;
then y in N by A4;
hence thesis by A2;
end;
now
let k;
thus ( ( ( f /* ( ( h + c ) ^\ n ) ) - ( f /* ( c ^\ n ) ) ) . k ) = ( ( ( f /* ( ( h + c ) ^\ n ) ) . k ) - ( ( f /* ( c ^\ n ) ) . k ) ) by CFCONT_1:1
.= ( ( f /. ( ( ( h + c ) ^\ n ) . k ) ) - ( ( f /* ( c ^\ n ) ) . k ) ) by A37,FUNCT_2:109
.= ( ( f /. ( ( ( h + c ) ^\ n ) . k ) ) - ( f /. ( ( c ^\ n ) . k ) ) ) by A21,FUNCT_2:109
.= ( ( L /. ( ( h ^\ n ) . k ) ) + ( R /. ( ( h ^\ n ) . k ) ) ) by A33
.= ( ( ( L /* ( h ^\ n ) ) . k ) + ( R /. ( ( h ^\ n ) . k ) ) ) by FUNCT_2:115
.= ( ( ( L /* ( h ^\ n ) ) . k ) + ( ( R /* ( h ^\ n ) ) . k ) ) by FUNCT_2:115
.= ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) . k ) by VALUED_1:1;
end;
then A38: ( ( ( L /* ( h ^\ n ) ) + ( R /* ( h ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) = ( ( ( f /* ( ( h + c ) ^\ n ) ) - ( f /* ( c ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) by FUNCT_2:def 7
.= ( ( ( ( f /* ( h + c ) ) ^\ n ) - ( f /* ( c ^\ n ) ) ) (#) ( ( h ^\ n ) " ) ) by A36,VALUED_0:27
.= ( ( ( ( f /* ( h + c ) ) ^\ n ) - ( ( f /* c ) ^\ n ) ) (#) ( ( h ^\ n ) " ) ) by A12,VALUED_0:27
.= ( ( ( ( f /* ( h + c ) ) - ( f /* c ) ) ^\ n ) (#) ( ( h ^\ n ) " ) ) by CKB54:1
.= ( ( ( ( f /* ( h + c ) ) - ( f /* c ) ) ^\ n ) (#) ( ( h " ) ^\ n ) ) by CKB55:1
.= ( ( ( ( f /* ( h + c ) ) - ( f /* c ) ) (#) ( h " ) ) ^\ n ) by CKB56:1;
then A39: ( L /. ( 1r ) ) = ( lim ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) ) by A23,CFCONT_1:23;
thus ( ( h " ) (#) ( ( f /* ( h + c ) ) - ( f /* c ) ) ) is  convergent by A23,A38,CFCONT_1:22;
(for x holds (x in N2 implies ( ( f /. x ) - ( f /. x0 ) ) = ( ( L /. ( x - x0 ) ) + ( R /. ( x - x0 ) ) ))) by A20,A5;
hence thesis by A1,A6,A39,CKB34:def 1;
end;
