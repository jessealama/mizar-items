environ
vocabularies XBOOLE_0,FUNCT_1,RELAT_1,PBOOLE,SUBSET_1,CARD_3,REALSET1,TARSKI,ZFMISC_1,PARTFUN1,STRUCT_0,MSUALG_1,MSUALG_2,PRELAMB,MSUALG_3,FINSEQ_1,MARGREL1,LANG1,TDGROUP,DTCONSTR,TREES_3,TREES_4,NAT_1,TREES_2,MCART_1,UNIALG_2,QC_LANG1,GROUP_6,MSAFREE;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NAT_1,RELAT_1,RELSET_1,STRUCT_0,FUNCT_1,PARTFUN1,MCART_1,FUNCT_2,FINSEQ_1,PBOOLE,TREES_2,FINSEQ_2,CARD_3,LANG1,TREES_4,DTCONSTR,MSUALG_1,MSUALG_2,MSUALG_3,CKB2,CKB3,CKB4,CKB7,CKB11,CKB13,CKB14,CKB16,CKB18;
definitions TARSKI,XBOOLE_0,PBOOLE,MSUALG_3,CKB2,CKB3,CKB7,CKB11,CKB13,CKB14,CKB16,CKB18;
theorems TARSKI,FUNCT_1,FUNCT_2,MCART_1,ZFMISC_1,PBOOLE,CARD_3,MSUALG_1,MSUALG_2,MSUALG_3,RELAT_1,LANG1,DTCONSTR,FINSEQ_1,TREES_4,TREES_1,DOMAIN_1,RELSET_1,XBOOLE_0,XBOOLE_1,FUNCOP_1,TREES_3,PARTFUN1,FINSEQ_3,FINSEQ_2,CKB1,CKB2,CKB3,CKB7,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB20;
schemes CLASSES1,FUNCT_1,RELSET_1,DTCONSTR,XBOOLE_0;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,ORDINAL1,FUNCOP_1,FINSEQ_1,PBOOLE,TREES_2,TREES_3,STRUCT_0,DTCONSTR,MSUALG_1,MSUALG_3,FUNCT_2,PARTFUN1,RELSET_1,PRE_POLY,CKB5,CKB6,CKB8,CKB9,CKB19;
constructors XXREAL_0,NAT_1,NAT_D,CARD_3,FINSEQOP,DTCONSTR,MSUALG_3,RELSET_1,PBOOLE,CKB2,CKB3,CKB7,CKB11,CKB13,CKB14,CKB16,CKB18;
requirements NUMERALS,BOOLE,SUBSET;
begin
reserve x for set;
registration
let S being non void non empty ManySortedSign;
let X being  non-empty (ManySortedSet of (the carrier of S));
cluster ( DTConMSA X ) ->  with_terminals  with_nonterminals  with_useful_nonterminals;
coherence
proof
set D = ( DTConMSA X );
set A = ( [: (the carrier' of S),{ (the carrier of S) } :] \/ ( Union ( coprod (X qua (ManySortedSet of (the carrier of S))) ) ) );
A1: ( Terminals D ) = ( Union ( coprod X ) ) by CKB20:1;
A2: ( NonTerminals D ) = [: (the carrier' of S),{ (the carrier of S) } :] by CKB20:1;
A3: ( Union ( coprod X ) ) misses [: (the carrier' of S),{ (the carrier of S) } :] by CKB15:1;
(for nt being (Symbol of D) holds (nt in ( NonTerminals D ) implies (ex p being (FinSequence of ( TS D )) st nt ==> ( roots p ))))
proof
let nt being (Symbol of D);
assume nt in ( NonTerminals D );
then consider o being (OperSymbol of S),x2 being (Element of { (the carrier of S) }) such that A4: nt = [ o,x2 ] by A2,DOMAIN_1:1;
set O = ( the_arity_of o );
defpred P[ set,set ]
 means
$2 in ( coprod (( O . $1 ),X) );
A5: (for a being set holds (a in ( Seg ( len O ) ) implies (ex b being set st P[ a,b ])))
proof
let a being set;
assume a in ( Seg ( len O ) );
then a in ( dom O ) by FINSEQ_1:def 3;
then A6: ( O . a ) in ( rng O ) by FUNCT_1:def 3;
A7: ( rng O ) c= (the carrier of S) by FINSEQ_1:def 4;
then consider x being set such that A8: x in ( X . ( O . a ) ) by A6,XBOOLE_0:def 1;
take [ x,( O . a ) ];
thus thesis by A6,A7,A8,CKB3:def 1;
end;
consider b being Function such that A9: (( dom b ) = ( Seg ( len O ) ) & (for a being set holds (a in ( Seg ( len O ) ) implies P[ a,( b . a ) ]))) from CLASSES1:sch 1(A5);
reconsider b as FinSequence by A9,FINSEQ_1:def 2;
A10: ( rng b ) c= A
proof
let a being set;
A11: ( rng O ) c= (the carrier of S) by FINSEQ_1:def 4;
assume a in ( rng b );
then consider c being set such that A12: c in ( dom b ) and A13: ( b . c ) = a by FUNCT_1:def 3;
( dom O ) = ( Seg ( len O ) ) by FINSEQ_1:def 3;
then A14: ( O . c ) in ( rng O ) by A9,A12,FUNCT_1:def 3;
( dom ( coprod X ) ) = (the carrier of S) by PARTFUN1:def 2;
then ( ( coprod X ) . ( O . c ) ) in ( rng ( coprod X ) ) by A14,A11,FUNCT_1:def 3;
then A15: ( coprod (( O . c ),X) ) in ( rng ( coprod X ) ) by A14,A11,CKB7:def 1;
a in ( coprod (( O . c ),X) ) by A9,A12,A13;
then a in ( union ( rng ( coprod X ) ) ) by A15,TARSKI:def 4;
then a in ( Union ( coprod X ) ) by CARD_3:def 4;
hence thesis by XBOOLE_0:def 3;
end;
then reconsider b as (FinSequence of A) by FINSEQ_1:def 4;
reconsider b as (Element of ( A * )) by FINSEQ_1:def 11;
deffunc F(set) = ( root-tree ( b . $1 ) );
consider f being Function such that A16: (( dom f ) = ( dom b ) & (for x holds (x in ( dom b ) implies ( f . x ) = F(x)))) from FUNCT_1:sch 3;
reconsider f as FinSequence by A9,A16,FINSEQ_1:def 2;
( rng f ) c= ( TS D )
proof
let x;
A17: ( rng O ) c= (the carrier of S) by FINSEQ_1:def 4;
assume x in ( rng f );
then consider y being set such that A18: y in ( dom f ) and A19: ( f . y ) = x by FUNCT_1:def 3;
( dom O ) = ( Seg ( len O ) ) by FINSEQ_1:def 3;
then A20: ( O . y ) in ( rng O ) by A9,A16,A18,FUNCT_1:def 3;
( dom ( coprod X ) ) = (the carrier of S) by PARTFUN1:def 2;
then ( ( coprod X ) . ( O . y ) ) in ( rng ( coprod X ) ) by A20,A17,FUNCT_1:def 3;
then A21: ( coprod (( O . y ),X) ) in ( rng ( coprod X ) ) by A20,A17,CKB7:def 1;
( b . y ) in ( rng b ) by A16,A18,FUNCT_1:def 3;
then reconsider a = ( b . y ) as (Symbol of D) by A10;
P[ y,( b . y ) ] by A9,A16,A18;
then ( b . y ) in ( union ( rng ( coprod X ) ) ) by A21,TARSKI:def 4;
then A22: a in ( Terminals D ) by A1,CARD_3:def 4;
x = ( root-tree ( b . y ) ) by A16,A18,A19;
hence thesis by A22,DTCONSTR:def 1;
end;
then reconsider f as (FinSequence of ( TS D )) by FINSEQ_1:def 4;
A23: (for x holds (x in ( dom b ) implies ( ( roots f ) . x ) = ( b . x )))
proof
let x;
assume A24: x in ( dom b );
then reconsider i = x as Nat;
(( f . x ) = ( root-tree ( b . x ) ) & (ex T being DecoratedTree st (T = ( f . i ) & ( ( roots f ) . i ) = ( T . ( {} ) )))) by A16,A24,TREES_3:def 18;
hence thesis by TREES_4:3;
end;
A25:now
let c being set;
assume A26: c in ( dom b );
( dom O ) = ( Seg ( len O ) ) by FINSEQ_1:def 3;
then A27: ( O . c ) in ( rng O ) by A9,A26,FUNCT_1:def 3;
A28: ( rng O ) c= (the carrier of S) by FINSEQ_1:def 4;
( dom ( coprod X ) ) = (the carrier of S) by PARTFUN1:def 2;
then ( ( coprod X ) . ( O . c ) ) in ( rng ( coprod X ) ) by A27,A28,FUNCT_1:def 3;
then A29: ( coprod (( O . c ),X) ) in ( rng ( coprod X ) ) by A27,A28,CKB7:def 1;
P[ c,( b . c ) ] by A9,A26;
then ( b . c ) in ( union ( rng ( coprod X ) ) ) by A29,TARSKI:def 4;
then ( b . c ) in ( Union ( coprod X ) ) by CARD_3:def 4;
hence (( b . c ) in [: (the carrier' of S),{ (the carrier of S) } :] implies (for o1 being (OperSymbol of S) holds ([ o1,(the carrier of S) ] = ( b . c ) implies ( the_result_sort_of o1 ) = ( O . c )))) by A3,XBOOLE_0:3;
assume ( b . c ) in ( Union ( coprod X ) );
thus ( b . c ) in ( coprod (( O . c ),X) ) by A9,A26;
end;
((the carrier of S) = x2 & ( len b ) = ( len O )) by A9,FINSEQ_1:def 3,TARSKI:def 1;
then [ nt,b ] in ( REL X ) by A4,A25,CKB17:1;
then A30: nt ==> b by LANG1:def 1;
take f;
( dom ( roots f ) ) = ( dom f ) by TREES_3:def 18;
hence thesis by A30,A16,A23,FUNCT_1:2;
end;
hence thesis by A1,A2,DTCONSTR:def 3,DTCONSTR:def 4,DTCONSTR:def 5;
end;
end;
