environ
vocabularies NUMBERS,ORDINAL1,XBOOLE_0,PROB_1,MEASURE1,FUNCT_1,SUBSET_1,XXREAL_0,ARYTM_3,RELAT_1,SETFAM_1,TARSKI,MEASURE2,ARYTM_1,SETLIM_1,NAT_1,ORDINAL2,CARD_3,CARD_1,SEQ_2,SEQFUNC,PARTFUN1,PBOOLE,RINFSUP1,XREAL_0,MESFUNC1,MEASURE6,XXREAL_2,ZFMISC_1,MESFUNC5,VALUED_0,COMPLEX1,REAL_1,SUPINF_2,SEQ_1,FUNCOP_1,VALUED_1,PREPOWER,NEWTON,SERIES_1,MESFUNC8,SEQ_4;
notations TARSKI,XBOOLE_0,SUBSET_1,ZFMISC_1,ORDINAL1,NUMBERS,XCMPLX_0,XREAL_0,COMPLEX1,XXREAL_0,XXREAL_2,VALUED_0,PROB_1,REAL_1,SETFAM_1,MEASURE1,KURATO_0,SETLIM_1,MEASURE2,RELAT_1,FUNCT_1,RELSET_1,PARTFUN1,RFUNCT_3,FUNCT_2,SUPINF_2,RINFSUP1,SEQFUNC,MEASURE6,VALUED_1,NAT_1,SEQ_1,SEQ_2,SEQ_4,NEWTON,PREPOWER,SERIES_1,EXTREAL1,MESFUNC1,MESFUNC5,RINFSUP2,CARD_3,FUNCOP_1,CKB7,CKB8,CKB10,CKB11,CKB12,CKB13,CKB19,CKB20,CKB24;
definitions TARSKI,CARD_3,FUNCT_6,MEASURE6,RINFSUP1,SETLIM_1,XCMPLX_0,RINFSUP2,VALUED_1,XXREAL_3,XXREAL_2,CKB7,CKB8,CKB10,CKB11,CKB12,CKB13,CKB19,CKB20,CKB24;
theorems ABSVALUE,MEASURE1,MEASURE2,MEASURE3,NAT_1,TARSKI,PARTFUN1,FUNCT_1,FUNCT_2,KURATO_0,SUPINF_2,EXTREAL2,SETFAM_1,SEQ_1,SEQ_2,SEQM_3,SEQ_4,SERIES_1,RINFSUP1,MESFUNC1,XREAL_0,PROB_1,XBOOLE_0,XBOOLE_1,MESFUNC2,XREAL_1,PREPOWER,XXREAL_0,ZFMISC_1,SETLIM_1,PROB_4,PARTFUN2,ORDINAL1,MESFUNC5,RINFSUP2,CARD_3,XXREAL_2,VALUED_0,FUNCOP_1,XXREAL_3,RELAT_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB10,CKB11,CKB12,CKB13,CKB14,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38;
schemes FUNCT_2,SEQFUNC,PARTFUN2;
registrations SUBSET_1,XREAL_0,MEMBERED,ORDINAL1,PARTFUN1,FUNCT_2,RELAT_1,XXREAL_0,XBOOLE_0,FUNCT_1,NUMBERS,VALUED_0,VALUED_1,SETLIM_1,SEQ_4,NAT_1,XXREAL_3,RELSET_1,MEASURE6,CKB9,CKB15;
constructors REAL_1,NAT_1,EXTREAL1,NEWTON,PREPOWER,SERIES_1,MESFUNC1,PROB_2,MEASURE6,MEASURE3,PARTFUN3,KURATO_0,RINFSUP1,SETLIM_1,MESFUNC5,RINFSUP2,SEQ_1,SUPINF_1,SEQFUNC,SEQ_4,RELSET_1,BINOP_2,RVSUM_1,CKB7,CKB10,CKB11,CKB12,CKB13,CKB19,CKB20,CKB24;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve k for  natural number;
reserve X for non empty set;
reserve S for (SigmaField of X);
theorem
Th28: (for M being (sigma_Measure of S) holds (for f being  with_the_same_dom (Functional_Sequence of X,( ExtREAL )) holds (for g being (PartFunc of X,( ExtREAL )) holds (for E being (Element of S) holds (((((( M . E ) < ( +infty ) & ( dom ( f . ( 0 ) ) ) = E) & (for n being  natural number holds (( f . n ) is_measurable_on E & ( f . n ) is  real-valued))) & ( dom g ) = E) & (for x being (Element of X) holds (x in E implies (( f # x ) is  convergent_to_finite_number & ( g . x ) = ( lim ( f # x ) ))))) implies (for r,e being  real number holds ((( 0 ) < r & ( 0 ) < e) implies (ex H being (Element of S) st (ex N being  natural number st ((H c= E & ( M . H ) < r) & (for k being  natural number holds (N < k implies (for x being (Element of X) holds (x in ( E \ H ) implies |. ( ( ( f . k ) . x ) - ( g . x ) ) .| < e))))))))))))))
proof
let M being (sigma_Measure of S);
let f being  with_the_same_dom (Functional_Sequence of X,( ExtREAL ));
let g being (PartFunc of X,( ExtREAL ));
let E being (Element of S);
assume that
A1: ( M . E ) < ( +infty )
and
A2: ( dom ( f . ( 0 ) ) ) = E
and
A3: (for n being  natural number holds (( f . n ) is_measurable_on E & ( f . n ) is  real-valued))
and
A4: ( dom g ) = E
and
A5: (for x being (Element of X) holds (x in E implies (( f # x ) is  convergent_to_finite_number & ( g . x ) = ( lim ( f # x ) ))));
let r being  real number,e being  real number;
defpred P[ (Element of ( NAT )),set ]
 means
$2 = ( E /\ ( less_dom (|. ( ( f . $1 ) - g ) .|,( R_EAL e )) ) );
A6: g is  real-valued by A4,A5,CKB38:1;
(for x being (Element of X) holds (x in E implies (( f # x ) is  convergent & ( g . x ) = ( lim ( f # x ) ))))
proof
let x being (Element of X);
assume A7: x in E;
then ( f # x ) is  convergent_to_finite_number by A5;
hence ( f # x ) is  convergent by MESFUNC5:def 11;
thus thesis by A5,A7;
end;
then A8: g is_measurable_on E by A2,A3,A4,CKB37:1;
A9: (for n being (Element of ( NAT )) holds ((|. ( ( f . n ) - g ) .| is_measurable_on E & ( dom ( ( f . n ) - g ) ) = E) & ( dom |. ( ( f . n ) - g ) .| ) = E))
proof
let n being (Element of ( NAT ));
A10: ( f . n ) is  real-valued by A3;
( dom ( ( f . n ) - g ) ) = ( ( dom ( f . n ) ) /\ ( dom g ) ) by A6,MESFUNC2:2;
then A11: ( dom ( ( f . n ) - g ) ) = ( E /\ E ) by A2,A4,CKB8:def 1;
( f . n ) is_measurable_on E by A3;
then ( ( f . n ) - g ) is_measurable_on E by A4,A8,A6,A10,MESFUNC2:11;
hence thesis by A11,MESFUNC1:def 10,MESFUNC2:27;
end;
A12: (for n being (Element of ( NAT )) holds (ex Z being (Element of S) st P[ n,Z ]))
proof
let n being (Element of ( NAT ));
|. ( ( f . n ) - g ) .| is_measurable_on E by A9;
then ( E /\ ( less_dom (|. ( ( f . n ) - g ) .|,( R_EAL e )) ) ) in S by MESFUNC1:def 16;
hence thesis;
end;
consider K being (Function of ( NAT ),S) such that A13: (for n being (Element of ( NAT )) holds P[ n,( K . n ) ]) from FUNCT_2:sch 10(A12);
defpred Q[ (Element of ( NAT )),set ]
 means
$2 = { x where x is (Element of X): (for k holds ($1 <= k implies x in ( K . k ))) };
A14: (for n being (Element of ( NAT )) holds (ex Z being (Element of S) st Q[ n,Z ]))
proof
let n being (Element of ( NAT ));
take { x where x is (Element of X): (for k holds (n <= k implies x in ( K . k ))) };
thus thesis by CKB1:1;
end;
consider EN being (Function of ( NAT ),S) such that A15: (for n being (Element of ( NAT )) holds Q[ n,( EN . n ) ]) from FUNCT_2:sch 10(A14);
A16: ( 0. ) <= ( M . E ) by MEASURE1:def 2;
then reconsider ME = ( M . E ) as Real by A1,XXREAL_0:14;
defpred R[ (Element of ( NAT )),set ]
 means
$2 = ( M . ( EN . $1 ) );
A17: (for n being  natural number holds ((((( EN . n ) c= E & ( M . ( EN . n ) ) <= ( M . E )) & ( M . ( EN . n ) ) is (Element of ( REAL ))) & ( M . ( E \ ( EN . n ) ) ) = ( ( M . E ) - ( M . ( EN . n ) ) )) & ( M . ( E \ ( EN . n ) ) ) is (Element of ( REAL ))))
proof
reconsider r1 = ( M . E ) as Real by A1,A16,XXREAL_0:14;
let n being  natural number;
reconsider n9 = n as (Element of ( NAT )) by ORDINAL1:def 12;
thus A18: ( EN . n ) c= E
proof
let z being set;
assume z in ( EN . n );
then z in { x where x is (Element of X): (for k holds (n9 <= k implies x in ( K . k ))) } by A15;
then (ex x being (Element of X) st (z = x & (for k holds (n <= k implies x in ( K . k )))));
then z in ( K . n );
then z in ( E /\ ( less_dom (|. ( ( f . n9 ) - g ) .|,( R_EAL e )) ) ) by A13;
hence thesis by XBOOLE_0:def 4;
end;

hence A19: ( M . ( EN . n ) ) <= ( M . E ) by MEASURE1:31;
A20: ( -infty ) < ( M . ( EN . n ) ) by MEASURE1:def 2;
then reconsider r2 = ( M . ( EN . n ) ) as Real by A1,A19,XXREAL_0:14;
thus ( M . ( EN . n ) ) is (Element of ( REAL )) by A1,A19,A20,XXREAL_0:14;
thus ( M . ( E \ ( EN . n ) ) ) = ( ( M . E ) - ( M . ( EN . n ) ) ) by A1,A18,A19,MEASURE1:32,XXREAL_0:4;
( ( M . E ) - ( M . ( EN . n ) ) ) = ( r1 - r2 ) by SUPINF_2:3;
hence thesis by A18,MEASURE1:32,XXREAL_0:4;
end;
A21:now
let n being (Element of ( NAT ));
( M . ( EN . n ) ) is (Element of ( REAL )) by A17;
hence (ex y being (Element of ( REAL )) st R[ n,y ]);
end;
consider seq1 being Real_Sequence such that A22: (for n being (Element of ( NAT )) holds R[ n,( seq1 . n ) ]) from FUNCT_2:sch 10(A21);
assume A23: ( 0 ) < r;
assume A24: ( 0 ) < e;
A25: E c= ( union ( rng EN ) )
proof
let z being set;
assume A26: z in E;
then reconsider x = z as (Element of X);
A27: (not (( lim ( f # x ) ) = ( +infty ) & ( f # x ) is  convergent_to_+infty)) by A5,A26,MESFUNC5:50;
( f # x ) is  convergent_to_finite_number by A5,A26;
then A28: ( f # x ) is  convergent by MESFUNC5:def 11;
(not (( lim ( f # x ) ) = ( -infty ) & ( f # x ) is  convergent_to_-infty)) by A5,A26,MESFUNC5:51;
then (ex g being  real number st ((( lim ( f # x ) ) = g & (for p being  real number holds (( 0 ) < p implies (ex n being Nat st (for m being Nat holds (n <= m implies |. ( ( ( f # x ) . m ) - ( lim ( f # x ) ) ) .| < p)))))) & ( f # x ) is  convergent_to_finite_number)) by A28,A27,MESFUNC5:def 12;
then consider n being Nat such that A29: (for m being Nat holds (n <= m implies |. ( ( ( f # x ) . m ) - ( lim ( f # x ) ) ) .| < e)) by A24;
reconsider n0 = n as (Element of ( NAT )) by ORDINAL1:def 12;
A30: ( g . x ) = ( lim ( f # x ) ) by A5,A26;
now
let k;
reconsider k9 = k as (Element of ( NAT )) by ORDINAL1:def 12;
A31: ( dom |. ( ( f . k9 ) - g ) .| ) = E by A9;
assume n0 <= k;
then |. ( ( ( f # x ) . k ) - ( lim ( f # x ) ) ) .| < e by A29;
then A32: |. ( ( ( f . k ) . x ) - ( g . x ) ) .| < e by A30,MESFUNC5:def 13;
( dom ( ( f . k9 ) - g ) ) = E by A9;
then |. ( ( ( f . k ) - g ) . x ) .| < e by A26,A32,MESFUNC1:def 4;
then ( |. ( ( f . k ) - g ) .| . x ) < e by A26,A31,MESFUNC1:def 10;
then x in ( less_dom (|. ( ( f . k ) - g ) .|,( R_EAL e )) ) by A26,A31,MESFUNC1:def 11;
then x in ( E /\ ( less_dom (|. ( ( f . k ) - g ) .|,( R_EAL e )) ) ) by A26,XBOOLE_0:def 4;
then x in ( K . k9 ) by A13;
hence x in ( K . k );
end;
then x in { y where y is (Element of X): (for k holds (n0 <= k implies y in ( K . k ))) };
then A33: x in ( EN . n0 ) by A15;
( EN . n0 ) in ( rng EN ) by FUNCT_2:4;
hence thesis by A33,TARSKI:def 4;
end;
defpred U[ (Element of ( NAT )),set ]
 means
$2 = ( M . ( E \ ( EN . $1 ) ) );
A34: ( dom ( M * EN ) ) = ( NAT ) by FUNCT_2:def 1;
A35: (for n,m being (Element of ( NAT )) holds (n <= m implies (( EN . n ) c= ( EN . m ) & ( M . ( EN . n ) ) <= ( M . ( EN . m ) ))))
proof
let n being (Element of ( NAT )),m being (Element of ( NAT ));
assume A36: n <= m;
thus ( EN . n ) c= ( EN . m )
proof
let z being set;
assume z in ( EN . n );
then z in { x where x is (Element of X): (for k holds (n <= k implies x in ( K . k ))) } by A15;
then A37: (ex x being (Element of X) st (z = x & (for k holds (n <= k implies x in ( K . k )))));
then (for k holds (m <= k implies z in ( K . k ))) by A36,XXREAL_0:2;
then z in { y where y is (Element of X): (for k holds (m <= k implies y in ( K . k ))) } by A37;
hence thesis by A15;
end;

hence thesis by MEASURE1:31;
end;
set seq3 = ( ( NAT ) --> ME );
A38: (for n being Nat holds ( seq3 . n ) = ME)
proof
let n being Nat;
n in ( NAT ) by ORDINAL1:def 12;
hence thesis by FUNCOP_1:7;
end;
then A39: seq3 is  constant by VALUED_0:def 18;
A40:now
let x being set;
assume A41: x in ( dom ( M * EN ) );
then reconsider n = x as (Element of ( NAT ));
( ( M * EN ) . x ) = ( M . ( EN . n ) ) by A41,FUNCT_1:12;
hence ( ( M * EN ) . x ) = ( seq1 . x ) by A22;
end;
( dom seq1 ) = ( NAT ) by FUNCT_2:def 1;
then A42: ( M * EN ) = seq1 by A34,A40,FUNCT_1:2;
now
let y being set;
assume y in ( rng EN );
then consider x being set such that A43: x in ( NAT ) and A44: y = ( EN . x ) by FUNCT_2:11;
reconsider x9 = x as  natural number by A43;
y = ( EN . x9 ) by A44;
hence y c= E by A17;
end;
then ( union ( rng EN ) ) c= E by ZFMISC_1:76;
then A45: ( union ( rng EN ) ) = E by A25,XBOOLE_0:def 10;
A46: (seq1 is  convergent & ( lim seq1 ) = ( M . E ))
proof
reconsider r1 = ( M . E ) as Real by A1,A16,XXREAL_0:14;
A47: (for n being (Element of ( NAT )) holds ( EN . n ) c= ( EN . ( n + 1 ) ))
proof
let n being (Element of ( NAT ));
n <= ( n + 1 ) by NAT_1:12;
hence thesis by A35;
end;
A48:now
let n being (Element of ( NAT ));
( M . ( EN . n ) ) <= ( M . E ) by A17;
then A49: ( seq1 . n ) <= r1 by A22;
( r1 + (( 0 ) qua Nat) ) < ( r1 + 1 ) by XREAL_1:8;
hence ( seq1 . n ) < ( r1 + 1 ) by A49,XXREAL_0:2;
end;
then A50: seq1 is  bounded_above by SEQ_2:def 3;
consider r being  real number such that A51: (for n being (Element of ( NAT )) holds ( seq1 . n ) < r) by A48;
r is (UpperBound of ( rng seq1 ))
proof
let d being  ext-real number;
assume d in ( rng seq1 );
then (ex x being set st (x in ( NAT ) & d = ( seq1 . x ))) by FUNCT_2:11;
hence d <= r by A51;
end;
then ( rng seq1 ) is  bounded_above by XXREAL_2:def 10;
then A52: ( sup ( rng ( M * EN ) ) ) = ( upper_bound ( rng seq1 ) ) by A42,RINFSUP2:1;
now
let n being (Element of ( NAT )),m being (Element of ( NAT ));
assume A53: n <= m;
A54: ( seq1 . m ) = ( M . ( EN . m ) ) by A22;
( seq1 . n ) = ( M . ( EN . n ) ) by A22;
hence ( seq1 . n ) <= ( seq1 . m ) by A35,A53,A54;
end;
then A55: seq1 is  non-decreasing by SEQM_3:6;
hence seq1 is  convergent by A50;
( lim seq1 ) = ( upper_bound seq1 ) by A55,A50,RINFSUP1:24;
hence thesis by A45,A52,A47,MEASURE2:23;
end;
A56:now
let n being (Element of ( NAT ));
( M . ( E \ ( EN . n ) ) ) is (Element of ( REAL )) by A17;
hence (ex y being (Element of ( REAL )) st U[ n,y ]);
end;
consider seq2 being Real_Sequence such that A57: (for n being (Element of ( NAT )) holds U[ n,( seq2 . n ) ]) from FUNCT_2:sch 10(A56);
now
let n being (Element of ( NAT ));
( seq2 . n ) = ( M . ( E \ ( EN . n ) ) ) by A57;
then A58: ( seq2 . n ) = ( ( M . E ) - ( M . ( EN . n ) ) ) by A17;
( M . ( EN . n ) ) = ( seq1 . n ) by A22;
then ( seq2 . n ) = ( ME - ( seq1 . n ) ) by A58,SUPINF_2:3;
then ( seq2 . n ) = ( ( seq3 . n ) - ( seq1 . n ) ) by A38;
hence ( seq2 . n ) = ( ( seq3 . n ) + ( ( - seq1 ) . n ) ) by SEQ_1:10;
end;
then A59: seq2 = ( seq3 - seq1 ) by SEQ_1:7;
then A60: seq2 is  convergent by A46,A39,SEQ_2:11;
A61: ( seq3 . ( 0 ) ) = ME by A38;
( lim seq2 ) = ( ( lim seq3 ) - ( lim seq1 ) ) by A46,A59,A39,SEQ_2:12;
then ( lim seq2 ) = ( ME - ME ) by A46,A39,A61,SEQ_4:25;
then consider N being (Element of ( NAT )) such that A62: (for m being (Element of ( NAT )) holds (N <= m implies ( abs ( ( seq2 . m ) - ( 0 ) ) ) < r)) by A23,A60,SEQ_2:def 7;
reconsider H = ( E \ ( EN . N ) ) as (Element of S);
A63: ( E \ H ) = ( E /\ ( EN . N ) ) by XBOOLE_1:48;
( EN . N ) c= E by A17;
then A64: ( E \ H ) = ( EN . N ) by A63,XBOOLE_1:28;
A65: (for k being  natural number holds (N < k implies (for x being (Element of X) holds (x in ( E \ H ) implies |. ( ( ( f . k ) . x ) - ( g . x ) ) .| < e))))
proof
let k being  natural number;
reconsider k9 = k as (Element of ( NAT )) by ORDINAL1:def 12;
assume A66: N < k;
let x being (Element of X);
assume x in ( E \ H );
then x in { y where y is (Element of X): (for k holds (N <= k implies y in ( K . k ))) } by A15,A64;
then (ex y being (Element of X) st (x = y & (for k holds (N <= k implies y in ( K . k )))));
then x in ( K . k ) by A66;
then A67: x in ( E /\ ( less_dom (|. ( ( f . k9 ) - g ) .|,( R_EAL e )) ) ) by A13;
then A68: x in E by XBOOLE_0:def 4;
x in ( less_dom (|. ( ( f . k ) - g ) .|,( R_EAL e )) ) by A67,XBOOLE_0:def 4;
then A69: ( |. ( ( f . k ) - g ) .| . x ) < ( R_EAL e ) by MESFUNC1:def 11;
A70: ( dom ( ( f . k9 ) - g ) ) = E by A9;
( dom |. ( ( f . k9 ) - g ) .| ) = E by A9;
then |. ( ( ( f . k ) - g ) . x ) .| < e by A68,A69,MESFUNC1:def 10;
hence thesis by A68,A70,MESFUNC1:def 4;
end;
take H;
take N;
( M . ( E \ ( EN . N ) ) ) = ( seq2 . N ) by A57;
then A71: ( 0 ) <= ( seq2 . N ) by MEASURE1:def 2;
( abs ( ( seq2 . N ) - ( 0 ) ) ) < r by A62;
then ( seq2 . N ) < r by A71,ABSVALUE:def 1;
hence thesis by A57,A65,XBOOLE_1:36;
end;
