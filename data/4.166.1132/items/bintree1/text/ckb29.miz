environ
vocabularies NUMBERS,XBOOLE_0,TREES_2,SUBSET_1,FUNCT_1,TREES_4,TREES_3,FINSEQ_1,TREES_1,ORDINAL1,ORDINAL4,CARD_1,XXREAL_0,ARYTM_3,FINSET_1,RELAT_1,TARSKI,TREES_A,LANG1,TDGROUP,DTCONSTR,STRUCT_0,ZFMISC_1,FUNCT_2,BINTREE1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,NAT_1,RELAT_1,STRUCT_0,MCART_1,FUNCT_1,RELSET_1,FUNCT_2,FINSEQ_1,FINSET_1,LANG1,TREES_1,TREES_2,TREES_3,TREES_4,DTCONSTR,PRE_POLY,XXREAL_0,CKB1,CKB4,CKB11,CKB20,CKB27;
definitions DTCONSTR,CKB1,CKB4,CKB11,CKB20;
theorems TARSKI,NAT_1,MCART_1,ZFMISC_1,ENUMSET1,MODAL_1,RELSET_1,FUNCT_1,FUNCT_2,FINSEQ_1,FINSEQ_2,FINSEQ_3,LANG1,TREES_1,TREES_2,TREES_3,TREES_4,DTCONSTR,FINSET_1,RELAT_1,CKB1,CKB2,CKB3,CKB4,CKB5,CKB8,CKB9,CKB11,CKB15,CKB16,CKB17,CKB18,CKB20,CKB23;
schemes FUNCT_2,DTCONSTR,MULTOP_1,CKB22,CKB24,CKB25,CKB26,CKB28;
registrations XBOOLE_0,SUBSET_1,RELAT_1,FUNCT_1,MEMBERED,FINSEQ_1,TREES_2,TREES_3,STRUCT_0,DTCONSTR,FINSET_1,PRE_POLY,TREES_4,TREES_1,RELSET_1,CKB6,CKB7,CKB10,CKB12,CKB13,CKB14,CKB19,CKB21;
constructors DOMAIN_1,XXREAL_0,NAT_1,MEMBERED,FINSEQOP,DTCONSTR,RELSET_1,PRE_POLY,CKB1,CKB4,CKB11,CKB20,CKB27;
requirements NUMERALS,REAL,SUBSET,BOOLE,ARITHM;
begin
scheme BinDTCDefLambdaUniq { G() ->  binary  with_terminals  with_nonterminals  with_useful_nonterminals non  empty DTConstrStr,A,B() -> non  empty set,f1,f2() -> (Function of ( TS G() ),( Funcs (A(),B()) )),F(set,set) -> (Element of B()),H(set,set,set,set) -> (Element of B()) } : f1() = f2()
provided
A1: ((for t being (Terminal of G()) holds (ex g being (Function of A(),B()) st (g = ( f1() . ( root-tree t ) ) & (for a being (Element of A()) holds ( g . a ) = F(t,a))))) & (for nt being (NonTerminal of G()) holds (for t1,t2 being (Element of ( TS G() )) holds (for rtl,rtr being (Symbol of G()) holds (((rtl = ( root-label t1 ) & rtr = ( root-label t2 )) & nt ==> <* rtl,rtr *>) implies (ex g,f1,f2 being (Function of A(),B()) st (((g = ( f1() . ( nt -tree (t1,t2) ) ) & f1 = ( f1() . t1 )) & f2 = ( f1() . t2 )) & (for a being (Element of A()) holds ( g . a ) = H(nt,f1,f2,a)))))))))
and
A2: ((for t being (Terminal of G()) holds (ex g being (Function of A(),B()) st (g = ( f2() . ( root-tree t ) ) & (for a being (Element of A()) holds ( g . a ) = F(t,a))))) & (for nt being (NonTerminal of G()) holds (for t1,t2 being (Element of ( TS G() )) holds (for rtl,rtr being (Symbol of G()) holds (((rtl = ( root-label t1 ) & rtr = ( root-label t2 )) & nt ==> <* rtl,rtr *>) implies (ex g,f1,f2 being (Function of A(),B()) st (((g = ( f2() . ( nt -tree (t1,t2) ) ) & f1 = ( f2() . t1 )) & f2 = ( f2() . t2 )) & (for a being (Element of A()) holds ( g . a ) = H(nt,f1,f2,a)))))))))
proof
defpred P[ set,set,set,set ]
 means
(for a being (Element of A()) holds (for ntv being (Function of A(),B()) holds (ntv = $4 implies ( ntv . a ) = H($1,$2,$3,a))));
defpred P[ set,set ]
 means
(for tv being (Function of A(),B()) holds (tv = $2 implies (for a being (Element of A()) holds ( tv . a ) = F($1,a))));
reconsider FAB = ( Funcs (A(),B()) ) as non  empty set;
reconsider f29 = f2() as (Function of ( TS G() ),FAB);
A3:now
let x being (Element of ( Terminals G() ));
deffunc F((Element of A())) = F(x,$1);
consider y being (Function of A(),B()) such that A4: (for a being (Element of A()) holds ( y . a ) = F(a)) from FUNCT_2:sch 4;
(A() = ( dom y ) & ( rng y ) c= B()) by FUNCT_2:def 1;
then reconsider y as (Element of FAB) by FUNCT_2:def 2;
take y;
thus P[ x,y ] by A4;
end;
consider TV being (Function of ( Terminals G() ),FAB) such that A5: (for e being (Element of ( Terminals G() )) holds P[ e,( TV . e ) ]) from FUNCT_2:sch 3(A3);
deffunc TermVal((Terminal of G())) = ( TV . $1 );
A6:now
let x being (Element of ( NonTerminals G() ));
let y being (Element of FAB);
let z being (Element of FAB);
deffunc F((Element of A())) = H(x,y,z,$1);
consider fab being (Function of A(),B()) such that A7: (for a being (Element of A()) holds ( fab . a ) = F(a)) from FUNCT_2:sch 4;
(A() = ( dom fab ) & ( rng fab ) c= B()) by FUNCT_2:def 1;
then reconsider fab as (Element of FAB) by FUNCT_2:def 2;
take fab;
thus P[ x,y,z,fab ] by A7;
end;
consider NTV being (Function of [: ( NonTerminals G() ),FAB,FAB :],FAB) such that A8: (for x being (Element of ( NonTerminals G() )) holds (for y being (Element of FAB) holds (for z being (Element of FAB) holds P[ x,y,z,( NTV . [ x,y,z ] ) ]))) from MULTOP_1:sch 1(A6);
deffunc NTV((NonTerminal of G()),set,set,(Element of FAB),(Element of FAB)) = ( NTV . [ $1,$4,$5 ] );
A9:now
hereby
let t being (Terminal of G());
consider TVt being Function such that A10: ( TV . t ) = TVt and A11: ( dom TVt ) = A() and A12: ( rng TVt ) c= B() by FUNCT_2:def 2;
reconsider TVt as (Function of A(),B()) by A11,A12,FUNCT_2:def 1,RELSET_1:4;
consider g being (Function of A(),B()) such that A13: g = ( f2() . ( root-tree t ) ) and A14: (for a being (Element of A()) holds ( g . a ) = F(t,a)) by A2;
now
thus A() = ( dom g ) by FUNCT_2:def 1;
thus A() = ( dom TVt ) by A11;
let x being set;
assume x in A();
then reconsider xx = x as (Element of A());
( g . xx ) = F(t,xx) by A14
.= ( TVt . xx ) by A5,A10;
hence ( g . x ) = ( TVt . x );
end;
hence ( f29 . ( root-tree t ) ) = TermVal(t) by A13,A10,FUNCT_1:2;
end;
let nt being (NonTerminal of G());
let tl being (Element of ( TS G() ));
let tr being (Element of ( TS G() ));
let rtl being (Symbol of G());
let rtr being (Symbol of G());
assume ((rtl = ( root-label tl ) & rtr = ( root-label tr )) & nt ==> <* rtl,rtr *>);
then consider g,ff1,ff2 being (Function of A(),B()) such that A15: g = ( f2() . ( nt -tree (tl,tr) ) ) and A16: ((ff1 = ( f2() . tl ) & ff2 = ( f2() . tr )) & (for a being (Element of A()) holds ( g . a ) = H(nt,ff1,ff2,a))) by A2;
let xl being (Element of FAB);
let xr being (Element of FAB);
consider ntvnt being Function such that A17: ntvnt = ( NTV . [ nt,xl,xr ] ) and A18: (( dom ntvnt ) = A() & ( rng ntvnt ) c= B()) by FUNCT_2:def 2;
reconsider ntvnt as (Function of A(),B()) by A18,FUNCT_2:def 1,RELSET_1:4;
assume A19: (xl = ( f29 . tl ) & xr = ( f29 . tr ));
now
thus A() = ( dom g ) by FUNCT_2:def 1;
thus A() = ( dom ntvnt ) by FUNCT_2:def 1;
let x being set;
assume x in A();
then reconsider xx = x as (Element of A());
( g . xx ) = H(nt,xl,xr,xx) by A19,A16
.= ( ntvnt . xx ) by A8,A17;
hence ( g . x ) = ( ntvnt . x );
end;
hence ( f29 . ( nt -tree (tl,tr) ) ) = NTV(nt,rtl,rtr,xl,xr) by A15,A17,FUNCT_1:2;
end;
reconsider f19 = f1() as (Function of ( TS G() ),FAB);
A20:now
hereby
let t being (Terminal of G());
consider TVt being Function such that A21: ( TV . t ) = TVt and A22: ( dom TVt ) = A() and A23: ( rng TVt ) c= B() by FUNCT_2:def 2;
reconsider TVt as (Function of A(),B()) by A22,A23,FUNCT_2:def 1,RELSET_1:4;
consider g being (Function of A(),B()) such that A24: g = ( f1() . ( root-tree t ) ) and A25: (for a being (Element of A()) holds ( g . a ) = F(t,a)) by A1;
now
thus A() = ( dom g ) by FUNCT_2:def 1;
thus A() = ( dom TVt ) by A22;
let x being set;
assume x in A();
then reconsider xx = x as (Element of A());
( g . xx ) = F(t,xx) by A25
.= ( TVt . xx ) by A5,A21;
hence ( g . x ) = ( TVt . x );
end;
hence ( f19 . ( root-tree t ) ) = TermVal(t) by A24,A21,FUNCT_1:2;
end;
let nt being (NonTerminal of G());
let tl being (Element of ( TS G() ));
let tr being (Element of ( TS G() ));
let rtl being (Symbol of G());
let rtr being (Symbol of G());
assume ((rtl = ( root-label tl ) & rtr = ( root-label tr )) & nt ==> <* rtl,rtr *>);
then consider g,ff1,ff2 being (Function of A(),B()) such that A26: g = ( f1() . ( nt -tree (tl,tr) ) ) and A27: ((ff1 = ( f1() . tl ) & ff2 = ( f1() . tr )) & (for a being (Element of A()) holds ( g . a ) = H(nt,ff1,ff2,a))) by A1;
let xl being (Element of FAB);
let xr being (Element of FAB);
consider ntvnt being Function such that A28: ntvnt = ( NTV . [ nt,xl,xr ] ) and A29: (( dom ntvnt ) = A() & ( rng ntvnt ) c= B()) by FUNCT_2:def 2;
reconsider ntvnt as (Function of A(),B()) by A29,FUNCT_2:def 1,RELSET_1:4;
assume A30: (xl = ( f19 . tl ) & xr = ( f19 . tr ));
now
thus A() = ( dom g ) by FUNCT_2:def 1;
thus A() = ( dom ntvnt ) by FUNCT_2:def 1;
let x being set;
assume x in A();
then reconsider xx = x as (Element of A());
( g . xx ) = H(nt,xl,xr,xx) by A30,A27
.= ( ntvnt . xx ) by A8,A28;
hence ( g . x ) = ( ntvnt . x );
end;
hence ( f19 . ( nt -tree (tl,tr) ) ) = NTV(nt,rtl,rtr,xl,xr) by A26,A28,FUNCT_1:2;
end;
f19 = f29 from CKB26:sch 1(A20,A9);
hence thesis;
end;
