environ
vocabularies SUBSET_1,RELAT_1,XBOOLE_0,FUNCT_1,ZFMISC_1,EQREL_1,RELAT_2,ORDERS_2,STRUCT_0,TARSKI,YELLOW_0,LATTICES,LATTICE3,ORDINAL2,WAYBEL_0,WELLORD1,CAT_1,XXREAL_0,REWRITE1,WAYBEL_1,GROUP_6,SEQM_3,YELLOW_1,WAYBEL_3,PBOOLE,CARD_3,FINSET_1,FUNCT_4,WAYBEL16,WAYBEL_5,BINOP_1,SETFAM_1,WAYBEL20;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,RELAT_1,SETFAM_1,RELAT_2,FUNCT_1,PBOOLE,RELSET_1,PARTFUN1,BINOP_1,FUNCT_2,FINSET_1,DOMAIN_1,EQREL_1,FUNCT_3,FUNCT_7,STRUCT_0,ORDERS_2,LATTICE3,QUANTAL1,YELLOW_0,YELLOW_1,YELLOW_2,YELLOW_3,WAYBEL_0,WAYBEL_1,WAYBEL_3,WAYBEL_5,WAYBEL16,CKB3,CKB36,CKB37;
definitions TARSKI,RELAT_2,LATTICE3,LATTICE5,YELLOW_0,WAYBEL_0,WAYBEL_1,WAYBEL_3,YELLOW_2,BINOP_1,STRUCT_0,CKB36,CKB37;
theorems TARSKI,ZFMISC_1,RELAT_1,RELAT_2,FUNCT_1,FUNCT_2,FUNCT_3,FUNCT_5,FUNCT_7,CARD_3,ORDERS_2,LATTICE3,LATTICE5,QUANTAL1,EQREL_1,YELLOW_0,YELLOW_2,YELLOW_3,YELLOW10,WAYBEL_0,WAYBEL_1,WAYBEL_3,WAYBEL_5,WAYBEL13,WAYBEL15,WAYBEL16,WAYBEL17,XBOOLE_0,XBOOLE_1,PARTFUN1,ORDERS_1,CKB1,CKB2,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38;
schemes YELLOW_0,FUNCT_2,PBOOLE;
registrations XBOOLE_0,SUBSET_1,RELAT_1,PARTFUN1,FUNCT_2,FINSET_1,STRUCT_0,LATTICE3,YELLOW_0,MONOID_0,WAYBEL_0,YELLOW_2,WAYBEL_1,YELLOW_3,WAYBEL_3,WAYBEL10,YELLOW_9,RELSET_1;
constructors DOMAIN_1,FUNCT_7,MONOID_0,QUANTAL1,ORDERS_3,WAYBEL_1,YELLOW_3,WAYBEL16,RELSET_1,CKB3,CKB36,CKB37;
requirements SUBSET,BOOLE;
begin
definition
let L being  complete LATTICE;
let R being non  empty (Subset of [: L,L :]);
assume that
A1: R is  CLCongruence;
func kernel_op R ->  kernel (Function of L,L) means 
:Def3: (for x being (Element of L) holds ( it . x ) = ( inf ( Class (( EqRel R ),x) ) ));
existence
proof
deffunc F((Element of L)) = ( inf ( Class (( EqRel R ),$1) ) );
consider k being (Function of (the carrier of L),(the carrier of L)) such that A2: (for x being (Element of L) holds ( k . x ) = F(x)) from FUNCT_2:sch 4;
reconsider k as (Function of L,L);
R is (Equivalence_Relation of (the carrier of L)) by A1,CKB37:def 1;
then A3: R = ( EqRel R ) by CKB36:def 1;
A4: ( subrelstr R ) is (CLSubFrame of [: L,L :]) by A1,CKB37:def 1;
A5: k is  monotone
proof
let x being (Element of L);
let y being (Element of L);
assume that
A6: x <= y;
set CRy = ( Class (( EqRel R ),y) );
set CRx = ( Class (( EqRel R ),x) );
reconsider SR = { [ ( inf CRx ),x ],[ ( inf CRy ),y ] } as (Subset of [: L,L :]);
A7: ( inf SR ) = [ ( inf ( proj1 SR ) ),( inf ( proj2 SR ) ) ] by CKB8:1,YELLOW_0:17
.= [ ( inf { ( inf CRx ),( inf CRy ) } ),( inf ( proj2 SR ) ) ] by FUNCT_5:13
.= [ ( inf { ( inf CRx ),( inf CRy ) } ),( inf { x,y } ) ] by FUNCT_5:13;
([ ( inf CRx ),x ] in R & [ ( inf CRy ),y ] in R) by A1,CKB38:1;
then SR c= R by ZFMISC_1:32;
then reconsider SR9 = SR as (Subset of ( subrelstr R )) by YELLOW_0:def 15;
 ex_inf_of SR,[: L,L :] by YELLOW_0:17;
then A8: ( "/\" (SR9,[: L,L :]) ) in (the carrier of ( subrelstr R )) by A4,YELLOW_0:def 18;
( inf { x,y } ) = ( x "/\" y ) by YELLOW_0:40
.= x by A6,YELLOW_0:25;
then [ ( inf { ( inf CRx ),( inf CRy ) } ),x ] in R by A7,A8,YELLOW_0:def 15;
then ( inf { ( inf CRx ),( inf CRy ) } ) in CRx by A3,EQREL_1:19;
then A9: ( inf CRx ) <= ( inf { ( inf CRx ),( inf CRy ) } ) by YELLOW_2:22;
( inf CRy ) in { ( inf CRx ),( inf CRy ) } by TARSKI:def 2;
then A10: ( inf { ( inf CRx ),( inf CRy ) } ) <= ( inf CRy ) by YELLOW_2:22;
(( k . x ) = ( inf CRx ) & ( k . y ) = ( inf CRy )) by A2;
hence ( k . x ) <= ( k . y ) by A9,A10,YELLOW_0:def 2;
end;
now
let x being (Element of L);
set CRx = ( Class (( EqRel R ),x) );
[ ( inf CRx ),x ] in R by A1,CKB38:1;
then ( inf CRx ) in CRx by A3,EQREL_1:19;
then A11: ( Class (( EqRel R ),( inf CRx )) ) = CRx by EQREL_1:23;
A12: ( k . x ) = ( inf CRx ) by A2;
then ( k . ( k . x ) ) = ( inf ( Class (( EqRel R ),( inf CRx )) ) ) by A2;
hence ( ( k * k ) . x ) = ( k . x ) by A12,A11,FUNCT_2:15;
end;
then ( k * k ) = k by FUNCT_2:63;
then k is  idempotent by QUANTAL1:def 9;
then A13: k is  projection by A5,WAYBEL_1:def 13;
now
let x being (Element of L);
set CRx = ( Class (( EqRel R ),x) );
(x in CRx & ( inf CRx ) is_<=_than CRx) by EQREL_1:20,YELLOW_0:33;
then A14: ( inf CRx ) <= x by LATTICE3:def 8;
( k . x ) = ( inf ( Class (( EqRel R ),x) ) ) by A2;
hence ( k . x ) <= ( ( id L ) . x ) by A14,FUNCT_1:18;
end;
then k <= ( id L ) by YELLOW_2:9;
then reconsider k as  kernel (Function of L,L) by A13,WAYBEL_1:def 15;
take k;
thus thesis by A2;
end;
uniqueness
proof
let it1 being  kernel (Function of L,L);
let it2 being  kernel (Function of L,L);
assume that
A15: (for x being (Element of L) holds ( it1 . x ) = ( inf ( Class (( EqRel R ),x) ) ))
and
A16: (for x being (Element of L) holds ( it2 . x ) = ( inf ( Class (( EqRel R ),x) ) ));
now
let x being set;
assume x in (the carrier of L);
then reconsider x9 = x as (Element of L);
thus ( it1 . x ) = ( inf ( Class (( EqRel R ),x9) ) ) by A15
.= ( it2 . x ) by A16;
end;
hence it1 = it2 by FUNCT_2:12;
end;
end;
