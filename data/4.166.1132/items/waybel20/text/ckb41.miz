environ
vocabularies SUBSET_1,RELAT_1,XBOOLE_0,FUNCT_1,ZFMISC_1,EQREL_1,RELAT_2,ORDERS_2,STRUCT_0,TARSKI,YELLOW_0,LATTICES,LATTICE3,ORDINAL2,WAYBEL_0,WELLORD1,CAT_1,XXREAL_0,REWRITE1,WAYBEL_1,GROUP_6,SEQM_3,YELLOW_1,WAYBEL_3,PBOOLE,CARD_3,FINSET_1,FUNCT_4,WAYBEL16,WAYBEL_5,BINOP_1,SETFAM_1,WAYBEL20;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,RELAT_1,SETFAM_1,RELAT_2,FUNCT_1,PBOOLE,RELSET_1,PARTFUN1,BINOP_1,FUNCT_2,FINSET_1,DOMAIN_1,EQREL_1,FUNCT_3,FUNCT_7,STRUCT_0,ORDERS_2,LATTICE3,QUANTAL1,YELLOW_0,YELLOW_1,YELLOW_2,YELLOW_3,WAYBEL_0,WAYBEL_1,WAYBEL_3,WAYBEL_5,WAYBEL16,CKB3,CKB36,CKB37,CKB39;
definitions TARSKI,RELAT_2,LATTICE3,LATTICE5,YELLOW_0,WAYBEL_0,WAYBEL_1,WAYBEL_3,YELLOW_2,BINOP_1,STRUCT_0,CKB36,CKB37,CKB39;
theorems TARSKI,ZFMISC_1,RELAT_1,RELAT_2,FUNCT_1,FUNCT_2,FUNCT_3,FUNCT_5,FUNCT_7,CARD_3,ORDERS_2,LATTICE3,LATTICE5,QUANTAL1,EQREL_1,YELLOW_0,YELLOW_2,YELLOW_3,YELLOW10,WAYBEL_0,WAYBEL_1,WAYBEL_3,WAYBEL_5,WAYBEL13,WAYBEL15,WAYBEL16,WAYBEL17,XBOOLE_0,XBOOLE_1,PARTFUN1,ORDERS_1,CKB1,CKB2,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40;
schemes YELLOW_0,FUNCT_2,PBOOLE;
registrations XBOOLE_0,SUBSET_1,RELAT_1,PARTFUN1,FUNCT_2,FINSET_1,STRUCT_0,LATTICE3,YELLOW_0,MONOID_0,WAYBEL_0,YELLOW_2,WAYBEL_1,YELLOW_3,WAYBEL_3,WAYBEL10,YELLOW_9,RELSET_1;
constructors DOMAIN_1,FUNCT_7,MONOID_0,QUANTAL1,ORDERS_3,WAYBEL_1,YELLOW_3,WAYBEL16,RELSET_1,CKB3,CKB36,CKB37,CKB39;
requirements SUBSET,BOOLE;
begin
theorem
Th38: (for L being  continuous  complete LATTICE holds (for R being (Subset of [: L,L :]) holds (for k being  kernel (Function of L,L) holds ((k is  directed-sups-preserving & R = ( [: k,k :] " ( id (the carrier of L) ) )) implies (ex LR being  continuous  complete  strict LATTICE st (((the carrier of LR) = ( Class ( EqRel R ) ) & (the InternalRel of LR) = { [ ( Class (( EqRel R ),x) ),( Class (( EqRel R ),y) ) ] where x is (Element of L),y is (Element of L): ( k . x ) <= ( k . y ) }) & (for g being (Function of L,LR) holds ((for x being (Element of L) holds ( g . x ) = ( Class (( EqRel R ),x) )) implies g is (CLHomomorphism of L,LR)))))))))
proof
let L being  continuous  complete LATTICE;
let R being (Subset of [: L,L :]);
let k being  kernel (Function of L,L);
assume that
A1: k is  directed-sups-preserving
and
A2: R = ( [: k,k :] " ( id (the carrier of L) ) );
set ER = ( EqRel R );
R is (Equivalence_Relation of (the carrier of L)) by A2,CKB2:1;
then A3: ER = R by CKB36:def 1;
reconsider rngk = ( rng k ) as non empty set;
defpred P[ set,set ]
 means
(ex x,y being (Element of L) st (($1 = ( Class (ER,x) ) & $2 = ( Class (ER,y) )) & ( k . x ) <= ( k . y )));
set xx = the (Element of L);
set cL = (the carrier of L);
( Class (ER,xx) ) in ( Class ER ) by EQREL_1:def 3;
then reconsider CER = ( Class ER ) as non empty (Subset-Family of cL);
consider LR being non empty  strict RelStr such that A4: (the carrier of LR) = CER and A5: (for a,b being (Element of LR) holds (a <= b iff P[ a,b ])) from YELLOW_0:sch 1;
defpred P[ set,set ]
 means
(ex a being (Element of cL) st ($1 = ( Class (ER,a) ) & $2 = ( k . a )));
A6: ( dom k ) = cL by FUNCT_2:def 1;
A7: (for x being (Element of CER) holds (ex y being (Element of rngk) st P[ x,y ]))
proof
let x being (Element of CER);
consider y being set such that A8: y in cL and A9: x = ( Class (ER,y) ) by EQREL_1:def 3;
reconsider y as (Element of L) by A8;
reconsider ky = ( k . y ) as (Element of rngk) by A6,FUNCT_1:def 3;
take ky;
thus thesis by A9;
end;
consider f being (Function of CER,rngk) such that A10: (for x being (Element of CER) holds P[ x,( f . x ) ]) from FUNCT_2:sch 3(A7);
A11: ( dom [: k,k :] ) = [: cL,cL :] by A6,FUNCT_3:def 8;
A12: (for a,b being (Element of cL) holds (( Class (ER,a) ) = ( Class (ER,b) ) iff ( k . a ) = ( k . b )))
proof
let a being (Element of cL),b being (Element of cL);
hereby
assume ( Class (ER,a) ) = ( Class (ER,b) );
then a in ( Class (ER,b) ) by EQREL_1:23;
then [ a,b ] in R by A3,EQREL_1:19;
then ( [: k,k :] . (a,b) ) in ( id cL ) by A2,FUNCT_1:def 7;
then [ ( k . a ),( k . b ) ] in ( id cL ) by A6,FUNCT_3:def 8;
hence ( k . a ) = ( k . b ) by RELAT_1:def 10;
end;
assume ( k . a ) = ( k . b );
then [ ( k . a ),( k . b ) ] in ( id cL ) by RELAT_1:def 10;
then ([ a,b ] in [: cL,cL :] & ( [: k,k :] . (a,b) ) in ( id cL )) by A6,FUNCT_3:def 8,ZFMISC_1:def 2;
then [ a,b ] in ER by A2,A3,A11,FUNCT_1:def 7;
then a in ( Class (ER,b) ) by EQREL_1:19;
hence thesis by EQREL_1:23;
end;
A13: (for x being (Element of L) holds ( f . ( Class (ER,x) ) ) = ( k . x ))
proof
let x being (Element of L);
reconsider CERx = ( Class (ER,x) ) as (Element of CER) by EQREL_1:def 3;
(ex a being (Element of cL) st (CERx = ( Class (ER,a) ) & ( f . CERx ) = ( k . a ))) by A10;
hence thesis by A12;
end;
A14: (for x being (Element of LR) holds (ex a being (Element of L) st x = ( Class (ER,a) )))
proof
let x being (Element of LR);
x in CER by A4;
then consider a being set such that A15: a in cL and A16: x = ( Class (ER,a) ) by EQREL_1:def 3;
reconsider a as (Element of L) by A15;
take a;
thus thesis by A16;
end;
now
let x1 being set,x2 being set;
assume that
A17: x1 in CER
and
A18: x2 in CER
and
A19: ( f . x1 ) = ( f . x2 );
reconsider x19 = x1 as (Element of LR) by A4,A17;
consider a being (Element of L) such that A20: x19 = ( Class (ER,a) ) by A14;
reconsider x29 = x2 as (Element of LR) by A4,A18;
consider b being (Element of L) such that A21: x29 = ( Class (ER,b) ) by A14;
A22: ( f . x29 ) = ( k . b ) by A13,A21;
( f . x19 ) = ( k . a ) by A13,A20;
hence x1 = x2 by A12,A19,A20,A21,A22;
end;
then A23: f is  one-to-one by FUNCT_2:19;
set tIR = (the InternalRel of LR);
A24: ( dom f ) = CER by FUNCT_2:def 1;
reconsider f as (Function of LR,( Image k )) by A4,YELLOW_0:def 15;
now
let y being set;
hereby
assume y in ( rng f );
then consider x being set such that A25: x in ( dom f ) and A26: y = ( f . x ) by FUNCT_1:def 3;
reconsider x as (Element of LR) by A25;
consider a being (Element of L) such that A27: x = ( Class (ER,a) ) by A14;
( f . x ) = ( k . a ) by A13,A27;
hence y in rngk by A6,A26,FUNCT_1:def 3;
end;
assume y in rngk;
then consider x being set such that A28: x in ( dom k ) and A29: y = ( k . x ) by FUNCT_1:def 3;
reconsider x as (Element of L) by A28;
(( Class (ER,x) ) in CER & ( f . ( Class (ER,x) ) ) = ( k . x )) by A13,EQREL_1:def 3;
hence y in ( rng f ) by A24,A29,FUNCT_1:def 3;
end;
then A30: ((the carrier of ( Image k )) = rngk & ( rng f ) = rngk) by TARSKI:1,YELLOW_0:def 15;
(for x,y being (Element of LR) holds (x <= y iff ( f . x ) <= ( f . y )))
proof
let x being (Element of LR),y being (Element of LR);
x in CER by A4;
then consider a being set such that A31: a in cL and A32: x = ( Class (ER,a) ) by EQREL_1:def 3;
hereby
assume x <= y;
then consider c being (Element of L),d being (Element of L) such that A33: (x = ( Class (ER,c) ) & y = ( Class (ER,d) )) and A34: ( k . c ) <= ( k . d ) by A5;
(( f . x ) = ( k . c ) & ( f . y ) = ( k . d )) by A13,A33;
hence ( f . x ) <= ( f . y ) by A34,YELLOW_0:60;
end;
reconsider a as (Element of L) by A31;
assume A35: ( f . x ) <= ( f . y );
y in CER by A4;
then consider b being set such that A36: b in cL and A37: y = ( Class (ER,b) ) by EQREL_1:def 3;
reconsider b as (Element of L) by A36;
A38: ( f . y ) = ( k . b ) by A13,A37;
( f . x ) = ( k . a ) by A13,A32;
then ( k . a ) <= ( k . b ) by A38,A35,YELLOW_0:59;
hence thesis by A5,A32,A37;
end;
then A39: f is  isomorphic by A23,A30,WAYBEL_0:66;
then A40: LR,( Image k ) are_isomorphic  by WAYBEL_1:def 8;
then ( Image k ),LR are_isomorphic  by WAYBEL_1:6;
then reconsider LR as non empty  strict Poset by CKB16:1,CKB17:1,CKB18:1;
( Image k ) is  complete by WAYBEL_1:54;
then reconsider LR as  complete non empty  strict Poset by A40,CKB19:1,WAYBEL_1:6;
reconsider LR as  complete  strict LATTICE;
( Image k ) is  continuous  continuous LATTICE by A1,WAYBEL15:14;
then reconsider LR as  continuous  complete  strict LATTICE by A40,WAYBEL15:9,WAYBEL_1:6;
reconsider f9 = ( (f qua Function) " ) as (Function of ( Image k ),LR) by A23,A30,FUNCT_2:25;
set IR = { [ ( Class (ER,x) ),( Class (ER,y) ) ] where x is (Element of L),y is (Element of L): ( k . x ) <= ( k . y ) };
A41: f9 is  isomorphic by A39,WAYBEL_0:68;
then A42: (( corestr k ) is  infs-preserving & f9 is  infs-preserving) by WAYBEL13:20,WAYBEL_1:56;
take LR;
thus (the carrier of LR) = ( Class ER ) by A4;
now
let z being set;
hereby
assume A43: z in tIR;
then consider a being set,b being set such that A44: (a in CER & b in CER) and A45: z = [ a,b ] by A4,ZFMISC_1:def 2;
reconsider a,b as (Element of LR) by A4,A44;
a <= b by A43,A45,ORDERS_2:def 5;
then (ex x,y being (Element of L) st ((a = ( Class (ER,x) ) & b = ( Class (ER,y) )) & ( k . x ) <= ( k . y ))) by A5;
hence z in IR by A45;
end;
assume z in IR;
then consider x being (Element of L),y being (Element of L) such that A46: z = [ ( Class (ER,x) ),( Class (ER,y) ) ] and A47: ( k . x ) <= ( k . y );
reconsider b = ( Class (ER,y) ) as (Element of LR) by A4,EQREL_1:def 3;
reconsider a = ( Class (ER,x) ) as (Element of LR) by A4,EQREL_1:def 3;
a <= b by A5,A47;
hence z in tIR by A46,ORDERS_2:def 5;
end;
hence (the InternalRel of LR) = { [ ( Class (ER,x) ),( Class (ER,y) ) ] where x is (Element of L),y is (Element of L): ( k . x ) <= ( k . y ) } by TARSKI:1;
let g being (Function of L,LR);
assume that
A48: (for x being (Element of L) holds ( g . x ) = ( Class (ER,x) ));
now
let x being set;
assume A49: x in cL;
then reconsider x9 = x as (Element of L);
A50: (( f . ( Class (ER,x9) ) ) = ( k . x9 ) & ( Class (ER,x9) ) in CER) by A13,EQREL_1:def 3;
( dom ( corestr k ) ) = cL by FUNCT_2:def 1;
hence ( ( f9 * ( corestr k ) ) . x ) = ( f9 . ( ( corestr k ) . x ) ) by A49,FUNCT_1:13
.= ( f9 . ( k . x ) ) by WAYBEL_1:30
.= ( Class (ER,x9) ) by A24,A23,A50,FUNCT_1:32
.= ( g . x ) by A48;
end;
then A51: g = ( f9 * ( corestr k ) ) by FUNCT_2:12;
A52: ( corestr k ) is  directed-sups-preserving by A1,CKB23:1;
reconsider f9 as  sups-preserving (Function of ( Image k ),LR) by A41,WAYBEL13:20;
f9 is  directed-sups-preserving;
then A53: g is  directed-sups-preserving by A51,A52,WAYBEL15:11;
g is  infs-preserving by A51,A42,CKB26:1;
hence thesis by A53,WAYBEL16:def 1;
end;
