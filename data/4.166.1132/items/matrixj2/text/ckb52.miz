environ
vocabularies NUMBERS,NAT_1,VECTSP_1,SUBSET_1,FUNCT_1,RELAT_1,FUNCT_4,XBOOLE_0,FUNCOP_1,MATRIX_1,FINSEQ_1,TREES_1,ARYTM_3,GROUP_1,SUPINF_2,ZFMISC_1,MATRIX_2,XXREAL_0,MATRIX_3,FINSEQ_2,ALGSTR_0,SETWISEO,CARD_3,CARD_1,INCSP_1,MESFUNC1,STRUCT_0,FVSUM_1,PARTFUN1,RVSUM_1,ARYTM_1,MATRIX_6,MATRIXJ1,MATHMORP,ORDINAL4,RFINSEQ,BCIALG_2,NEWTON,GRCAT_1,FUNCSDOM,VECTSP_2,RANKNULL,VECTSP10,HURWITZ,TARSKI,RLSUB_1,RLVECT_5,MATRLIN,MATRLIN2,MATRIXR1,FINSEQ_4,RLVECT_3,FINSET_1,RLVECT_2,POLYNOM5,VECTSP11,RLSUB_2,PRVECT_1,MATRIXJ2,UNIALG_1,MSSUBFAM;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,CARD_1,XCMPLX_0,ALGSTR_0,XXREAL_0,NAT_1,FINSET_1,RELAT_1,FUNCT_1,PARTFUN1,FUNCT_2,SETWOP_2,FINSEQ_1,PRVECT_1,FUNCOP_1,STRUCT_0,RLVECT_1,GROUP_1,VECTSP_1,FINSEQ_2,MATRIX_1,MATRIX_2,FVSUM_1,NAT_D,GROUP_4,MATRIX_3,MATRIX_6,FUNCT_4,DOMAIN_1,VECTSP_4,VECTSP_6,VECTSP_7,VECTSP_9,MATRIX13,MATRLIN,FUNCT_7,LAPLACE,MOD_2,RFINSEQ,VECTSP_2,VECTSP_5,MATRIX15,RANKNULL,FUNCSDOM,GRCAT_1,POLYNOM5,WSIERP_1,MATRIXJ1,MATRLIN2,VECTSP11,CKB2,CKB3,CKB13,CKB16,CKB18,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB35,CKB36;
definitions STRUCT_0,TARSKI,RLVECT_1,FINSEQ_1,VECTSP_4,RELAT_1,GROUP_4,FVSUM_1,MATRIX_1,FUNCT_1,FUNCOP_1,MATRIXJ1,MATRLIN2,CKB2,CKB13,CKB18,CKB30,CKB35;
theorems ZFMISC_1,RLVECT_1,MATRIX_1,MATRIX_2,MATRIX_3,VECTSP_1,NAT_1,FINSEQ_2,CARD_1,CARD_2,FINSEQ_1,FINSEQ_3,FRECHET,FUNCT_1,FUNCT_2,FUNCT_7,FUNCOP_1,FVSUM_1,GROUP_1,LAPLACE,MATRIX_6,MATRIX13,MATRIXR1,MATRIXR2,MATRLIN,ORDINAL1,PARTFUN1,RELAT_1,STIRL2_1,STRUCT_0,TARSKI,WELLORD2,VECTSP_4,VECTSP_6,VECTSP_7,VECTSP_9,XBOOLE_0,XBOOLE_1,XREAL_1,XXREAL_0,MATRIX15,MOD_2,VECTSP10,RANKNULL,VECTSP_5,FINSEQ_4,FINSEQ_5,RFINSEQ,RVSUM_1,POLYNOM3,POLYNOM4,MATRIXJ1,MATRLIN2,VECTSP11,GRCAT_1,FUNCT_4,NAT_D,CKB1,CKB2,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB17,CKB18,CKB19,CKB20,CKB23,CKB30,CKB31,CKB34,CKB35,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46,CKB47,CKB48,CKB49,CKB50,CKB51;
schemes NAT_1,MATRIX_1,FUNCT_2;
registrations XBOOLE_0,FINSET_1,STRUCT_0,VECTSP_1,FUNCT_2,ORDINAL1,XXREAL_0,NAT_1,FINSEQ_1,RELAT_1,CARD_1,FINSEQ_2,XREAL_0,VECTSP_9,VALUED_0,MATRIXJ1,VECTSP11,POLYNOM5,FUNCOP_1,RELSET_1,MOD_2,GRCAT_1,PRVECT_1,MATRIX13,MATRLIN2,CKB14,CKB15,CKB21,CKB22,CKB32,CKB33;
constructors FINSOP_1,XXREAL_0,GROUP_4,WELLORD2,VECTSP_7,VECTSP_9,MATRIX_6,REALSET1,LAPLACE,VECTSP_5,RANKNULL,MATRIX15,POLYNOM1,POLYNOM5,MATRIXJ1,MATRLIN2,VECTSP11,REAL_1,BINARITH,RELSET_1,FUNCT_7,MATRIX13,FVSUM_1,CKB2,CKB3,CKB13,CKB18,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB35;
requirements ARITHM,NUMERALS,REAL,BOOLE,SUBSET;
begin
reserve i for Nat;
reserve j for Nat;
reserve m for Nat;
reserve n for Nat;
reserve k for Nat;
reserve x for set;
reserve y for set;
reserve K for Field;
reserve L for (Element of K);
reserve V1 for  finite-dimensional (VectSp of K);
reserve V2 for  finite-dimensional (VectSp of K);
reserve b1 for (OrdBasis of V1);
reserve b2 for (OrdBasis of V2);
theorem
Th28: (for V1 holds (for V2 holds (for b1 holds (for b2 holds (for L holds (( len b1 ) = ( len b2 ) implies (for F being (linear-transformation of V1,V2) holds ((for i holds (i in ( dom b1 ) implies (( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) ) or (( i + 1 ) in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( b2 /. ( i + 1 ) ) ))))) implies (ex J being  non-empty (FinSequence_of_Jordan_block of L,K) st ( AutMt (F,b1,b2) ) = ( block_diagonal (J,( 0. K )) ))))))))))
proof
defpred P[ Nat ]
 means
(for V1 holds (for V2 holds (for b1 holds (for b2 holds (for L holds (( len b1 ) = ( len b2 ) implies (for F being (linear-transformation of V1,V2) holds (($1 = ( card { i where i is (Element of ( NAT )): (i in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )) } ) & (for i holds (i in ( dom b1 ) implies (( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) ) or (( i + 1 ) in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( b2 /. ( i + 1 ) ) )))))) implies (ex J being  non-empty (FinSequence_of_Jordan_block of L,K) st ( AutMt (F,b1,b2) ) = ( block_diagonal (J,( 0. K )) ))))))))));
A1: P[ ( 0 ) ]
proof
let V1;
let V2;
let b1;
let b2;
let L;
assume that
( len b1 ) = ( len b2 );
set Lb = ( len b1 );
reconsider J = ( {} ) as (FinSequence_of_Jordan_block of L,K) by CKB19:1;
let F being (linear-transformation of V1,V2);
assume that
A2: ( 0 ) = ( card { i where i is (Element of ( NAT )): (i in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )) } )
and
A3: (for i holds (i in ( dom b1 ) implies (( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) ) or (( i + 1 ) in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( b2 /. ( i + 1 ) ) )))));
reconsider J as  non-empty (FinSequence_of_Jordan_block of L,K);
take J;
Lb = ( 0 )
proof
assume Lb <> ( 0 );
then A4: Lb in ( Seg Lb ) by FINSEQ_1:3;
A5: ( dom b1 ) = ( Seg Lb ) by FINSEQ_1:def 3;
per cases  by A3,A4,A5;
suppose ( F . ( b1 /. Lb ) ) = ( L * ( b2 /. Lb ) );

then Lb in { i where i is (Element of ( NAT )): (i in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )) } by A4,A5;
hence thesis by A2;
end;
suppose (( Lb + 1 ) in ( dom b1 ) & ( F . ( b1 /. Lb ) ) = ( ( L * ( b2 /. Lb ) ) + ( b2 /. ( Lb + 1 ) ) ));

then ( Lb + 1 ) <= Lb by FINSEQ_3:25;
hence thesis by NAT_1:13;
end;
end;
then ( len ( AutMt (F,b1,b2) ) ) = ( 0 ) by MATRIX_1:def 2;
then ( AutMt (F,b1,b2) ) = ( {} );
hence thesis by MATRIXJ1:22;
end;
A6: (for n holds (P[ n ] implies P[ ( n + 1 ) ]))
proof
let n;
assume that
A7: P[ n ];
set n1 = ( n + 1 );
let V1;
let V2;
let b1;
let b2;
let L;
assume that
A8: ( len b1 ) = ( len b2 );
A9: ( dom b1 ) = ( dom b2 ) by A8,FINSEQ_3:29;
set Lb = ( len b1 );
let F being (linear-transformation of V1,V2);
assume that
A10: n1 = ( card { i where i is (Element of ( NAT )): (i in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )) } )
and
A11: (for i holds (i in ( dom b1 ) implies (( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) ) or (( i + 1 ) in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( b2 /. ( i + 1 ) ) )))));
set FF = { i where i is (Element of ( NAT )): (i in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )) };
reconsider FF as  finite set by A10;
consider x such that A12: x in FF by A10,CARD_1:27,XBOOLE_0:def 1;
(ex ii being (Element of ( NAT )) st ((ii = x & ii in ( dom b1 )) & ( F . ( b1 /. ii ) ) = ( L * ( b2 /. ii ) ))) by A12;
then ( dom b1 ) <> ( {} );
then ( Seg Lb ) <> ( {} ) by FINSEQ_1:def 3;
then A13: Lb <> ( 0 );
A14: ( dom b1 ) = ( Seg Lb ) by FINSEQ_1:def 3;
then A15: (not ( Lb + 1 ) in ( dom b1 )) by FINSEQ_3:8;
A16: Lb in ( dom b1 ) by A14,A13,FINSEQ_1:3;
then ( F . ( b1 /. Lb ) ) = ( L * ( b2 /. Lb ) ) by A11,A15;
then A17: Lb in FF by A16;
per cases ;
suppose A18: n = ( 0 );

set J = ( Jordan_block (L,Lb) );
reconsider JJ = <* J *> as (FinSequence_of_Jordan_block of L,K) by CKB20:1;
now
A19: ( dom JJ ) = { 1 } by FINSEQ_1:2,FINSEQ_1:def 8;
let x;
assume x in ( dom JJ );
then (( JJ . 1 ) = J & x = 1) by A19,FINSEQ_1:def 8,TARSKI:def 1;
hence ( JJ . x ) is non empty by A13,CKB2:def 1;
end;
then reconsider JJ as  non-empty (FinSequence_of_Jordan_block of L,K) by FUNCT_1:def 9;
reconsider F9 = F as (Function of V1,V2);
reconsider BB = ( block_diagonal (JJ,( 0. K )) ) as (Matrix of ( len b1 ),( len b2 ),K) by A8,MATRIXJ1:34;
set T = ( Mx2Tran (BB,b1,b2) );
A20: ( block_diagonal (JJ,( 0. K )) ) = J by MATRIXJ1:34;
A21:now
let y;
assume that
A22: y in ( dom b1 );
reconsider j = y as (Element of ( NAT )) by A22;
A23: ( ( T * b1 ) . y ) = ( T . ( b1 . y ) ) by A22,FUNCT_1:13;
A24: ( b1 /. j ) = ( b1 . j ) by A22,PARTFUN1:def 6;
A25: ( ( F9 * b1 ) . y ) = ( F . ( b1 . y ) ) by A22,FUNCT_1:13;
now
per cases ;
suppose A26: j = Lb;

hence ( ( T * b1 ) . y ) = ( L * ( b2 /. Lb ) ) by A20,A22,A23,A24,CKB45:1
.= ( ( F9 * b1 ) . y ) by A11,A16,A15,A25,A24,A26;
end;
suppose A27: j <> Lb;

(ex z being set st FF = { z }) by A10,A18,CARD_2:42;
then FF = { Lb } by A17,TARSKI:def 1;
then (not j in FF) by A27,TARSKI:def 1;
then A28: ( F . ( b1 /. j ) ) <> ( L * ( b2 /. j ) ) by A22;
( ( T * b1 ) . y ) = ( ( L * ( b2 /. j ) ) + ( b2 /. ( j + 1 ) ) ) by A20,A22,A23,A24,A27,CKB45:1;
hence ( ( T * b1 ) . y ) = ( ( F9 * b1 ) . y ) by A11,A22,A25,A24,A28;
end;
end;
hence ( ( F9 * b1 ) . y ) = ( ( T * b1 ) . y );
end;
take JJ;
A29: ( rng b1 ) c= ( [#] V1 ) by FINSEQ_1:def 4;
( dom T ) = ( [#] V1 ) by FUNCT_2:def 1;
then A30: ( dom ( T * b1 ) ) = ( dom b1 ) by A29,RELAT_1:27;
( dom F ) = ( [#] V1 ) by FUNCT_2:def 1;
then ( dom ( F9 * b1 ) ) = ( dom b1 ) by A29,RELAT_1:27;
then F = T by A13,A30,A21,FUNCT_1:2,MATRLIN:22;
hence thesis by MATRLIN2:36;
end;
suppose A31: n <> ( 0 );

defpred Q[ Nat ]
 means
($1 in FF & $1 < Lb);
A32: (ex k st Q[ k ])
proof
( card FF ) <> 1 by A10,A31;
then FF <> { Lb } by CARD_2:42;
then consider y such that A33: y in FF and A34: y <> Lb by A17,ZFMISC_1:35;
consider j being (Element of ( NAT )) such that A35: j = y and A36: j in ( dom b1 ) and ( F . ( b1 /. j ) ) = ( L * ( b2 /. j ) ) by A33;
take j;
j <= Lb by A36,FINSEQ_3:25;
hence thesis by A33,A34,A35,XXREAL_0:1;
end;
A37: (for k holds (Q[ k ] implies k <= Lb));
consider m such that A38: Q[ m ] and A39: (for k holds (Q[ k ] implies k <= m)) from NAT_1:sch 6(A37,A32);
set b1m = ( b1 | m );
A40: ( len b1m ) = m by A38,FINSEQ_1:59;
set JB = ( Jordan_block (L,( Lb -' m )) );
reconsider JJ = <* JB *> as (FinSequence_of_Jordan_block of L,K) by CKB20:1;
set b19m = ( b1 /^ m );
A41: ( len b19m ) = ( Lb - m ) by A38,RFINSEQ:def 1;
set b29m = ( b2 /^ m );
A42: ( len b29m ) = ( Lb - m ) by A8,A38,RFINSEQ:def 1;
set b2m = ( b2 | m );
A43: ( len b2m ) = m by A8,A38,FINSEQ_1:59;
reconsider Rb2 = ( rng b2m ),Rb29 = ( rng b29m ) as  linearly-independent (Subset of V2) by MATRLIN2:22,MATRLIN2:23;
reconsider Rb1 = ( rng b1m ),Rb19 = ( rng b19m ) as  linearly-independent (Subset of V1) by MATRLIN2:22,MATRLIN2:23;
set Lb1 = ( Lin Rb1 );
set Lb2 = ( Lin Rb2 );
set Lb19 = ( Lin Rb19 );
set Lb29 = ( Lin Rb29 );
set FRb1 = ( F .: Rb1 );
A44: ( rng ( F | Lb1 ) ) = ( F .: (the carrier of Lb1) ) by RELAT_1:115;
reconsider b2m as (OrdBasis of Lb2) by MATRLIN2:22;
reconsider b1m as (OrdBasis of Lb1) by MATRLIN2:22;
A45: ( dom b1m ) = ( dom b2m ) by A40,A43,FINSEQ_3:29;
reconsider b19m as (OrdBasis of Lb19) by MATRLIN2:23;
reconsider b29m as (OrdBasis of Lb29) by MATRLIN2:23;
A46: b2 = ( b2m ^ b29m ) by RFINSEQ:8;
A47: b1 = ( b1m ^ b19m ) by RFINSEQ:8;
then A48: ( dom b1m ) c= ( dom b1 ) by FINSEQ_1:26;
A49: (for i holds (i in ( dom b1m ) implies (( ( F | Lb1 ) . ( b1m /. i ) ) = ( L * ( b2m /. i ) ) or (( i + 1 ) in ( dom b1m ) & ( ( F | Lb1 ) . ( b1m /. i ) ) = ( ( L * ( b2m /. i ) ) + ( b2m /. ( i + 1 ) ) )))))
proof
let i;
assume that
A50: i in ( dom b1m );
A51: ( b1m . i ) = ( b1m /. i ) by A50,PARTFUN1:def 6;
set i1 = ( i + 1 );
A52: ( F . ( b1m /. i ) ) = ( ( F | Lb1 ) . ( b1m /. i ) ) by FUNCT_1:49;
A53: (( b2 /. i ) = ( b2 . i ) & ( b2 . i ) = ( b2m . i )) by A9,A46,A48,A45,A50,FINSEQ_1:def 7,PARTFUN1:def 6;
A54: (( b1 /. i ) = ( b1 . i ) & ( b1 . i ) = ( b1m . i )) by A47,A48,A50,FINSEQ_1:def 7,PARTFUN1:def 6;
per cases  by A11,A48,A50;
suppose ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) );

hence thesis by A45,A50,A53,A54,A51,A52,PARTFUN1:def 6,VECTSP_4:14;
end;
suppose A55: (i1 in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( b2 /. i1 ) ));

reconsider rngb2 = ( rng b2 ) as (Basis of V2) by MATRLIN:def 2;
A56: i1 <= m
proof
assume i1 > m;
then A57: i >= m by NAT_1:13;
i <= m by A40,A50,FINSEQ_3:25;
then A58: i = m by A57,XXREAL_0:1;
(ex ii being (Element of ( NAT )) st ((m = ii & ii in ( dom b1 )) & ( F . ( b1 /. ii ) ) = ( L * ( b2 /. ii ) ))) by A38;
then ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( 0. V2 ) ) by A58,RLVECT_1:def 4;
then A59: ( b2 /. i1 ) = ( 0. V2 ) by A55,RLVECT_1:8;
A60: rngb2 is  linearly-independent by VECTSP_7:def 3;
(( b2 /. i1 ) = ( b2 . i1 ) & ( b2 . i1 ) in rngb2) by A9,A55,FUNCT_1:def 3,PARTFUN1:def 6;
hence thesis by A59,A60,VECTSP_7:2;
end;
A61: 1 <= i1 by NAT_1:11;
then A62: i1 in ( dom b1m ) by A40,A56,FINSEQ_3:25;
then A63: ( b2m . i1 ) = ( b2m /. i1 ) by A45,PARTFUN1:def 6;
A64: ( L * ( b2 /. i ) ) = ( L * ( b2m /. i ) ) by A45,A50,A53,PARTFUN1:def 6,VECTSP_4:14;
(( b2 /. i1 ) = ( b2 . i1 ) & ( b2 . i1 ) = ( b2m . i1 )) by A9,A46,A48,A45,A62,FINSEQ_1:def 7,PARTFUN1:def 6;
hence thesis by A40,A54,A51,A52,A55,A56,A61,A63,A64,FINSEQ_3:25,VECTSP_4:13;
end;
end;
FRb1 c= (the carrier of Lb2)
proof
let y;
assume y in FRb1;
then consider x such that x in ( dom F ) and A65: x in Rb1 and A66: ( F . x ) = y by FUNCT_1:def 6;
consider i being set such that A67: i in ( dom b1m ) and A68: ( b1m . i ) = x by A65,FUNCT_1:def 3;
reconsider i as (Element of ( NAT )) by A67;
( b1m /. i ) = ( b1m . i ) by A67,PARTFUN1:def 6;
then ( ( F | Lb1 ) . ( b1m /. i ) ) = y by A66,A68,FUNCT_1:49;
then (y = ( L * ( b2m /. i ) ) or y = ( ( L * ( b2m /. i ) ) + ( b2m /. ( i + 1 ) ) )) by A49,A67;
hence thesis;
end;
then ((the carrier of ( Lin FRb1 )) = ( F .: (the carrier of Lb1) ) & ( Lin FRb1 ) is (Subspace of Lb2)) by VECTSP11:42,VECTSP_9:16;
then ( F .: (the carrier of Lb1) ) c= (the carrier of Lb2) by VECTSP_4:def 2;
then reconsider FL = ( F | Lb1 ) as (linear-transformation of Lb1,Lb2) by A44,CKB51:1,FUNCT_2:6;
A69: (for i holds (i in ( dom b1m ) implies (( FL . ( b1m /. i ) ) = ( L * ( b2m /. i ) ) or (( i + 1 ) in ( dom b1m ) & ( FL . ( b1m /. i ) ) = ( ( L * ( b2m /. i ) ) + ( b2m /. ( i + 1 ) ) ))))) by A49;
set FF1 = { i where i is (Element of ( NAT )): (i in ( dom b1m ) & ( FL . ( b1m /. i ) ) = ( L * ( b2m /. i ) )) };
A70: ( FF \ { Lb } ) c= FF1
proof
let x;
assume that
A71: x in ( FF \ { Lb } );
A72: x <> Lb by A71,ZFMISC_1:56;
x in FF by A71;
then consider j being (Element of ( NAT )) such that A73: j = x and A74: j in ( dom b1 ) and A75: ( F . ( b1 /. j ) ) = ( L * ( b2 /. j ) );
j <= Lb by A74,FINSEQ_3:25;
then j < Lb by A72,A73,XXREAL_0:1;
then A76: j <= m by A39,A71,A73;
1 <= j by A74,FINSEQ_3:25;
then A77: j in ( dom b1m ) by A40,A76,FINSEQ_3:25;
then A78: (( b1m /. j ) = ( b1m . j ) & ( b1m . j ) = ( b1 . j )) by A47,FINSEQ_1:def 7,PARTFUN1:def 6;
A79: (( FL . ( b1m /. j ) ) = ( F . ( b1m /. j ) ) & ( b1 /. j ) = ( b1 . j )) by A48,A77,FUNCT_1:49,PARTFUN1:def 6;
(( b2m . j ) = ( b2 . j ) & ( b2 /. j ) = ( b2 . j )) by A9,A46,A48,A45,A77,FINSEQ_1:def 7,PARTFUN1:def 6;
then ( FL . ( b1m /. j ) ) = ( L * ( b2m /. j ) ) by A45,A75,A77,A78,A79,PARTFUN1:def 6,VECTSP_4:14;
hence thesis by A73,A77;
end;
FF1 c= ( FF \ { Lb } )
proof
let x;
assume x in FF1;
then consider j being (Element of ( NAT )) such that A80: x = j and A81: j in ( dom b1m ) and A82: ( FL . ( b1m /. j ) ) = ( L * ( b2m /. j ) );
A83: (( b1m /. j ) = ( b1m . j ) & ( b1m . j ) = ( b1 . j )) by A47,A81,FINSEQ_1:def 7,PARTFUN1:def 6;
A84: (( FL . ( b1m /. j ) ) = ( F . ( b1m /. j ) ) & ( b1 /. j ) = ( b1 . j )) by A48,A81,FUNCT_1:49,PARTFUN1:def 6;
(( b2m . j ) = ( b2 . j ) & ( b2 /. j ) = ( b2 . j )) by A9,A46,A48,A45,A81,FINSEQ_1:def 7,PARTFUN1:def 6;
then ( F . ( b1 /. j ) ) = ( L * ( b2 /. j ) ) by A45,A81,A82,A83,A84,PARTFUN1:def 6,VECTSP_4:14;
then A85: j in FF by A48,A81;
j <= m by A40,A81,FINSEQ_3:25;
hence thesis by A38,A80,A85,ZFMISC_1:56;
end;
then FF1 = ( FF \ { Lb } ) by A70,XBOOLE_0:def 10;
then ( card FF1 ) = n by A10,A17,STIRL2_1:55;
then consider J being  non-empty (FinSequence_of_Jordan_block of L,K) such that A86: ( AutMt (FL,b1m,b2m) ) = ( block_diagonal (J,( 0. K )) ) by A7,A40,A43,A69;
set JJJ = ( J ^ JJ );
A87: ( Lb - m ) = ( Lb -' m ) by A38,XREAL_1:233;
A88:now
let x;
assume that
A89: x in ( dom JJJ );
reconsider i = x as Nat by A89;
per cases  by A89,FINSEQ_1:25;
suppose A90: i in ( dom J );

then ( J . i ) is non empty by FUNCT_1:def 9;
hence ( JJJ . x ) is non empty by A90,FINSEQ_1:def 7;
end;
suppose A91: (ex j st (j in ( dom JJ ) & i = ( ( len J ) + j )));

( len JB ) = ( Lb -' m ) by CKB2:def 1;
then A92: ( len JB ) <> ( 0 ) by A38,A87;
consider j such that A93: j in ( dom JJ ) and A94: i = ( ( len J ) + j ) by A91;
( dom JJ ) = ( Seg 1 ) by FINSEQ_1:38;
then j = 1 by A93,FINSEQ_1:2,TARSKI:def 1;
then ( JJJ . i ) = ( JJ . 1 ) by A93,A94,FINSEQ_1:def 7;
hence ( JJJ . x ) is non empty by A92,FINSEQ_1:40;
end;
end;
reconsider JB as (Matrix of ( len b19m ),( len b29m ),K) by A8,A38,A41,A87,RFINSEQ:def 1;
A95: ( width JB ) = ( len b19m ) by A41,A42,MATRIX_1:24;
reconsider JJJ as  non-empty (FinSequence_of_Jordan_block of L,K) by A88,FUNCT_1:def 9;
take JJJ;
reconsider F9 = F as (Function of V1,V2);
reconsider B = ( block_diagonal (J,( 0. K )) ) as (Matrix of ( len b1m ),( len b2m ),K) by A86;
A96: ( width B ) = ( len b1m ) by A40,A43,MATRIX_1:24;
A97: (( Sum ( Len <* B,JB *> ) ) = ( ( len B ) + ( len JB ) ) & ( Sum ( Width <* B,JB *> ) ) = ( ( width B ) + ( width JB ) )) by MATRIXJ1:16,MATRIXJ1:20;
( len B ) = ( len b1m ) by A40,A43,MATRIX_1:24;
then reconsider BB = ( block_diagonal (<* B,JB *>,( 0. K )) ) as (Matrix of ( len b1 ),( len b2 ),K) by A8,A40,A41,A42,A97,A96,A95,MATRIX_1:24;
set T = ( Mx2Tran (BB,b1,b2) );
A98: ( dom b19m ) = ( dom b29m ) by A41,A42,FINSEQ_3:29;
A99:now
let x;
assume that
A100: x in ( dom b1 );
reconsider I = x as (Element of ( NAT )) by A100;
A101: ( ( T * b1 ) . x ) = ( T . ( b1 . I ) ) by A100,FUNCT_1:13;
A102: ( b1 . I ) = ( b1 /. I ) by A100,PARTFUN1:def 6;
A103: ( ( F9 * b1 ) . x ) = ( F . ( b1 . I ) ) by A100,FUNCT_1:13;
now
per cases  by A47,A100,FINSEQ_1:25;
suppose A104: I in ( dom b1m );

then A105: (( b1m /. I ) = ( b1m . I ) & ( b1 . I ) = ( b1m . I )) by A47,FINSEQ_1:def 7,PARTFUN1:def 6;
A106: ( FL . ( b1m /. I ) ) = ( F . ( b1m /. I ) ) by FUNCT_1:49;
thus ( ( T * b1 ) . x ) = ( ( Mx2Tran (B,b1m,b2m) ) . ( b1m /. I ) ) by A40,A43,A41,A42,A47,A46,A96,A95,A101,A102,A104,CKB41:1
.= ( FL . ( b1m /. I ) ) by A86,MATRLIN2:34
.= ( ( F9 * b1 ) . x ) by A100,A106,A105,FUNCT_1:13;
end;
suppose (ex j st (j in ( dom b19m ) & I = ( ( len b1m ) + j )));

then consider j such that A107: j in ( dom b19m ) and A108: I = ( ( len b1m ) + j );
now
per cases ;
suppose A109: j = ( len b19m );

A110: (( b2 . I ) = ( b29m . j ) & ( b2 /. I ) = ( b2 . I )) by A9,A40,A43,A46,A98,A100,A107,A108,FINSEQ_1:def 7,PARTFUN1:def 6;
thus ( ( F9 * b1 ) . x ) = ( L * ( b2 /. I ) ) by A11,A16,A15,A40,A41,A103,A102,A108,A109
.= ( L * ( b29m /. j ) ) by A98,A107,A110,PARTFUN1:def 6,VECTSP_4:14
.= ( ( Mx2Tran (JB,b19m,b29m) ) . ( b19m /. j ) ) by A107,A109,CKB45:1;
end;
suppose A111: j <> ( len b19m );

A112: ( ( F9 * b1 ) . x ) = ( ( L * ( b2 /. I ) ) + ( b2 /. ( I + 1 ) ) )
proof
assume ( ( F9 * b1 ) . x ) <> ( ( L * ( b2 /. I ) ) + ( b2 /. ( I + 1 ) ) );
then ( F . ( b1 /. I ) ) = ( L * ( b2 /. I ) ) by A11,A100,A103,A102;
then A113: I in FF by A100;
(I <> Lb & I <= Lb) by A40,A41,A100,A108,A111,FINSEQ_3:25;
then I < Lb by XXREAL_0:1;
then ( ( len b1m ) + j ) <= ( ( len b1m ) + ( 0 ) ) by A39,A40,A108,A113;
then j <= ( 0 ) by XREAL_1:6;
hence thesis by A107,FINSEQ_3:25;
end;
j <= ( len b19m ) by A107,FINSEQ_3:25;
then j < ( len b19m ) by A111,XXREAL_0:1;
then (1 <= ( j + 1 ) & ( j + 1 ) <= ( len b19m )) by NAT_1:11,NAT_1:13;
then A114: ( j + 1 ) in ( dom b19m ) by FINSEQ_3:25;
then (( b29m /. ( j + 1 ) ) = ( b29m . ( j + 1 ) ) & ( b2 . ( ( len b1m ) + ( j + 1 ) ) ) = ( b29m . ( j + 1 ) )) by A40,A43,A46,A98,FINSEQ_1:def 7,PARTFUN1:def 6;
then A115: ( b29m /. ( j + 1 ) ) = ( b2 /. ( I + 1 ) ) by A9,A47,A108,A114,FINSEQ_1:28,PARTFUN1:def 6;
(( b2 . I ) = ( b29m . j ) & ( b2 /. I ) = ( b2 . I )) by A9,A40,A43,A46,A98,A100,A107,A108,FINSEQ_1:def 7,PARTFUN1:def 6;
then ( L * ( b29m /. j ) ) = ( L * ( b2 /. I ) ) by A98,A107,PARTFUN1:def 6,VECTSP_4:14;
then ( ( L * ( b2 /. I ) ) + ( b2 /. ( I + 1 ) ) ) = ( ( L * ( b29m /. j ) ) + ( b29m /. ( j + 1 ) ) ) by A115,VECTSP_4:13
.= ( ( Mx2Tran (JB,b19m,b29m) ) . ( b19m /. j ) ) by A107,A111,CKB45:1;
hence ( ( F9 * b1 ) . x ) = ( ( Mx2Tran (JB,b19m,b29m) ) . ( b19m /. j ) ) by A112;
end;
end;
hence ( ( F9 * b1 ) . x ) = ( ( T * b1 ) . x ) by A40,A43,A41,A42,A47,A46,A96,A95,A101,A102,A107,A108,CKB41:1;
end;
end;
hence ( ( F9 * b1 ) . x ) = ( ( T * b1 ) . x );
end;
A116: ( rng b1 ) c= ( [#] V1 ) by FINSEQ_1:def 4;
( dom T ) = ( [#] V1 ) by FUNCT_2:def 1;
then A117: ( dom ( T * b1 ) ) = ( dom b1 ) by A116,RELAT_1:27;
( dom F ) = ( [#] V1 ) by FUNCT_2:def 1;
then ( dom ( F9 * b1 ) ) = ( dom b1 ) by A116,RELAT_1:27;
then (( block_diagonal (JJJ,( 0. K )) ) = ( block_diagonal (<* B,JB *>,( 0. K )) ) & F = T) by A13,A117,A99,FUNCT_1:2,MATRIXJ1:35,MATRLIN:22;
hence thesis by MATRLIN2:36;
end;
end;
let V1;
let V2;
let b1;
let b2;
let L;
assume that
A118: ( len b1 ) = ( len b2 );
let F being (linear-transformation of V1,V2);
assume that
A119: (for i holds (i in ( dom b1 ) implies (( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) ) or (( i + 1 ) in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( ( L * ( b2 /. i ) ) + ( b2 /. ( i + 1 ) ) )))));
set FF = { i where i is (Element of ( NAT )): (i in ( dom b1 ) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )) };
FF c= ( dom b1 )
proof
let x;
assume x in FF;
then (ex i being (Element of ( NAT )) st ((x = i & i in ( dom b1 )) & ( F . ( b1 /. i ) ) = ( L * ( b2 /. i ) )));
hence thesis;
end;
then reconsider FF as  finite set;
(for n holds P[ n ]) from NAT_1:sch 2(A1,A6);
then P[ ( card FF ) ];
hence thesis by A118,A119;
end;
