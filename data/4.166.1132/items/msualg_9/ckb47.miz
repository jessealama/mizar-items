environ
vocabularies XBOOLE_0,STRUCT_0,MSUALG_1,PBOOLE,FINSET_1,SUBSET_1,CLOSURE2,TARSKI,RELAT_1,FUNCT_1,FINSEQ_1,MARGREL1,NAT_1,PRALG_2,CARD_3,RLVECT_2,MSAFREE,PRELAMB,ZFMISC_1,PRALG_1,MCART_1,EQREL_1,FUNCOP_1,MSUALG_3,TREES_4,LANG1,NUMBERS,MSUALG_2,MEMBER_1,GROUP_6,WELLORD1,PARTFUN1,FUNCT_6,FINSEQ_4,PZFMISC1,CARD_1,MSUALG_4,MSUALG_5,SETFAM_1,FUNCT_4,RELAT_2,MSUALG_9;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,NAT_1,RELAT_1,RELAT_2,STRUCT_0,SETFAM_1,FUNCT_1,PBOOLE,EQREL_1,RELSET_1,PARTFUN1,FUNCT_2,FINSEQ_1,LANG1,MCART_1,FINSET_1,CARD_3,TREES_4,FUNCT_6,DTCONSTR,MSUALG_1,MSUALG_2,PRALG_1,PRALG_3,MSUALG_3,MSAFREE,PRALG_2,FUNCOP_1,MSAFREE2,MSUALG_4,PZFMISC1,MSSUBFAM,CLOSURE2,MSUALG_5,CKB27,CKB28;
definitions FINSEQ_1,FUNCT_1,MSAFREE2,FINSET_1,MSUALG_1,MSUALG_3,PZFMISC1,MSUALG_4,PBOOLE,TARSKI,XBOOLE_0,CKB27,CKB28;
theorems CARD_3,CLOSURE1,CLOSURE2,EXTENS_1,EQREL_1,FINSEQ_1,FUNCOP_1,FUNCT_1,FUNCT_2,MCART_1,MSAFREE,MSAFREE2,MSSUBFAM,MSUALG_1,MSUALG_2,MSUALG_3,MSUALG_4,MSUALG_5,MSUALG_6,MSUALG_7,PARTFUN1,PBOOLE,PRALG_1,PRALG_2,PZFMISC1,RELAT_2,SETFAM_1,TARSKI,RELSET_1,XBOOLE_0,XBOOLE_1,ORDERS_1,RELAT_1,FINSET_1,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18,CKB19,CKB20,CKB21,CKB22,CKB23,CKB24,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB32,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40,CKB41,CKB42,CKB43,CKB44,CKB45,CKB46;
schemes MSSUBFAM,PBOOLE,MSUALG_8;
registrations XBOOLE_0,RELAT_1,ORDINAL1,FUNCT_2,FUNCOP_1,FINSET_1,EQREL_1,PRE_CIRC,PZFMISC1,MSSUBFAM,STRUCT_0,FUNCT_1,MSUALG_1,MSUALG_2,PRALG_2,MSUALG_3,MSAFREE,MSUALG_4,MSUALG_5,CLOSURE2,CARD_3,RELSET_1,PRALG_1,PBOOLE,CKB1,CKB2,CKB3,CKB4,CKB5,CKB6,CKB7,CKB33,CKB34;
constructors SETFAM_1,BINOP_1,PZFMISC1,MSUALG_3,MSAFREE2,MSUALG_5,CLOSURE1,CLOSURE2,PRALG_3,RELSET_1,CIRCUIT1,NAT_1,FUNCT_6,FUNCT_5,CKB27,CKB28;
requirements SUBSET,BOOLE;
begin
reserve S for non empty non void ManySortedSign;
theorem
(for A,B being  non-empty MSAlgebra over S holds (for F being (ManySortedFunction of A,B) holds (F is_homomorphism A,B implies (for C1 being (MSCongruence of A) holds (C1 c= ( MSCng F ) implies (ex H being (ManySortedFunction of ( QuotMSAlg (A,C1) ),B) st (H is_homomorphism ( QuotMSAlg (A,C1) ),B & F = ( H ** ( MSNat_Hom (A,C1) ) ))))))))
proof
let A being  non-empty MSAlgebra over S,B being  non-empty MSAlgebra over S;
let F being (ManySortedFunction of A,B);
assume that
A1: F is_homomorphism A,B;
( MSHomQuot F ) is_monomorphism ( QuotMSAlg (A,( MSCng F )) ),B by A1,MSUALG_4:4;
then A2: ( MSHomQuot F ) is_homomorphism ( QuotMSAlg (A,( MSCng F )) ),B by MSUALG_3:def 9;
let C1 being (MSCongruence of A);
assume that
A3: C1 c= ( MSCng F );
set G = ( MSNat_Hom (A,C1) );
set I = (the carrier of S);
set sQ = (the Sorts of ( QuotMSAlg (A,C1) ));
set sF = (the Sorts of ( QuotMSAlg (A,( MSCng F )) ));
defpred P[ set,set,set ]
 means
(ex s being (Element of I) st (ex xx being (Element of ( (the Sorts of A) . s )) st (($3 = s & $2 = ( Class (C1,xx) )) & $1 = ( Class (( MSCng F ),xx) ))));
A4: (for i being set holds (i in I implies (for x being set holds (x in ( sQ . i ) implies (ex y being set st (y in ( sF . i ) & P[ y,x,i ]))))))
proof
let i being set;
assume i in I;
then reconsider s = i as (Element of I);
let x being set;
assume x in ( sQ . i );
then consider x1 being (Element of ( (the Sorts of A) . s )) such that A5: x = ( Class (C1,x1) ) by CKB42:1;
take y = ( Class (( MSCng F ),x1) );
y in ( Class ( ( MSCng F ) . s ) ) by EQREL_1:def 3;
hence y in ( sF . i ) by MSUALG_4:def 6;
thus thesis by A5;
end;
consider C12 being (ManySortedFunction of sQ,sF) such that A6: (for i being set holds (i in I implies (ex f being (Function of ( sQ . i ),( sF . i )) st (f = ( C12 . i ) & (for x being set holds (x in ( sQ . i ) implies P[ ( f . x ),x,i ])))))) from MSSUBFAM:sch 1(A4);
reconsider H = ( ( MSHomQuot F ) ** C12 ) as (ManySortedFunction of ( QuotMSAlg (A,C1) ),B);
take H;
A7: (for i being (Element of S) holds (for x being (Element of ( (the Sorts of ( QuotMSAlg (A,C1) )) . i )) holds (for xx being (Element of ( (the Sorts of A) . i )) holds (x = ( Class (C1,xx) ) implies ( ( C12 . i ) . x ) = ( Class (( MSCng F ),xx) )))))
proof
let i being (Element of S);
let x being (Element of ( (the Sorts of ( QuotMSAlg (A,C1) )) . i ));
let xx being (Element of ( (the Sorts of A) . i ));
assume that
A8: x = ( Class (C1,xx) );
consider f being (Function of ( sQ . i ),( sF . i )) such that A9: f = ( C12 . i ) and A10: (for x being set holds (x in ( sQ . i ) implies P[ ( f . x ),x,i ])) by A6;
consider s being (Element of I),x1 being (Element of ( (the Sorts of A) . s )) such that A11: i = s and A12: x = ( Class (C1,x1) ) and A13: ( f . x ) = ( Class (( MSCng F ),x1) ) by A10;
xx in ( Class (( C1 . s ),x1) ) by A8,A12,EQREL_1:23;
then A14: [ xx,x1 ] in ( C1 . s ) by EQREL_1:19;
( C1 . s ) c= ( ( MSCng F ) . s ) by A3,PBOOLE:def 2;
then xx in ( Class (( ( MSCng F ) . s ),x1) ) by A14,EQREL_1:19;
hence thesis by A9,A11,A13,EQREL_1:23;
end;
then C12 is_epimorphism ( QuotMSAlg (A,C1) ),( QuotMSAlg (A,( MSCng F )) ) by CKB46:1;
then C12 is_homomorphism ( QuotMSAlg (A,C1) ),( QuotMSAlg (A,( MSCng F )) ) by MSUALG_3:def 8;
hence H is_homomorphism ( QuotMSAlg (A,C1) ),B by A2,MSUALG_3:10;
A15:now
let i being set;
assume i in (the carrier of S);
then reconsider s = i as (SortSymbol of S);
A16: (for x being (Element of ( (the Sorts of A) . s )) holds ( ( ( C12 . s ) * ( G . s ) ) . x ) = ( ( ( MSNat_Hom (A,( MSCng F )) ) . s ) . x ))
proof
let x being (Element of ( (the Sorts of A) . s ));
( Class (( C1 . s ),x) ) in ( Class ( C1 . s ) ) by EQREL_1:def 3;
then A17: ( Class (C1,x) ) in ( ( Class C1 ) . s ) by MSUALG_4:def 6;
thus ( ( ( C12 . s ) * ( G . s ) ) . x ) = ( ( C12 . s ) . ( ( G . s ) . x ) ) by FUNCT_2:15
.= ( ( C12 . s ) . ( ( MSNat_Hom (A,C1,s) ) . x ) ) by MSUALG_4:def 16
.= ( ( C12 . s ) . ( Class (C1,x) ) ) by MSUALG_4:def 15
.= ( Class (( MSCng F ),x) ) by A7,A17
.= ( ( MSNat_Hom (A,( MSCng F ),s) ) . x ) by MSUALG_4:def 15
.= ( ( ( MSNat_Hom (A,( MSCng F )) ) . s ) . x ) by MSUALG_4:def 16;
end;
thus ( ( C12 ** G ) . i ) = ( ( C12 . s ) * ( G . s ) ) by MSUALG_3:2
.= ( ( MSNat_Hom (A,( MSCng F )) ) . i ) by A16,FUNCT_2:63;
end;
thus F = ( ( MSHomQuot F ) ** ( MSNat_Hom (A,( MSCng F )) ) ) by A1,CKB41:1
.= ( ( MSHomQuot F ) ** ( C12 ** G ) ) by A15,PBOOLE:3
.= ( H ** ( MSNat_Hom (A,C1) ) ) by PBOOLE:140;
end;
