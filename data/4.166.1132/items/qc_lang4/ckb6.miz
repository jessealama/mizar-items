environ
vocabularies NUMBERS,SUBSET_1,FINSEQ_1,RELAT_1,TREES_1,XBOOLE_0,ARYTM_3,XXREAL_0,ORDINAL4,CARD_1,FUNCT_1,TARSKI,TREES_2,TREES_9,ORDINAL1,NAT_1,FINSET_1,QC_LANG1,ZF_LANG,CLASSES2,TREES_4,QC_LANG4;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,NUMBERS,XCMPLX_0,NAT_1,RELAT_1,FUNCT_1,FUNCT_2,BINOP_1,FINSET_1,FINSEQ_1,FINSEQ_4,TREES_1,TREES_2,TREES_4,TREES_9,QC_LANG1,QC_LANG2,MCART_1,XXREAL_0,CKB3;
definitions TARSKI,XBOOLE_0,TREES_2,TREES_4,BINOP_1,CKB3;
theorems TARSKI,NAT_1,RELAT_1,FUNCT_1,FINSEQ_1,TREES_1,TREES_2,TREES_9,GRFUNC_1,QC_LANG1,QC_LANG2,XBOOLE_0,XBOOLE_1,FINSEQ_6,XREAL_1,XXREAL_0,ORDINAL1,CKB1,CKB2,CKB3,CKB4,CKB5;
schemes NAT_1,TREES_2,FINSEQ_1,TREES_9;
registrations SUBSET_1,ORDINAL1,RELSET_1,FINSET_1,XREAL_0,NAT_1,FINSEQ_1,TREES_1,TREES_2,TREES_A,TREES_9,CARD_1,RELAT_1;
constructors BINOP_1,XXREAL_0,XREAL_0,NAT_1,FINSEQ_4,TREES_4,TREES_9,QC_LANG2,RELSET_1,CKB3;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
reserve n for (Element of ( NAT ));
definition
let p being (Element of ( QC-WFF ));
func tree_of_subformulae p ->  finite (DecoratedTree of ( QC-WFF ))
means
:Def2: (( it . ( {} ) ) = p & (for x being (Element of ( dom it )) holds ( succ (it,x) ) = ( list_of_immediate_constituents ( it . x ) )));
existence
proof
deffunc F((Element of ( QC-WFF ))) = ( len ( @ $1 ) );
consider W being  finite-branching (DecoratedTree of ( QC-WFF )) such that A1: (( W . ( {} ) ) = p & (for x being (Element of ( dom W )) holds (for w being (Element of ( QC-WFF )) holds (w = ( W . x ) implies ( succ (W,x) ) = ( list_of_immediate_constituents w ))))) from TREES_9:sch 2;
A2: (for t,t9 being (Element of ( dom W )) holds (for d being (Element of ( QC-WFF )) holds ((t9 in ( succ t ) & d = ( W . t9 )) implies F(d) < F(( W . t )))))
proof
let t being (Element of ( dom W )),t9 being (Element of ( dom W ));
let d being (Element of ( QC-WFF ));
assume that
A3: t9 in ( succ t )
and
A4: d = ( W . t9 );
consider n such that A5: t9 = ( t ^ <* n *> ) and ( t ^ <* n *> ) in ( dom W ) by A3;
A6: ( W . t9 ) = ( ( succ (W,t) ) . ( n + 1 ) ) by A5,TREES_9:40
.= ( ( list_of_immediate_constituents ( W . t ) ) . ( n + 1 ) ) by A1;
( dom ( list_of_immediate_constituents ( W . t ) ) ) = ( dom ( succ (W,t) ) ) by A1
.= ( dom ( t succ ) ) by TREES_9:38;
then ( n + 1 ) in ( dom ( list_of_immediate_constituents ( W . t ) ) ) by A5,TREES_9:39;
hence thesis by A4,A6,CKB4:1,QC_LANG2:51;
end;
W is  finite from TREES_9:sch 3(A2);
then reconsider W as  finite (DecoratedTree of ( QC-WFF ));
take W;
thus thesis by A1;
end;
uniqueness
proof
let t1 being  finite (DecoratedTree of ( QC-WFF )),t2 being  finite (DecoratedTree of ( QC-WFF ));
A7: (for t1,t2 being  finite (DecoratedTree of ( QC-WFF )) holds (((( t1 . ( {} ) ) = p & (for x being (Element of ( dom t1 )) holds ( succ (t1,x) ) = ( list_of_immediate_constituents ( t1 . x ) ))) & (( t2 . ( {} ) ) = p & (for x being (Element of ( dom t2 )) holds ( succ (t2,x) ) = ( list_of_immediate_constituents ( t2 . x ) )))) implies t1 c= t2))
proof
let t1 being  finite (DecoratedTree of ( QC-WFF )),t2 being  finite (DecoratedTree of ( QC-WFF ));
assume that
A8: ( t1 . ( {} ) ) = p
and
A9: (for x being (Element of ( dom t1 )) holds ( succ (t1,x) ) = ( list_of_immediate_constituents ( t1 . x ) ))
and
A10: ( t2 . ( {} ) ) = p
and
A11: (for x being (Element of ( dom t2 )) holds ( succ (t2,x) ) = ( list_of_immediate_constituents ( t2 . x ) ));
defpred P[ set ]
 means
($1 in ( dom t2 ) & ( t1 . $1 ) = ( t2 . $1 ));
A12: (for t being (Element of ( dom t1 )) holds (for n holds ((P[ t ] & ( t ^ <* n *> ) in ( dom t1 )) implies P[ ( t ^ <* n *> ) ])))
proof
let t being (Element of ( dom t1 ));
let n;
assume that
A13: P[ t ]
and
A14: ( t ^ <* n *> ) in ( dom t1 );
reconsider t9 = t as (Element of ( dom t2 )) by A13;
A15: ( succ (t1,t) ) = ( list_of_immediate_constituents ( t2 . t9 ) ) by A9,A13
.= ( succ (t2,t9) ) by A11;
( t ^ <* n *> ) in ( succ t ) by A14;
then n < ( card ( succ t ) ) by TREES_9:7;
then n < ( len ( t succ ) ) by TREES_9:def 5;
then n < ( len ( succ (t1,t) ) ) by TREES_9:28;
then n < ( len ( t9 succ ) ) by A15,TREES_9:28;
then n < ( card ( succ t9 ) ) by TREES_9:def 5;
then A16: ( t9 ^ <* n *> ) in ( succ t9 ) by TREES_9:7;
hence ( t ^ <* n *> ) in ( dom t2 );
thus ( t1 . ( t ^ <* n *> ) ) = ( ( succ (t2,t9) ) . ( n + 1 ) ) by A14,A15,TREES_9:40
.= ( t2 . ( t ^ <* n *> ) ) by A16,TREES_9:40;
end;
A17: P[ ( {} ) ] by A8,A10,TREES_1:22;
A18: (for t being (Element of ( dom t1 )) holds P[ t ]) from TREES_2:sch 1(A17,A12);
then (for t being set holds (t in ( dom t1 ) implies t in ( dom t2 )));
then A19: ( dom t1 ) c= ( dom t2 ) by TARSKI:def 3;
(for x being set holds (x in ( dom t1 ) implies ( t1 . x ) = ( t2 . x ))) by A18;
hence thesis by A19,GRFUNC_1:2;
end;
assume ((( t1 . ( {} ) ) = p & (for x being (Element of ( dom t1 )) holds ( succ (t1,x) ) = ( list_of_immediate_constituents ( t1 . x ) ))) & (( t2 . ( {} ) ) = p & (for x being (Element of ( dom t2 )) holds ( succ (t2,x) ) = ( list_of_immediate_constituents ( t2 . x ) ))));
then (t1 c= t2 & t2 c= t1) by A7;
hence thesis by XBOOLE_0:def 10;
end;
end;
