environ
vocabularies NUMBERS,STRUCT_0,ZFMISC_1,RLVECT_1,ALGSTR_0,VECTSP_1,XBOOLE_0,SUPINF_2,MESFUNC1,SUBSET_1,RELAT_1,FINSEQ_1,ARYTM_3,PARTFUN1,TARSKI,CARD_3,NAT_1,ORDINAL4,FUNCT_1,FVSUM_1,ALGSTR_1,BINOP_1,LATTICES,PRE_POLY,ALGSEQ_1,FINSET_1,ARYTM_1,FUNCOP_1,GROUP_1,FUNCT_4,ORDINAL1,XXREAL_0,FINSEQ_2,MEMBER_1,FUNCT_2,CARD_1,POLYNOM1;
notations TARSKI,XBOOLE_0,ZFMISC_1,SUBSET_1,NUMBERS,RELAT_1,FUNCT_1,PBOOLE,RELSET_1,FINSET_1,ORDINAL1,PARTFUN1,FUNCT_2,FINSEQ_1,STRUCT_0,ALGSTR_0,FUNCT_3,XXREAL_0,BINOP_1,NAT_1,ALGSTR_1,RLVECT_1,FINSEQ_2,GROUP_1,VECTSP_1,FUNCOP_1,FUNCT_7,MATRLIN,VFUNCT_1,FVSUM_1,PRE_POLY,RECDEF_1,CKB8,CKB9,CKB21,CKB22,CKB23,CKB24,CKB25,CKB32,CKB34,CKB35,CKB38;
definitions TARSKI,XBOOLE_0,FUNCT_1,FUNCT_2,RLVECT_1,VECTSP_1,GROUP_1,FINSEQ_2,STRUCT_0,ALGSTR_0,FUNCOP_1,CKB8,CKB9,CKB21,CKB22,CKB25,CKB34,CKB35,CKB38;
theorems FUNCT_1,FINSET_1,FINSEQ_3,FINSEQ_4,ZFMISC_1,FINSEQ_1,FUNCT_2,RLVECT_1,VECTSP_1,FUNCOP_1,TARSKI,FUNCT_7,BINOP_1,RELAT_1,MATRLIN,FINSEQ_2,ORDINAL1,FINSEQ_5,NAT_1,PBOOLE,SUBSET_1,FVSUM_1,FUNCT_3,GROUP_1,XBOOLE_0,XBOOLE_1,RLVECT_2,PARTFUN1,XREAL_1,XXREAL_0,PRE_POLY,VFUNCT_1,CKB3,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB18,CKB19,CKB20,CKB21,CKB22,CKB25,CKB26,CKB27,CKB28,CKB29,CKB30,CKB31,CKB33,CKB34,CKB35,CKB36,CKB37,CKB38,CKB39,CKB40;
schemes FRAENKEL,FUNCT_2,FINSEQ_2,FINSEQ_1,FINSEQ_4,SUBSET_1,BINOP_1;
registrations SUBSET_1,RELAT_1,FUNCT_1,FUNCOP_1,FINSET_1,XREAL_0,CARD_1,MEMBERED,FINSEQ_1,FINSEQ_2,STRUCT_0,VECTSP_1,ALGSTR_1,VALUED_0,PRE_POLY,RELSET_1,VFUNCT_1,FUNCT_2,CKB1,CKB2,CKB16,CKB17;
constructors BINOP_1,FINSEQOP,SETWISEO,FINSEQ_4,RFUNCT_3,FUNCT_7,ALGSTR_1,FVSUM_1,MATRLIN,RECDEF_1,RELSET_1,PBOOLE,VFUNCT_1,CKB9,CKB21,CKB22,CKB23,CKB25,CKB32,CKB34,CKB35,CKB38;
requirements NUMERALS,REAL,BOOLE,SUBSET,ARITHM;
begin
definition
let n being Ordinal;
let L being  add-associative  right_complementable  right_zeroed non empty doubleLoopStr;
let p being (Series of n,L);
let q being (Series of n,L);
func p *' q -> (Series of n,L)
means
:Def26: (for b being (bag of n) holds (ex s being (FinSequence of (the carrier of L)) st ((( it . b ) = ( Sum s ) & ( len s ) = ( len ( decomp b ) )) & (for k being (Element of ( NAT )) holds (k in ( dom s ) implies (ex b1,b2 being (bag of n) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( s /. k ) = ( ( p . b1 ) * ( q . b2 ) ))))))));
existence
proof
defpred P[ (Element of ( Bags n )),(Element of L) ]
 means
(ex b being (bag of n) st (b = $1 & (ex s being (FinSequence of (the carrier of L)) st (($2 = ( Sum s ) & ( len s ) = ( len ( decomp b ) )) & (for k being (Element of ( NAT )) holds (k in ( dom s ) implies (ex b1,b2 being (bag of n) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( s /. k ) = ( ( p . b1 ) * ( q . b2 ) )))))))));
A1:now
let bb being (Element of ( Bags n ));
reconsider b = bb as (bag of n);
defpred Q[ Nat,set ]
 means
(ex b1,b2 being (bag of n) st (( ( decomp b ) /. $1 ) = <* b1,b2 *> & $2 = ( ( p . b1 ) * ( q . b2 ) )));
A2:now
let k being Nat;
assume k in ( Seg ( len ( decomp b ) ) );
then k in ( dom ( decomp b ) ) by FINSEQ_1:def 3;
then consider b1 being (bag of n),b2 being (bag of n) such that A3: ( ( decomp b ) /. k ) = <* b1,b2 *> and b = ( b1 + b2 ) by PRE_POLY:68;
reconsider x = ( ( p . b1 ) * ( q . b2 ) ) as (Element of L);
take x;
thus Q[ k,x ] by A3;
end;
consider s being (FinSequence of (the carrier of L)) such that A4: ( len s ) = ( len ( decomp b ) ) and A5: (for k being Nat holds (k in ( Seg ( len ( decomp b ) ) ) implies Q[ k,( s /. k ) ])) from FINSEQ_4:sch 1(A2);
reconsider y = ( Sum s ) as (Element of L);
take y;
thus P[ bb,y ]
proof
take b;
thus b = bb;
take s;
thus y = ( Sum s );
thus ( len s ) = ( len ( decomp b ) ) by A4;
let k being (Element of ( NAT ));
assume k in ( dom s );
then k in ( Seg ( len ( decomp b ) ) ) by A4,FINSEQ_1:def 3;
hence thesis by A5;
end;

end;
consider P being (Function of ( Bags n ),(the carrier of L)) such that A6: (for b being (Element of ( Bags n )) holds P[ b,( P . b ) ]) from FUNCT_2:sch 3(A1);
reconsider P as (Function of ( Bags n ),L);
reconsider P as (Series of n,L);
take P;
let b being (bag of n);
reconsider bb = b as (Element of ( Bags n )) by PRE_POLY:def 12;
P[ bb,( P . bb ) ] by A6;
hence thesis;
end;
uniqueness
proof
let it1 being (Series of n,L),it2 being (Series of n,L);
assume that
A7: (for b being (bag of n) holds (ex s being (FinSequence of (the carrier of L)) st ((( it1 . b ) = ( Sum s ) & ( len s ) = ( len ( decomp b ) )) & (for k being (Element of ( NAT )) holds (k in ( dom s ) implies (ex b1,b2 being (bag of n) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( s /. k ) = ( ( p . b1 ) * ( q . b2 ) ))))))))
and
A8: (for b being (bag of n) holds (ex s being (FinSequence of (the carrier of L)) st ((( it2 . b ) = ( Sum s ) & ( len s ) = ( len ( decomp b ) )) & (for k being (Element of ( NAT )) holds (k in ( dom s ) implies (ex b1,b2 being (bag of n) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( s /. k ) = ( ( p . b1 ) * ( q . b2 ) ))))))));
reconsider ita = it1,itb = it2 as (Function of ( Bags n ),(the carrier of L));
now
let b being (Element of ( Bags n ));
consider sa being (FinSequence of (the carrier of L)) such that A9: ( ita . b ) = ( Sum sa ) and A10: ( len sa ) = ( len ( decomp b ) ) and A11: (for k being (Element of ( NAT )) holds (k in ( dom sa ) implies (ex b1,b2 being (bag of n) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( sa /. k ) = ( ( p . b1 ) * ( q . b2 ) ))))) by A7;
consider sb being (FinSequence of (the carrier of L)) such that A12: ( itb . b ) = ( Sum sb ) and A13: ( len sb ) = ( len ( decomp b ) ) and A14: (for k being (Element of ( NAT )) holds (k in ( dom sb ) implies (ex b1,b2 being (bag of n) st (( ( decomp b ) /. k ) = <* b1,b2 *> & ( sb /. k ) = ( ( p . b1 ) * ( q . b2 ) ))))) by A8;
now
let k being Nat;
assume A15: (1 <= k & k <= ( len sa ));
then A16: k in ( dom sa ) by FINSEQ_3:25;
then A17: ( sa /. k ) = ( sa . k ) by PARTFUN1:def 6;
A18: k in ( dom sb ) by A10,A13,A15,FINSEQ_3:25;
then A19: ( sb /. k ) = ( sb . k ) by PARTFUN1:def 6;
consider ab1 being (bag of n),ab2 being (bag of n) such that A20: ( ( decomp b ) /. k ) = <* ab1,ab2 *> and A21: ( sa /. k ) = ( ( p . ab1 ) * ( q . ab2 ) ) by A11,A16;
consider bb1 being (bag of n),bb2 being (bag of n) such that A22: ( ( decomp b ) /. k ) = <* bb1,bb2 *> and A23: ( sb /. k ) = ( ( p . bb1 ) * ( q . bb2 ) ) by A14,A18;
ab1 = bb1 by A20,A22,FINSEQ_1:77;
hence ( sa . k ) = ( sb . k ) by A20,A21,A22,A23,A17,A19,FINSEQ_1:77;
end;
hence ( ita . b ) = ( itb . b ) by A9,A10,A12,A13,FINSEQ_1:14;
end;
hence it1 = it2 by FUNCT_2:63;
end;
end;
