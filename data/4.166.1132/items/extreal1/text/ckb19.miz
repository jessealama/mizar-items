environ
vocabularies NUMBERS,SUPINF_1,REAL_1,RELAT_1,XREAL_0,ORDINAL1,XXREAL_0,ARYTM_3,COMPLEX1,CARD_1,ARYTM_1,MEASURE6,FINSEQ_1,CARD_3,FUNCT_1,SUBSET_1,SUPINF_2,NAT_1,FUNCT_2,FUNCOP_1,XBOOLE_0,TARSKI,ORDINAL4,PARTFUN1,RFINSEQ,XCMPLX_0;
notations TARSKI,XBOOLE_0,SUBSET_1,CARD_1,ORDINAL1,NUMBERS,XXREAL_3,XCMPLX_0,XREAL_0,REAL_1,FUNCT_1,RELSET_1,PARTFUN1,BINOP_1,FUNCT_2,SEQ_1,DOMAIN_1,BINOP_2,RFINSEQ,RFUNCT_3,RVSUM_1,FUNCOP_1,FINSEQ_1,FINSEQ_4,XXREAL_0,NAT_1,NAT_D,SUPINF_1,SUPINF_2,MEASURE6,CKB1,CKB3,CKB5,CKB10;
definitions XXREAL_3,XCMPLX_0,CKB5,CKB10;
theorems FUNCT_2,FINSEQ_1,FINSEQ_2,FINSEQ_3,FINSEQ_5,NAT_1,TARSKI,FUNCT_1,INT_1,XCMPLX_1,XBOOLE_0,RFINSEQ,RELAT_1,FUNCOP_1,XREAL_1,XXREAL_0,XREAL_0,PARTFUN1,ORDINAL1,MEASURE6,XXREAL_3,CKB2,CKB4,CKB5,CKB6,CKB7,CKB8,CKB9,CKB10,CKB11,CKB12,CKB13,CKB14,CKB15,CKB16,CKB17,CKB18;
schemes FUNCT_2,FINSEQ_2,NAT_1,RECDEF_1;
registrations XBOOLE_0,SUBSET_1,FUNCT_1,ORDINAL1,RELSET_1,FUNCT_2,FINSET_1,NUMBERS,XXREAL_0,XREAL_0,NAT_1,INT_1,MEMBERED,FINSEQ_1,VALUED_0,CARD_1,XXREAL_3;
constructors BINOP_1,DOMAIN_1,REAL_1,NAT_1,FINSEQ_4,FINSOP_1,RVSUM_1,SUPINF_2,RFINSEQ,RFUNCT_3,MEASURE6,BINARITH,SEQ_1,BINOP_2,SUPINF_1,CLASSES1,NAT_D,RELSET_1,XXREAL_3,FINSEQ_1,FUNCT_1,FUNCT_2,INT_1,FUNCOP_1,CKB1,CKB3,CKB5,CKB10;
requirements NUMERALS,REAL,SUBSET,BOOLE,ARITHM;
begin
theorem
Lm5: (for n,q being Nat holds (for p being (Permutation of ( Seg ( n + 1 ) )) holds (for F,H being (FinSequence of ( ExtREAL )) holds (((((F = ( H * p ) & q in ( Seg ( n + 1 ) )) & ( len H ) = ( n + 1 )) & (not ( -infty ) in ( rng H ))) & (for i being (Element of ( NAT )) holds (i in ( Seg ( n + 1 ) ) implies (((i < q implies ( p . i ) = i) & (i = q implies ( p . i ) = ( n + 1 ))) & (i > q implies ( p . i ) = ( i - 1 )))))) implies ( Sum F ) = ( Sum H )))))
proof
let n being Nat;
let q being Nat;
let p being (Permutation of ( Seg ( n + 1 ) ));
let F being (FinSequence of ( ExtREAL ));
let H being (FinSequence of ( ExtREAL ));
assume that
A1: F = ( H * p )
and
A2: q in ( Seg ( n + 1 ) )
and
A3: ( len H ) = ( n + 1 )
and
A4: (not ( -infty ) in ( rng H ))
and
A5: (for i being (Element of ( NAT )) holds (i in ( Seg ( n + 1 ) ) implies (((i < q implies ( p . i ) = i) & (i = q implies ( p . i ) = ( n + 1 ))) & (i > q implies ( p . i ) = ( i - 1 )))));
A6: 1 <= q by A2,FINSEQ_1:1;
then ( q - 1 ) >= ( 1 - 1 ) by XREAL_1:9;
then A7: ( q -' 1 ) = ( q - 1 ) by XREAL_0:def 2;
set H1 = ( H | n );
A8: H1 = ( ( H1 | ( q -' 1 ) ) ^ ( H1 /^ ( q -' 1 ) ) ) by RFINSEQ:8;
reconsider p9 = p as (FinSequence of ( Seg ( n + 1 ) )) by FINSEQ_2:25;
( dom p ) = ( Seg ( n + 1 ) ) by FUNCT_2:def 1;
then A9: ( len p9 ) = ( n + 1 ) by FINSEQ_1:def 3;
A10: q <= ( n + 1 ) by A2,FINSEQ_1:1;
then A11: ( q -' 1 ) <= ( ( n + 1 ) - 1 ) by A7,XREAL_1:9;
A12: ( dom H ) = ( Seg ( n + 1 ) ) by A3,FINSEQ_1:def 3;
then H is (Function of ( Seg ( n + 1 ) ),( ExtREAL )) by FINSEQ_2:26;
then A13: ( len F ) = ( n + 1 ) by A1,A9,FINSEQ_2:33;
then A14: ( len ( F /^ q ) ) = ( ( n + 1 ) - q ) by A10,RFINSEQ:def 1;
A15: n <= ( n + 1 ) by NAT_1:11;
then A16: ( len ( F | ( q -' 1 ) ) ) = ( q -' 1 ) by A11,A13,FINSEQ_1:59,XXREAL_0:2;
A17: ( dom F ) = ( Seg ( n + 1 ) ) by A13,FINSEQ_1:def 3;
A18: (for i being Nat holds ((1 <= i & i <= ( q -' 1 )) implies ( ( F | ( q -' 1 ) ) . i ) = ( ( H1 | ( q -' 1 ) ) . i )))
proof
let i being Nat;
assume that
A19: 1 <= i
and
A20: i <= ( q -' 1 );
A21: ( ( F | ( q -' 1 ) ) . i ) = ( F . i ) by A20,FINSEQ_3:112;
A22: ( H1 . i ) = ( H . i ) by A11,A20,FINSEQ_3:112,XXREAL_0:2;
A23: ( ( H1 | ( q -' 1 ) ) . i ) = ( H1 . i ) by A20,FINSEQ_3:112;
A24: i < ( ( q -' 1 ) + 1 ) by A20,NAT_1:13;
i <= n by A11,A20,XXREAL_0:2;
then i <= ( n + 1 ) by A15,XXREAL_0:2;
then A25: i in ( Seg ( n + 1 ) ) by A19,FINSEQ_1:1;
then ( F . i ) = ( H . ( p . i ) ) by A1,A17,FUNCT_1:12;
hence thesis by A5,A7,A21,A23,A22,A25,A24;
end;
( ( 0 ) + n ) <= ( 1 + n ) by XREAL_1:6;
then A26: ( len H1 ) = n by A3,FINSEQ_1:59;
then A27: ( len ( H1 | ( q -' 1 ) ) ) = ( q -' 1 ) by A11,FINSEQ_1:59;
A28: ( len ( H1 /^ ( q -' 1 ) ) ) = ( n - ( q - 1 ) ) by A7,A11,A26,RFINSEQ:def 1;
(for i being Nat holds ((1 <= i & i <= ( ( n + 1 ) - q )) implies ( ( F /^ q ) . i ) = ( ( H1 /^ ( q -' 1 ) ) . i )))
proof
reconsider n1 = ( ( n + 1 ) - q ) as (Element of ( NAT )) by A10,INT_1:5;
let i being Nat;
assume that
A29: 1 <= i
and
A30: i <= ( ( n + 1 ) - q );
A31: ( i + q ) <= ( n + 1 ) by A30,XREAL_1:19;
A32: i in ( Seg n1 ) by A29,A30,FINSEQ_1:1;
then i in ( dom ( H1 /^ ( q -' 1 ) ) ) by A28,FINSEQ_1:def 3;
then A33: ( ( H1 /^ ( q -' 1 ) ) . i ) = ( H1 . ( i + ( q -' 1 ) ) ) by A11,A26,RFINSEQ:def 1;
( i + ( q -' 1 ) ) = ( ( i + q ) - 1 ) by A7;
then ( i + ( q -' 1 ) ) <= n by A31,XREAL_1:20;
then A34: ( ( H1 /^ ( q -' 1 ) ) . i ) = ( H . ( ( i + q ) - 1 ) ) by A7,A33,FINSEQ_3:112;
A35: 1 <= ( i + q ) by A29,NAT_1:12;
then ( i + q ) in ( dom F ) by A17,A31,FINSEQ_1:1;
then A36: ( F . ( i + q ) ) = ( H . ( p . ( i + q ) ) ) by A1,FUNCT_1:12;
( dom ( F /^ q ) ) = ( Seg n1 ) by A14,FINSEQ_1:def 3;
then A37: ( ( F /^ q ) . i ) = ( F . ( i + q ) ) by A10,A13,A32,RFINSEQ:def 1;
( i + q ) >= ( 1 + q ) by A29,XREAL_1:6;
then A38: ( i + q ) > q by NAT_1:13;
( i + q ) in ( Seg ( n + 1 ) ) by A31,A35,FINSEQ_1:1;
hence thesis by A5,A37,A34,A36,A38;
end;
then A39: ( F /^ q ) = ( H1 /^ ( q -' 1 ) ) by A14,A28,FINSEQ_1:14;
A40: F = ( ( ( F | ( q -' 1 ) ) ^ <* ( F . q ) *> ) ^ ( F /^ q ) ) by A6,A10,A13,FINSEQ_5:84;
then A41: ( rng F ) = ( ( rng ( ( F | ( q -' 1 ) ) ^ <* ( F . q ) *> ) ) \/ ( rng ( F /^ q ) ) ) by FINSEQ_1:31;
( p . q ) = ( n + 1 ) by A2,A5;
then A42: ( F . q ) = ( H . ( n + 1 ) ) by A1,A2,A17,FUNCT_1:12;
A43: H1 = ( H | ( Seg n ) ) by FINSEQ_1:def 15;
then ( rng H1 ) c= ( rng H ) by RELAT_1:70;
then (not ( -infty ) in ( rng H1 )) by A4;
then A44: (not ( -infty ) in ( ( rng ( H1 | ( q -' 1 ) ) ) \/ ( rng ( H1 /^ ( q -' 1 ) ) ) )) by A8,FINSEQ_1:31;
then A45: (not ( -infty ) in ( rng ( H1 | ( q -' 1 ) ) )) by XBOOLE_0:def 3;
A46: (not ( -infty ) in ( rng F )) by A1,A4,FUNCT_1:14;
then A47: (not ( -infty ) in ( rng ( ( F | ( q -' 1 ) ) ^ <* ( F . q ) *> ) )) by A41,XBOOLE_0:def 3;
then A48: (not ( -infty ) in ( ( rng ( F | ( q -' 1 ) ) ) \/ ( rng <* ( F . q ) *> ) )) by FINSEQ_1:31;
then (not ( -infty ) in ( rng ( F | ( q -' 1 ) ) )) by XBOOLE_0:def 3;
then A49: ( Sum ( F | ( q -' 1 ) ) ) <> ( -infty ) by CKB15:1;
(not ( -infty ) in ( rng <* ( F . q ) *> )) by A48,XBOOLE_0:def 3;
then (not ( -infty ) in { ( F . q ) }) by FINSEQ_1:39;
then A50: ( -infty ) <> ( F . q ) by TARSKI:def 1;
A51: (not ( -infty ) in ( rng ( F /^ q ) )) by A46,A41,XBOOLE_0:def 3;
then A52: ( Sum ( F /^ q ) ) <> ( -infty ) by CKB15:1;
A53: ( H | ( n + 1 ) ) = ( H | ( Seg ( n + 1 ) ) ) by FINSEQ_1:def 15;
( H | ( n + 1 ) ) = H by A3,FINSEQ_1:58;
then A54: H = ( H1 ^ <* ( H . ( n + 1 ) ) *> ) by A12,A43,A53,FINSEQ_1:4,FINSEQ_5:10;
A55: (not ( -infty ) in ( rng ( H1 /^ ( q -' 1 ) ) )) by A44,XBOOLE_0:def 3;
thus ( Sum F ) = ( ( Sum ( ( F | ( q -' 1 ) ) ^ <* ( F . q ) *> ) ) + ( Sum ( F /^ q ) ) ) by A40,A47,A51,CKB16:1
.= ( ( ( Sum ( F | ( q -' 1 ) ) ) + ( F . q ) ) + ( Sum ( F /^ q ) ) ) by CKB13:1
.= ( ( ( Sum ( F | ( q -' 1 ) ) ) + ( Sum ( F /^ q ) ) ) + ( F . q ) ) by A50,A49,A52,XXREAL_3:29
.= ( ( ( Sum ( H1 | ( q -' 1 ) ) ) + ( Sum ( H1 /^ ( q -' 1 ) ) ) ) + ( H . ( n + 1 ) ) ) by A16,A27,A18,A42,A39,FINSEQ_1:14
.= ( ( Sum H1 ) + ( H . ( n + 1 ) ) ) by A8,A45,A55,CKB16:1
.= ( Sum H ) by A54,CKB13:1;
end;
