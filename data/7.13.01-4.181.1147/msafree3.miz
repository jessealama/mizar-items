:: Yet another construction of free algebra
::  by Grzegorz Bancerek and Artur Korni{\l}owicz
::
:: Received August 8, 2001
:: Copyright (c) 2001-2012 Association of Mizar Users
::           (Stowarzyszenie Uzytkownikow Mizara, Bialystok, Poland).
:: This code can be distributed under the GNU General Public Licence
:: version 3.0 or later, or the Creative Commons Attribution-ShareAlike
:: License version 3.0 or later, subject to the binding interpretation
:: detailed in file COPYING.interpretation.
:: See COPYING.GPL and COPYING.CC-BY-SA for the full text of these
:: licenses, or see http://www.gnu.org/licenses/gpl.html and
:: http://creativecommons.org/licenses/by-sa/3.0/.

environ

 vocabularies XBOOLE_0, STRUCT_0, MSUALG_1, CARD_3, RELAT_1, FUNCT_1, SUBSET_1,
      PBOOLE, MSUALG_3, TARSKI, FUNCT_6, MEMBER_1, CATALG_1, ZF_MODEL,
      MSUALG_2, MSAFREE, FUNCOP_1, CARD_1, LANG1, ZFMISC_1, TREES_4, MCART_1,
      MARGREL1, FINSEQ_1, MSATERM, UNIALG_2, DTCONSTR, FINSET_1, TREES_2,
      TREES_9, ZF_LANG1, TREES_3, TREES_A, NUMBERS, ARYTM_3, ORDINAL4,
      XXREAL_0, NAT_1, PARTFUN1, MSUALG_6, PRELAMB;
 notations TARSKI, XBOOLE_0, ZFMISC_1,
      XTUPLE_0, SUBSET_1, DOMAIN_1, RELAT_1, FUNCT_1,
      RELSET_1, STRUCT_0, NUMBERS, ORDINAL1, NAT_1, MCART_1, FINSET_1, CARD_3,
      FINSEQ_1, FINSEQ_2, TREES_1, TREES_2, FUNCT_6, TREES_3, TREES_4,
      DTCONSTR, LANG1, PBOOLE, TREES_9, MSUALG_1, MSUALG_2, MSAFREE, FUNCOP_1,
      MSUALG_3, EQUATION, MSATERM, MSUALG_6, CATALG_1, XXREAL_0;
 constructors DOMAIN_1, TREES_9, MSUALG_3, MSATERM, MSUALG_6, CATALG_1,
      EQUATION, SEQ_4, RELSET_1, XTUPLE_0;
 registrations XBOOLE_0, SUBSET_1, RELAT_1, FUNCT_1, ORDINAL1, FUNCOP_1,
      XREAL_0, FINSEQ_1, TREES_2, TREES_3, TREES_9, STRUCT_0, RELSET_1,
      MSUALG_1, MSUALG_2, MSUALG_3, MSAFREE, MSATERM, INDEX_1, MSUALG_6,
      MSUALG_9, INSTALG1, CATALG_1, MSSUBFAM, PBOOLE, XTUPLE_0;
 requirements BOOLE, SUBSET, NUMERALS;
 definitions TARSKI, XBOOLE_0, PBOOLE, MSUALG_2, MSUALG_6, CATALG_1, XTUPLE_0;
 theorems TARSKI, ZFMISC_1, FUNCT_1, FUNCT_2, FINSEQ_1, FINSEQ_3, NAT_1,
      MCART_1, PBOOLE, RELAT_1, CARD_3, CARD_5, FUNCT_6, TREES_3, MSUALG_1,
      INSTALG1, TREES_4, PRE_CIRC, TREES_1, TREES_2, MSUALG_2, MSUALG_3,
      MSAFREE, MSATERM, EQUATION, MSUALG_6, XBOOLE_0, XBOOLE_1, ORDINAL1,
      PARTFUN1, TREES_9, FINSEQ_2, XTUPLE_0;
 schemes PBOOLE, MSATERM;

begin
registration
let C1 being non  empty non  void ManySortedSign;
let C2 being non  empty MSAlgebra over C1;
cluster ( Union (the Sorts of C2) ) -> non  empty;
coherence
proof
L1: ( dom (the Sorts of C2) ) = (the carrier of C1) by PARTFUN1:def 2;
consider C3 being set such that L2: C3 in (the carrier of C1) and L3: ( (the Sorts of C2) . C3 ) is non  empty by PBOOLE:def 12;
set D1 = the (Element of ( (the Sorts of C2) . C3 ));
L4: D1 in ( (the Sorts of C2) . C3 ) by L3;
thus L5: thesis by L4 , L2 , L1 , CARD_5:2;
end;
end;
definition
let C4 being non  empty non  void ManySortedSign;
let C5 being non  empty MSAlgebra over C4;
mode Element of C5
 is (Element of ( Union (the Sorts of C5) ));
end;
theorem
L8: (for B1 being set holds (for B2 being (ManySortedSet of B1) holds (for B3 being (ManySortedFunction of B1) holds ((B3 is  "1-1" & B2 c= ( doms B3 )) implies ( B3 "" ( B3 .:.: B2 ) ) = B2))))
proof
let C6 being set;
let C7 being (ManySortedSet of C6);
let C8 being (ManySortedFunction of C6);
assume that
L9: C8 is  "1-1"
and
L10: C7 c= ( doms C8 );
L11: ( dom C8 ) = C6 by PARTFUN1:def 2;
L12:
now
let C9 being set;
assume L13: C9 in C6;
L14: ( C8 . C9 ) is  one-to-one by L13 , L9 , L11 , MSUALG_3:def 2;
L15: ( C7 . C9 ) c= ( ( doms C8 ) . C9 ) by L10 , L13 , PBOOLE:def 2;
L16: ( C7 . C9 ) c= ( dom ( C8 . C9 ) ) by L15 , L11 , L13 , FUNCT_6:22;
thus L17: ( ( C8 "" ( C8 .:.: C7 ) ) . C9 ) = ( ( C8 . C9 ) " ( ( C8 .:.: C7 ) . C9 ) ) by L13 , EQUATION:def 1
.= ( ( C8 . C9 ) " ( ( C8 . C9 ) .: ( C7 . C9 ) ) ) by L13 , PBOOLE:def 20
.= ( C7 . C9 ) by L16 , L14 , FUNCT_1:94;
end;
thus L18: thesis by L12 , PBOOLE:3;
end;
definition
let C10 being non  void Signature;
let C11 being (ManySortedSet of (the carrier of C10));
func Free (C10 , C11) ->  strict MSAlgebra over C10 means 
:L19: (ex B4 being (MSSubset of ( FreeMSA ( C11 \/ ( (the carrier of C10) --> { ( 0 ) } ) ) )) st (it = ( GenMSAlg B4 ) & B4 = ( ( Reverse ( C11 \/ ( (the carrier of C10) --> { ( 0 ) } ) ) ) "" C11 )));
uniqueness;
existence
proof
set D2 = (the carrier of C10);
set D3 = ( C11 \/ ( D2 --> { ( 0 ) } ) );
set D4 = ( Reverse D3 );
L20: ( D4 "" C11 ) is (ManySortedSubset of ( FreeGen D3 )) by EQUATION:8;
L21: ( D4 "" C11 ) c= ( FreeGen D3 ) by L20 , PBOOLE:def 18;
L22: ( FreeGen D3 ) c= (the Sorts of ( FreeMSA D3 )) by PBOOLE:def 18;
L23: ( D4 "" C11 ) c= (the Sorts of ( FreeMSA D3 )) by L22 , L21 , PBOOLE:13;
reconsider D5 = ( D4 "" C11 ) as (MSSubset of ( FreeMSA D3 )) by L23 , PBOOLE:def 18;
take ( GenMSAlg D5 );
take D5;
thus L24: thesis;
end;
end;
theorem
L26: (for R1 being set holds (for B5 being non  void Signature holds (for B6 being (ManySortedSet of (the carrier of B5)) holds (for B7 being (SortSymbol of B5) holds ([ R1 , B7 ] in (the carrier of ( DTConMSA B6 )) iff R1 in ( B6 . B7 ))))))
proof
let R1 being set;
let C12 being non  void Signature;
let C13 being (ManySortedSet of (the carrier of C12));
let C14 being (SortSymbol of C12);
L27: ( DTConMSA C13 ) = DTConstrStr (# ( [: (the carrier' of C12) , { (the carrier of C12) } :] \/ ( Union ( coprod C13 ) ) ) , ( REL C13 ) #) by MSAFREE:def 8;
L28: ( dom ( coprod C13 ) ) = (the carrier of C12) by PARTFUN1:def 2;
L29: C14 in (the carrier of C12);
L30: C14 <> (the carrier of C12) by L29;
L31: (not C14 in { (the carrier of C12) }) by L30 , TARSKI:def 1;
L32: (not [ R1 , C14 ] in [: (the carrier' of C12) , { (the carrier of C12) } :]) by L31 , ZFMISC_1:87;
thus L33:now
assume L34: [ R1 , C14 ] in (the carrier of ( DTConMSA C13 ));
L35: [ R1 , C14 ] in ( Union ( coprod C13 ) ) by L34 , L27 , L32 , XBOOLE_0:def 3;
consider R2 being set such that L36: R2 in ( dom ( coprod C13 ) ) and L37: [ R1 , C14 ] in ( ( coprod C13 ) . R2 ) by L35 , CARD_5:2;
L38: ( ( coprod C13 ) . R2 ) = ( coprod (R2 , C13) ) by L36 , MSAFREE:def 3;
consider R3 being set such that L39: R3 in ( C13 . R2 ) and L40: [ R1 , C14 ] = [ R3 , R2 ] by L38 , L36 , L37 , MSAFREE:def 2;
L41: R1 = R3 by L40 , XTUPLE_0:1;
thus L42: R1 in ( C13 . C14 ) by L41 , L39 , L40 , XTUPLE_0:1;
end;
assume L43: R1 in ( C13 . C14 );
L44: [ R1 , C14 ] in ( coprod (C14 , C13) ) by L43 , MSAFREE:def 2;
L45: [ R1 , C14 ] in ( ( coprod C13 ) . C14 ) by L44 , MSAFREE:def 3;
L46: [ R1 , C14 ] in ( Union ( coprod C13 ) ) by L45 , L28 , CARD_5:2;
thus L47: thesis by L46 , L27 , XBOOLE_0:def 3;
end;
theorem
L48: (for R1 being set holds (for B8 being non  void Signature holds (for B9 being  non-empty (ManySortedSet of (the carrier of B8)) holds (for B10 being (ManySortedSet of (the carrier of B8)) holds (for B11 being (SortSymbol of B8) holds ((R1 in ( B10 . B11 ) & R1 in ( B9 . B11 )) iff ( root-tree [ R1 , B11 ] ) in ( ( ( Reverse B9 ) "" B10 ) . B11 )))))))
proof
let R1 being set;
let C15 being non  void Signature;
let C16 being  non-empty (ManySortedSet of (the carrier of C15));
let C17 being (ManySortedSet of (the carrier of C15));
let C18 being (SortSymbol of C15);
L49: ( ( Reverse C16 ) . C18 ) = ( Reverse (C18 , C16) ) by MSAFREE:def 18;
L50: ( dom ( Reverse (C18 , C16) ) ) = ( FreeGen (C18 , C16) ) by FUNCT_2:def 1;
thus L51:now
assume that
L52: R1 in ( C17 . C18 )
and
L53: R1 in ( C16 . C18 );
L54: ( root-tree [ R1 , C18 ] ) in ( FreeGen (C18 , C16) ) by L53 , MSAFREE:def 15;
L55: [ R1 , C18 ] in (the carrier of ( DTConMSA C16 )) by L53 , L26;
L56: ( ( ( Reverse C16 ) . C18 ) . ( root-tree [ R1 , C18 ] ) ) = ( [ R1 , C18 ] `1 ) by L55 , L49 , L54 , MSAFREE:def 17
.= R1;
L57: ( root-tree [ R1 , C18 ] ) in ( ( ( Reverse C16 ) . C18 ) " ( C17 . C18 ) ) by L56 , L49 , L50 , L52 , L54 , FUNCT_1:def 7;
thus L58: ( root-tree [ R1 , C18 ] ) in ( ( ( Reverse C16 ) "" C17 ) . C18 ) by L57 , EQUATION:def 1;
end;
assume L59: ( root-tree [ R1 , C18 ] ) in ( ( ( Reverse C16 ) "" C17 ) . C18 );
L60: ( root-tree [ R1 , C18 ] ) in ( ( ( Reverse C16 ) . C18 ) " ( C17 . C18 ) ) by L59 , EQUATION:def 1;
L61: ( ( Reverse (C18 , C16) ) . ( root-tree [ R1 , C18 ] ) ) in ( C17 . C18 ) by L60 , L49 , FUNCT_1:def 7;
L62: ( root-tree [ R1 , C18 ] ) in ( FreeGen (C18 , C16) ) by L49 , L50 , L60 , FUNCT_1:def 7;
consider R3 being set such that L63: R3 in ( C16 . C18 ) and L64: ( root-tree [ R1 , C18 ] ) = ( root-tree [ R3 , C18 ] ) by L62 , MSAFREE:def 15;
L65: [ R1 , C18 ] = [ R3 , C18 ] by L64 , TREES_4:4;
L66: [ R1 , C18 ] in (the carrier of ( DTConMSA C16 )) by L65 , L63 , L26;
L67: ( [ R1 , C18 ] `1 ) in ( C17 . C18 ) by L66 , L62 , L61 , MSAFREE:def 17;
thus L68: thesis by L67 , L63 , L65 , MCART_1:7;
end;
theorem
L69: (for R1 being set holds (for B12 being non  void Signature holds (for B13 being (ManySortedSet of (the carrier of B12)) holds (for B14 being (SortSymbol of B12) holds (R1 in ( B13 . B14 ) implies ( root-tree [ R1 , B14 ] ) in ( (the Sorts of ( Free (B12 , B13) )) . B14 ))))))
proof
let R1 being set;
let C19 being non  void Signature;
let C20 being (ManySortedSet of (the carrier of C19));
let C21 being (SortSymbol of C19);
assume that
L70: R1 in ( C20 . C21 );
set D6 = ( C20 \/ ( (the carrier of C19) --> { ( 0 ) } ) );
consider C22 being (MSSubset of ( FreeMSA D6 )) such that L71: ( Free (C19 , C20) ) = ( GenMSAlg C22 ) and L72: C22 = ( ( Reverse D6 ) "" C20 ) by L19;
L73: C22 is (MSSubset of ( Free (C19 , C20) )) by L71 , MSUALG_2:def 17;
L74: C22 c= (the Sorts of ( Free (C19 , C20) )) by L73 , PBOOLE:def 18;
L75: ( C22 . C21 ) c= ( (the Sorts of ( Free (C19 , C20) )) . C21 ) by L74 , PBOOLE:def 2;
L76: C20 c= D6 by PBOOLE:14;
L77: ( C20 . C21 ) c= ( D6 . C21 ) by L76 , PBOOLE:def 2;
L78: ( root-tree [ R1 , C21 ] ) in ( C22 . C21 ) by L77 , L70 , L72 , L48;
thus L79: thesis by L78 , L75;
end;
theorem
L80: (for B15 being non  void Signature holds (for B16 being (ManySortedSet of (the carrier of B15)) holds (for B17 being (OperSymbol of B15) holds (( the_arity_of B17 ) = ( {} ) implies ( root-tree [ B17 , (the carrier of B15) ] ) in ( (the Sorts of ( Free (B15 , B16) )) . ( the_result_sort_of B17 ) )))))
proof
let C23 being non  void Signature;
let C24 being (ManySortedSet of (the carrier of C23));
let C25 being (OperSymbol of C23);
assume that
L81: ( the_arity_of C25 ) = ( {} );
set D7 = ( C24 \/ ( (the carrier of C23) --> { ( 0 ) } ) );
L82: ( Args (C25 , ( FreeMSA D7 )) ) = ( ( ( (the Sorts of ( FreeMSA D7 )) # ) * (the Arity of C23) ) . C25 ) by MSUALG_1:def 4
.= ( ( (the Sorts of ( FreeMSA D7 )) # ) . ( (the Arity of C23) . C25 ) ) by FUNCT_2:15
.= ( ( (the Sorts of ( FreeMSA D7 )) # ) . ( <*> (the carrier of C23) ) ) by L81 , MSUALG_1:def 1
.= { ( {} ) } by PRE_CIRC:2;
L83: ( dom ( Den (C25 , ( FreeMSA D7 )) ) ) c= { ( {} ) } by L82;
L84: (ex B18 being (MSSubset of ( FreeMSA D7 )) st (( Free (C23 , C24) ) = ( GenMSAlg B18 ) & B18 = ( ( Reverse D7 ) "" C24 ))) by L19;
reconsider D8 = (the Sorts of ( Free (C23 , C24) )) as (MSSubset of ( FreeMSA D7 )) by L84 , MSUALG_2:def 9;
L85: ( ( ( D8 # ) * (the Arity of C23) ) . C25 ) = ( ( D8 # ) . ( (the Arity of C23) . C25 ) ) by FUNCT_2:15
.= ( ( D8 # ) . ( <*> (the carrier of C23) ) ) by L81 , MSUALG_1:def 1
.= { ( {} ) } by PRE_CIRC:2;
L86: ( ( Den (C25 , ( FreeMSA D7 )) ) | ( ( ( D8 # ) * (the Arity of C23) ) . C25 ) ) = ( Den (C25 , ( FreeMSA D7 )) ) by L85 , L83 , RELAT_1:68;
set D9 = the (ArgumentSeq of ( Sym (C25 , D7) ));
reconsider D10 = D9 as (Element of ( Args (C25 , ( FreeMSA D7 )) )) by INSTALG1:1;
L87: D10 = ( {} ) by L82 , TARSKI:def 1;
L88: ( root-tree [ C25 , (the carrier of C23) ] ) = ( [ C25 , (the carrier of C23) ] -tree D10 ) by L87 , TREES_4:20;
L89: ( ( Den (C25 , ( FreeMSA D7 )) ) . D10 ) = ( root-tree [ C25 , (the carrier of C23) ] ) by L88 , INSTALG1:3;
L90: ( root-tree [ C25 , (the carrier of C23) ] ) in ( rng ( Den (C25 , ( FreeMSA D7 )) ) ) by L89 , FUNCT_2:4;
L91: D8 is  opers_closed by L84 , MSUALG_2:def 9;
L92: D8 is_closed_on C25 by L91 , MSUALG_2:def 6;
L93: ( rng ( ( Den (C25 , ( FreeMSA D7 )) ) | ( ( ( D8 # ) * (the Arity of C23) ) . C25 ) ) ) c= ( ( D8 * (the ResultSort of C23) ) . C25 ) by L92 , MSUALG_2:def 5;
L94: ( ( D8 * (the ResultSort of C23) ) . C25 ) = ( D8 . ( (the ResultSort of C23) . C25 ) ) by FUNCT_2:15
.= ( D8 . ( the_result_sort_of C25 ) ) by MSUALG_1:def 2;
thus L95: thesis by L94 , L93 , L86 , L90;
end;
registration
let C26 being non  void Signature;
let C27 being non  empty-yielding (ManySortedSet of (the carrier of C26));
cluster ( Free (C26 , C27) ) -> non  empty;
coherence
proof
consider C28 being set such that L96: C28 in (the carrier of C26) and L97: ( C27 . C28 ) is non  empty by PBOOLE:def 12;
reconsider D11 = C28 as (SortSymbol of C26) by L96;
set D12 = the (Element of ( C27 . D11 ));
L98: ( root-tree [ D12 , D11 ] ) in ( (the Sorts of ( Free (C26 , C27) )) . D11 ) by L97 , L69;
thus L99: (not (the Sorts of ( Free (C26 , C27) )) is  empty-yielding) by L98;
end;
end;
theorem
L101: (for R1 being set holds (for B19 being non  void Signature holds (for B20 being  non-empty (ManySortedSet of (the carrier of B19)) holds (R1 is (Element of ( FreeMSA B20 )) iff R1 is (Term of B19 , B20)))))
proof
let R1 being set;
let C29 being non  void Signature;
let C30 being  non-empty (ManySortedSet of (the carrier of C29));
L102: ( C29 -Terms C30 ) = ( TS ( DTConMSA C30 ) ) by MSATERM:def 1
.= ( union ( rng ( FreeSort C30 ) ) ) by MSAFREE:11
.= ( Union ( FreeSort C30 ) ) by CARD_3:def 4;
L103: ( FreeMSA C30 ) = MSAlgebra (# ( FreeSort C30 ) , ( FreeOper C30 ) #) by MSAFREE:def 14;
thus L104: thesis by L103 , L102;
end;
theorem
L105: (for B21 being non  void Signature holds (for B22 being  non-empty (ManySortedSet of (the carrier of B21)) holds (for B23 being (SortSymbol of B21) holds (for B24 being (Term of B21 , B22) holds (B24 in ( (the Sorts of ( FreeMSA B22 )) . B23 ) iff ( the_sort_of B24 ) = B23)))))
proof
let C31 being non  void Signature;
let C32 being  non-empty (ManySortedSet of (the carrier of C31));
let C33 being (SortSymbol of C31);
L106: ( FreeMSA C32 ) = MSAlgebra (# ( FreeSort C32 ) , ( FreeOper C32 ) #) by MSAFREE:def 14;
L107: ( (the Sorts of ( FreeMSA C32 )) . C33 ) = ( FreeSort (C32 , C33) ) by L106 , MSAFREE:def 11;
thus L108: thesis by L107 , MSATERM:def 5;
end;
theorem
L109: (for B25 being non  void Signature holds (for B26 being non  empty-yielding (ManySortedSet of (the carrier of B25)) holds (for B27 being (Element of ( Free (B25 , B26) )) holds B27 is (Term of B25 , ( B26 \/ ( (the carrier of B25) --> { ( 0 ) } ) )))))
proof
let C34 being non  void Signature;
let C35 being non  empty-yielding (ManySortedSet of (the carrier of C34));
set D13 = ( C35 \/ ( (the carrier of C34) --> { ( 0 ) } ) );
let C36 being (Element of ( Free (C34 , C35) ));
L110: ( C34 -Terms D13 ) = ( TS ( DTConMSA D13 ) ) by MSATERM:def 1
.= ( union ( rng ( FreeSort D13 ) ) ) by MSAFREE:11
.= ( Union ( FreeSort D13 ) ) by CARD_3:def 4;
L111: (( FreeMSA D13 ) = MSAlgebra (# ( FreeSort D13 ) , ( FreeOper D13 ) #) & ( dom (the Sorts of ( FreeMSA D13 )) ) = (the carrier of C34)) by MSAFREE:def 14 , PARTFUN1:def 2;
consider R2 being set such that L112: R2 in ( dom (the Sorts of ( Free (C34 , C35) )) ) and L113: C36 in ( (the Sorts of ( Free (C34 , C35) )) . R2 ) by CARD_5:2;
L114: (ex B28 being (MSSubset of ( FreeMSA D13 )) st (( Free (C34 , C35) ) = ( GenMSAlg B28 ) & B28 = ( ( Reverse D13 ) "" C35 ))) by L19;
L115: (the Sorts of ( Free (C34 , C35) )) is (MSSubset of ( FreeMSA D13 )) by L114 , MSUALG_2:def 9;
L116: (the Sorts of ( Free (C34 , C35) )) c= (the Sorts of ( FreeMSA D13 )) by L115 , PBOOLE:def 18;
L117: ( (the Sorts of ( Free (C34 , C35) )) . R2 ) c= ( (the Sorts of ( FreeMSA D13 )) . R2 ) by L116 , L112 , PBOOLE:def 2;
thus L118: thesis by L117 , L110 , L112 , L113 , L111 , CARD_5:2;
end;
registration
let C37 being non  empty non  void ManySortedSign;
let C38 being non  empty-yielding (ManySortedSet of (the carrier of C37));
cluster  ->  Relation-like  Function-like for (Element of ( Free (C37 , C38) ));
coherence by L109;
end;
registration
let C39 being non  empty non  void ManySortedSign;
let C40 being non  empty-yielding (ManySortedSet of (the carrier of C39));
cluster  ->  finite  DecoratedTree-like for (Element of ( Free (C39 , C40) ));
coherence by L109;
end;
registration
let C41 being non  empty non  void ManySortedSign;
let C42 being non  empty-yielding (ManySortedSet of (the carrier of C41));
cluster  ->  finite-branching for (Element of ( Free (C41 , C42) ));
coherence;
end;
registration
cluster  -> non  empty for DecoratedTree;
coherence by RELAT_1:38;
end;
definition
let C43 being ManySortedSign;
let C44 being non  empty Relation;
func C43 variables_in C44 -> (ManySortedSet of (the carrier of C43)) means 
:L123: (for B29 being set holds (B29 in (the carrier of C43) implies ( it . B29 ) = { ( B30 `1 ) where B30 is (Element of ( rng C44 )) : ( B30 `2 ) = B29 }));
existence
proof
deffunc H1(set) = { ( B31 `1 ) where B31 is (Element of ( rng C44 )) : ( B31 `2 ) = $1 };
L124: (ex B32 being (ManySortedSet of (the carrier of C43)) st (for B33 being set holds (B33 in (the carrier of C43) implies ( B32 . B33 ) = H1(B33)))) from PBOOLE:sch 4;
thus L125: thesis by L124;
end;
uniqueness
proof
let C45 , C46 being (ManySortedSet of (the carrier of C43));
assume that
L126: (for B34 being set holds (B34 in (the carrier of C43) implies ( C45 . B34 ) = { ( B35 `1 ) where B35 is (Element of ( rng C44 )) : ( B35 `2 ) = B34 }))
and
L127: (for B36 being set holds (B36 in (the carrier of C43) implies ( C46 . B36 ) = { ( B37 `1 ) where B37 is (Element of ( rng C44 )) : ( B37 `2 ) = B36 }));
L128:
now
let C47 being set;
assume L129: C47 in (the carrier of C43);
thus L130: ( C45 . C47 ) = { ( B38 `1 ) where B38 is (Element of ( rng C44 )) : ( B38 `2 ) = C47 } by L129 , L126
.= ( C46 . C47 ) by L127 , L129;
end;
thus L131: thesis by L128 , PBOOLE:3;
end;
end;
definition
let C48 being ManySortedSign;
let C49 being (ManySortedSet of (the carrier of C48));
let C50 being non  empty Relation;
func C49 variables_in C50 -> (ManySortedSubset of C49) equals 
( C49 /\ ( C48 variables_in C50 ) );
coherence
proof
thus L133: ( C49 /\ ( C48 variables_in C50 ) ) c= C49 by PBOOLE:15;
end;
end;
theorem
L135: (for B39 being ManySortedSign holds (for B40 being (ManySortedSet of (the carrier of B39)) holds (for B41 being non  empty Relation holds (for B42 being (ManySortedSubset of B40) holds (B42 = ( B40 variables_in B41 ) iff (for B43 being set holds (B43 in (the carrier of B39) implies ( B42 . B43 ) = ( ( B40 . B43 ) /\ { ( B44 `1 ) where B44 is (Element of ( rng B41 )) : ( B44 `2 ) = B43 } ))))))))
proof
let C51 being ManySortedSign;
let C52 being (ManySortedSet of (the carrier of C51));
let C53 being non  empty Relation;
let C54 being (ManySortedSubset of C52);
thus L136:now
assume L137: C54 = ( C52 variables_in C53 );
let C55 being set;
assume L138: C55 in (the carrier of C51);
L139: ( C54 . C55 ) = ( ( C52 . C55 ) /\ ( ( C51 variables_in C53 ) . C55 ) ) by L138 , L137 , PBOOLE:def 5;
thus L140: ( C54 . C55 ) = ( ( C52 . C55 ) /\ { ( B45 `1 ) where B45 is (Element of ( rng C53 )) : ( B45 `2 ) = C55 } ) by L139 , L138 , L123;
end;
assume L141: (for B46 being set holds (B46 in (the carrier of C51) implies ( C54 . B46 ) = ( ( C52 . B46 ) /\ { ( B47 `1 ) where B47 is (Element of ( rng C53 )) : ( B47 `2 ) = B46 } )));
L142:
now
let C56 being set;
assume L143: C56 in (the carrier of C51);
thus L144: ( C54 . C56 ) = ( ( C52 . C56 ) /\ { ( B48 `1 ) where B48 is (Element of ( rng C53 )) : ( B48 `2 ) = C56 } ) by L143 , L141
.= ( ( C52 . C56 ) /\ ( ( C51 variables_in C53 ) . C56 ) ) by L143 , L123;
end;
thus L145: thesis by L142 , PBOOLE:def 5;
end;
theorem
L146: (for B49 being ManySortedSign holds (for B50 , B51 being set holds ((B50 in (the carrier of B49) implies ( ( B49 variables_in ( root-tree [ B51 , B50 ] ) ) . B50 ) = { B51 }) & (for B52 being set holds ((B52 <> B50 or (not B50 in (the carrier of B49))) implies ( ( B49 variables_in ( root-tree [ B51 , B50 ] ) ) . B52 ) = ( {} ))))))
proof
let C57 being ManySortedSign;
let C58 , C59 being set;
reconsider D14 = ( root-tree [ C59 , C58 ] ) as DecoratedTree;
L147: ( [ C59 , C58 ] `2 ) = C58;
L148: D14 = { [ ( {} ) , [ C59 , C58 ] ] } by TREES_4:6;
L149: ( rng D14 ) = { [ C59 , C58 ] } by L148 , RELAT_1:9;
L150: ( [ C59 , C58 ] `1 ) = C59;
thus L151:now
assume L152: C58 in (the carrier of C57);
L153: ( ( C57 variables_in D14 ) . C58 ) = { ( B53 `1 ) where B53 is (Element of ( rng D14 )) : ( B53 `2 ) = C58 } by L152 , L123;
thus L154: ( ( C57 variables_in ( root-tree [ C59 , C58 ] ) ) . C58 ) = { C59 }
proof
thus L155:now
let R2 being set;
assume L156: R2 in ( ( C57 variables_in ( root-tree [ C59 , C58 ] ) ) . C58 );
consider C60 being (Element of ( rng D14 )) such that L157: R2 = ( C60 `1 ) and L158: ( C60 `2 ) = C58 by L156 , L153;
L159: C60 = [ C59 , C58 ] by L149 , TARSKI:def 1;
thus L160: R2 in { C59 } by L159 , L150 , L157 , TARSKI:def 1;
end;
L161: [ C59 , C58 ] in ( rng D14 ) by L149 , TARSKI:def 1;
L162: C59 in { ( B54 `1 ) where B54 is (Element of ( rng D14 )) : ( B54 `2 ) = C58 } by L161 , L150 , L147;
thus L163: thesis by L162 , L153 , ZFMISC_1:31;
end;

end;
let C61 being set;
assume that
L155: (C61 <> C58 or (not C58 in (the carrier of C57)));
set D15 = the (Element of ( ( C57 variables_in ( root-tree [ C59 , C58 ] ) ) . C61 ));
assume L156: ( ( C57 variables_in ( root-tree [ C59 , C58 ] ) ) . C61 ) <> ( {} );
L157: D15 in ( ( C57 variables_in D14 ) . C61 ) by L156;
L158: ( dom ( C57 variables_in D14 ) ) = (the carrier of C57) by PARTFUN1:def 2;
L159: C61 in (the carrier of C57) by L158 , L156 , FUNCT_1:def 2;
L160: ( ( C57 variables_in D14 ) . C61 ) = { ( B55 `1 ) where B55 is (Element of ( rng D14 )) : ( B55 `2 ) = C61 } by L159 , L123;
L161: (ex B56 being (Element of ( rng D14 )) st (D15 = ( B56 `1 ) & ( B56 `2 ) = C61)) by L160 , L157;
thus L162: thesis by L161 , L149 , L147 , L155 , L159 , TARSKI:def 1;
end;
theorem
L163: (for R1 being set holds (for R3 being set holds (for B57 being ManySortedSign holds (for B58 being set holds (B58 in (the carrier of B57) implies (for B59 being  DTree-yielding FinSequence holds (R1 in ( ( B57 variables_in ( [ R3 , (the carrier of B57) ] -tree B59 ) ) . B58 ) iff (ex B60 being DecoratedTree st (B60 in ( rng B59 ) & R1 in ( ( B57 variables_in B60 ) . B58 ))))))))))
proof
let R1 being set;
let R3 being set;
let C62 being ManySortedSign;
let C63 being set;
assume that
L164: C63 in (the carrier of C62);
let C64 being  DTree-yielding FinSequence;
reconsider D16 = ( [ R3 , (the carrier of C62) ] -tree C64 ) as DecoratedTree;
L165: ( ( C62 variables_in D16 ) . C63 ) = { ( B61 `1 ) where B61 is (Element of ( rng D16 )) : ( B61 `2 ) = C63 } by L164 , L123;
L166: ( dom D16 ) = ( tree ( doms C64 ) ) by TREES_4:10;
L167: ( dom ( doms C64 ) ) = ( dom C64 ) by TREES_3:37;
L168: ( len C64 ) = ( len ( doms C64 ) ) by L167 , FINSEQ_3:29;
thus L169:now
assume L170: R1 in ( ( C62 variables_in ( [ R3 , (the carrier of C62) ] -tree C64 ) ) . C63 );
consider C65 being (Element of ( rng D16 )) such that L171: R1 = ( C65 `1 ) and L172: ( C65 `2 ) = C63 by L170 , L165;
consider R2 being set such that L173: R2 in ( dom D16 ) and L174: C65 = ( D16 . R2 ) by FUNCT_1:def 3;
reconsider D17 = R2 as (Element of ( dom D16 )) by L173;
L175: (( D16 . ( {} ) ) = [ R3 , (the carrier of C62) ] & C63 <> (the carrier of C62)) by L164 , TREES_4:def 4;
L176: D17 <> ( {} ) by L175 , L172 , L174 , MCART_1:7;
consider C66 being (Element of ( NAT )), C67 being FinSequence such that L177: C66 < ( len ( doms C64 ) ) and L178: C67 in ( ( doms C64 ) . ( C66 + 1 ) ) and L179: D17 = ( <* C66 *> ^ C67 ) by L176 , L166 , TREES_3:def 15;
L180: (1 <= ( C66 + 1 ) & ( C66 + 1 ) <= ( len ( doms C64 ) )) by L177 , NAT_1:11 , NAT_1:13;
L181: ( C66 + 1 ) in ( dom ( doms C64 ) ) by L180 , FINSEQ_3:25;
reconsider D18 = ( C64 . ( C66 + 1 ) ) as DecoratedTree by L181 , L167 , TREES_3:24;
reconsider D19 = C67 as (FinSequence of ( NAT )) by L179 , FINSEQ_1:36;
take D20 = D18;
thus L182: D20 in ( rng C64 ) by L167 , L181 , FUNCT_1:def 3;
L183: ( ( doms C64 ) . ( C66 + 1 ) ) = ( dom D20 ) by L167 , L181 , FUNCT_6:22;
L184: D20 = ( D16 | <* C66 *> ) by L168 , L177 , TREES_4:def 4;
L185: ( dom D20 ) = ( ( dom D16 ) | <* C66 *> ) by L184 , TREES_2:def 10;
L186: C65 = ( D20 . D19 ) by L185 , L174 , L178 , L179 , L184 , L183 , TREES_2:def 10;
L187: C65 in ( rng D20 ) by L186 , L178 , L183 , FUNCT_1:def 3;
L188: R1 in { ( B62 `1 ) where B62 is (Element of ( rng D20 )) : ( B62 `2 ) = C63 } by L187 , L171 , L172;
thus L189: R1 in ( ( C62 variables_in D20 ) . C63 ) by L188 , L164 , L123;
end;
given C68 being DecoratedTree such that
L190: C68 in ( rng C64 )
and
L191: R1 in ( ( C62 variables_in C68 ) . C63 );

consider R2 being set such that L192: R2 in ( dom C64 ) and L193: C68 = ( C64 . R2 ) by L190 , FUNCT_1:def 3;
reconsider D21 = R2 as (Element of ( NAT )) by L192;
L194: D21 >= 1 by L192 , FINSEQ_3:25;
consider C69 being Nat such that L195: D21 = ( 1 + C69 ) by L194 , NAT_1:10;
reconsider D22 = C69 as (Element of ( NAT )) by ORDINAL1:def 12;
L196: D21 <= ( len C64 ) by L192 , FINSEQ_3:25;
L197: D22 < ( len C64 ) by L196 , L195 , NAT_1:13;
L198: C68 = ( D16 | <* D22 *> ) by L197 , L193 , L195 , TREES_4:def 4;
L199: (( {} ) in ( dom C68 ) & ( <* D22 *> ^ ( {} ) ) = <* D22 *>) by FINSEQ_1:34 , TREES_1:22;
L200: ( dom C68 ) = ( ( doms C64 ) . ( D22 + 1 ) ) by L192 , L193 , L195 , FUNCT_6:22;
L201: <* D22 *> in ( dom D16 ) by L200 , L166 , L168 , L197 , L199 , TREES_3:def 15;
L202: ( rng C68 ) c= ( rng D16 ) by L201 , L198 , TREES_2:32;
L203: R1 in { ( B63 `1 ) where B63 is (Element of ( rng C68 )) : ( B63 `2 ) = C63 } by L164 , L191 , L123;
consider C70 being (Element of ( rng C68 )) such that L204: (R1 = ( C70 `1 ) & ( C70 `2 ) = C63) by L203;
L205: C70 in ( rng C68 );
thus L206: thesis by L205 , L165 , L204 , L202;
end;
theorem
L207: (for B64 being ManySortedSign holds (for B65 being (ManySortedSet of (the carrier of B64)) holds (for B66 , B67 being set holds ((B67 in ( B65 . B66 ) implies ( ( B65 variables_in ( root-tree [ B67 , B66 ] ) ) . B66 ) = { B67 }) & (for B68 being set holds ((B68 <> B66 or (not B67 in ( B65 . B66 ))) implies ( ( B65 variables_in ( root-tree [ B67 , B66 ] ) ) . B68 ) = ( {} )))))))
proof
let C71 being ManySortedSign;
let C72 being (ManySortedSet of (the carrier of C71));
let C73 , C74 being set;
reconsider D23 = ( root-tree [ C74 , C73 ] ) as DecoratedTree;
L208: (( [ C74 , C73 ] `1 ) = C74 & ( [ C74 , C73 ] `2 ) = C73);
thus L209:now
assume L210: C74 in ( C72 . C73 );
L211: { C74 } c= ( C72 . C73 ) by L210 , ZFMISC_1:31;
L212: ( dom C72 ) = (the carrier of C71) by PARTFUN1:def 2;
L213: C73 in (the carrier of C71) by L212 , L210 , FUNCT_1:def 2;
L214: ( ( C71 variables_in ( root-tree [ C74 , C73 ] ) ) . C73 ) = { C74 } by L213 , L146;
L215: ( ( C72 . C73 ) /\ ( ( C71 variables_in ( root-tree [ C74 , C73 ] ) ) . C73 ) ) = { C74 } by L214 , L211 , XBOOLE_1:28;
thus L216: ( ( C72 variables_in ( root-tree [ C74 , C73 ] ) ) . C73 ) = { C74 } by L215 , L213 , PBOOLE:def 5;
end;
let C75 being set;
assume that
L217: (C75 <> C73 or (not C74 in ( C72 . C73 )));
set D24 = the (Element of ( ( C72 variables_in ( root-tree [ C74 , C73 ] ) ) . C75 ));
assume L218: ( ( C72 variables_in ( root-tree [ C74 , C73 ] ) ) . C75 ) <> ( {} );
L219: ( dom ( C72 variables_in D23 ) ) = (the carrier of C71) by PARTFUN1:def 2;
L220: C75 in (the carrier of C71) by L219 , L218 , FUNCT_1:def 2;
L221: ( ( C72 variables_in D23 ) . C75 ) = ( ( C72 . C75 ) /\ { ( B69 `1 ) where B69 is (Element of ( rng D23 )) : ( B69 `2 ) = C75 } ) by L220 , L135;
L222: D24 in { ( B70 `1 ) where B70 is (Element of ( rng D23 )) : ( B70 `2 ) = C75 } by L221 , L218 , XBOOLE_0:def 4;
consider C76 being (Element of ( rng D23 )) such that L223: (D24 = ( C76 `1 ) & ( C76 `2 ) = C75) by L222;
L224: D23 = { [ ( {} ) , [ C74 , C73 ] ] } by TREES_4:6;
L225: ( rng D23 ) = { [ C74 , C73 ] } by L224 , RELAT_1:9;
L226: C76 = [ C74 , C73 ] by L225 , TARSKI:def 1;
thus L227: thesis by L226 , L208 , L217 , L218 , L221 , L223 , XBOOLE_0:def 4;
end;
theorem
L228: (for R1 being set holds (for R3 being set holds (for B71 being ManySortedSign holds (for B72 being (ManySortedSet of (the carrier of B71)) holds (for B73 being set holds (B73 in (the carrier of B71) implies (for B74 being  DTree-yielding FinSequence holds (R1 in ( ( B72 variables_in ( [ R3 , (the carrier of B71) ] -tree B74 ) ) . B73 ) iff (ex B75 being DecoratedTree st (B75 in ( rng B74 ) & R1 in ( ( B72 variables_in B75 ) . B73 )))))))))))
proof
let R1 being set;
let R3 being set;
let C77 being ManySortedSign;
let C78 being (ManySortedSet of (the carrier of C77));
let C79 being set;
assume that
L229: C79 in (the carrier of C77);
let C80 being  DTree-yielding FinSequence;
reconsider D25 = ( [ R3 , (the carrier of C77) ] -tree C80 ) as DecoratedTree;
L230: ( ( C78 variables_in D25 ) . C79 ) = ( ( C78 . C79 ) /\ ( ( C77 variables_in D25 ) . C79 ) ) by L229 , PBOOLE:def 5;
L231: (R1 in ( ( C78 variables_in ( [ R3 , (the carrier of C77) ] -tree C80 ) ) . C79 ) iff (R1 in ( C78 . C79 ) & R1 in ( ( C77 variables_in ( [ R3 , (the carrier of C77) ] -tree C80 ) ) . C79 ))) by L230 , XBOOLE_0:def 4;
L232: (R1 in ( ( C78 variables_in ( [ R3 , (the carrier of C77) ] -tree C80 ) ) . C79 ) iff (R1 in ( C78 . C79 ) & (ex B76 being DecoratedTree st (B76 in ( rng C80 ) & R1 in ( ( C77 variables_in B76 ) . C79 ))))) by L231 , L229 , L163;
thus L233:now
assume L234: R1 in ( ( C78 variables_in ( [ R3 , (the carrier of C77) ] -tree C80 ) ) . C79 );
consider C81 being DecoratedTree such that L235: C81 in ( rng C80 ) and L236: (R1 in ( C78 . C79 ) & R1 in ( ( C77 variables_in C81 ) . C79 )) by L234 , L232;
take D26 = C81;
thus L237: D26 in ( rng C80 ) by L235;
L238: R1 in ( ( C78 . C79 ) /\ ( ( C77 variables_in D26 ) . C79 ) ) by L236 , XBOOLE_0:def 4;
thus L239: R1 in ( ( C78 variables_in D26 ) . C79 ) by L238 , L229 , PBOOLE:def 5;
end;
given C82 being DecoratedTree such that
L240: C82 in ( rng C80 )
and
L241: R1 in ( ( C78 variables_in C82 ) . C79 );

L242: ( ( C78 variables_in C82 ) . C79 ) = ( ( C78 . C79 ) /\ ( ( C77 variables_in C82 ) . C79 ) ) by L229 , PBOOLE:def 5;
L243: R1 in ( ( C77 variables_in C82 ) . C79 ) by L242 , L241 , XBOOLE_0:def 4;
thus L244: thesis by L243 , L229 , L231 , L240 , L241 , L242 , L163 , XBOOLE_0:def 4;
end;
theorem
L245: (for B77 being non  void Signature holds (for B78 being  non-empty (ManySortedSet of (the carrier of B77)) holds (for B79 being (Term of B77 , B78) holds ( B77 variables_in B79 ) c= B78)))
proof
let C83 being non  void Signature;
let C84 being  non-empty (ManySortedSet of (the carrier of C83));
defpred S1[ DecoratedTree ] means ( C83 variables_in $1 ) c= C84;
L246: (for B80 being (OperSymbol of C83) holds (for B81 being (ArgumentSeq of ( Sym (B80 , C84) )) holds ((for B82 being (Term of C83 , C84) holds (B82 in ( rng B81 ) implies S1[ B82 ])) implies S1[ ( [ B80 , (the carrier of C83) ] -tree B81 ) ])))
proof
let C85 being (OperSymbol of C83);
let C86 being (ArgumentSeq of ( Sym (C85 , C84) ));
assume that
L247: (for B83 being (Term of C83 , C84) holds (B83 in ( rng C86 ) implies ( C83 variables_in B83 ) c= C84));
set D27 = ( [ C85 , (the carrier of C83) ] -tree C86 );
thus L248: ( C83 variables_in D27 ) c= C84
proof
let C87 being set;
assume L249: C87 in (the carrier of C83);
reconsider D28 = C87 as (SortSymbol of C83) by L249;
let R1 being set;
assume L250: R1 in ( ( C83 variables_in D27 ) . C87 );
consider C88 being DecoratedTree such that L251: C88 in ( rng C86 ) and L252: R1 in ( ( C83 variables_in C88 ) . D28 ) by L250 , L163;
consider C89 being set such that L253: C89 in ( dom C86 ) and L254: C88 = ( C86 . C89 ) by L251 , FUNCT_1:def 3;
reconsider D29 = C89 as Nat by L253;
reconsider D30 = ( C86 . D29 ) as (Term of C83 , C84) by L253 , MSATERM:22;
L255: ( C83 variables_in D30 ) c= C84 by L247 , L251 , L254;
L256: ( ( C83 variables_in D30 ) . D28 ) c= ( C84 . D28 ) by L255 , PBOOLE:def 2;
thus L257: thesis by L256 , L252 , L254;
end;

end;
L249: (for B84 being (SortSymbol of C83) holds (for B85 being (Element of ( C84 . B84 )) holds S1[ ( root-tree [ B85 , B84 ] ) ]))
proof
let C90 being (SortSymbol of C83);
let C91 being (Element of ( C84 . C90 ));
thus L250: ( C83 variables_in ( root-tree [ C91 , C90 ] ) ) c= C84
proof
let C92 being set;
assume L251: C92 in (the carrier of C83);
reconsider D31 = C92 as (SortSymbol of C83) by L251;
let R1 being set;
assume L252: R1 in ( ( C83 variables_in ( root-tree [ C91 , C90 ] ) ) . C92 );
L253: (C90 <> D31 implies R1 in ( {} )) by L252 , L146;
L254: (C90 = D31 implies R1 in { C91 }) by L252 , L146;
thus L255: thesis by L254 , L253;
end;

end;
L251: (for B86 being (Term of C83 , C84) holds S1[ B86 ]) from MSATERM:sch 1(L249 , L246);
thus L252: thesis by L251;
end;
definition
let C93 being non  void Signature;
let C94 being  non-empty (ManySortedSet of (the carrier of C93));
let C95 being (Term of C93 , C94);
func variables_in C95 -> (ManySortedSubset of C94) equals 
( C93 variables_in C95 );
correctness
proof
L253: ( C93 variables_in C95 ) c= C94 by L245;
L254: ( C93 variables_in C95 ) = ( C94 variables_in C95 ) by L253 , PBOOLE:23;
thus L255: thesis by L254;
end;
end;
theorem
L257: (for B87 being non  void Signature holds (for B88 being  non-empty (ManySortedSet of (the carrier of B87)) holds (for B89 being (Term of B87 , B88) holds ( variables_in B89 ) = ( B88 variables_in B89 )))) by L245 , PBOOLE:23;
definition
let C96 being non  void Signature;
let C97 being  non-empty (ManySortedSet of (the carrier of C96));
let C98 being (ManySortedSet of (the carrier of C96));
func C96 -Terms (C98 , C97) -> (MSSubset of ( FreeMSA C97 )) means 
:L258: (for B90 being (SortSymbol of C96) holds ( it . B90 ) = { B91 where B91 is (Term of C96 , C97) : (( the_sort_of B91 ) = B90 & ( variables_in B91 ) c= C98) });
existence
proof
deffunc H2((SortSymbol of C96)) = { B92 where B92 is (Term of C96 , C97) : (( the_sort_of B92 ) = $1 & ( variables_in B92 ) c= C98) };
consider C99 being (ManySortedSet of (the carrier of C96)) such that L259: (for B93 being (SortSymbol of C96) holds ( C99 . B93 ) = H2(B93)) from PBOOLE:sch 5;
L260: C99 c= (the Sorts of ( FreeMSA C97 ))
proof
let C100 being set;
assume L261: C100 in (the carrier of C96);
reconsider D32 = C100 as (SortSymbol of C96) by L261;
let R1 being set;
assume L262: R1 in ( C99 . C100 );
L263: ( C99 . D32 ) = { B94 where B94 is (Term of C96 , C97) : (( the_sort_of B94 ) = D32 & ( variables_in B94 ) c= C98) } by L259;
L264: (ex B95 being (Term of C96 , C97) st (R1 = B95 & ( the_sort_of B95 ) = D32 & ( variables_in B95 ) c= C98)) by L263 , L262;
thus L265: thesis by L264 , L105;
end;
reconsider D33 = C99 as (MSSubset of ( FreeMSA C97 )) by L260 , PBOOLE:def 18;
take D33;
thus L266: thesis by L259;
end;
correctness
proof
let C101 , C102 being (MSSubset of ( FreeMSA C97 ));
assume that
L267: (for B96 being (SortSymbol of C96) holds ( C101 . B96 ) = { B97 where B97 is (Term of C96 , C97) : (( the_sort_of B97 ) = B96 & ( variables_in B97 ) c= C98) })
and
L268: (for B98 being (SortSymbol of C96) holds ( C102 . B98 ) = { B99 where B99 is (Term of C96 , C97) : (( the_sort_of B99 ) = B98 & ( variables_in B99 ) c= C98) });
L269:
now
let C103 being set;
assume L270: C103 in (the carrier of C96);
thus L271: ( C101 . C103 ) = { B100 where B100 is (Term of C96 , C97) : (( the_sort_of B100 ) = C103 & ( variables_in B100 ) c= C98) } by L270 , L267
.= ( C102 . C103 ) by L268 , L270;
end;
thus L272: thesis by L269 , PBOOLE:3;
end;
end;
theorem
L274: (for R1 being set holds (for B101 being non  void Signature holds (for B102 being  non-empty (ManySortedSet of (the carrier of B101)) holds (for B103 being (ManySortedSet of (the carrier of B101)) holds (for B104 being (SortSymbol of B101) holds (R1 in ( ( B101 -Terms (B103 , B102) ) . B104 ) implies R1 is (Term of B101 , B102)))))))
proof
let R1 being set;
let C104 being non  void Signature;
let C105 being  non-empty (ManySortedSet of (the carrier of C104));
let C106 being (ManySortedSet of (the carrier of C104));
let C107 being (SortSymbol of C104);
assume L275: R1 in ( ( C104 -Terms (C106 , C105) ) . C107 );
L276: R1 in { B105 where B105 is (Term of C104 , C105) : (( the_sort_of B105 ) = C107 & ( variables_in B105 ) c= C106) } by L275 , L258;
L277: (ex B106 being (Term of C104 , C105) st (R1 = B106 & ( the_sort_of B106 ) = C107 & ( variables_in B106 ) c= C106)) by L276;
thus L278: thesis by L277;
end;
theorem
L279: (for B107 being non  void Signature holds (for B108 being  non-empty (ManySortedSet of (the carrier of B107)) holds (for B109 being (ManySortedSet of (the carrier of B107)) holds (for B110 being (Term of B107 , B108) holds (for B111 being (SortSymbol of B107) holds (B110 in ( ( B107 -Terms (B109 , B108) ) . B111 ) implies (( the_sort_of B110 ) = B111 & ( variables_in B110 ) c= B109)))))))
proof
let C108 being non  void Signature;
let C109 being  non-empty (ManySortedSet of (the carrier of C108));
let C110 being (ManySortedSet of (the carrier of C108));
let C111 being (Term of C108 , C109);
let C112 being (SortSymbol of C108);
assume that
L280: C111 in ( ( C108 -Terms (C110 , C109) ) . C112 );
L281: ( ( C108 -Terms (C110 , C109) ) . C112 ) = { B112 where B112 is (Term of C108 , C109) : (( the_sort_of B112 ) = C112 & ( variables_in B112 ) c= C110) } by L258;
L282: (ex B113 being (Term of C108 , C109) st (C111 = B113 & ( the_sort_of B113 ) = C112 & ( variables_in B113 ) c= C110)) by L281 , L280;
thus L283: thesis by L282;
end;
theorem
L284: (for R1 being set holds (for B114 being non  void Signature holds (for B115 being  non-empty (ManySortedSet of (the carrier of B114)) holds (for B116 being (ManySortedSet of (the carrier of B114)) holds (for B117 being (SortSymbol of B114) holds (( root-tree [ R1 , B117 ] ) in ( ( B114 -Terms (B116 , B115) ) . B117 ) iff (R1 in ( B116 . B117 ) & R1 in ( B115 . B117 ))))))))
proof
let R1 being set;
let C113 being non  void Signature;
let C114 being  non-empty (ManySortedSet of (the carrier of C113));
let C115 being (ManySortedSet of (the carrier of C113));
let C116 being (SortSymbol of C113);
L285: ( ( C113 -Terms (C115 , C114) ) . C116 ) = { B118 where B118 is (Term of C113 , C114) : (( the_sort_of B118 ) = C116 & ( variables_in B118 ) c= C115) } by L258;
thus L286:now
assume L287: ( root-tree [ R1 , C116 ] ) in ( ( C113 -Terms (C115 , C114) ) . C116 );
consider C117 being (Term of C113 , C114) such that L288: ( root-tree [ R1 , C116 ] ) = C117 and L289: ( the_sort_of C117 ) = C116 and L290: ( variables_in C117 ) c= C115 by L287 , L285;
L291: ( C117 . ( {} ) ) = [ R1 , C116 ] by L288 , TREES_4:3;
L292: C116 in (the carrier of C113);
L293: C116 <> (the carrier of C113) by L292;
L294: (not C116 in { (the carrier of C113) }) by L293 , TARSKI:def 1;
L295: (not ( C117 . ( {} ) ) in [: (the carrier' of C113) , { (the carrier of C113) } :]) by L294 , L291 , ZFMISC_1:87;
consider C118 being (SortSymbol of C113), C119 being (Element of ( C114 . C118 )) such that L296: ( C117 . ( {} ) ) = [ C119 , C118 ] by L295 , MSATERM:2;
L297: (C116 = C118 & R1 = C119) by L291 , L296 , XTUPLE_0:1;
L298: (( ( C113 variables_in C117 ) . C116 ) = { R1 } & ( ( variables_in C117 ) . C116 ) c= ( C115 . C116 )) by L288 , L290 , L146 , PBOOLE:def 2;
thus L299: (R1 in ( C115 . C116 ) & R1 in ( C114 . C116 )) by L298 , L297 , ZFMISC_1:31;
end;
assume that
L300: R1 in ( C115 . C116 )
and
L301: R1 in ( C114 . C116 );
reconsider D34 = ( root-tree [ R1 , C116 ] ) as (Term of C113 , C114) by L301 , MSATERM:4;
L302: ( variables_in D34 ) c= C115
proof
let C120 being set;
assume L303: C120 in (the carrier of C113);
L304: ( ( C113 variables_in D34 ) . C116 ) = { R1 } by L146;
L305: (C120 <> C116 implies ( ( C113 variables_in D34 ) . C120 ) = ( {} )) by L146;
thus L306: thesis by L305 , L300 , L304 , XBOOLE_1:2 , ZFMISC_1:31;
end;
L307: ( the_sort_of D34 ) = C116 by L301 , MSATERM:14;
thus L308: thesis by L307 , L285 , L302;
end;
theorem
L309: (for B119 being non  void Signature holds (for B120 being  non-empty (ManySortedSet of (the carrier of B119)) holds (for B121 being (ManySortedSet of (the carrier of B119)) holds (for B122 being (OperSymbol of B119) holds (for B123 being (ArgumentSeq of ( Sym (B122 , B120) )) holds (( ( Sym (B122 , B120) ) -tree B123 ) in ( ( B119 -Terms (B121 , B120) ) . ( the_result_sort_of B122 ) ) iff ( rng B123 ) c= ( Union ( B119 -Terms (B121 , B120) ) )))))))
proof
let C121 being non  void Signature;
let C122 being  non-empty (ManySortedSet of (the carrier of C121));
let C123 being (ManySortedSet of (the carrier of C121));
let C124 being (OperSymbol of C121);
let C125 being (ArgumentSeq of ( Sym (C124 , C122) ));
set D35 = ( the_result_sort_of C124 );
L310: ( dom ( C121 -Terms (C123 , C122) ) ) = (the carrier of C121) by PARTFUN1:def 2;
L311: ( Sym (C124 , C122) ) = [ C124 , (the carrier of C121) ] by MSAFREE:def 9;
L312: ( ( C121 -Terms (C123 , C122) ) . D35 ) = { B124 where B124 is (Term of C121 , C122) : (( the_sort_of B124 ) = D35 & ( variables_in B124 ) c= C123) } by L258;
thus L313:now
assume L314: ( ( Sym (C124 , C122) ) -tree C125 ) in ( ( C121 -Terms (C123 , C122) ) . D35 );
consider C126 being (Term of C121 , C122) such that L315: ( [ C124 , (the carrier of C121) ] -tree C125 ) = C126 and L316: ( the_sort_of C126 ) = D35 and L317: ( variables_in C126 ) c= C123 by L314 , L312 , L311;
thus L318: ( rng C125 ) c= ( Union ( C121 -Terms (C123 , C122) ) )
proof
let R2 being set;
assume L319: R2 in ( rng C125 );
consider R1 being set such that L320: R1 in ( dom C125 ) and L321: R2 = ( C125 . R1 ) by L319 , FUNCT_1:def 3;
reconsider D36 = R1 as Nat by L320;
reconsider D37 = ( C125 . D36 ) as (Term of C121 , C122) by L320 , MSATERM:22;
L322: ( variables_in D37 ) c= C123
proof
let R3 being set;
assume L323: R3 in (the carrier of C121);
let C127 being set;
assume L324: C127 in ( ( variables_in D37 ) . R3 );
L325: C127 in ( ( variables_in C126 ) . R3 ) by L324 , L315 , L319 , L321 , L323 , L163;
L326: ( ( variables_in C126 ) . R3 ) c= ( C123 . R3 ) by L317 , L323 , PBOOLE:def 2;
thus L327: thesis by L326 , L325;
end;
set D38 = ( the_sort_of D37 );
L328: ( ( C121 -Terms (C123 , C122) ) . D38 ) = { B125 where B125 is (Term of C121 , C122) : (( the_sort_of B125 ) = D38 & ( variables_in B125 ) c= C123) } by L258;
L329: D37 in ( ( C121 -Terms (C123 , C122) ) . D38 ) by L328 , L322;
thus L330: thesis by L329 , L310 , L321 , CARD_5:2;
end;

end;
set D39 = ( ( Sym (C124 , C122) ) -tree C125 );
assume L319: ( rng C125 ) c= ( Union ( C121 -Terms (C123 , C122) ) );
L320: ( variables_in D39 ) c= C123
proof
let R3 being set;
assume L321: R3 in (the carrier of C121);
let R1 being set;
assume L322: R1 in ( ( variables_in D39 ) . R3 );
consider C128 being DecoratedTree such that L323: C128 in ( rng C125 ) and L324: R1 in ( ( C121 variables_in C128 ) . R3 ) by L322 , L311 , L321 , L163;
consider R2 being set such that L325: R2 in (the carrier of C121) and L326: C128 in ( ( C121 -Terms (C123 , C122) ) . R2 ) by L310 , L319 , L323 , CARD_5:2;
L327: ( ( C121 -Terms (C123 , C122) ) . R2 ) = { B126 where B126 is (Term of C121 , C122) : (( the_sort_of B126 ) = R2 & ( variables_in B126 ) c= C123) } by L325 , L258;
consider C129 being (Term of C121 , C122) such that L328: C128 = C129 and L329: ( the_sort_of C129 ) = R2 and L330: ( variables_in C129 ) c= C123 by L327 , L326;
L331: ( ( variables_in C129 ) . R3 ) c= ( C123 . R3 ) by L321 , L330 , PBOOLE:def 2;
thus L332: thesis by L331 , L324 , L328;
end;
L333: ( the_sort_of D39 ) = D35 by MSATERM:20;
thus L334: thesis by L333 , L312 , L320;
end;
theorem
L335: (for B127 being non  void Signature holds (for B128 being  non-empty (ManySortedSet of (the carrier of B127)) holds (for B129 being (MSSubset of ( FreeMSA B128 )) holds (B129 is  opers_closed iff (for B130 being (OperSymbol of B127) holds (for B131 being (ArgumentSeq of ( Sym (B130 , B128) )) holds (( rng B131 ) c= ( Union B129 ) implies ( ( Sym (B130 , B128) ) -tree B131 ) in ( B129 . ( the_result_sort_of B130 ) ))))))))
proof
let C130 being non  void Signature;
let C131 being  non-empty (ManySortedSet of (the carrier of C130));
set D40 = ( FreeMSA C131 );
let C132 being (MSSubset of ( FreeMSA C131 ));
thus L336:now
assume L337: C132 is  opers_closed;
let C133 being (OperSymbol of C130);
let C134 being (ArgumentSeq of ( Sym (C133 , C131) ));
L338: C132 is_closed_on C133 by L337 , MSUALG_2:def 6;
L339: ( rng ( ( Den (C133 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C133 ) ) ) c= ( ( C132 * (the ResultSort of C130) ) . C133 ) by L338 , MSUALG_2:def 5;
L340: C134 is (Element of ( Args (C133 , D40) )) by INSTALG1:1;
L341: ( dom C134 ) = ( dom ( the_arity_of C133 ) ) by MSATERM:22;
L342: ( dom C132 ) = (the carrier of C130) by PARTFUN1:def 2;
assume L343: ( rng C134 ) c= ( Union C132 );
L344:
now
let R1 being set;
assume L345: R1 in ( dom ( the_arity_of C133 ) );
reconsider D41 = R1 as Nat by L345;
reconsider D42 = ( C134 . D41 ) as (Term of C130 , C131) by L341 , L345 , MSATERM:22;
L346: (( the_sort_of D42 ) = ( ( the_arity_of C133 ) . R1 ) & ( ( C132 * ( the_arity_of C133 ) ) . R1 ) = ( C132 . ( ( the_arity_of C133 ) . R1 ) )) by L341 , L345 , FUNCT_1:13 , MSATERM:23;
L347: ( C134 . R1 ) in ( rng C134 ) by L341 , L345 , FUNCT_1:def 3;
consider R2 being set such that L348: R2 in ( dom C132 ) and L349: ( C134 . R1 ) in ( C132 . R2 ) by L347 , L343 , CARD_5:2;
L350: C132 c= (the Sorts of D40) by PBOOLE:def 18;
L351: ( C132 . R2 ) c= ( (the Sorts of D40) . R2 ) by L350 , L348 , PBOOLE:def 2;
thus L352: ( C134 . R1 ) in ( ( C132 * ( the_arity_of C133 ) ) . R1 ) by L351 , L348 , L349 , L346 , L105;
end;
L353: ( rng ( the_arity_of C133 ) ) c= ( dom C132 ) by L342;
L354: ( dom ( C132 * ( the_arity_of C133 ) ) ) = ( dom ( the_arity_of C133 ) ) by L353 , RELAT_1:27;
L355: C134 in ( product ( C132 * ( the_arity_of C133 ) ) ) by L354 , L341 , L344 , CARD_3:9;
L356: ( ( ( C132 # ) * (the Arity of C130) ) . C133 ) = ( ( C132 # ) . ( (the Arity of C130) . C133 ) ) by FUNCT_2:15
.= ( ( C132 # ) . ( the_arity_of C133 ) ) by MSUALG_1:def 1
.= ( product ( C132 * ( the_arity_of C133 ) ) ) by FINSEQ_2:def 5;
L357: ( ( ( Den (C133 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C133 ) ) . C134 ) = ( ( Den (C133 , D40) ) . C134 ) by L356 , L355 , FUNCT_1:49;
L358: ( dom ( Den (C133 , D40) ) ) = ( Args (C133 , D40) ) by FUNCT_2:def 1;
L359: C134 in ( dom ( ( Den (C133 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C133 ) ) ) by L358 , L356 , L340 , L355 , RELAT_1:57;
L360: ( ( Den (C133 , D40) ) . C134 ) in ( rng ( ( Den (C133 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C133 ) ) ) by L359 , L357 , FUNCT_1:def 3;
L361: ( ( C132 * (the ResultSort of C130) ) . C133 ) = ( C132 . ( (the ResultSort of C130) . C133 ) ) by FUNCT_2:15
.= ( C132 . ( the_result_sort_of C133 ) ) by MSUALG_1:def 2;
L362: ([ C133 , (the carrier of C130) ] = ( Sym (C133 , C131) ) & ( ( Den (C133 , D40) ) . C134 ) in ( C132 . ( the_result_sort_of C133 ) )) by L361 , L339 , L360 , MSAFREE:def 9;
thus L363: ( ( Sym (C133 , C131) ) -tree C134 ) in ( C132 . ( the_result_sort_of C133 ) ) by L362 , L340 , INSTALG1:3;
end;
assume L364: (for B132 being (OperSymbol of C130) holds (for B133 being (ArgumentSeq of ( Sym (B132 , C131) )) holds (( rng B133 ) c= ( Union C132 ) implies ( ( Sym (B132 , C131) ) -tree B133 ) in ( C132 . ( the_result_sort_of B132 ) ))));
let C135 being (OperSymbol of C130);
let C136 being set;
L365: ( ( C132 * (the ResultSort of C130) ) . C135 ) = ( C132 . ( (the ResultSort of C130) . C135 ) ) by FUNCT_2:15
.= ( C132 . ( the_result_sort_of C135 ) ) by MSUALG_1:def 2;
assume L366: C136 in ( rng ( ( Den (C135 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C135 ) ) );
consider R2 being set such that L367: R2 in ( dom ( ( Den (C135 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C135 ) ) ) and L368: C136 = ( ( ( Den (C135 , D40) ) | ( ( ( C132 # ) * (the Arity of C130) ) . C135 ) ) . R2 ) by L366 , FUNCT_1:def 3;
L369: R2 in ( dom ( Den (C135 , D40) ) ) by L367 , RELAT_1:57;
reconsider D43 = R2 as (Element of ( Args (C135 , D40) )) by L369;
reconsider D44 = D43 as (ArgumentSeq of ( Sym (C135 , C131) )) by INSTALG1:1;
L370: ( ( ( C132 # ) * (the Arity of C130) ) . C135 ) = ( ( C132 # ) . ( (the Arity of C130) . C135 ) ) by FUNCT_2:15
.= ( ( C132 # ) . ( the_arity_of C135 ) ) by MSUALG_1:def 1
.= ( product ( C132 * ( the_arity_of C135 ) ) ) by FINSEQ_2:def 5;
L371: ( rng D44 ) c= ( Union C132 )
proof
let R3 being set;
L372: ( dom C132 ) = (the carrier of C130) by PARTFUN1:def 2;
assume L373: R3 in ( rng D44 );
consider C137 being set such that L374: C137 in ( dom D44 ) and L375: R3 = ( D44 . C137 ) by L373 , FUNCT_1:def 3;
L376: ( dom D44 ) = ( dom ( C132 * ( the_arity_of C135 ) ) ) by L367 , L370 , CARD_3:9;
L377: (R3 in ( ( C132 * ( the_arity_of C135 ) ) . C137 ) & ( ( C132 * ( the_arity_of C135 ) ) . C137 ) = ( C132 . ( ( the_arity_of C135 ) . C137 ) )) by L376 , L367 , L370 , L374 , L375 , CARD_3:9 , FUNCT_1:12;
L378: ( rng ( the_arity_of C135 ) ) c= (the carrier of C130);
L379: ( dom ( C132 * ( the_arity_of C135 ) ) ) = ( dom ( the_arity_of C135 ) ) by L378 , L372 , RELAT_1:27;
L380: ( ( the_arity_of C135 ) . C137 ) in ( rng ( the_arity_of C135 ) ) by L379 , L374 , L376 , FUNCT_1:def 3;
thus L381: thesis by L380 , L372 , L377 , CARD_5:2;
end;
L382: C136 = ( ( Den (C135 , D40) ) . D43 ) by L367 , L368 , FUNCT_1:47
.= ( [ C135 , (the carrier of C130) ] -tree D43 ) by INSTALG1:3
.= ( ( Sym (C135 , C131) ) -tree D44 ) by MSAFREE:def 9;
thus L383: thesis by L382 , L364 , L365 , L371;
end;
theorem
L384: (for B134 being non  void Signature holds (for B135 being  non-empty (ManySortedSet of (the carrier of B134)) holds (for B136 being (ManySortedSet of (the carrier of B134)) holds ( B134 -Terms (B136 , B135) ) is  opers_closed)))
proof
let C138 being non  void Signature;
let C139 being  non-empty (ManySortedSet of (the carrier of C138));
let C140 being (ManySortedSet of (the carrier of C138));
L385: (for B137 being (OperSymbol of C138) holds (for B138 being (ArgumentSeq of ( Sym (B137 , C139) )) holds (( rng B138 ) c= ( Union ( C138 -Terms (C140 , C139) ) ) implies ( ( Sym (B137 , C139) ) -tree B138 ) in ( ( C138 -Terms (C140 , C139) ) . ( the_result_sort_of B137 ) )))) by L309;
thus L386: thesis by L385 , L335;
end;
theorem
L387: (for B139 being non  void Signature holds (for B140 being  non-empty (ManySortedSet of (the carrier of B139)) holds (for B141 being (ManySortedSet of (the carrier of B139)) holds ( ( Reverse B140 ) "" B141 ) c= ( B139 -Terms (B141 , B140) ))))
proof
let C141 being non  void Signature;
let C142 being  non-empty (ManySortedSet of (the carrier of C141));
let C143 being (ManySortedSet of (the carrier of C141));
let C144 being set;
assume L388: C144 in (the carrier of C141);
reconsider D45 = C144 as (SortSymbol of C141) by L388;
let R1 being set;
assume L389: R1 in ( ( ( Reverse C142 ) "" C143 ) . C144 );
L390: R1 in ( ( ( Reverse C142 ) . D45 ) " ( C143 . D45 ) ) by L389 , EQUATION:def 1;
L391: R1 in ( dom ( ( Reverse C142 ) . C144 ) ) by L390 , FUNCT_1:def 7;
L392: ( ( ( Reverse C142 ) . C144 ) . R1 ) in ( C143 . C144 ) by L390 , FUNCT_1:def 7;
L393: ( ( Reverse C142 ) . C144 ) = ( Reverse (D45 , C142) ) by MSAFREE:def 18;
L394: ( dom ( ( Reverse C142 ) . C144 ) ) = ( FreeGen (D45 , C142) ) by L393 , FUNCT_2:def 1;
consider C145 being set such that L395: C145 in ( C142 . D45 ) and L396: R1 = ( root-tree [ C145 , D45 ] ) by L394 , L391 , MSAFREE:def 15;
L397: ( FreeGen (D45 , C142) ) = { ( root-tree B142 ) where B142 is (Symbol of ( DTConMSA C142 )) : (B142 in ( Terminals ( DTConMSA C142 ) ) & ( B142 `2 ) = C144) } by MSAFREE:13;
consider C146 being (Symbol of ( DTConMSA C142 )) such that L398: R1 = ( root-tree C146 ) and L399: C146 in ( Terminals ( DTConMSA C142 ) ) and L400: ( C146 `2 ) = C144 by L397 , L391 , L394;
L401: ( ( Reverse (D45 , C142) ) . R1 ) = ( C146 `1 ) by L391 , L394 , L398 , MSAFREE:def 17
.= ( [ C145 , C144 ] `1 ) by L398 , L396 , TREES_4:4
.= C145;
thus L402: thesis by L401 , L392 , L393 , L395 , L396 , L284;
end;
theorem
L403: (for B143 being non  void Signature holds (for B144 being (ManySortedSet of (the carrier of B143)) holds (for B145 being (Term of B143 , ( B144 \/ ( (the carrier of B143) --> { ( 0 ) } ) )) holds (for B146 being (SortSymbol of B143) holds (B145 in ( ( B143 -Terms (B144 , ( B144 \/ ( (the carrier of B143) --> { ( 0 ) } ) )) ) . B146 ) implies B145 in ( (the Sorts of ( Free (B143 , B144) )) . B146 ))))))
proof
let C147 being non  void non  empty ManySortedSign;
let C148 being (ManySortedSet of (the carrier of C147));
set D46 = ( C148 \/ ( (the carrier of C147) --> { ( 0 ) } ) );
set D47 = (the Sorts of ( Free (C147 , C148) ));
defpred S2[ set ] means (for B147 being (SortSymbol of C147) holds ($1 in ( ( C147 -Terms (C148 , D46) ) . B147 ) implies $1 in ( D47 . B147 )));
L404: (ex B148 being (MSSubset of ( FreeMSA D46 )) st (( Free (C147 , C148) ) = ( GenMSAlg B148 ) & B148 = ( ( Reverse D46 ) "" C148 ))) by L19;
reconsider D48 = D47 as (MSSubset of ( FreeMSA D46 )) by L404 , MSUALG_2:def 9;
L405:
now
let C149 being (OperSymbol of C147);
let C150 being (ArgumentSeq of ( Sym (C149 , D46) ));
assume that
L406: (for B149 being (Term of C147 , D46) holds (B149 in ( rng C150 ) implies S2[ B149 ]));
thus L407: S2[ ( [ C149 , (the carrier of C147) ] -tree C150 ) ]
proof
let C151 being (SortSymbol of C147);
assume L408: ( [ C149 , (the carrier of C147) ] -tree C150 ) in ( ( C147 -Terms (C148 , D46) ) . C151 );
L409: ( Sym (C149 , D46) ) = [ C149 , (the carrier of C147) ] by MSAFREE:def 9;
L410: ( the_sort_of ( ( Sym (C149 , D46) ) -tree C150 ) ) = ( the_result_sort_of C149 ) by MSATERM:20;
L411: C151 = ( the_result_sort_of C149 ) by L410 , L408 , L409 , L279;
L412: ( rng C150 ) c= ( Union ( C147 -Terms (C148 , D46) ) ) by L411 , L408 , L409 , L309;
L413: ( rng C150 ) c= ( Union D48 )
proof
let R1 being set;
assume L414: R1 in ( rng C150 );
consider R2 being set such that L415: R2 in ( dom ( C147 -Terms (C148 , D46) ) ) and L416: R1 in ( ( C147 -Terms (C148 , D46) ) . R2 ) by L414 , L412 , CARD_5:2;
reconsider D49 = R2 as (SortSymbol of C147) by L415;
L417: ( ( C147 -Terms (C148 , D46) ) . D49 ) = ( ( C147 -Terms (C148 , D46) ) . D49 );
reconsider D50 = R1 as (Term of C147 , D46) by L417 , L416 , L274;
L418: (( dom D47 ) = (the carrier of C147) & D50 in ( D47 . D49 )) by L406 , L414 , L416 , PARTFUN1:def 2;
thus L419: thesis by L418 , CARD_5:2;
end;
L420: D48 is  opers_closed by L404 , MSUALG_2:def 9;
thus L421: thesis by L420 , L409 , L411 , L413 , L335;
end;

end;
L408: ( C147 -Terms (C148 , D46) ) c= (the Sorts of ( FreeMSA D46 )) by PBOOLE:def 18;
L409:
now
let C152 being (SortSymbol of C147);
let C153 being (Element of ( D46 . C152 ));
thus L410: S2[ ( root-tree [ C153 , C152 ] ) ]
proof
reconsider D51 = ( root-tree [ C153 , C152 ] ) as (Term of C147 , D46) by MSATERM:4;
let C154 being (SortSymbol of C147);
assume L411: ( root-tree [ C153 , C152 ] ) in ( ( C147 -Terms (C148 , D46) ) . C154 );
L412: ( ( C147 -Terms (C148 , D46) ) . C154 ) c= ( (the Sorts of ( FreeMSA D46 )) . C154 ) by L408 , PBOOLE:def 2;
L413: ( the_sort_of D51 ) = C154 by L412 , L411 , L105;
L414: ( the_sort_of D51 ) = C152 by MSATERM:14;
L415: C153 in ( C148 . C154 ) by L414 , L411 , L413 , L284;
thus L416: thesis by L415 , L413 , L414 , L69;
end;

end;
thus L411: (for B150 being (Term of C147 , D46) holds S2[ B150 ]) from MSATERM:sch 1(L409 , L405);
end;
theorem
L412: (for B151 being non  void Signature holds (for B152 being (ManySortedSet of (the carrier of B151)) holds (the Sorts of ( Free (B151 , B152) )) = ( B151 -Terms (B152 , ( B152 \/ ( (the carrier of B151) --> { ( 0 ) } ) )) )))
proof
let C155 being non  void Signature;
let C156 being (ManySortedSet of (the carrier of C155));
set D52 = ( C156 \/ ( (the carrier of C155) --> { ( 0 ) } ) );
set D53 = MSAlgebra (# ( C155 -Terms (C156 , D52) ) , ( Opers (( FreeMSA D52 ) , ( C155 -Terms (C156 , D52) )) ) #);
L413: (for B153 being (MSSubset of ( FreeMSA D52 )) holds (B153 = (the Sorts of D53) implies (B153 is  opers_closed & (the Charact of D53) = ( Opers (( FreeMSA D52 ) , B153) )))) by L384;
reconsider D54 = D53 as (MSSubAlgebra of ( FreeMSA D52 )) by L413 , MSUALG_2:def 9;
L414: (( FreeMSA D52 ) = MSAlgebra (# ( FreeSort D52 ) , ( FreeOper D52 ) #) & ( dom ( FreeSort D52 ) ) = (the carrier of C155)) by MSAFREE:def 14 , PARTFUN1:def 2;
L415: ( ( Reverse D52 ) "" C156 ) c= ( C155 -Terms (C156 , D52) ) by L387;
L416: ( ( Reverse D52 ) "" C156 ) is (MSSubset of D54) by L415 , PBOOLE:def 18;
let C157 being (Element of C155);
L417: (ex B154 being (MSSubset of ( FreeMSA D52 )) st (( Free (C155 , C156) ) = ( GenMSAlg B154 ) & B154 = ( ( Reverse D52 ) "" C156 ))) by L19;
L418: ( Free (C155 , C156) ) is (MSSubAlgebra of D54) by L417 , L416 , MSUALG_2:def 17;
L419: (the Sorts of ( Free (C155 , C156) )) is (MSSubset of D54) by L418 , MSUALG_2:def 9;
L420: (the Sorts of ( Free (C155 , C156) )) c= ( C155 -Terms (C156 , D52) ) by L419 , PBOOLE:def 18;
thus L421: ( (the Sorts of ( Free (C155 , C156) )) . C157 ) c= ( ( C155 -Terms (C156 , D52) ) . C157 ) by L420 , PBOOLE:def 2;
let R1 being set;
assume L422: R1 in ( ( C155 -Terms (C156 , D52) ) . C157 );
L423: ( C155 -Terms (C156 , D52) ) c= (the Sorts of ( FreeMSA D52 )) by PBOOLE:def 18;
L424: ( ( C155 -Terms (C156 , D52) ) . C157 ) c= ( (the Sorts of ( FreeMSA D52 )) . C157 ) by L423 , PBOOLE:def 2;
L425: R1 in ( Union ( FreeSort D52 ) ) by L424 , L422 , L414 , CARD_5:2;
L426: R1 is (Term of C155 , D52) by L425 , MSATERM:13;
thus L427: thesis by L426 , L422 , L403;
end;
theorem
L428: (for B155 being non  void Signature holds (for B156 being (ManySortedSet of (the carrier of B155)) holds ( ( FreeMSA ( B156 \/ ( (the carrier of B155) --> { ( 0 ) } ) ) ) | ( B155 -Terms (B156 , ( B156 \/ ( (the carrier of B155) --> { ( 0 ) } ) )) ) ) = ( Free (B155 , B156) )))
proof
let C158 being non  void Signature;
let C159 being (ManySortedSet of (the carrier of C158));
set D55 = ( C159 \/ ( (the carrier of C158) --> { ( 0 ) } ) );
L429: (( ( FreeMSA D55 ) | ( C158 -Terms (C159 , D55) ) ) = MSAlgebra (# ( C158 -Terms (C159 , D55) ) , ( Opers (( FreeMSA D55 ) , ( C158 -Terms (C159 , D55) )) ) #) & (ex B157 being (MSSubset of ( FreeMSA D55 )) st (( Free (C158 , C159) ) = ( GenMSAlg B157 ) & B157 = ( ( Reverse D55 ) "" C159 )))) by L19 , L384 , MSUALG_2:def 15;
thus L430: thesis by L429 , L412 , MSUALG_2:9;
end;
theorem
L431: (for B158 being non  void Signature holds (for B159 , B160 being  non-empty (ManySortedSet of (the carrier of B158)) holds (for B161 being (MSSubAlgebra of ( FreeMSA B159 )) holds (for B162 being (MSSubAlgebra of ( FreeMSA B160 )) holds ((the Sorts of B161) = (the Sorts of B162) implies ( the MSAlgebra of B161 ) = ( the MSAlgebra of B162 ))))))
proof
let C160 being non  void Signature;
let C161 , C162 being  non-empty (ManySortedSet of (the carrier of C160));
let C163 being (MSSubAlgebra of ( FreeMSA C161 ));
let C164 being (MSSubAlgebra of ( FreeMSA C162 ));
assume that
L432: (the Sorts of C163) = (the Sorts of C164);
reconsider D56 = (the Sorts of C164) as (MSSubset of ( FreeMSA C162 )) by MSUALG_2:def 9;
reconsider D57 = (the Sorts of C163) as (MSSubset of ( FreeMSA C161 )) by MSUALG_2:def 9;
L433: D57 is  opers_closed by MSUALG_2:def 9;
L434: D56 is  opers_closed by MSUALG_2:def 9;
L435:
now
let R1 being set;
L436: (D57 c= (the Sorts of ( FreeMSA C161 )) & (the Sorts of ( FreeMSA C161 )) is (MSSubset of ( FreeMSA C161 ))) by PBOOLE:def 18;
assume L437: R1 in (the carrier' of C160);
reconsider D58 = R1 as (OperSymbol of C160) by L437;
L438: D57 is_closed_on D58 by L433 , MSUALG_2:def 6;
L439: ( (the Charact of C163) . D58 ) = ( ( Opers (( FreeMSA C161 ) , D57) ) . D58 ) by MSUALG_2:def 9
.= ( D58 /. D57 ) by MSUALG_2:def 8
.= ( ( Den (D58 , ( FreeMSA C161 )) ) | ( ( ( D57 # ) * (the Arity of C160) ) . D58 ) ) by L438 , MSUALG_2:def 7;
L440: ( Args (D58 , ( FreeMSA C161 )) ) = ( ( ( (the Sorts of ( FreeMSA C161 )) # ) * (the Arity of C160) ) . D58 ) by MSUALG_1:def 4;
L441: ( dom ( Den (D58 , ( FreeMSA C161 )) ) ) = ( ( ( (the Sorts of ( FreeMSA C161 )) # ) * (the Arity of C160) ) . D58 ) by L440 , FUNCT_2:def 1;
L442: ( dom ( (the Charact of C163) . D58 ) ) = ( ( ( D57 # ) * (the Arity of C160) ) . D58 ) by L441 , L439 , L436 , MSUALG_2:2 , RELAT_1:62;
L443: (D56 c= (the Sorts of ( FreeMSA C162 )) & (the Sorts of ( FreeMSA C162 )) is (MSSubset of ( FreeMSA C162 ))) by PBOOLE:def 18;
L444: ( ( ( D56 # ) * (the Arity of C160) ) . D58 ) c= ( ( ( (the Sorts of ( FreeMSA C162 )) # ) * (the Arity of C160) ) . D58 ) by L443 , MSUALG_2:2;
L445: D56 is_closed_on D58 by L434 , MSUALG_2:def 6;
L446: ( (the Charact of C164) . D58 ) = ( ( Opers (( FreeMSA C162 ) , D56) ) . D58 ) by MSUALG_2:def 9
.= ( D58 /. D56 ) by MSUALG_2:def 8
.= ( ( Den (D58 , ( FreeMSA C162 )) ) | ( ( ( D56 # ) * (the Arity of C160) ) . D58 ) ) by L445 , MSUALG_2:def 7;
L447: ( Args (D58 , ( FreeMSA C162 )) ) = ( ( ( (the Sorts of ( FreeMSA C162 )) # ) * (the Arity of C160) ) . D58 ) by MSUALG_1:def 4;
L448: ( dom ( Den (D58 , ( FreeMSA C162 )) ) ) = ( ( ( (the Sorts of ( FreeMSA C162 )) # ) * (the Arity of C160) ) . D58 ) by L447 , FUNCT_2:def 1;
L449: ( dom ( (the Charact of C164) . D58 ) ) = ( ( ( D56 # ) * (the Arity of C160) ) . D58 ) by L448 , L446 , L443 , MSUALG_2:2 , RELAT_1:62;
L450: ( ( ( D57 # ) * (the Arity of C160) ) . D58 ) c= ( ( ( (the Sorts of ( FreeMSA C161 )) # ) * (the Arity of C160) ) . D58 ) by L436 , MSUALG_2:2;
L451:
now
let R1 being set;
assume L452: R1 in ( ( ( D57 # ) * (the Arity of C160) ) . D58 );
reconsider D59 = R1 as (Element of ( Args (D58 , ( FreeMSA C161 )) )) by L452 , L450 , MSUALG_1:def 4;
reconsider D60 = R1 as (Element of ( Args (D58 , ( FreeMSA C162 )) )) by L432 , L444 , L452 , MSUALG_1:def 4;
thus L453: ( ( (the Charact of C163) . D58 ) . R1 ) = ( ( Den (D58 , ( FreeMSA C161 )) ) . D59 ) by L439 , L442 , L452 , FUNCT_1:47
.= ( [ D58 , (the carrier of C160) ] -tree D59 ) by INSTALG1:3
.= ( ( Den (D58 , ( FreeMSA C162 )) ) . D60 ) by INSTALG1:3
.= ( ( (the Charact of C164) . D58 ) . R1 ) by L432 , L446 , L449 , L452 , FUNCT_1:47;
end;
thus L454: ( (the Charact of C163) . R1 ) = ( (the Charact of C164) . R1 ) by L451 , L432 , L442 , L449 , FUNCT_1:2;
end;
thus L455: thesis by L435 , L432 , PBOOLE:3;
end;
theorem
L456: (for B163 being non  void Signature holds (for B164 being non  empty-yielding (ManySortedSet of (the carrier of B163)) holds (for B165 being (ManySortedSet of (the carrier of B163)) holds (for B166 being (Element of ( Free (B163 , B164) )) holds ( B163 variables_in B166 ) c= B164))))
proof
let C165 being non  void Signature;
let C166 being non  empty-yielding (ManySortedSet of (the carrier of C165));
let C167 being (ManySortedSet of (the carrier of C165));
let C168 being (Element of ( Free (C165 , C166) ));
set D61 = ( C166 \/ ( (the carrier of C165) --> { ( 0 ) } ) );
reconsider D62 = C168 as (Term of C165 , D61) by L109;
L457: D62 in ( Union (the Sorts of ( Free (C165 , C166) )) );
L458: D62 in ( Union ( C165 -Terms (C166 , D61) ) ) by L457 , L412;
L459: ( dom ( C165 -Terms (C166 , D61) ) ) = (the carrier of C165) by PARTFUN1:def 2;
L460: (ex B167 being set st (B167 in (the carrier of C165) & D62 in ( ( C165 -Terms (C166 , D61) ) . B167 ))) by L459 , L458 , CARD_5:2;
L461: ( variables_in D62 ) c= C166 by L460 , L279;
thus L462: thesis by L461;
end;
theorem
L463: (for B168 being non  void Signature holds (for B169 being  non-empty (ManySortedSet of (the carrier of B168)) holds (for B170 being (Term of B168 , B169) holds ( variables_in B170 ) c= B169)))
proof
let C169 being non  void Signature;
let C170 being  non-empty (ManySortedSet of (the carrier of C169));
defpred S3[ DecoratedTree ] means ( C169 variables_in $1 ) c= C170;
let C171 being (Term of C169 , C170);
L464: (for B171 being (OperSymbol of C169) holds (for B172 being (ArgumentSeq of ( Sym (B171 , C170) )) holds ((for B173 being (Term of C169 , C170) holds (B173 in ( rng B172 ) implies S3[ B173 ])) implies S3[ ( [ B171 , (the carrier of C169) ] -tree B172 ) ])))
proof
let C172 being (OperSymbol of C169);
let C173 being (ArgumentSeq of ( Sym (C172 , C170) ));
assume that
L465: (for B174 being (Term of C169 , C170) holds (B174 in ( rng C173 ) implies ( C169 variables_in B174 ) c= C170));
thus L466: ( C169 variables_in ( [ C172 , (the carrier of C169) ] -tree C173 ) ) c= C170
proof
let C174 being set;
assume L467: C174 in (the carrier of C169);
let R1 being set;
assume L468: R1 in ( ( C169 variables_in ( [ C172 , (the carrier of C169) ] -tree C173 ) ) . C174 );
consider C175 being DecoratedTree such that L469: C175 in ( rng C173 ) and L470: R1 in ( ( C169 variables_in C175 ) . C174 ) by L468 , L467 , L163;
consider C176 being set such that L471: C176 in ( dom C173 ) and L472: C175 = ( C173 . C176 ) by L469 , FUNCT_1:def 3;
reconsider D63 = C176 as Nat by L471;
reconsider D64 = ( C173 . D63 ) as (Term of C169 , C170) by L471 , MSATERM:22;
L473: ( C169 variables_in D64 ) c= C170 by L465 , L469 , L472;
L474: ( ( C169 variables_in D64 ) . C174 ) c= ( C170 . C174 ) by L473 , L467 , PBOOLE:def 2;
thus L475: thesis by L474 , L470 , L472;
end;

end;
L467: (for B175 being (SortSymbol of C169) holds (for B176 being (Element of ( C170 . B175 )) holds S3[ ( root-tree [ B176 , B175 ] ) ]))
proof
let C177 being (SortSymbol of C169);
let C178 being (Element of ( C170 . C177 ));
thus L468: ( C169 variables_in ( root-tree [ C178 , C177 ] ) ) c= C170
proof
let R2 being set;
assume L469: R2 in (the carrier of C169);
L470: (R2 <> C177 implies ( ( C169 variables_in ( root-tree [ C178 , C177 ] ) ) . R2 ) = ( {} )) by L146;
L471: ( ( C169 variables_in ( root-tree [ C178 , C177 ] ) ) . C177 ) = { C178 } by L146;
thus L472: thesis by L471 , L470 , XBOOLE_1:2;
end;

end;
L469: (for B177 being (Term of C169 , C170) holds S3[ B177 ]) from MSATERM:sch 1(L467 , L464);
thus L470: thesis by L469;
end;
theorem
L471: (for B178 being non  void Signature holds (for B179 , B180 being  non-empty (ManySortedSet of (the carrier of B178)) holds (for B181 being (Term of B178 , B179) holds (for B182 being (Term of B178 , B180) holds (B181 = B182 implies ( the_sort_of B181 ) = ( the_sort_of B182 ))))))
proof
let C179 being non  void Signature;
let C180 , C181 being  non-empty (ManySortedSet of (the carrier of C179));
let C182 being (Term of C179 , C180);
let C183 being (Term of C179 , C181);
assume that
L472: C182 = C183;
per cases  by MSATERM:2;
suppose L473: (ex B183 being (SortSymbol of C179) st (ex B184 being (Element of ( C180 . B183 )) st ( C182 . ( {} ) ) = [ B184 , B183 ]));

consider C184 being (SortSymbol of C179), C185 being (Element of ( C180 . C184 )) such that L474: ( C182 . ( {} ) ) = [ C185 , C184 ] by L473;
L475: C184 in (the carrier of C179);
L476: C184 <> (the carrier of C179) by L475;
L477: (not C184 in { (the carrier of C179) }) by L476 , TARSKI:def 1;
L478: (not [ C185 , C184 ] in [: (the carrier' of C179) , { (the carrier of C179) } :]) by L477 , ZFMISC_1:87;
consider C186 being (SortSymbol of C179), C187 being (Element of ( C181 . C186 )) such that L479: ( C183 . ( {} ) ) = [ C187 , C186 ] by L478 , L472 , L474 , MSATERM:2;
L480: C182 = ( root-tree [ C185 , C184 ] ) by L474 , MSATERM:5;
L481: ( the_sort_of C182 ) = C184 by L480 , MSATERM:14;
L482: C183 = ( root-tree [ C187 , C186 ] ) by L479 , MSATERM:5;
L483: ( the_sort_of C183 ) = C186 by L482 , MSATERM:14;
thus L484: thesis by L483 , L472 , L474 , L479 , L481 , XTUPLE_0:1;
end;
suppose L485: ( C182 . ( {} ) ) in [: (the carrier' of C179) , { (the carrier of C179) } :];

consider C188 , C189 being set such that L486: C188 in (the carrier' of C179) and L487: C189 in { (the carrier of C179) } and L488: ( C182 . ( {} ) ) = [ C188 , C189 ] by L485 , ZFMISC_1:def 2;
reconsider D65 = C188 as (OperSymbol of C179) by L486;
L489: C189 = (the carrier of C179) by L487 , TARSKI:def 1;
L490: ( the_sort_of C182 ) = ( the_result_sort_of D65 ) by L489 , L488 , MSATERM:17;
thus L491: thesis by L490 , L472 , L488 , L489 , MSATERM:17;
end;
end;
theorem
L493: (for B185 being non  void Signature holds (for B186 , B187 being  non-empty (ManySortedSet of (the carrier of B185)) holds (for B188 being (Term of B185 , B187) holds (( variables_in B188 ) c= B186 implies B188 is (Term of B185 , B186)))))
proof
let C190 being non  void Signature;
let C191 , C192 being  non-empty (ManySortedSet of (the carrier of C190));
defpred S4[ DecoratedTree ] means (( C192 variables_in $1 ) c= C191 implies $1 is (Term of C190 , C191));
let C193 being (Term of C190 , C192);
L494: (for B189 being (OperSymbol of C190) holds (for B190 being (ArgumentSeq of ( Sym (B189 , C192) )) holds ((for B191 being (Term of C190 , C192) holds (B191 in ( rng B190 ) implies S4[ B191 ])) implies S4[ ( [ B189 , (the carrier of C190) ] -tree B190 ) ])))
proof
let C194 being (OperSymbol of C190);
let C195 being (ArgumentSeq of ( Sym (C194 , C192) ));
assume that
L495: (for B192 being (Term of C190 , C192) holds ((B192 in ( rng C195 ) & ( C192 variables_in B192 ) c= C191) implies B192 is (Term of C190 , C191)))
and
L496: ( C192 variables_in ( [ C194 , (the carrier of C190) ] -tree C195 ) ) c= C191;
L497:
now
let C196 being Nat;
assume L498: C196 in ( dom C195 );
reconsider D66 = ( C195 . C196 ) as (Term of C190 , C192) by L498 , MSATERM:22;
L499: D66 in ( rng C195 ) by L498 , FUNCT_1:def 3;
L500: ( C192 variables_in D66 ) c= C191
proof
let R2 being set;
assume L501: R2 in (the carrier of C190);
reconsider D67 = R2 as (SortSymbol of C190) by L501;
let R1 being set;
assume L502: R1 in ( ( C192 variables_in D66 ) . R2 );
L503: R1 in ( ( C192 variables_in ( [ C194 , (the carrier of C190) ] -tree C195 ) ) . D67 ) by L502 , L499 , L228;
L504: ( ( C192 variables_in ( [ C194 , (the carrier of C190) ] -tree C195 ) ) . D67 ) c= ( C191 . D67 ) by L496 , PBOOLE:def 2;
thus L505: thesis by L504 , L503;
end;
reconsider D68 = D66 as (Term of C190 , C191) by L500 , L495 , L499;
take D69 = D68;
thus L506: D69 = ( C195 . C196 );
L507: ( the_sort_of D66 ) = ( ( the_arity_of C194 ) . C196 ) by L498 , MSATERM:23;
thus L508: ( the_sort_of D69 ) = ( ( the_arity_of C194 ) . C196 ) by L507 , L471;
end;
L509: ( len C195 ) = ( len ( the_arity_of C194 ) ) by MSATERM:22;
reconsider D70 = C195 as (ArgumentSeq of ( Sym (C194 , C191) )) by L509 , L497 , MSATERM:24;
L510: ( ( Sym (C194 , C191) ) -tree D70 ) is (Term of C190 , C191);
thus L511: thesis by L510 , MSAFREE:def 9;
end;
assume L512: ( variables_in C193 ) c= C191;
L513: ( C192 variables_in C193 ) c= C191 by L512 , L257;
L514: (for B193 being (SortSymbol of C190) holds (for B194 being (Element of ( C192 . B193 )) holds S4[ ( root-tree [ B194 , B193 ] ) ]))
proof
let C197 being (SortSymbol of C190);
let C198 being (Element of ( C192 . C197 ));
assume L515: ( C192 variables_in ( root-tree [ C198 , C197 ] ) ) c= C191;
L516: ( ( C192 variables_in ( root-tree [ C198 , C197 ] ) ) . C197 ) c= ( C191 . C197 ) by L515 , PBOOLE:def 2;
L517: ( ( C192 variables_in ( root-tree [ C198 , C197 ] ) ) . C197 ) = { C198 } by L207;
L518: C198 in ( C191 . C197 ) by L517 , L516 , ZFMISC_1:31;
thus L519: thesis by L518 , MSATERM:4;
end;
L520: (for B195 being (Term of C190 , C192) holds S4[ B195 ]) from MSATERM:sch 1(L514 , L494);
thus L521: thesis by L520 , L513;
end;
theorem
L522: (for B196 being non  void Signature holds (for B197 being  non-empty (ManySortedSet of (the carrier of B196)) holds ( Free (B196 , B197) ) = ( FreeMSA B197 )))
proof
let C199 being non  void Signature;
let C200 being  non-empty (ManySortedSet of (the carrier of C199));
set D71 = ( C200 \/ ( (the carrier of C199) --> { ( 0 ) } ) );
L523: (the Sorts of ( Free (C199 , C200) )) = ( C199 -Terms (C200 , D71) ) by L412;
L524: ( FreeMSA C200 ) = MSAlgebra (# ( FreeSort C200 ) , ( FreeOper C200 ) #) by MSAFREE:def 14;
L525: (the Sorts of ( Free (C199 , C200) )) = (the Sorts of ( FreeMSA C200 ))
proof
let C201 being (Element of C199);
reconsider D72 = C201 as (SortSymbol of C199);
thus L526: ( (the Sorts of ( Free (C199 , C200) )) . C201 ) c= ( (the Sorts of ( FreeMSA C200 )) . C201 )
proof
let R1 being set;
assume L527: R1 in ( (the Sorts of ( Free (C199 , C200) )) . C201 );
reconsider D73 = R1 as (Term of C199 , D71) by L527 , L523 , L274;
L528: ( variables_in D73 ) c= C200 by L523 , L527 , L279;
reconsider D74 = D73 as (Term of C199 , C200) by L528 , L493;
L529: ( the_sort_of D73 ) = C201 by L523 , L527 , L279;
L530: ( the_sort_of D74 ) = C201 by L529 , L471;
L531: R1 in ( FreeSort (C200 , D72) ) by L530 , MSATERM:def 5;
thus L532: thesis by L531 , L524 , MSAFREE:def 11;
end;

reconsider D75 = C201 as (SortSymbol of C199);
let R1 being set;
assume L533: R1 in ( (the Sorts of ( FreeMSA C200 )) . C201 );
L534: R1 in ( FreeSort (C200 , D75) ) by L533 , L524 , MSAFREE:def 11;
L535: ( FreeSort (C200 , D75) ) c= ( C199 -Terms C200 ) by MSATERM:12;
reconsider D76 = R1 as (Term of C199 , C200) by L535 , L534;
L536: C200 c= D71 by PBOOLE:14;
reconsider D77 = D76 as (Term of C199 , D71) by L536 , MSATERM:26;
L537: ( variables_in D76 ) = ( C199 variables_in D76 );
L538: ( variables_in D77 ) c= C200 by L537 , L463;
L539: ( the_sort_of D76 ) = C201 by L534 , MSATERM:def 5;
L540: ( the_sort_of D77 ) = C201 by L539 , L471;
L541: D76 in { B198 where B198 is (Term of C199 , D71) : (( the_sort_of B198 ) = D75 & ( variables_in B198 ) c= C200) } by L540 , L538;
thus L542: thesis by L541 , L523 , L258;
end;
L543: (( FreeMSA C200 ) is (MSSubAlgebra of ( FreeMSA C200 )) & (ex B199 being (MSSubset of ( FreeMSA D71 )) st (( Free (C199 , C200) ) = ( GenMSAlg B199 ) & B199 = ( ( Reverse D71 ) "" C200 )))) by L19 , MSUALG_2:5;
thus L544: thesis by L543 , L525 , L431;
end;
theorem
L545: (for B200 being non  void Signature holds (for B201 being  non-empty (ManySortedSet of (the carrier of B200)) holds (for B202 being (Term of B200 , B201) holds (for B203 being (Element of ( dom B202 )) holds ( variables_in ( B202 | B203 ) ) c= ( variables_in B202 )))))
proof
let C202 being non  void Signature;
let C203 being  non-empty (ManySortedSet of (the carrier of C202));
let C204 being (Term of C202 , C203);
let C205 being (Element of ( dom C204 ));
reconsider D78 = ( C204 | C205 ) as (Term of C202 , C203);
let C206 being set;
assume L546: C206 in (the carrier of C202);
let R1 being set;
assume L547: R1 in ( ( variables_in ( C204 | C205 ) ) . C206 );
L548: R1 in { ( B204 `1 ) where B204 is (Element of ( rng D78 )) : ( B204 `2 ) = C206 } by L547 , L546 , L123;
consider C207 being (Element of ( rng ( C204 | C205 ) )) such that L549: (R1 = ( C207 `1 ) & ( C207 `2 ) = C206) by L548;
L550: (( rng ( C204 | C205 ) ) c= ( rng C204 ) & C207 in ( rng ( C204 | C205 ) )) by TREES_2:32;
L551: R1 in { ( B205 `1 ) where B205 is (Element of ( rng C204 )) : ( B205 `2 ) = C206 } by L550 , L549;
thus L552: thesis by L551 , L546 , L123;
end;
theorem
L553: (for B206 being non  void Signature holds (for B207 being non  empty-yielding (ManySortedSet of (the carrier of B206)) holds (for B208 being (Element of ( Free (B206 , B207) )) holds (for B209 being (Element of ( dom B208 )) holds ( B208 | B209 ) is (Element of ( Free (B206 , B207) ))))))
proof
let C208 being non  void Signature;
let C209 being non  empty-yielding (ManySortedSet of (the carrier of C208));
let C210 being (Element of ( Free (C208 , C209) ));
let C211 being (Element of ( dom C210 ));
set D79 = ( C209 \/ ( (the carrier of C208) --> { ( 0 ) } ) );
reconsider D80 = C210 as (Term of C208 , D79) by L109;
reconsider D81 = C211 as (Element of ( dom D80 ));
L554: ( variables_in ( D80 | D81 ) ) c= ( variables_in D80 ) by L545;
L555: ((the Sorts of ( Free (C208 , C209) )) = ( C208 -Terms (C209 , D79) ) & ( dom ( C208 -Terms (C209 , D79) ) ) = (the carrier of C208)) by L412 , PARTFUN1:def 2;
L556: (ex R1 being set st (R1 in (the carrier of C208) & D80 in ( ( C208 -Terms (C209 , D79) ) . R1 ))) by L555 , CARD_5:2;
L557: ( variables_in D80 ) c= C209 by L556 , L279;
L558: ( variables_in ( D80 | D81 ) ) c= C209 by L557 , L554 , PBOOLE:13;
L559: ( D80 | D81 ) in { B210 where B210 is (Term of C208 , D79) : (( the_sort_of B210 ) = ( the_sort_of ( D80 | D81 ) ) & ( variables_in B210 ) c= C209) } by L558;
L560: ( D80 | D81 ) in ( ( C208 -Terms (C209 , D79) ) . ( the_sort_of ( D80 | D81 ) ) ) by L559 , L258;
thus L561: thesis by L560 , L555 , CARD_5:2;
end;
theorem
L562: (for B211 being non  void Signature holds (for B212 being  non-empty (ManySortedSet of (the carrier of B211)) holds (for B213 being (Term of B211 , B212) holds (for B214 being (Element of ( rng B213 )) holds B214 = [ ( B214 `1 ) , ( B214 `2 ) ]))))
proof
let C212 being non  void Signature;
let C213 being  non-empty (ManySortedSet of (the carrier of C212));
let C214 being (Term of C212 , C213);
let C215 being (Element of ( rng C214 ));
consider R1 being set such that L563: R1 in ( dom C214 ) and L564: C215 = ( C214 . R1 ) by FUNCT_1:def 3;
reconsider D82 = R1 as (Element of ( dom C214 )) by L563;
L565: C215 = ( ( C214 | D82 ) . ( {} ) ) by L564 , TREES_9:35;
L566: ((ex B215 being (SortSymbol of C212) st (ex B216 being (Element of ( C213 . B215 )) st C215 = [ B216 , B215 ])) or C215 in [: (the carrier' of C212) , { (the carrier of C212) } :]) by L565 , MSATERM:2;
thus L567: thesis by L566 , MCART_1:21;
end;
theorem
L568: (for R1 being set holds (for B217 being non  void Signature holds (for B218 being non  empty-yielding (ManySortedSet of (the carrier of B217)) holds (for B219 being (Element of ( Free (B217 , B218) )) holds (for B220 being (SortSymbol of B217) holds ((R1 in ( ( B217 variables_in B219 ) . B220 ) implies [ R1 , B220 ] in ( rng B219 )) & ([ R1 , B220 ] in ( rng B219 ) implies (R1 in ( ( B217 variables_in B219 ) . B220 ) & R1 in ( B218 . B220 )))))))))
proof
let R1 being set;
let C216 being non  void Signature;
let C217 being non  empty-yielding (ManySortedSet of (the carrier of C216));
let C218 being (Element of ( Free (C216 , C217) ));
let C219 being (SortSymbol of C216);
set D83 = ( C217 \/ ( (the carrier of C216) --> { ( 0 ) } ) );
thus L569:now
assume L570: R1 in ( ( C216 variables_in C218 ) . C219 );
L571: R1 in { ( B221 `1 ) where B221 is (Element of ( rng C218 )) : ( B221 `2 ) = C219 } by L570 , L123;
consider C220 being (Element of ( rng C218 )) such that L572: (R1 = ( C220 `1 ) & ( C220 `2 ) = C219) by L571;
L573: (C218 is (Term of C216 , D83) & C220 in ( rng C218 )) by L109;
thus L574: [ R1 , C219 ] in ( rng C218 ) by L573 , L572 , L562;
end;
assume L575: [ R1 , C219 ] in ( rng C218 );
consider R3 being set such that L576: R3 in ( dom C218 ) and L577: [ R1 , C219 ] = ( C218 . R3 ) by L575 , FUNCT_1:def 3;
reconsider D84 = R3 as (Element of ( dom C218 )) by L576;
reconsider D85 = ( C218 | D84 ) as (Element of ( Free (C216 , C217) )) by L553;
L578: [ R1 , C219 ] = ( D85 . ( {} ) ) by L577 , TREES_9:35;
L579: (( [ R1 , C219 ] `1 ) = R1 & ( [ R1 , C219 ] `2 ) = C219);
L580: R1 in { ( B222 `1 ) where B222 is (Element of ( rng C218 )) : ( B222 `2 ) = C219 } by L579 , L575;
L581: D85 is (Term of C216 , D83) by L109;
L582: C219 in (the carrier of C216);
L583: C219 <> (the carrier of C216) by L582;
L584: (not C219 in { (the carrier of C216) }) by L583 , TARSKI:def 1;
L585: (not [ R1 , C219 ] in [: (the carrier' of C216) , { (the carrier of C216) } :]) by L584 , ZFMISC_1:87;
consider C221 being (SortSymbol of C216), C222 being (Element of ( D83 . C221 )) such that L586: [ R1 , C219 ] = [ C222 , C221 ] by L585 , L578 , L581 , MSATERM:2;
L587: ( C216 variables_in D85 ) c= C217 by L456;
L588: ( ( C216 variables_in D85 ) . C221 ) c= ( C217 . C221 ) by L587 , PBOOLE:def 2;
L589: D85 = ( root-tree [ C222 , C221 ] ) by L578 , L581 , L586 , MSATERM:5;
L590: ( ( C216 variables_in D85 ) . C221 ) = { C222 } by L589 , L146;
L591: C222 in ( C217 . C221 ) by L590 , L588 , ZFMISC_1:31;
L592: R1 = C222 by L586 , XTUPLE_0:1;
thus L593: thesis by L592 , L586 , L591 , L580 , L123 , XTUPLE_0:1;
end;
theorem
L594: (for B223 being non  void Signature holds (for B224 being (ManySortedSet of (the carrier of B223)) holds ((for B225 being (SortSymbol of B223) holds (( B224 . B225 ) = ( {} ) implies (ex B226 being (OperSymbol of B223) st (( the_result_sort_of B226 ) = B225 & ( the_arity_of B226 ) = ( {} ))))) implies ( Free (B223 , B224) ) is  non-empty)))
proof
let C223 being non  void Signature;
let C224 being (ManySortedSet of (the carrier of C223));
assume that
L595: (for B227 being (SortSymbol of C223) holds (( C224 . B227 ) = ( {} ) implies (ex B228 being (OperSymbol of C223) st (( the_result_sort_of B228 ) = B227 & ( the_arity_of B228 ) = ( {} )))));
L596:
now
assume L597: ( {} ) in ( rng (the Sorts of ( Free (C223 , C224) )) );
consider C225 being set such that L598: C225 in ( dom (the Sorts of ( Free (C223 , C224) )) ) and L599: ( {} ) = ( (the Sorts of ( Free (C223 , C224) )) . C225 ) by L597 , FUNCT_1:def 3;
reconsider D86 = C225 as (SortSymbol of C223) by L598;
set D87 = the (Element of ( C224 . D86 ));
per cases ;
suppose L600: ( C224 . D86 ) = ( {} );

L601: (ex B229 being (OperSymbol of C223) st (( the_result_sort_of B229 ) = D86 & ( the_arity_of B229 ) = ( {} ))) by L600 , L595;
thus L602: contradiction by L601 , L599 , L80;
end;
suppose L603: ( C224 . D86 ) <> ( {} );

L604: ( root-tree [ D87 , D86 ] ) in ( (the Sorts of ( Free (C223 , C224) )) . D86 ) by L603 , L69;
thus L605: contradiction by L604 , L599;
end;
end;
L607: (the Sorts of ( Free (C223 , C224) )) is  non-empty by L596 , RELAT_1:def 9;
thus L608: thesis by L607 , MSUALG_1:def 3;
end;
theorem
L609: (for B230 being non  void non  empty ManySortedSign holds (for B231 being MSAlgebra over B230 holds (for B232 being (MSSubAlgebra of B231) holds (for B233 being (OperSymbol of B230) holds ( Args (B233 , B232) ) c= ( Args (B233 , B231) )))))
proof
let C226 being non  void non  empty ManySortedSign;
let C227 being MSAlgebra over C226;
let C228 being (MSSubAlgebra of C227);
reconsider D88 = (the Sorts of C228) as (MSSubset of C227) by MSUALG_2:def 9;
let C229 being (OperSymbol of C226);
reconsider D89 = (the Sorts of C227) as (MSSubset of C227) by PBOOLE:def 18;
L610: ( Args (C229 , C228) ) = ( ( ( D88 # ) * (the Arity of C226) ) . C229 ) by MSUALG_1:def 4;
L611: (D88 c= D89 & ( Args (C229 , C227) ) = ( ( ( D89 # ) * (the Arity of C226) ) . C229 )) by MSUALG_1:def 4 , PBOOLE:def 18;
thus L612: thesis by L611 , L610 , MSUALG_2:2;
end;
theorem
L613: (for B234 being non  void Signature holds (for B235 being  feasible MSAlgebra over B234 holds (for B236 being (MSSubAlgebra of B235) holds B236 is  feasible)))
proof
let C230 being non  void Signature;
let C231 being  feasible MSAlgebra over C230;
let C232 being (MSSubAlgebra of C231);
reconsider D90 = (the Sorts of C232) as (MSSubset of C231) by MSUALG_2:def 9;
let C233 being (OperSymbol of C230);
set D91 = the (Element of ( Args (C233 , C232) ));
assume L614: ( Args (C233 , C232) ) <> ( {} );
L615: D91 in ( Args (C233 , C232) ) by L614;
L616: ( Args (C233 , C232) ) c= ( Args (C233 , C231) ) by L609;
L617: ( Result (C233 , C231) ) <> ( {} ) by L616 , L615 , MSUALG_6:def 1;
L618: ( dom ( Den (C233 , C231) ) ) = ( Args (C233 , C231) ) by L617 , FUNCT_2:def 1;
L619: D91 in ( dom ( ( Den (C233 , C231) ) | ( Args (C233 , C232) ) ) ) by L618 , L615 , L616 , RELAT_1:57;
L620: (( Result (C233 , C232) ) = ( ( D90 * (the ResultSort of C230) ) . C233 ) & ( ( ( Den (C233 , C231) ) | ( Args (C233 , C232) ) ) . D91 ) in ( rng ( ( Den (C233 , C231) ) | ( Args (C233 , C232) ) ) )) by L619 , FUNCT_1:def 3 , MSUALG_1:def 5;
L621: D90 is  opers_closed by MSUALG_2:def 9;
L622: D90 is_closed_on C233 by L621 , MSUALG_2:def 6;
L623: ( rng ( ( Den (C233 , C231) ) | ( ( ( D90 # ) * (the Arity of C230) ) . C233 ) ) ) c= ( ( D90 * (the ResultSort of C230) ) . C233 ) by L622 , MSUALG_2:def 5;
thus L624: thesis by L623 , L620 , MSUALG_1:def 4;
end;
registration
let C234 being non  void Signature;
let C235 being  feasible MSAlgebra over C234;
cluster  ->  feasible for (MSSubAlgebra of C235);
coherence by L613;
end;
theorem
L626: (for B237 being non  void Signature holds (for B238 being (ManySortedSet of (the carrier of B237)) holds ( Free (B237 , B238) ) is  feasible  free))
proof
let C236 being non  void Signature;
let C237 being (ManySortedSet of (the carrier of C236));
set D92 = ( C237 \/ ( (the carrier of C236) --> { ( 0 ) } ) );
consider C238 being (MSSubset of ( FreeMSA D92 )) such that L627: ( Free (C236 , C237) ) = ( GenMSAlg C238 ) and L628: C238 = ( ( Reverse D92 ) "" C237 ) by L19;
thus L629: ( Free (C236 , C237) ) is  feasible by L627;
L630: C238 is (ManySortedSubset of ( FreeGen D92 )) by L628 , EQUATION:8;
L631: C238 c= ( FreeGen D92 ) by L630 , PBOOLE:def 18;
thus L632: thesis by L631 , L627 , EQUATION:28;
end;
registration
let C239 being non  void Signature;
let C240 being (ManySortedSet of (the carrier of C239));
cluster ( Free (C239 , C240) ) ->  feasible  free;
coherence by L626;
end;
