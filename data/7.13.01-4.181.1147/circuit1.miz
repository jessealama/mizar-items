:: Introduction to Circuits, I
::  by Yatsuka Nakamura, Piotr Rudnicki, Andrzej Trybulec and Pauline N. Kawamoto
::
:: Received December 15, 1994
:: Copyright (c) 1994-2012 Association of Mizar Users
::           (Stowarzyszenie Uzytkownikow Mizara, Bialystok, Poland).
:: This code can be distributed under the GNU General Public Licence
:: version 3.0 or later, or the Creative Commons Attribution-ShareAlike
:: License version 3.0 or later, subject to the binding interpretation
:: detailed in file COPYING.interpretation.
:: See COPYING.GPL and COPYING.CC-BY-SA for the full text of these
:: licenses, or see http://www.gnu.org/licenses/gpl.html and
:: http://creativecommons.org/licenses/by-sa/3.0/.

environ

 vocabularies NUMBERS, STRUCT_0, MSAFREE2, XBOOLE_0, MSUALG_1, FINSET_1,
      RELAT_1, PBOOLE, GLIB_000, FUNCT_1, UNIALG_2, SUBSET_1, FINSEQ_1,
      FUNCOP_1, FUNCT_6, FSM_1, CARD_3, MARGREL1, TREES_3, TREES_4, PARTFUN1,
      MSAFREE, TREES_2, ARYTM_3, TREES_1, ZFMISC_1, LANG1, DTCONSTR, TREES_A,
      TDGROUP, TARSKI, NAT_1, ORDINAL4, CARD_1, ORDINAL1, XXREAL_0, MEMBERED,
      XREAL_0, ARYTM_1, FUNCT_4, REAL_1, CIRCUIT1;
 notations TARSKI, XBOOLE_0, ZFMISC_1, SUBSET_1, ORDINAL1, CARD_1, NUMBERS,
      XREAL_0, REAL_1, NAT_1, MEMBERED, RELAT_1, FUNCT_1, PBOOLE, PARTFUN1,
      FINSEQ_1, FINSEQ_2, RELSET_1, FINSET_1, CARD_3, FUNCT_4, FUNCT_6,
      TREES_1, TREES_2, TREES_3, TREES_4, STRUCT_0, LANG1, DTCONSTR, MSUALG_1,
      MSUALG_2, MSAFREE, XXREAL_2, FUNCOP_1, MSAFREE2, XXREAL_0;
 constructors FUNCT_4, REAL_1, MSUALG_2, MSAFREE2, SEQ_4, RELSET_1;
 registrations XBOOLE_0, RELAT_1, FUNCT_1, ORDINAL1, FINSET_1, NUMBERS,
      XXREAL_0, XREAL_0, NAT_1, MEMBERED, FINSEQ_1, TREES_1, CARD_3, PBOOLE,
      TREES_2, TREES_3, PRE_CIRC, STRUCT_0, DTCONSTR, MSUALG_1, MSAFREE,
      MSAFREE2, FUNCT_2, XXREAL_2, CARD_1, RELSET_1;
 requirements REAL, NUMERALS, BOOLE, SUBSET, ARITHM;
 definitions TARSKI, MEMBERED, MSAFREE2;
 theorems TARSKI, ZFMISC_1, NAT_1, FINSEQ_1, FINSEQ_2, FINSEQ_3, FUNCT_1,
      FUNCT_2, TREES_1, TREES_2, TREES_3, TREES_4, CARD_1, CARD_2, CARD_3,
      FUNCOP_1, PBOOLE, PRALG_2, MSUALG_1, MSUALG_2, RELAT_1, MSAFREE1,
      MSAFREE, PRE_CIRC, DTCONSTR, LANG1, MSAFREE2, FUNCT_4, FUNCT_6, XBOOLE_0,
      XBOOLE_1, MEMBERED, FINSET_1, XREAL_1, XXREAL_0, ORDINAL1, PARTFUN1,
      XXREAL_2, XTUPLE_0;
 schemes NAT_1, FINSEQ_1, PRE_CIRC, PBOOLE, FRAENKEL, DOMAIN_1;

begin
definition
let C1 being non  void  Circuit-like non  empty ManySortedSign;
mode Circuit of C1
 is  finite-yielding MSAlgebra over C1;
end;
definition
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C2 being  non-empty (Circuit of R1);
func Set-Constants C2 -> (ManySortedSet of ( SortsWithConstants R1 )) means 
:L2: (for B1 being (Vertex of R1) holds (B1 in ( dom it ) implies ( it . B1 ) in ( Constants (C2 , B1) )));
existence
proof
defpred S1[ set , set ] means (ex B2 being (Vertex of R1) st (B2 = $1 & $2 in ( Constants (C2 , B2) )));
set D1 = ( SortsWithConstants R1 );
L3:
now
let C3 being set;
L4: D1 = { B3 where B3 is (SortSymbol of R1) : B3 is  with_const_op } by MSAFREE2:def 1;
assume L5: C3 in D1;
reconsider D2 = C3 as (Vertex of R1) by L5;
consider C4 being (Vertex of R1) such that L6: C4 = D2 and L7: C4 is  with_const_op by L5 , L4;
consider C5 being (OperSymbol of R1) such that L8: ( (the Arity of R1) . C5 ) = ( {} ) and L9: ( (the ResultSort of R1) . C5 ) = C4 by L7 , MSUALG_2:def 1;
L10: ( dom (the ResultSort of R1) ) = (the carrier' of R1) by FUNCT_2:def 1;
set D3 = the (Element of ( rng ( Den (C5 , C2) ) ));
L11: ( Result (C5 , C2) ) = ( ( (the Sorts of C2) * (the ResultSort of R1) ) . C5 ) by MSUALG_1:def 5
.= ( (the Sorts of C2) . ( (the ResultSort of R1) . C5 ) ) by L10 , FUNCT_1:13;
reconsider D4 = D3 as (Element of ( (the Sorts of C2) . C4 )) by L11 , L9;
reconsider D5 = D3 as set;
take D6 = D5;
L12: (ex B4 being non  empty set st (B4 = ( (the Sorts of C2) . C4 ) & ( Constants (C2 , C4) ) = { B5 where B5 is (Element of B4) : (ex B6 being (OperSymbol of R1) st (( (the Arity of R1) . B6 ) = ( {} ) & ( (the ResultSort of R1) . B6 ) = C4 & B5 in ( rng ( Den (B6 , C2) ) ))) })) by MSUALG_2:def 3;
L13: D4 in ( Constants (C2 , D2) ) by L12 , L6 , L8 , L9;
thus L14: S1[ C3 , D6 ] by L13;
end;
consider C6 being (ManySortedSet of D1) such that L15: (for B7 being set holds (B7 in D1 implies S1[ B7 , ( C6 . B7 ) ])) from PBOOLE:sch 3(L3);
take C6;
let C7 being (Vertex of R1);
assume L16: C7 in ( dom C6 );
L17: C7 in D1 by L16;
L18: S1[ C7 , ( C6 . C7 ) ] by L17 , L15;
thus L19: thesis by L18;
end;
correctness
proof
let C8 , C9 being (ManySortedSet of ( SortsWithConstants R1 ));
assume L20: (for B8 being (Vertex of R1) holds (B8 in ( dom C8 ) implies ( C8 . B8 ) in ( Constants (C2 , B8) )));
assume L21: (for B9 being (Vertex of R1) holds (B9 in ( dom C9 ) implies ( C9 . B9 ) in ( Constants (C2 , B9) )));
L22:
now
let C10 being set;
L23: ( dom (the Arity of R1) ) = (the carrier' of R1) by FUNCT_2:def 1;
assume L24: C10 in ( SortsWithConstants R1 );
reconsider D7 = C10 as (Vertex of R1) by L24;
L25: (ex B10 being non  empty set st (B10 = ( (the Sorts of C2) . D7 ) & ( Constants (C2 , D7) ) = { B11 where B11 is (Element of B10) : (ex B12 being (OperSymbol of R1) st (( (the Arity of R1) . B12 ) = ( {} ) & ( (the ResultSort of R1) . B12 ) = D7 & B11 in ( rng ( Den (B12 , C2) ) ))) })) by MSUALG_2:def 3;
L26: ( dom C9 ) = ( SortsWithConstants R1 ) by PARTFUN1:def 2;
L27: ( C9 . D7 ) in ( Constants (C2 , D7) ) by L26 , L21 , L24;
consider C11 being (Element of ( (the Sorts of C2) . D7 )) such that L28: ( C9 . D7 ) = C11 and L29: (ex B13 being (OperSymbol of R1) st (( (the Arity of R1) . B13 ) = ( {} ) & ( (the ResultSort of R1) . B13 ) = D7 & C11 in ( rng ( Den (B13 , C2) ) ))) by L27 , L25;
consider C12 being (OperSymbol of R1) such that L30: ( (the Arity of R1) . C12 ) = ( {} ) and L31: ( (the ResultSort of R1) . C12 ) = D7 and L32: C11 in ( rng ( Den (C12 , C2) ) ) by L29;
L33: ( the_result_sort_of C12 ) = D7 by L31 , MSUALG_1:def 2;
L34: ( dom C8 ) = ( SortsWithConstants R1 ) by PARTFUN1:def 2;
L35: ( C8 . D7 ) in ( Constants (C2 , D7) ) by L34 , L20 , L24;
consider C13 being (Element of ( (the Sorts of C2) . D7 )) such that L36: ( C8 . D7 ) = C13 and L37: (ex B14 being (OperSymbol of R1) st (( (the Arity of R1) . B14 ) = ( {} ) & ( (the ResultSort of R1) . B14 ) = D7 & C13 in ( rng ( Den (B14 , C2) ) ))) by L35 , L25;
consider C14 being (OperSymbol of R1) such that L38: ( (the Arity of R1) . C14 ) = ( {} ) and L39: ( (the ResultSort of R1) . C14 ) = D7 and L40: C13 in ( rng ( Den (C14 , C2) ) ) by L37;
L41: ( {} ) = ( <*> (the carrier of R1) );
L42: (ex B15 being set st (B15 in ( dom ( Den (C12 , C2) ) ) & C11 = ( ( Den (C12 , C2) ) . B15 ))) by L32 , FUNCT_1:def 3;
L43: ( the_result_sort_of C14 ) = D7 by L39 , MSUALG_1:def 2;
L44: C14 = C12 by L43 , L33 , MSAFREE2:def 6;
consider C15 being set such that L45: C15 in ( dom ( Den (C14 , C2) ) ) and L46: C13 = ( ( Den (C14 , C2) ) . C15 ) by L40 , FUNCT_1:def 3;
L47: ( dom ( Den (C14 , C2) ) ) = ( Args (C14 , C2) ) by FUNCT_2:def 1
.= ( ( ( (the Sorts of C2) # ) * (the Arity of R1) ) . C14 ) by MSUALG_1:def 4
.= ( ( (the Sorts of C2) # ) . ( (the Arity of R1) . C14 ) ) by L23 , FUNCT_1:13
.= { ( {} ) } by L38 , L41 , PRE_CIRC:2;
L48: C15 = ( {} ) by L47 , L45 , TARSKI:def 1;
thus L49: ( C8 . C10 ) = ( C9 . C10 ) by L48 , L36 , L28 , L44 , L47 , L46 , L42 , TARSKI:def 1;
end;
thus L50: C8 = C9 by L22 , PBOOLE:3;
end;
end;
theorem
L52: (for R1 being  Circuit-like non  void non  empty ManySortedSign holds (for B16 being  non-empty (Circuit of R1) holds (for B17 being (Vertex of R1) holds (for B18 being (Element of ( (the Sorts of B16) . B17 )) holds ((B17 in ( SortsWithConstants R1 ) & B18 in ( Constants (B16 , B17) )) implies ( ( Set-Constants B16 ) . B17 ) = B18)))))
proof
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C16 being  non-empty (Circuit of R1);
let C17 being (Vertex of R1);
let C18 being (Element of ( (the Sorts of C16) . C17 ));
assume that
L53: C17 in ( SortsWithConstants R1 )
and
L54: C18 in ( Constants (C16 , C17) );
L55: (ex B19 being non  empty set st (B19 = ( (the Sorts of C16) . C17 ) & ( Constants (C16 , C17) ) = { B20 where B20 is (Element of B19) : (ex B21 being (OperSymbol of R1) st (( (the Arity of R1) . B21 ) = ( {} ) & ( (the ResultSort of R1) . B21 ) = C17 & B20 in ( rng ( Den (B21 , C16) ) ))) })) by MSUALG_2:def 3;
L56: (ex B22 being (Element of ( (the Sorts of C16) . C17 )) st (B22 = C18 & (ex B23 being (OperSymbol of R1) st (( (the Arity of R1) . B23 ) = ( {} ) & ( (the ResultSort of R1) . B23 ) = C17 & B22 in ( rng ( Den (B23 , C16) ) ))))) by L55 , L54;
consider C19 being (OperSymbol of R1) such that L57: ( (the Arity of R1) . C19 ) = ( {} ) and L58: ( (the ResultSort of R1) . C19 ) = C17 and L59: C18 in ( rng ( Den (C19 , C16) ) ) by L56;
L60: ( {} ) = ( <*> (the carrier of R1) );
L61: C17 in ( dom ( Set-Constants C16 ) ) by L53 , PARTFUN1:def 2;
L62: ( ( Set-Constants C16 ) . C17 ) in ( Constants (C16 , C17) ) by L61 , L2;
L63: (ex B24 being (Element of ( (the Sorts of C16) . C17 )) st (B24 = ( ( Set-Constants C16 ) . C17 ) & (ex B25 being (OperSymbol of R1) st (( (the Arity of R1) . B25 ) = ( {} ) & ( (the ResultSort of R1) . B25 ) = C17 & B24 in ( rng ( Den (B25 , C16) ) ))))) by L62 , L55;
consider C20 being (OperSymbol of R1) such that L64: ( (the Arity of R1) . C20 ) = ( {} ) and L65: ( (the ResultSort of R1) . C20 ) = C17 and L66: ( ( Set-Constants C16 ) . C17 ) in ( rng ( Den (C20 , C16) ) ) by L63;
L67: (ex B26 being set st (B26 in ( dom ( Den (C20 , C16) ) ) & ( ( Set-Constants C16 ) . C17 ) = ( ( Den (C20 , C16) ) . B26 ))) by L66 , FUNCT_1:def 3;
L68: (( the_result_sort_of C19 ) = ( (the ResultSort of R1) . C19 ) & ( the_result_sort_of C20 ) = ( (the ResultSort of R1) . C20 )) by MSUALG_1:def 2;
L69: C19 = C20 by L68 , L58 , L65 , MSAFREE2:def 6;
consider C21 being set such that L70: C21 in ( dom ( Den (C19 , C16) ) ) and L71: C18 = ( ( Den (C19 , C16) ) . C21 ) by L59 , FUNCT_1:def 3;
L72: ( dom (the Arity of R1) ) = (the carrier' of R1) by FUNCT_2:def 1;
L73: ( dom ( Den (C19 , C16) ) ) = ( Args (C19 , C16) ) by FUNCT_2:def 1
.= ( ( ( (the Sorts of C16) # ) * (the Arity of R1) ) . C19 ) by MSUALG_1:def 4
.= ( ( (the Sorts of C16) # ) . ( (the Arity of R1) . C19 ) ) by L72 , FUNCT_1:13
.= { ( {} ) } by L57 , L60 , PRE_CIRC:2;
L74: C21 = ( {} ) by L73 , L70 , TARSKI:def 1;
thus L75: thesis by L74 , L69 , L73 , L71 , L67 , TARSKI:def 1;
end;
definition
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C22 being (Circuit of R1);
mode InputFuncs of C22
 is (ManySortedFunction of (( ( InputVertices R1 ) --> ( NAT ) ) qua (ManySortedSet of ( InputVertices R1 ))) , (( (the Sorts of C22) | ( InputVertices R1 ) ) qua (ManySortedSet of ( InputVertices R1 ))));
end;
theorem
L77: (for R1 being  Circuit-like non  void non  empty ManySortedSign holds (for B27 being  non-empty (Circuit of R1) holds (for B28 being (InputFuncs of B27) holds (for B29 being (Element of ( NAT )) holds (R1 is  with_input_V implies ( ( commute B28 ) . B29 ) is (InputValues of B27))))))
proof
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C23 being  non-empty (Circuit of R1);
let C24 being (InputFuncs of C23);
let C25 being (Element of ( NAT ));
reconsider D8 = ( InputVertices R1 ) as (Subset of R1);
reconsider D9 = (the Sorts of C23) as  non-empty (ManySortedSet of (the carrier of R1));
assume L78: R1 is  with_input_V;
reconsider D10 = D8 as non  empty (Subset of R1) by L78;
reconsider D11 = ( D9 | D10 ) as (ManySortedSet of D10);
reconsider D12 = D11 as  non-empty (ManySortedSet of D10);
consider C26 being (ManySortedSet of D10) such that L79: C26 = ( ( commute C24 ) . C25 ) and L80: C26 in D12 by PRE_CIRC:7;
L81:
now
let C27 being (Vertex of R1);
assume L82: C27 in ( InputVertices R1 );
L83: ( D12 . C27 ) = ( (the Sorts of C23) . C27 ) by L82 , FUNCT_1:49;
thus L84: ( C26 . C27 ) in ( (the Sorts of C23) . C27 ) by L83 , L80 , L82 , PBOOLE:def 1;
end;
thus L85: thesis by L81 , L79 , MSAFREE2:def 5;
end;
definition
let R1 being  Circuit-like non  void non  empty ManySortedSign;
assume that
L86: R1 is  with_input_V;
let C28 being  non-empty (Circuit of R1);
let C29 being (InputFuncs of C28);
let C30 being (Element of ( NAT ));
func C30 -th_InputValues C29 -> (InputValues of C28) equals 
( ( commute C29 ) . C30 );
coherence by L86 , L77;
correctness;
end;
definition
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C31 being (Circuit of R1);
mode State of C31
 is (Element of ( product (the Sorts of C31) ));
end;
theorem
L89: (for R1 being  Circuit-like non  void non  empty ManySortedSign holds (for B30 being  non-empty (Circuit of R1) holds (for B31 being (State of B30) holds ( dom B31 ) = (the carrier of R1)))) by PARTFUN1:def 2;
theorem
L90: (for R1 being  Circuit-like non  void non  empty ManySortedSign holds (for B32 being  non-empty (Circuit of R1) holds (for B33 being (State of B32) holds (for B34 being (Vertex of R1) holds ( B33 . B34 ) in ( (the Sorts of B32) . B34 )))))
proof
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C32 being  non-empty (Circuit of R1);
let C33 being (State of C32);
let C34 being (Vertex of R1);
L91: (( dom (the Sorts of C32) ) = (the carrier of R1) & (ex B35 being Function st (C33 = B35 & ( dom B35 ) = ( dom (the Sorts of C32) ) & (for B36 being set holds (B36 in ( dom (the Sorts of C32) ) implies ( B35 . B36 ) in ( (the Sorts of C32) . B36 )))))) by CARD_3:def 5 , PARTFUN1:def 2;
thus L92: thesis by L91;
end;
definition
let R1 being  Circuit-like non  void non  empty ManySortedSign;
let C35 being  non-empty (Circuit of R1);
let C36 being (State of C35);
let C37 being (OperSymbol of R1);
func C37 depends_on_in C36 -> (Element of ( Args (C37 , C35) )) equals 
( C36 * ( the_arity_of C37 ) );
coherence
proof
L93: ( Args (C37 , C35) ) = ( product ( (the Sorts of C35) * ( the_arity_of C37 ) ) ) by PRALG_2:3;
thus L94: thesis by L93 , CARD_3:83;
end;
correctness;
end;
theorem
L96: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B37 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B38 , B39 being (Vertex of R2) holds (for B40 being (Element of ( (the Sorts of ( FreeEnv B37 )) . B38 )) holds (for B41 being  DTree-yielding FinSequence holds ((B38 in ( InnerVertices R2 ) & B40 = ( [ ( action_at B38 ) , (the carrier of R2) ] -tree B41 )) implies (for B42 being (Element of ( NAT )) holds ((B42 in ( dom B41 ) & ( B41 . B42 ) in ( (the Sorts of ( FreeEnv B37 )) . B39 )) implies B39 = ( ( the_arity_of ( action_at B38 ) ) /. B42 )))))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C38 being  finite-yielding  non-empty MSAlgebra over R2;
let C39 , C40 being (Vertex of R2);
let C41 being (Element of ( (the Sorts of ( FreeEnv C38 )) . C39 ));
let C42 being  DTree-yielding FinSequence;
assume that
L97: C39 in ( InnerVertices R2 )
and
L98: C41 = ( [ ( action_at C39 ) , (the carrier of R2) ] -tree C42 );
thus L99: (for B43 being (Element of ( NAT )) holds ((B43 in ( dom C42 ) & ( C42 . B43 ) in ( (the Sorts of ( FreeEnv C38 )) . C40 )) implies C40 = ( ( the_arity_of ( action_at C39 ) ) /. B43 )))
proof
reconsider D13 = ( action_at C39 ) as (OperSymbol of R2);
let C43 being (Element of ( NAT ));
assume that
L100: C43 in ( dom C42 )
and
L101: ( C42 . C43 ) in ( (the Sorts of ( FreeEnv C38 )) . C40 );
L102: ( FreeEnv C38 ) = MSAlgebra (# ( FreeSort (the Sorts of C38) ) , ( FreeOper (the Sorts of C38) ) #) by MSAFREE:def 14;
L103: C41 in ( (the Sorts of ( FreeEnv C38 )) . C39 );
L104: C41 in ( (the Sorts of ( FreeEnv C38 )) . ( the_result_sort_of D13 ) ) by L103 , L97 , MSAFREE2:def 7;
L105: ( len C42 ) = ( len ( the_arity_of D13 ) ) by L104 , L98 , MSAFREE2:10;
L106: C43 in ( dom ( the_arity_of D13 ) ) by L105 , L100 , FINSEQ_3:29;
L107: ( C42 . C43 ) in ( (the Sorts of ( FreeEnv C38 )) . ( ( the_arity_of D13 ) . C43 ) ) by L106 , L98 , L104 , MSAFREE2:11;
L108: ( C42 . C43 ) in ( ( FreeSort (the Sorts of C38) ) . ( ( the_arity_of D13 ) /. C43 ) ) by L107 , L106 , L102 , PARTFUN1:def 6;
L109:
now
assume L110: ( ( the_arity_of D13 ) /. C43 ) <> C40;
L111: ( ( FreeSort (the Sorts of C38) ) . ( ( the_arity_of D13 ) /. C43 ) ) misses ( ( FreeSort (the Sorts of C38) ) . C40 ) by L110 , MSAFREE:12;
L112: ( ( ( FreeSort (the Sorts of C38) ) . ( ( the_arity_of D13 ) /. C43 ) ) /\ ( ( FreeSort (the Sorts of C38) ) . C40 ) ) = ( {} ) by L111 , XBOOLE_0:def 7;
thus L113: contradiction by L112 , L101 , L102 , L108 , XBOOLE_0:def 4;
end;
thus L114: thesis by L109;
end;

end;
registration
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C44 being  finite-yielding  non-empty MSAlgebra over R2;
let C45 being (Vertex of R2);
cluster  ->  finite non  empty  Function-like  Relation-like for (Element of ( (the Sorts of ( FreeEnv C44 )) . C45 ));
coherence;
end;
registration
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C46 being  finite-yielding  non-empty MSAlgebra over R2;
let C47 being (Vertex of R2);
cluster  ->  DecoratedTree-like for (Element of ( (the Sorts of ( FreeEnv C46 )) . C47 ));
coherence;
end;
theorem
L102: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B44 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B45 , B46 being (Vertex of R2) holds (for B47 being (Element of ( (the Sorts of ( FreeEnv B44 )) . B45 )) holds (for B48 being (Element of ( (the Sorts of ( FreeEnv B44 )) . B46 )) holds (for B49 being  DTree-yielding FinSequence holds (for B50 being (Element of ( NAT )) holds ((B45 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) & B47 = ( [ ( action_at B45 ) , (the carrier of R2) ] -tree B49 ) & ( B50 + 1 ) in ( dom B49 ) & ( B49 . ( B50 + 1 ) ) in ( (the Sorts of ( FreeEnv B44 )) . B46 )) implies ( B47 with-replacement (<* B50 *> , B48) ) in ( (the Sorts of ( FreeEnv B44 )) . B45 )))))))))
proof
set D14 = ( <*> ( NAT ) );
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C48 being  finite-yielding  non-empty MSAlgebra over R2;
let C49 , C50 being (Vertex of R2);
let C51 being (Element of ( (the Sorts of ( FreeEnv C48 )) . C49 ));
let C52 being (Element of ( (the Sorts of ( FreeEnv C48 )) . C50 ));
let C53 being  DTree-yielding FinSequence;
let C54 being (Element of ( NAT ));
set D15 = ( C54 + 1 );
set D16 = ( C51 with-replacement (<* C54 *> , C52) );
assume that
L103: C49 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) )
and
L104: C51 = ( [ ( action_at C49 ) , (the carrier of R2) ] -tree C53 )
and
L105: D15 in ( dom C53 )
and
L106: ( C53 . D15 ) in ( (the Sorts of ( FreeEnv C48 )) . C50 );
reconsider D17 = ( [: (the carrier' of R2) , { (the carrier of R2) } :] \/ ( Union ( coprod (the Sorts of C48) ) ) ) as non  empty set;
reconsider D18 = ( REL (the Sorts of C48) ) as (Relation of D17 , ( D17 * ));
L107: ( DTConMSA (the Sorts of C48) ) = DTConstrStr (# D17 , D18 #) by MSAFREE:def 8;
reconsider D19 = ( TS ( DTConMSA (the Sorts of C48) ) ) as (Subset of ( FinTrees D17 )) by L107;
L108: (for B51 being set holds (B51 in D19 implies B51 is (DecoratedTree of D17)));
reconsider D20 = D19 as (DTree-set of D17) by L108 , TREES_3:def 6;
reconsider D21 = ( action_at C49 ) as (OperSymbol of R2);
reconsider D22 = C51 as DecoratedTree;
L109: (ex B52 being  DTree-yielding FinSequence st (B52 = C53 & ( dom D22 ) = ( tree ( doms B52 ) ))) by L104 , TREES_4:def 4;
reconsider D23 = <* C54 *> as (Element of ( dom C51 )) by L109 , L105 , PRE_CIRC:13;
reconsider D24 = D23 as (FinSequence of ( NAT ));
consider C55 being  DTree-yielding FinSequence such that L110: ( C51 with-replacement (D24 , C52) ) = ( [ D21 , (the carrier of R2) ] -tree C55 ) and L111: ( len C55 ) = ( len C53 ) and L112: ( C55 . ( C54 + 1 ) ) = C52 and L113: (for B53 being (Element of ( NAT )) holds (B53 in ( dom C53 ) implies (B53 <> ( C54 + 1 ) implies ( C55 . B53 ) = ( C53 . B53 )))) by L104 , PRE_CIRC:15;
L114: (( NonTerminals ( DTConMSA (the Sorts of C48) ) ) = [: (the carrier' of R2) , { (the carrier of R2) } :] & (the carrier of R2) in { (the carrier of R2) }) by MSAFREE:6 , TARSKI:def 1;
reconsider D25 = [ D21 , (the carrier of R2) ] as (NonTerminal of ( DTConMSA (the Sorts of C48) )) by L114 , ZFMISC_1:87;
L115: ( FreeEnv C48 ) = MSAlgebra (# ( FreeSort (the Sorts of C48) ) , ( FreeOper (the Sorts of C48) ) #) by MSAFREE:def 14;
L116: ( (the Sorts of ( FreeEnv C48 )) . C49 ) = ( FreeSort ((the Sorts of C48) , C49) ) by L115 , MSAFREE:def 11;
L117: C51 in ( TS ( DTConMSA (the Sorts of C48) ) ) by L116 , TARSKI:def 3;
L118: ( C51 . ( {} ) ) = D25 by L104 , TREES_4:def 4;
L119: (ex B54 being (FinSequence of ( TS ( DTConMSA (the Sorts of C48) ) )) st (C51 = ( D25 -tree B54 ) & D25 ==> ( roots B54 ))) by L118 , L117 , DTCONSTR:10;
reconsider D26 = C53 as (FinSequence of ( TS ( DTConMSA (the Sorts of C48) ) )) by L119 , L104 , TREES_4:15;
L120: ( (the Sorts of ( FreeEnv C48 )) . C50 ) = ( FreeSort ((the Sorts of C48) , C50) ) by L115 , MSAFREE:def 11;
L121: C52 in ( FreeSort ((the Sorts of C48) , C50) ) by L120;
L122: C52 in { B55 where B55 is (Element of ( TS ( DTConMSA (the Sorts of C48) ) )) : ((ex B56 being set st (B56 in ( (the Sorts of C48) . C50 ) & B55 = ( root-tree [ B56 , C50 ] ))) or (ex B57 being (OperSymbol of R2) st ([ B57 , (the carrier of R2) ] = ( B55 . ( {} ) ) & ( the_result_sort_of B57 ) = C50))) } by L121 , MSAFREE:def 10;
consider C56 being (Element of ( TS ( DTConMSA (the Sorts of C48) ) )) such that L123: C56 = C52 and L124: ((ex B58 being set st (B58 in ( (the Sorts of C48) . C50 ) & C56 = ( root-tree [ B58 , C50 ] ))) or (ex B59 being (OperSymbol of R2) st ([ B59 , (the carrier of R2) ] = ( C56 . ( {} ) ) & ( the_result_sort_of B59 ) = C50))) by L122;
L125: ( dom C55 ) = ( dom C53 ) by L111 , FINSEQ_3:29;
L126: ( rng C55 ) c= ( TS ( DTConMSA (the Sorts of C48) ) )
proof
let C57 being set;
assume L127: C57 in ( rng C55 );
consider C58 being set such that L128: C58 in ( dom C55 ) and L129: C57 = ( C55 . C58 ) by L127 , FUNCT_1:def 3;
reconsider D27 = C58 as (Element of ( NAT )) by L128;
per cases ;
suppose L130: D27 = ( C54 + 1 );

thus L131: thesis by L130 , L112 , L123 , L129;
end;
suppose L132: D27 <> ( C54 + 1 );

L133: ( C55 . D27 ) = ( D26 . D27 ) by L132 , L113 , L125 , L128;
thus L134: thesis by L133 , L125 , L128 , L129 , FINSEQ_2:11;
end;
end;
reconsider D28 = C55 as (FinSequence of D20) by L126 , FINSEQ_1:def 4;
reconsider D29 = ( roots D28 ) as (FinSequence of D17);
reconsider D30 = D29 as (Element of ( D17 * )) by FINSEQ_1:def 11;
L136: ( dom D30 ) = ( dom C55 ) by TREES_3:def 18;
L137: C49 in ( InnerVertices R2 ) by L103 , XBOOLE_0:def 5;
L138: ( (the Sorts of ( FreeEnv C48 )) . ( the_result_sort_of D21 ) ) = ( (the Sorts of ( FreeEnv C48 )) . C49 ) by L137 , MSAFREE2:def 7;
L139: ( len C53 ) = ( len ( the_arity_of D21 ) ) by L138 , L104 , MSAFREE2:10;
L140: ( dom D30 ) = ( dom ( the_arity_of D21 ) ) by L139 , L111 , L136 , FINSEQ_3:29;
L141: (for B60 being set holds (B60 in ( dom D30 ) implies ((( D30 . B60 ) in [: (the carrier' of R2) , { (the carrier of R2) } :] implies (for B61 being (OperSymbol of R2) holds ([ B61 , (the carrier of R2) ] = ( D30 . B60 ) implies ( the_result_sort_of B61 ) = ( ( the_arity_of D21 ) . B60 )))) & (( D30 . B60 ) in ( Union ( coprod (the Sorts of C48) ) ) implies ( D30 . B60 ) in ( coprod (( ( the_arity_of D21 ) . B60 ) , (the Sorts of C48)) )))))
proof
L142: (the carrier of R2) in { (the carrier of R2) } by TARSKI:def 1;
L143: [ D21 , (the carrier of R2) ] in [: (the carrier' of R2) , { (the carrier of R2) } :] by L142 , ZFMISC_1:87;
reconsider D31 = [ D21 , (the carrier of R2) ] as (Symbol of ( DTConMSA (the Sorts of C48) )) by L143 , L107 , XBOOLE_0:def 3;
reconsider D32 = D26 as (FinSequence of D20);
let C59 being set;
reconsider D33 = ( roots D32 ) as (Element of ( ( [: (the carrier' of R2) , { (the carrier of R2) } :] \/ ( Union ( coprod (the Sorts of C48) ) ) ) * )) by FINSEQ_1:def 11;
reconsider D34 = D33 as FinSequence;
assume L144: C59 in ( dom D30 );
reconsider D35 = C59 as (Element of ( NAT )) by L144;
L145: ( ( the_arity_of D21 ) /. D35 ) = ( ( the_arity_of D21 ) . D35 ) by L140 , L144 , PARTFUN1:def 6;
L146: ( dom C53 ) = ( dom ( the_arity_of D21 ) ) by L139 , FINSEQ_3:29;
L147: (for B62 being Nat holds (B62 in ( dom C53 ) implies ( C53 . B62 ) in ( FreeSort ((the Sorts of C48) , ( ( the_arity_of D21 ) /. B62 )) )))
proof
let C60 being Nat;
assume L148: C60 in ( dom C53 );
L149: (( C53 . C60 ) in ( (the Sorts of ( FreeEnv C48 )) . ( ( the_arity_of D21 ) . C60 ) ) & ( ( the_arity_of D21 ) . C60 ) = ( ( the_arity_of D21 ) /. C60 )) by L148 , L104 , L138 , L146 , MSAFREE2:11 , PARTFUN1:def 6;
thus L150: thesis by L149 , L115 , MSAFREE:def 11;
end;
L151: D32 in ( ( ( ( FreeSort (the Sorts of C48) ) # ) * (the Arity of R2) ) . D21 ) by L147 , L146 , MSAFREE:9;
L152: ( Sym (D21 , (the Sorts of C48)) ) = [ D21 , (the carrier of R2) ] by MSAFREE:def 9;
L153: D31 ==> D34 by L152 , L151 , MSAFREE:10;
L154: (( dom ( roots C53 ) ) = ( dom C53 ) & [ D31 , D34 ] in D18) by L153 , L107 , LANG1:def 1 , TREES_3:def 18;
L155: ( ( the_arity_of D21 ) /. D15 ) = C50 by L104 , L105 , L106 , L137 , L96;
L156: (ex B63 being DecoratedTree st (B63 = ( C55 . D35 ) & ( D30 . D35 ) = ( B63 . ( {} ) ))) by L136 , L144 , TREES_3:def 18;
L157: (ex B64 being DecoratedTree st (B64 = ( C53 . D35 ) & ( ( roots C53 ) . D35 ) = ( B64 . ( {} ) ))) by L125 , L136 , L144 , TREES_3:def 18;
thus L158: (( D30 . C59 ) in [: (the carrier' of R2) , { (the carrier of R2) } :] implies (for B65 being (OperSymbol of R2) holds ([ B65 , (the carrier of R2) ] = ( D30 . C59 ) implies ( the_result_sort_of B65 ) = ( ( the_arity_of D21 ) . C59 ))))
proof
assume L159: ( D30 . C59 ) in [: (the carrier' of R2) , { (the carrier of R2) } :];
let C61 being (OperSymbol of R2);
assume L160: [ C61 , (the carrier of R2) ] = ( D30 . C59 );
per cases ;
suppose L161: D35 = ( C54 + 1 );

L162:
now
per cases  by L124;
case L163: (ex B66 being set st (B66 in ( (the Sorts of C48) . C50 ) & C56 = ( root-tree [ B66 , C50 ] )));
consider C62 being set such that L164: C62 in ( (the Sorts of C48) . C50 ) and L165: C56 = ( root-tree [ C62 , C50 ] ) by L163;
L166: [ C61 , (the carrier of R2) ] = [ C62 , C50 ] by L112 , L123 , L156 , L160 , L161 , L165 , TREES_4:3;
L167: (the carrier of R2) = C50 by L166 , XTUPLE_0:1;
L168: (for B67 being set holds (not B67 in B67));
thus L169: contradiction by L168 , L167;
end;
case L170: (ex B68 being (OperSymbol of R2) st ([ B68 , (the carrier of R2) ] = ( C56 . ( {} ) ) & ( the_result_sort_of B68 ) = C50));
thus L171: thesis by L170 , L112 , L123 , L145 , L156 , L155 , L160 , L161 , XTUPLE_0:1;
end;
end;
thus L173: thesis by L162;
end;
suppose L174: D35 <> ( C54 + 1 );

L175: ( ( roots C53 ) . D35 ) = [ C61 , (the carrier of R2) ] by L174 , L113 , L125 , L136 , L144 , L156 , L157 , L160;
thus L176: thesis by L175 , L125 , L136 , L144 , L154 , L159 , L160 , MSAFREE1:3;
end;
end;

thus L178: (( D30 . C59 ) in ( Union ( coprod (the Sorts of C48) ) ) implies ( D30 . C59 ) in ( coprod (( ( the_arity_of D21 ) . C59 ) , (the Sorts of C48)) ))
proof
assume L179: ( D30 . C59 ) in ( Union ( coprod (the Sorts of C48) ) );
L180: ( D30 . C59 ) in ( Terminals ( DTConMSA (the Sorts of C48) ) ) by L179 , MSAFREE:6;
consider C63 being (SortSymbol of R2), C64 being set such that L181: (C64 in ( (the Sorts of C48) . C63 ) & ( D30 . C59 ) = [ C64 , C63 ]) by L180 , MSAFREE:7;
per cases ;
suppose L182: D35 = ( C54 + 1 );

reconsider D36 = ( D30 . D35 ) as (Terminal of ( DTConMSA (the Sorts of C48) )) by L179 , MSAFREE:6;
L183: C56 = ( root-tree D36 ) by L112 , L123 , L156 , L182 , DTCONSTR:9;
L184: C56 in { B69 where B69 is (Element of ( TS ( DTConMSA (the Sorts of C48) ) )) : ((ex B70 being set st (B70 in ( (the Sorts of C48) . C63 ) & B69 = ( root-tree [ B70 , C63 ] ))) or (ex B71 being (OperSymbol of R2) st ([ B71 , (the carrier of R2) ] = ( B69 . ( {} ) ) & ( the_result_sort_of B71 ) = C63))) } by L183 , L181;
L185: C56 in ( FreeSort ((the Sorts of C48) , C63) ) by L184 , MSAFREE:def 10;
L186: C52 in ( ( FreeSort (the Sorts of C48) ) . C50 ) by L121 , MSAFREE:def 11;
L187:
now
assume L188: C50 <> C63;
L189: ( ( FreeSort (the Sorts of C48) ) . C50 ) misses ( ( FreeSort (the Sorts of C48) ) . C63 ) by L188 , MSAFREE:12;
L190: ( ( ( FreeSort (the Sorts of C48) ) . C50 ) /\ ( ( FreeSort (the Sorts of C48) ) . C63 ) ) = ( {} ) by L189 , XBOOLE_0:def 7;
L191: C52 in ( ( FreeSort (the Sorts of C48) ) . C63 ) by L123 , L185 , MSAFREE:def 11;
thus L192: contradiction by L191 , L186 , L190 , XBOOLE_0:def 4;
end;
thus L193: thesis by L187 , L145 , L155 , L181 , L182 , MSAFREE:def 2;
end;
suppose L194: D35 <> ( C54 + 1 );

L195: ( D30 . D35 ) = ( ( roots C53 ) . D35 ) by L194 , L113 , L125 , L136 , L144 , L156 , L157;
thus L196: thesis by L195 , L125 , L136 , L144 , L154 , L179 , MSAFREE1:3;
end;
end;

end;
L179: ( len D30 ) = ( len C55 ) by L136 , FINSEQ_3:29;
L180: [ D25 , ( roots C55 ) ] in ( REL (the Sorts of C48) ) by L179 , L111 , L139 , L141 , MSAFREE:5;
L181: D25 ==> ( roots C55 ) by L180 , L107 , LANG1:def 1;
reconsider D37 = D28 as (SubtreeSeq of D25) by L181 , DTCONSTR:def 6;
L182: D16 = ( D25 -tree D37 ) by L110;
reconsider D38 = D16 as (Element of ( TS ( DTConMSA (the Sorts of C48) ) )) by L182;
L183: D14 in ( ( dom C51 ) with-replacement (D24 , ( dom C52 )) ) by TREES_1:22;
L184: (((not D24 is_a_prefix_of D14) & ( D16 . D14 ) = ( C51 . D14 )) or (ex B72 being (FinSequence of ( NAT )) st (B72 in ( dom C52 ) & D14 = ( D24 ^ B72 ) & ( D16 . D14 ) = ( C52 . B72 )))) by L183 , TREES_2:def 11;
L185: ( D16 . ( {} ) ) = [ D21 , (the carrier of R2) ] by L184 , L104 , TREES_4:def 4;
L186:
now
take D39 = D21;
L187: ( the_result_sort_of D39 ) = C49 by L137 , MSAFREE2:def 7;
thus L188: (ex B73 being (OperSymbol of R2) st ([ B73 , (the carrier of R2) ] = ( D16 . ( {} ) ) & ( the_result_sort_of B73 ) = C49)) by L187 , L185;
end;
L189: D38 in { B74 where B74 is (Element of ( TS ( DTConMSA (the Sorts of C48) ) )) : ((ex B75 being set st (B75 in ( (the Sorts of C48) . C49 ) & B74 = ( root-tree [ B75 , C49 ] ))) or (ex B76 being (OperSymbol of R2) st ([ B76 , (the carrier of R2) ] = ( B74 . ( {} ) ) & ( the_result_sort_of B76 ) = C49))) } by L186;
reconsider D40 = D38 as (Element of ( (the Sorts of ( FreeEnv C48 )) . C49 )) by L189 , L116 , MSAFREE:def 10;
L190: D40 in ( (the Sorts of ( FreeEnv C48 )) . C49 );
thus L191: thesis by L190;
end;
theorem
L192: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B77 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B78 being (Element of R2) holds (for B79 being (Element of ( (the Sorts of ( FreeEnv B77 )) . B78 )) holds (1 < ( card B79 ) implies (ex B80 being (OperSymbol of R2) st ( B79 . ( {} ) ) = [ B80 , (the carrier of R2) ]))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C65 being  finite-yielding  non-empty MSAlgebra over R2;
let C66 being (Element of R2);
let C67 being (Element of ( (the Sorts of ( FreeEnv C65 )) . C66 ));
set D41 = (the Sorts of C65);
assume L193: 1 < ( card C67 );
L194: (( ( FreeSort D41 ) . C66 ) = ( FreeSort (D41 , C66) ) & ( FreeSort (D41 , C66) ) = { B81 where B81 is (Element of ( TS ( DTConMSA D41 ) )) : ((ex B82 being set st (B82 in ( D41 . C66 ) & B81 = ( root-tree [ B82 , C66 ] ))) or (ex B83 being (OperSymbol of R2) st ([ B83 , (the carrier of R2) ] = ( B81 . ( {} ) ) & ( the_result_sort_of B83 ) = C66))) }) by MSAFREE:def 10 , MSAFREE:def 11;
L195: (C67 in ( (the Sorts of ( FreeMSA D41 )) . C66 ) & ( FreeMSA D41 ) = MSAlgebra (# ( FreeSort D41 ) , ( FreeOper D41 ) #)) by MSAFREE:def 14;
L196: (ex B84 being (Element of ( TS ( DTConMSA D41 ) )) st (B84 = C67 & ((ex B85 being set st (B85 in ( D41 . C66 ) & B84 = ( root-tree [ B85 , C66 ] ))) or (ex B86 being (OperSymbol of R2) st ([ B86 , (the carrier of R2) ] = ( B84 . ( {} ) ) & ( the_result_sort_of B86 ) = C66))))) by L195 , L194;
thus L197: thesis by L196 , L193 , PRE_CIRC:19;
end;
theorem
L198: (for B87 being non  void  Circuit-like non  empty ManySortedSign holds (for B88 being  non-empty (Circuit of B87) holds (for B89 being (State of B88) holds (for B90 being (OperSymbol of B87) holds ( ( Den (B90 , B88) ) . ( B90 depends_on_in B89 ) ) in ( (the Sorts of B88) . ( the_result_sort_of B90 ) )))))
proof
let C68 being non  void  Circuit-like non  empty ManySortedSign;
let C69 being  non-empty (Circuit of C68);
let C70 being (State of C69);
let C71 being (OperSymbol of C68);
L199: ( dom (the ResultSort of C68) ) = (the carrier' of C68) by FUNCT_2:def 1;
L200: ( Result (C71 , C69) ) = ( ( (the Sorts of C69) * (the ResultSort of C68) ) . C71 ) by MSUALG_1:def 5
.= ( (the Sorts of C69) . ( (the ResultSort of C68) . C71 ) ) by L199 , FUNCT_1:13
.= ( (the Sorts of C69) . ( the_result_sort_of C71 ) ) by MSUALG_1:def 2;
thus L201: thesis by L200 , FUNCT_2:5;
end;
theorem
L202: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B91 being  non-empty (Circuit of R2) holds (for B92 being (Vertex of R2) holds (for B93 being (Element of ( (the Sorts of ( FreeEnv B91 )) . B92 )) holds (( B93 . ( {} ) ) = [ ( action_at B92 ) , (the carrier of R2) ] implies (ex B94 being  DTree-yielding FinSequence st B93 = ( [ ( action_at B92 ) , (the carrier of R2) ] -tree B94 )))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C72 being  non-empty (Circuit of R2);
let C73 being (Vertex of R2);
let C74 being (Element of ( (the Sorts of ( FreeEnv C72 )) . C73 ));
assume that
L203: ( C74 . ( {} ) ) = [ ( action_at C73 ) , (the carrier of R2) ];
set D42 = (the Sorts of C72);
L204: (( NonTerminals ( DTConMSA D42 ) ) = [: (the carrier' of R2) , { (the carrier of R2) } :] & (the carrier of R2) in { (the carrier of R2) }) by MSAFREE:6 , TARSKI:def 1;
reconsider D43 = [ ( action_at C73 ) , (the carrier of R2) ] as (NonTerminal of ( DTConMSA D42 )) by L204 , ZFMISC_1:87;
L205: (( FreeMSA D42 ) = MSAlgebra (# ( FreeSort D42 ) , ( FreeOper D42 ) #) & C74 in ( (the Sorts of ( FreeEnv C72 )) . C73 )) by MSAFREE:def 14;
L206: C74 in ( FreeSort (D42 , C73) ) by L205 , MSAFREE:def 11;
reconsider D44 = C74 as (Element of ( TS ( DTConMSA D42 ) )) by L206;
consider C75 being (FinSequence of ( TS ( DTConMSA D42 ) )) such that L207: D44 = ( D43 -tree C75 ) and L208: D43 ==> ( roots C75 ) by L203 , DTCONSTR:10;
take C75;
thus L209: thesis by L207;
end;
begin
registration
let C76 being  monotonic non  void non  empty ManySortedSign;
let C77 being  finite-yielding  non-empty MSAlgebra over C76;
let C78 being (SortSymbol of C76);
cluster ( (the Sorts of ( FreeEnv C77 )) . C78 ) ->  finite;
coherence
proof
L210: (the Sorts of C77) is  finite-yielding by MSAFREE2:def 11;
L211: ( FreeEnv C77 ) is  finitely-generated by L210 , MSAFREE2:8;
L212: ( FreeEnv C77 ) is  finite-yielding by L211 , MSAFREE2:def 13;
L213: (the Sorts of ( FreeEnv C77 )) is  finite-yielding by L212 , MSAFREE2:def 11;
thus L214: thesis by L213;
end;
end;
defpred S2[ set ] means (not contradiction);
definition
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C79 being  finite-yielding  non-empty MSAlgebra over R2;
let C80 being (SortSymbol of R2);
func size (C80 , C79) -> Nat means 
:L216: (ex B95 being  finite non  empty (Subset of ( NAT )) st (B95 = { ( card B96 ) where B96 is (Element of ( (the Sorts of ( FreeEnv C79 )) . C80 )) : (not contradiction) } & it = ( max B95 )));
existence
proof
deffunc H1((Element of ( (the Sorts of ( FreeEnv C79 )) . C80 ))) = ( card $1 );
set D45 = { H1(B97) where B97 is (Element of ( (the Sorts of ( FreeEnv C79 )) . C80 )) : S2[ B97 ] };
set D46 = the (Element of ( (the Sorts of ( FreeEnv C79 )) . C80 ));
L217: ( card D46 ) in D45;
L218: D45 is (Subset of ( NAT )) from DOMAIN_1:sch 8;
L219: D45 is  finite from PRE_CIRC:sch 1;
reconsider D47 = D45 as  finite non  empty (Subset of ( NAT )) by L219 , L217 , L218;
take ( max D47 );
take D47;
thus L220: thesis;
end;
correctness;
end;
theorem
L222: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B98 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B99 being (Element of R2) holds (( size (B99 , B98) ) = 1 iff B99 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) )))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C81 being  finite-yielding  non-empty MSAlgebra over R2;
let C82 being (Element of R2);
consider C83 being  finite non  empty (Subset of ( NAT )) such that L223: C83 = { ( card B100 ) where B100 is (Element of ( (the Sorts of ( FreeEnv C81 )) . C82 )) : (not contradiction) } and L224: ( size (C82 , C81) ) = ( max C83 ) by L216;
reconsider D48 = C83 as  finite non  empty  real-membered set;
L225: ( max D48 ) in { ( card B101 ) where B101 is (Element of ( (the Sorts of ( FreeEnv C81 )) . C82 )) : (not contradiction) } by L223 , XXREAL_2:def 8;
consider C84 being (Element of ( (the Sorts of ( FreeEnv C81 )) . C82 )) such that L226: ( card C84 ) = ( max D48 ) by L225;
L227: ( FreeEnv C81 ) = MSAlgebra (# ( FreeSort (the Sorts of C81) ) , ( FreeOper (the Sorts of C81) ) #) by MSAFREE:def 14;
L228: (C84 in ( (the Sorts of ( FreeEnv C81 )) . C82 ) & ( (the Sorts of ( FreeEnv C81 )) . C82 ) = ( FreeSort ((the Sorts of C81) , C82) )) by L227 , MSAFREE:def 11;
L229: C84 in { B102 where B102 is (Element of ( TS ( DTConMSA (the Sorts of C81) ) )) : ((ex B103 being set st (B103 in ( (the Sorts of C81) . C82 ) & B102 = ( root-tree [ B103 , C82 ] ))) or (ex B104 being (OperSymbol of R2) st ([ B104 , (the carrier of R2) ] = ( B102 . ( {} ) ) & ( the_result_sort_of B104 ) = C82))) } by L228 , MSAFREE:def 10;
thus L230: (( size (C82 , C81) ) = 1 implies C82 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) ))
proof
assume L231: ( size (C82 , C81) ) = 1;
L232:
now
assume L233: (not C82 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) ));
L234: (not C82 in ( SortsWithConstants R2 )) by L233 , XBOOLE_0:def 3;
L235: (not C82 in { B105 where B105 is (SortSymbol of R2) : B105 is  with_const_op }) by L234 , MSAFREE2:def 1;
L236: (not C82 is  with_const_op) by L235;
L237: (the carrier of R2) = ( ( InputVertices R2 ) \/ ( InnerVertices R2 ) ) by XBOOLE_1:45;
L238: (not C82 in ( InputVertices R2 )) by L233 , XBOOLE_0:def 3;
L239: C82 in ( InnerVertices R2 ) by L238 , L237 , XBOOLE_0:def 3;
consider C85 being set such that L240: C85 in ( dom (the ResultSort of R2) ) and L241: C82 = ( (the ResultSort of R2) . C85 ) by L239 , FUNCT_1:def 3;
reconsider D49 = C85 as (OperSymbol of R2) by L240;
per cases  by L236 , MSUALG_2:def 1;
suppose L242: (not ( (the Arity of R2) . D49 ) = ( {} ));

L243: ( the_arity_of D49 ) <> ( {} ) by L242 , MSUALG_1:def 1;
reconsider D50 = ( [: (the carrier' of R2) , { (the carrier of R2) } :] \/ ( Union ( coprod (the Sorts of C81) ) ) ) as non  empty set;
reconsider D51 = ( REL (the Sorts of C81) ) as (Relation of D50 , ( D50 * ));
L244: (the carrier of R2) in { (the carrier of R2) } by TARSKI:def 1;
L245: [ D49 , (the carrier of R2) ] in [: (the carrier' of R2) , { (the carrier of R2) } :] by L244 , ZFMISC_1:87;
L246: ( DTConMSA (the Sorts of C81) ) = DTConstrStr (# D50 , D51 #) by MSAFREE:def 8;
reconsider D52 = [ D49 , (the carrier of R2) ] as (Symbol of ( DTConMSA (the Sorts of C81) )) by L246 , L245 , XBOOLE_0:def 3;
L247: D52 in ( NonTerminals ( DTConMSA (the Sorts of C81) ) ) by L245 , MSAFREE:6;
consider C86 being (FinSequence of ( TS ( DTConMSA (the Sorts of C81) ) )) such that L248: D52 ==> ( roots C86 ) by L247 , DTCONSTR:def 5;
reconsider D53 = ( D52 -tree C86 ) as (Element of ( TS ( DTConMSA (the Sorts of C81) ) )) by L248 , DTCONSTR:def 1;
reconsider D54 = D53 as  finite DecoratedTree;
reconsider D55 = ( card D54 ) as  real number;
L249: ( D53 . ( {} ) ) = D52 by TREES_4:def 4;
L250:
now
take D56 = D49;
L251: ( the_result_sort_of D56 ) = C82 by L241 , MSUALG_1:def 2;
thus L252: (ex B106 being (OperSymbol of R2) st ([ B106 , (the carrier of R2) ] = ( D53 . ( {} ) ) & ( the_result_sort_of B106 ) = C82)) by L251 , L249;
end;
L253: D53 in { B107 where B107 is (Element of ( TS ( DTConMSA (the Sorts of C81) ) )) : ((ex B108 being set st (B108 in ( (the Sorts of C81) . C82 ) & B107 = ( root-tree [ B108 , C82 ] ))) or (ex B109 being (OperSymbol of R2) st ([ B109 , (the carrier of R2) ] = ( B107 . ( {} ) ) & ( the_result_sort_of B109 ) = C82))) } by L250;
L254: D53 in ( FreeSort ((the Sorts of C81) , C82) ) by L253 , MSAFREE:def 10;
L255: ( (the Sorts of ( FreeEnv C81 )) . ( the_result_sort_of D49 ) ) = ( ( FreeSort (the Sorts of C81) ) . C82 ) by L227 , L241 , MSUALG_1:def 2
.= ( FreeSort ((the Sorts of C81) , C82) ) by MSAFREE:def 11;
reconsider D57 = D54 as (Element of ( (the Sorts of ( FreeEnv C81 )) . C82 )) by L255 , L241 , L254 , MSUALG_1:def 2;
L256: ( len C86 ) = ( len ( the_arity_of D49 ) ) by L254 , L255 , MSAFREE2:10;
L257: C86 <> ( {} ) by L256 , L243;
L258: ( rng C86 ) <> ( {} ) by L257;
L259: 1 in ( dom C86 ) by L258 , FINSEQ_3:32;
L260: ((ex B110 being  DTree-yielding FinSequence st (C86 = B110 & ( dom D53 ) = ( tree ( doms B110 ) ))) & ( ( 0 ) + 1 ) = 1) by TREES_4:def 4;
L261: <* ( 0 ) *> in ( dom D53 ) by L260 , L259 , PRE_CIRC:13;
consider C87 being (Element of ( NAT )), C88 being DecoratedTree, C89 being (Node of C88) such that L262: (C87 < ( len C86 ) & C88 = ( C86 . ( C87 + 1 ) ) & <* ( 0 ) *> = ( <* C87 *> ^ C89 )) by L261 , TREES_4:11;
L263: ( D53 . <* ( 0 ) *> ) = ( C88 . C89 ) by L262 , TREES_4:12;
L264: [ <* ( 0 ) *> , ( C88 . C89 ) ] in D53 by L263 , L261 , FUNCT_1:1;
L265: ( {} ) in ( dom D53 ) by TREES_1:22;
L266: [ ( {} ) , D52 ] in D53 by L265 , L249 , FUNCT_1:1;
L267: { [ ( {} ) , D52 ] , [ <* ( 0 ) *> , ( C88 . C89 ) ] } c= D53 by L266 , L264 , ZFMISC_1:32;
L268: D57 in ( (the Sorts of ( FreeEnv C81 )) . C82 );
L269: D55 in D48 by L268 , L223;
L270: [ ( {} ) , D52 ] <> [ <* ( 0 ) *> , ( C88 . C89 ) ] by XTUPLE_0:1;
L271: ( card { [ ( {} ) , D52 ] , [ <* ( 0 ) *> , ( C88 . C89 ) ] } ) = 2 by L270 , CARD_2:57;
L272: 2 <= D55 by L271 , L267 , NAT_1:43;
L273: D55 > ( size (C82 , C81) ) by L272 , L231 , XXREAL_0:2;
thus L274: contradiction by L273 , L224 , L269 , XXREAL_2:def 8;
end;
suppose L275: (not ( (the ResultSort of R2) . D49 ) = C82);

thus L276: contradiction by L275 , L241;
end;
end;
thus L278: thesis by L232;
end;

consider C90 being (Element of ( TS ( DTConMSA (the Sorts of C81) ) )) such that L279: C90 = C84 and L280: ((ex B111 being set st (B111 in ( (the Sorts of C81) . C82 ) & C90 = ( root-tree [ B111 , C82 ] ))) or (ex B112 being (OperSymbol of R2) st ([ B112 , (the carrier of R2) ] = ( C90 . ( {} ) ) & ( the_result_sort_of B112 ) = C82))) by L229;
assume L281: C82 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) );
per cases  by L281 , XBOOLE_0:def 3;
suppose L282: C82 in ( InputVertices R2 );

consider C91 being set such that L283: C91 in ( (the Sorts of C81) . C82 ) and L284: C90 = ( root-tree [ C91 , C82 ] ) by L282 , L280 , MSAFREE2:2;
L285: ( root-tree [ C91 , C82 ] ) = ( { ( {} ) } --> [ C91 , C82 ] ) by TREES_1:29 , TREES_4:def 2
.= [: { ( {} ) } , { [ C91 , C82 ] } :] by FUNCOP_1:def 2
.= { [ ( {} ) , [ C91 , C82 ] ] } by ZFMISC_1:29;
thus L286: thesis by L285 , L224 , L226 , L279 , L284 , CARD_1:30;
end;
suppose L287: C82 in ( SortsWithConstants R2 );

L288: C82 in { B113 where B113 is (SortSymbol of R2) : B113 is  with_const_op } by L287 , MSAFREE2:def 1;
consider C92 being (SortSymbol of R2) such that L289: C92 = C82 and L290: C92 is  with_const_op by L288;
consider C93 being (OperSymbol of R2) such that L291: ( (the Arity of R2) . C93 ) = ( {} ) and L292: ( (the ResultSort of R2) . C93 ) = C92 by L290 , MSUALG_2:def 1;
L293:
now
per cases  by L280;
suppose L294: (ex B114 being set st (B114 in ( (the Sorts of C81) . C82 ) & C90 = ( root-tree [ B114 , C82 ] )));

consider C94 being set such that L295: C94 in ( (the Sorts of C81) . C82 ) and L296: C90 = ( root-tree [ C94 , C82 ] ) by L294;
L297: ( root-tree [ C94 , C82 ] ) = { [ ( {} ) , [ C94 , C82 ] ] } by TREES_4:6;
thus L298: thesis by L297 , L224 , L226 , L279 , L296 , CARD_1:30;
end;
suppose L299: (ex B115 being (OperSymbol of R2) st ([ B115 , (the carrier of R2) ] = ( C90 . ( {} ) ) & ( the_result_sort_of B115 ) = C82));

consider C95 being (OperSymbol of R2) such that L300: [ C95 , (the carrier of R2) ] = ( C90 . ( {} ) ) and L301: ( the_result_sort_of C95 ) = C82 by L299;
L302: ( the_result_sort_of C95 ) = ( the_result_sort_of C93 ) by L289 , L292 , L301 , MSUALG_1:def 2;
L303: C95 = C93 by L302 , MSAFREE2:def 6;
L304: (( NonTerminals ( DTConMSA (the Sorts of C81) ) ) = [: (the carrier' of R2) , { (the carrier of R2) } :] & (the carrier of R2) in { (the carrier of R2) }) by MSAFREE:6 , TARSKI:def 1;
reconsider D58 = [ C95 , (the carrier of R2) ] as (NonTerminal of ( DTConMSA (the Sorts of C81) )) by L304 , ZFMISC_1:87;
consider C96 being (FinSequence of ( TS ( DTConMSA (the Sorts of C81) ) )) such that L305: C90 = ( D58 -tree C96 ) and L306: D58 ==> ( roots C96 ) by L300 , DTCONSTR:10;
reconsider D59 = C96 as  DTree-yielding FinSequence;
L307: ( len D59 ) = ( len ( the_arity_of C95 ) ) by L279 , L301 , L305 , MSAFREE2:10
.= ( len ( {} ) ) by L291 , L303 , MSUALG_1:def 1
.= ( 0 );
L308: D59 = ( {} ) by L307;
L309: C90 = ( root-tree D58 ) by L308 , L305 , TREES_4:20
.= { [ ( {} ) , D58 ] } by TREES_4:6;
thus L310: thesis by L309 , L224 , L226 , L279 , CARD_1:30;
end;
end;
thus L312: thesis by L293;
end;
end;
theorem
L314: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B116 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B117 , B118 being (Vertex of R2) holds (for B119 being (Element of ( (the Sorts of ( FreeEnv B116 )) . B117 )) holds (for B120 being (Element of ( (the Sorts of ( FreeEnv B116 )) . B118 )) holds (for B121 being  DTree-yielding FinSequence holds ((B117 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) & ( card B119 ) = ( size (B117 , B116) ) & B119 = ( [ ( action_at B117 ) , (the carrier of R2) ] -tree B121 ) & B120 in ( rng B121 )) implies ( card B120 ) = ( size (B118 , B116) ))))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C97 being  finite-yielding  non-empty MSAlgebra over R2;
let C98 , C99 being (Vertex of R2);
let C100 being (Element of ( (the Sorts of ( FreeEnv C97 )) . C98 ));
let C101 being (Element of ( (the Sorts of ( FreeEnv C97 )) . C99 ));
let C102 being  DTree-yielding FinSequence;
assume that
L315: C98 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) )
and
L316: ( card C100 ) = ( size (C98 , C97) )
and
L317: C100 = ( [ ( action_at C98 ) , (the carrier of R2) ] -tree C102 )
and
L318: C101 in ( rng C102 );
consider C103 being  finite non  empty (Subset of ( NAT )) such that L319: C103 = { ( card B122 ) where B122 is (Element of ( (the Sorts of ( FreeEnv C97 )) . C99 )) : (not contradiction) } and L320: ( size (C99 , C97) ) = ( max C103 ) by L216;
reconsider D60 = C103 as  finite non  empty  real-membered set;
reconsider D61 = ( max D60 ) as  real number;
L321: D61 in { ( card B123 ) where B123 is (Element of ( (the Sorts of ( FreeEnv C97 )) . C99 )) : (not contradiction) } by L319 , XXREAL_2:def 8;
consider C104 being (Element of ( (the Sorts of ( FreeEnv C97 )) . C99 )) such that L322: ( card C104 ) = D61 by L321;
L323: ( card C101 ) in D60 by L319;
L324: ( card C101 ) <= ( max D60 ) by L323 , XXREAL_2:def 8;
reconsider D62 = C104 as DecoratedTree;
reconsider D63 = C100 as DecoratedTree;
reconsider D64 = C102 as Function;
consider C105 being set such that L325: C105 in ( dom D64 ) and L326: C101 = ( D64 . C105 ) by L318 , FUNCT_1:def 3;
L327: C105 in ( dom C102 ) by L325;
reconsider D65 = C105 as (Element of ( NAT )) by L327;
reconsider D66 = ( D65 - 1 ) as (Element of ( NAT )) by L325 , FINSEQ_3:26;
L328: ( D66 + 1 ) = D65;
L329: (ex B124 being  DTree-yielding FinSequence st (B124 = C102 & ( dom D63 ) = ( tree ( doms B124 ) ))) by L317 , TREES_4:def 4;
reconsider D67 = <* D66 *> as (Element of ( dom C100 )) by L329 , L325 , L328 , PRE_CIRC:13;
L330: D65 <= ( len C102 ) by L325 , FINSEQ_3:25;
L331: D66 < D65 by L328 , XREAL_1:29;
L332: D66 < ( len C102 ) by L331 , L330 , XXREAL_0:2;
L333: ( C100 | D67 ) = C101 by L332 , L317 , L326 , L328 , TREES_4:def 4;
assume L334: ( card C101 ) <> ( size (C99 , C97) );
L335: ( card C101 ) < ( max D60 ) by L334 , L320 , L324 , XXREAL_0:1;
L336: (( ( card ( C100 with-replacement (D67 , C104) ) ) + ( card ( C100 | D67 ) ) ) = ( ( card C100 ) + ( card C104 ) ) & ( ( card C100 ) + ( card ( C100 | D67 ) ) ) < ( ( card C100 ) + ( card C104 ) )) by L335 , L322 , L333 , PRE_CIRC:18 , XREAL_1:6;
L337: ( card C100 ) < ( card ( C100 with-replacement (D67 , C104) ) ) by L336 , XREAL_1:6;
reconsider D68 = D67 as (FinSequence of ( NAT ));
reconsider D69 = ( D63 with-replacement (D68 , D62) ) as DecoratedTree;
reconsider D70 = D69 as (Element of ( (the Sorts of ( FreeEnv C97 )) . C98 )) by L315 , L317 , L325 , L326 , L328 , L102;
consider C106 being  finite non  empty (Subset of ( NAT )) such that L338: C106 = { ( card B125 ) where B125 is (Element of ( (the Sorts of ( FreeEnv C97 )) . C98 )) : (not contradiction) } and L339: ( size (C98 , C97) ) = ( max C106 ) by L216;
reconsider D71 = C106 as  finite non  empty  real-membered set;
L340: ( card D70 ) in D71 by L338;
thus L341: contradiction by L340 , L316 , L339 , L337 , XXREAL_2:def 8;
end;
theorem
L342: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B126 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B127 being (Vertex of R2) holds (for B128 being (Element of ( (the Sorts of ( FreeEnv B126 )) . B127 )) holds ((B127 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) & ( card B128 ) = ( size (B127 , B126) )) implies (ex B129 being  DTree-yielding FinSequence st B128 = ( [ ( action_at B127 ) , (the carrier of R2) ] -tree B129 )))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C107 being  finite-yielding  non-empty MSAlgebra over R2;
let C108 being (Vertex of R2);
let C109 being (Element of ( (the Sorts of ( FreeEnv C107 )) . C108 ));
assume that
L343: C108 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) )
and
L344: ( card C109 ) = ( size (C108 , C107) );
L345: (not C108 in ( SortsWithConstants R2 )) by L343 , XBOOLE_0:def 5;
L346: ( InputVertices R2 ) misses ( InnerVertices R2 ) by XBOOLE_1:79;
L347: ( ( InputVertices R2 ) /\ ( InnerVertices R2 ) ) = ( {} ) by L346 , XBOOLE_0:def 7;
L348: C108 in ( InnerVertices R2 ) by L343 , XBOOLE_0:def 5;
L349: (not C108 in ( InputVertices R2 )) by L348 , L347 , XBOOLE_0:def 4;
L350: (not C108 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) )) by L349 , L345 , XBOOLE_0:def 3;
L351: ( card C109 ) <> 1 by L350 , L344 , L222;
reconsider D72 = C109 as  finite non  empty set;
L352: ( FreeEnv C107 ) = MSAlgebra (# ( FreeSort (the Sorts of C107) ) , ( FreeOper (the Sorts of C107) ) #) by MSAFREE:def 14;
L353: ( (the Sorts of ( FreeEnv C107 )) . C108 ) = ( FreeSort ((the Sorts of C107) , C108) ) by L352 , MSAFREE:def 11;
L354: C109 in ( FreeSort ((the Sorts of C107) , C108) ) by L353;
L355: C109 in { B130 where B130 is (Element of ( TS ( DTConMSA (the Sorts of C107) ) )) : ((ex B131 being set st (B131 in ( (the Sorts of C107) . C108 ) & B130 = ( root-tree [ B131 , C108 ] ))) or (ex B132 being (OperSymbol of R2) st ([ B132 , (the carrier of R2) ] = ( B130 . ( {} ) ) & ( the_result_sort_of B132 ) = C108))) } by L354 , MSAFREE:def 10;
L356: 1 <= ( card D72 ) by NAT_1:14;
L357: 1 < ( card D72 ) by L356 , L351 , XXREAL_0:1;
consider C110 being (OperSymbol of R2) such that L358: ( C109 . ( {} ) ) = [ C110 , (the carrier of R2) ] by L357 , L192;
L359: (( NonTerminals ( DTConMSA (the Sorts of C107) ) ) = [: (the carrier' of R2) , { (the carrier of R2) } :] & (the carrier of R2) in { (the carrier of R2) }) by MSAFREE:6 , TARSKI:def 1;
reconsider D73 = [ C110 , (the carrier of R2) ] as (NonTerminal of ( DTConMSA (the Sorts of C107) )) by L359 , ZFMISC_1:87;
consider C111 being (Element of ( TS ( DTConMSA (the Sorts of C107) ) )) such that L360: C111 = C109 and L361: ((ex B133 being set st (B133 in ( (the Sorts of C107) . C108 ) & C111 = ( root-tree [ B133 , C108 ] ))) or (ex B134 being (OperSymbol of R2) st ([ B134 , (the carrier of R2) ] = ( C111 . ( {} ) ) & ( the_result_sort_of B134 ) = C108))) by L355;
consider C112 being set such that L362: ((C112 in ( (the Sorts of C107) . C108 ) & C111 = ( root-tree [ C112 , C108 ] )) or (ex B135 being (OperSymbol of R2) st ([ B135 , (the carrier of R2) ] = ( C111 . ( {} ) ) & ( the_result_sort_of B135 ) = C108))) by L361;
consider C113 being (FinSequence of ( TS ( DTConMSA (the Sorts of C107) ) )) such that L363: C111 = ( D73 -tree C113 ) and L364: D73 ==> ( roots C113 ) by L360 , L358 , DTCONSTR:10;
reconsider D74 = C113 as  DTree-yielding FinSequence;
take D74;
L365: C108 in ( InnerVertices R2 ) by L343 , XBOOLE_0:def 5;
L366:
now
assume L367: C111 = ( root-tree [ C112 , C108 ] );
L368: [ C110 , (the carrier of R2) ] = [ C112 , C108 ] by L367 , L360 , L358 , TREES_4:3;
L369: (the carrier of R2) = C108 by L368 , XTUPLE_0:1;
L370: (for B136 being set holds (not B136 in B136));
thus L371: contradiction by L370 , L369;
end;
consider C114 being (OperSymbol of R2) such that L372: [ C114 , (the carrier of R2) ] = ( C111 . ( {} ) ) and L373: ( the_result_sort_of C114 ) = C108 by L366 , L362;
L374: C110 = C114 by L360 , L358 , L372 , XTUPLE_0:1
.= ( action_at C108 ) by L373 , L365 , MSAFREE2:def 7;
thus L375: thesis by L374 , L360 , L363;
end;
theorem
L376: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B137 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B138 being (Vertex of R2) holds (for B139 being (Element of ( (the Sorts of ( FreeEnv B137 )) . B138 )) holds ((B138 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) & ( card B139 ) = ( size (B138 , B137) )) implies (ex B140 being (OperSymbol of R2) st ( B139 . ( {} ) ) = [ B140 , (the carrier of R2) ]))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C115 being  finite-yielding  non-empty MSAlgebra over R2;
let C116 being (Vertex of R2);
let C117 being (Element of ( (the Sorts of ( FreeEnv C115 )) . C116 ));
assume L377: (C116 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) & ( card C117 ) = ( size (C116 , C115) ));
L378: (ex B141 being  DTree-yielding FinSequence st C117 = ( [ ( action_at C116 ) , (the carrier of R2) ] -tree B141 )) by L377 , L342;
take ( action_at C116 );
thus L379: thesis by L378 , TREES_4:def 4;
end;
definition
let C118 being non  void non  empty ManySortedSign;
let C119 being  finite-yielding  non-empty MSAlgebra over C118;
let C120 being (SortSymbol of C118);
let C121 being (Element of ( (the Sorts of ( FreeEnv C119 )) . C120 ));
func depth C121 -> (Element of ( NAT )) means 
:L380: (ex B142 being (Element of ( (the Sorts of ( FreeMSA (the Sorts of C119) )) . C120 )) st (C121 = B142 & it = ( depth B142 )));
existence
proof
reconsider D75 = C121 as (Element of ( (the Sorts of ( FreeMSA (the Sorts of C119) )) . C120 ));
reconsider D76 = ( depth D75 ) as (Element of ( NAT )) by ORDINAL1:def 12;
take D76;
take D75;
thus L381: thesis;
end;
correctness;
end;
theorem
L383: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B143 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B144 , B145 being (Element of R2) holds ((B144 in ( InnerVertices R2 ) & B145 in ( rng ( the_arity_of ( action_at B144 ) ) )) implies ( size (B145 , B143) ) < ( size (B144 , B143) )))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C122 being  finite-yielding  non-empty MSAlgebra over R2;
let C123 , C124 being (Element of R2);
assume that
L384: C123 in ( InnerVertices R2 )
and
L385: C124 in ( rng ( the_arity_of ( action_at C123 ) ) );
reconsider D77 = ( action_at C123 ) as (OperSymbol of R2);
consider C125 being set such that L386: C125 in ( dom ( the_arity_of D77 ) ) and L387: C124 = ( ( the_arity_of D77 ) . C125 ) by L385 , FUNCT_1:def 3;
reconsider D78 = C125 as (Element of ( NAT )) by L386;
reconsider D79 = ( D78 - 1 ) as (Element of ( NAT )) by L386 , FINSEQ_3:26;
L388: ( D79 + 1 ) = D78;
reconsider D80 = <* D79 *> as (FinSequence of ( NAT ));
consider C126 being  finite non  empty (Subset of ( NAT )) such that L389: C126 = { ( card B146 ) where B146 is (Element of ( (the Sorts of ( FreeEnv C122 )) . C123 )) : (not contradiction) } and L390: ( size (C123 , C122) ) = ( max C126 ) by L216;
reconsider D81 = C126 as  finite non  empty  real-membered set;
L391: ( max D81 ) in D81 by XXREAL_2:def 8;
consider C127 being (Element of ( (the Sorts of ( FreeEnv C122 )) . C123 )) such that L392: ( card C127 ) = ( max D81 ) by L391 , L389;
L393:
now
assume L394: C123 in ( SortsWithConstants R2 );
L395: C123 in { B147 where B147 is (SortSymbol of R2) : B147 is  with_const_op } by L394 , MSAFREE2:def 1;
consider C128 being (SortSymbol of R2) such that L396: C128 = C123 and L397: C128 is  with_const_op by L395;
consider C129 being (OperSymbol of R2) such that L398: ( (the Arity of R2) . C129 ) = ( {} ) and L399: ( (the ResultSort of R2) . C129 ) = C128 by L397 , MSUALG_2:def 1;
L400: ( the_result_sort_of C129 ) = C123 by L396 , L399 , MSUALG_1:def 2
.= ( the_result_sort_of D77 ) by L384 , MSAFREE2:def 7;
L401: D77 = C129 by L400 , MSAFREE2:def 6;
reconsider D82 = ( (the Arity of R2) . C129 ) as FinSequence;
L402: ( dom D82 ) = ( {} ) by L398;
thus L403: contradiction by L402 , L386 , L401 , MSUALG_1:def 1;
end;
L404: C123 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) by L393 , L384 , XBOOLE_0:def 5;
consider C130 being  DTree-yielding FinSequence such that L405: C127 = ( [ D77 , (the carrier of R2) ] -tree C130 ) by L404 , L390 , L392 , L342;
L406: ( (the Sorts of ( FreeEnv C122 )) . C123 ) = ( (the Sorts of ( FreeEnv C122 )) . ( the_result_sort_of D77 ) ) by L384 , MSAFREE2:def 7;
L407: ( len C130 ) = ( len ( the_arity_of D77 ) ) by L406 , L405 , MSAFREE2:10;
L408: D78 in ( dom C130 ) by L407 , L386 , FINSEQ_3:29;
reconsider D83 = C127 as  finite DecoratedTree;
reconsider D84 = ( dom D83 ) as  finite Tree;
consider C131 being  finite non  empty (Subset of ( NAT )) such that L409: C131 = { ( card B148 ) where B148 is (Element of ( (the Sorts of ( FreeEnv C122 )) . C124 )) : (not contradiction) } and L410: ( size (C124 , C122) ) = ( max C131 ) by L216;
reconsider D85 = C131 as  finite non  empty  real-membered set;
L411: ( max D85 ) in D85 by XXREAL_2:def 8;
consider C132 being (Element of ( (the Sorts of ( FreeEnv C122 )) . C124 )) such that L412: ( card C132 ) = ( max D85 ) by L411 , L409;
reconsider D86 = C132 as  finite DecoratedTree;
reconsider D87 = ( dom D86 ) as  finite Tree;
L413: (ex B149 being  DTree-yielding FinSequence st (B149 = C130 & ( dom D83 ) = ( tree ( doms B149 ) ))) by L405 , TREES_4:def 4;
reconsider D88 = D80 as (Element of ( dom D83 )) by L413 , L408 , L388 , PRE_CIRC:13;
reconsider D89 = ( D83 with-replacement (D88 , D86) ) as  finite Function;
reconsider D90 = D88 as (Element of D84);
reconsider D91 = ( dom D89 ) as  finite Tree;
L414: ( card ( D84 | D90 ) ) < ( card D84 ) by PRE_CIRC:16;
L415: ( dom D89 ) = ( D84 with-replacement (D90 , D87) ) by TREES_2:def 11;
L416: ( ( card D91 ) + ( card ( D84 | D90 ) ) ) = ( ( card D84 ) + ( card D87 ) ) by L415 , PRE_CIRC:17;
L417: ( ( card ( D84 | D90 ) ) + ( card D87 ) ) < ( ( card D91 ) + ( card ( D84 | D90 ) ) ) by L416 , L414 , XREAL_1:6;
L418: ( card D87 ) < ( card D91 ) by L417 , XREAL_1:6;
L419: ( card D86 ) < ( card D91 ) by L418 , CARD_1:62;
L420: ( C130 . D78 ) in ( (the Sorts of ( FreeEnv C122 )) . ( ( the_arity_of D77 ) . D78 ) ) by L386 , L405 , L406 , MSAFREE2:11;
reconsider D92 = D89 as (Element of ( (the Sorts of ( FreeEnv C122 )) . C123 )) by L420 , L387 , L404 , L405 , L408 , L388 , L102;
L421: ( card D92 ) in D81 by L389;
L422: ( card D92 ) <= ( size (C123 , C122) ) by L421 , L390 , XXREAL_2:def 8;
L423: ( card D91 ) <= ( size (C123 , C122) ) by L422 , CARD_1:62;
thus L424: thesis by L423 , L410 , L412 , L419 , XXREAL_0:2;
end;
theorem
L425: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B150 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B151 being (SortSymbol of R2) holds ( size (B151 , B150) ) > ( 0 ))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C133 being  finite-yielding  non-empty MSAlgebra over R2;
let C134 being (SortSymbol of R2);
consider C135 being  finite non  empty (Subset of ( NAT )) such that L426: C135 = { ( card B152 ) where B152 is (Element of ( (the Sorts of ( FreeEnv C133 )) . C134 )) : (not contradiction) } and L427: ( size (C134 , C133) ) = ( max C135 ) by L216;
reconsider D93 = C135 as  finite non  empty  real-membered set;
L428: ( max D93 ) in { ( card B153 ) where B153 is (Element of ( (the Sorts of ( FreeEnv C133 )) . C134 )) : (not contradiction) } by L426 , XXREAL_2:def 8;
L429: (ex B154 being (Element of ( (the Sorts of ( FreeEnv C133 )) . C134 )) st ( card B154 ) = ( max D93 )) by L428;
thus L430: thesis by L429 , L427;
end;
theorem
L431: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B155 being  non-empty (Circuit of R2) holds (for B156 being (Vertex of R2) holds (for B157 being (Element of ( (the Sorts of ( FreeEnv B155 )) . B156 )) holds (for B158 being  DTree-yielding FinSequence holds ((B156 in ( InnerVertices R2 ) & B157 = ( [ ( action_at B156 ) , (the carrier of R2) ] -tree B158 ) & (for B159 being (Element of ( NAT )) holds (B159 in ( dom B158 ) implies (ex B160 being (Element of ( (the Sorts of ( FreeEnv B155 )) . ( ( the_arity_of ( action_at B156 ) ) /. B159 ) )) st (B160 = ( B158 . B159 ) & ( card B160 ) = ( size (( ( the_arity_of ( action_at B156 ) ) /. B159 ) , B155) )))))) implies ( card B157 ) = ( size (B156 , B155) )))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C136 being  non-empty (Circuit of R2);
let C137 being (Vertex of R2);
let C138 being (Element of ( (the Sorts of ( FreeEnv C136 )) . C137 ));
let C139 being  DTree-yielding FinSequence;
assume that
L432: C137 in ( InnerVertices R2 )
and
L433: C138 = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree C139 )
and
L434: (for B161 being (Element of ( NAT )) holds (B161 in ( dom C139 ) implies (ex B162 being (Element of ( (the Sorts of ( FreeEnv C136 )) . ( ( the_arity_of ( action_at C137 ) ) /. B161 ) )) st (B162 = ( C139 . B161 ) & ( card B162 ) = ( size (( ( the_arity_of ( action_at C137 ) ) /. B161 ) , C136) )))));
consider C140 being  finite non  empty (Subset of ( NAT )) such that L435: C140 = { ( card B163 ) where B163 is (Element of ( (the Sorts of ( FreeEnv C136 )) . C137 )) : (not contradiction) } and L436: ( size (C137 , C136) ) = ( max C140 ) by L216;
reconsider D94 = C140 as  finite non  empty  real-membered set;
L437:
now
reconsider D95 = C138 as  finite set;
let C141 being  ext-real number;
L438: 1 <= ( card D95 ) by NAT_1:14;
assume L439: C141 in D94;
consider C142 being (Element of ( (the Sorts of ( FreeEnv C136 )) . C137 )) such that L440: C141 = ( card C142 ) by L439 , L435;
L441: ( FreeEnv C136 ) = MSAlgebra (# ( FreeSort (the Sorts of C136) ) , ( FreeOper (the Sorts of C136) ) #) by MSAFREE:def 14;
L442: ( (the Sorts of ( FreeEnv C136 )) . C137 ) = ( FreeSort ((the Sorts of C136) , C137) ) by L441 , MSAFREE:def 11;
L443: C142 in ( FreeSort ((the Sorts of C136) , C137) ) by L442;
L444: C142 in { B164 where B164 is (Element of ( TS ( DTConMSA (the Sorts of C136) ) )) : ((ex B165 being set st (B165 in ( (the Sorts of C136) . C137 ) & B164 = ( root-tree [ B165 , C137 ] ))) or (ex B166 being (OperSymbol of R2) st ([ B166 , (the carrier of R2) ] = ( B164 . ( {} ) ) & ( the_result_sort_of B166 ) = C137))) } by L443 , MSAFREE:def 10;
consider C143 being (Element of ( TS ( DTConMSA (the Sorts of C136) ) )) such that L445: C143 = C142 and L446: ((ex B167 being set st (B167 in ( (the Sorts of C136) . C137 ) & C143 = ( root-tree [ B167 , C137 ] ))) or (ex B168 being (OperSymbol of R2) st ([ B168 , (the carrier of R2) ] = ( C143 . ( {} ) ) & ( the_result_sort_of B168 ) = C137))) by L444;
per cases  by L446;
suppose L447: (ex B169 being set st (B169 in ( (the Sorts of C136) . C137 ) & C143 = ( root-tree [ B169 , C137 ] )));

consider C144 being set such that L448: C144 in ( (the Sorts of C136) . C137 ) and L449: C143 = ( root-tree [ C144 , C137 ] ) by L447;
L450: ( root-tree [ C144 , C137 ] ) = { [ ( {} ) , [ C144 , C137 ] ] } by TREES_4:6;
thus L451: C141 <= ( card C138 ) by L450 , L438 , L440 , L445 , L449 , CARD_1:30;
end;
suppose L452: (ex B170 being (OperSymbol of R2) st ([ B170 , (the carrier of R2) ] = ( C143 . ( {} ) ) & ( the_result_sort_of B170 ) = C137));

L453: ( C143 . ( {} ) ) = [ ( action_at C137 ) , (the carrier of R2) ] by L452 , L432 , MSAFREE2:def 7;
consider C145 being  DTree-yielding FinSequence such that L454: C142 = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree C145 ) by L453 , L445 , L202;
deffunc H2(Nat) = ( C139 +* ( C145 | ( Seg $1 ) ) );
consider C146 being FinSequence such that L455: ( len C146 ) = ( len C139 ) and L456: (for B171 being Nat holds (B171 in ( dom C146 ) implies ( C146 . B171 ) = H2(B171))) from FINSEQ_1:sch 2;
L457: ( dom C146 ) = ( dom C139 ) by L455 , FINSEQ_3:29;
L458: ( the_result_sort_of ( action_at C137 ) ) = C137 by L432 , MSAFREE2:def 7;
L459: ( dom C139 ) = ( Seg ( len C139 ) ) by FINSEQ_1:def 3;
L460:
now
per cases ;
suppose L461: ( len C145 ) = ( 0 );

L462: C145 = ( {} ) by L461;
L463: C142 = ( root-tree [ ( action_at C137 ) , (the carrier of R2) ] ) by L462 , L454 , TREES_4:20;
thus L464: C141 <= ( card C138 ) by L463 , L438 , L440 , PRE_CIRC:19;
end;
suppose L465: ( len C145 ) <> ( 0 );

defpred S3[ (Element of ( NAT )) ] means ($1 in ( dom C139 ) implies (for B172 being  DTree-yielding FinSequence holds (B172 = ( C146 . $1 ) implies (for B173 being  finite set holds (B173 = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree B172 ) implies ( card B173 ) <= ( card C138 ))))));
L466: ( len C139 ) = ( len ( the_arity_of ( action_at C137 ) ) ) by L433 , L458 , MSAFREE2:10;
L467: ( len C139 ) = ( len C145 ) by L466 , L454 , L458 , MSAFREE2:10;
L468: ( 1 + ( 0 ) ) <= ( len C139 ) by L467 , L465 , NAT_1:14;
L469: ( dom C139 ) = ( dom C145 ) by L467 , FINSEQ_3:29;
L470: ( dom C139 ) = ( dom ( the_arity_of ( action_at C137 ) ) ) by L466 , FINSEQ_3:29;
L471:
now
let C147 being (Element of ( NAT ));
assume L472: S3[ C147 ];
thus L473: S3[ ( C147 + 1 ) ]
proof
reconsider D96 = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree C139 ) as  finite DecoratedTree by L433;
assume L474: ( C147 + 1 ) in ( dom C139 );
let C148 being  DTree-yielding FinSequence;
assume that
L475: C148 = ( C146 . ( C147 + 1 ) );
let C149 being  finite set;
assume L476: C149 = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree C148 );
reconsider D97 = C149 as  finite DecoratedTree by L476;
per cases ;
suppose L477: C147 = ( 0 );

set D98 = ( ( the_arity_of ( action_at C137 ) ) /. 1 );
L478: 1 in ( dom C139 ) by L468 , FINSEQ_3:25;
consider C150 being (Element of ( (the Sorts of ( FreeEnv C136 )) . D98 )) such that L479: C150 = ( C139 . 1 ) and L480: ( card C150 ) = ( size (D98 , C136) ) by L478 , L434;
L481: 1 in ( Seg 1 ) by FINSEQ_1:3;
L482: 1 in ( dom ( C145 | ( Seg 1 ) ) ) by L481 , L469 , L478 , RELAT_1:57;
L483: 1 in ( dom ( the_arity_of ( action_at C137 ) ) ) by L466 , L468 , FINSEQ_3:25;
L484: ( C145 . 1 ) in ( (the Sorts of ( FreeEnv C136 )) . ( ( the_arity_of ( action_at C137 ) ) . 1 ) ) by L483 , L454 , L458 , MSAFREE2:11;
reconsider D99 = ( C145 . 1 ) as (Element of ( (the Sorts of ( FreeEnv C136 )) . D98 )) by L484 , L483 , PARTFUN1:def 6;
reconsider D100 = ( C139 . 1 ) as  finite DecoratedTree by L479;
L485: (( {} ) is (Element of ( dom D100 )) & <* ( 0 ) *> = ( <* ( 0 ) *> ^ ( {} ) )) by FINSEQ_1:34 , TREES_1:22;
reconsider D101 = <* ( 0 ) *> as (Element of ( dom D96 )) by L485 , L468 , TREES_4:11;
consider C151 being  DTree-yielding FinSequence such that L486: ( C138 with-replacement (D101 , D99) ) = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree C151 ) and L487: ( len C151 ) = ( len C139 ) and L488: ( C151 . ( ( 0 ) + 1 ) ) = D99 and L489: (for B174 being (Element of ( NAT )) holds ((B174 in ( dom C139 ) & B174 <> ( ( 0 ) + 1 )) implies ( C151 . B174 ) = ( C139 . B174 ))) by L433 , PRE_CIRC:15;
L490: 1 in ( dom C139 ) by L468 , FINSEQ_3:25;
L491: ( C148 . 1 ) = ( ( C139 +* ( C145 | ( Seg 1 ) ) ) . 1 ) by L490 , L456 , L457 , L475 , L477
.= ( ( C145 | ( Seg 1 ) ) . 1 ) by L482 , FUNCT_4:13
.= ( C145 . 1 ) by FINSEQ_1:3 , FUNCT_1:49;
L492:
now
let C152 being Nat;
assume L493: (1 <= C152 & C152 <= ( len C151 ));
L494: C152 in ( dom C139 ) by L493 , L487 , FINSEQ_3:25;
per cases ;
suppose L495: C152 = 1;

thus L496: ( C151 . C152 ) = ( C148 . C152 ) by L495 , L491 , L488;
end;
suppose L497: C152 <> 1;

L498: ( dom ( C145 | ( Seg 1 ) ) ) = ( ( dom C145 ) /\ ( Seg 1 ) ) by RELAT_1:61;
L499: (not C152 in ( Seg 1 )) by L497 , FINSEQ_1:2 , TARSKI:def 1;
L500: (not C152 in ( dom ( C145 | ( Seg 1 ) ) )) by L499 , L498 , XBOOLE_0:def 4;
thus L501: ( C148 . C152 ) = ( ( C139 +* ( C145 | ( Seg 1 ) ) ) . C152 ) by L456 , L457 , L475 , L477 , L490
.= ( C139 . C152 ) by L500 , FUNCT_4:11
.= ( C151 . C152 ) by L489 , L494 , L497;
end;
end;
L503: ( dom C148 ) = ( dom ( C139 +* ( C145 | ( Seg 1 ) ) ) ) by L456 , L457 , L475 , L477 , L490
.= ( ( dom C139 ) \/ ( dom ( C145 | ( Seg 1 ) ) ) ) by FUNCT_4:def 1
.= ( ( dom C139 ) \/ ( ( dom C145 ) /\ ( Seg 1 ) ) ) by RELAT_1:61
.= ( dom C139 ) by L469 , XBOOLE_1:22;
L504: ( len C148 ) = ( len C139 ) by L503 , FINSEQ_3:29;
L505: D97 = ( D96 with-replacement (D101 , D99) ) by L504 , L433 , L476 , L486 , L487 , L492 , FINSEQ_1:14;
L506: ( ( card D97 ) + ( card ( D96 | D101 ) ) ) = ( ( card D96 ) + ( card D99 ) ) by L505 , PRE_CIRC:18;
consider C153 being  finite non  empty (Subset of ( NAT )) such that L507: C153 = { ( card B175 ) where B175 is (Element of ( (the Sorts of ( FreeEnv C136 )) . D98 )) : (not contradiction) } and L508: ( card C150 ) = ( max C153 ) by L480 , L216;
reconsider D102 = C153 as  finite non  empty  real-membered set;
L509: ( card D99 ) in D102 by L507;
L510: ( card D99 ) <= ( card C150 ) by L509 , L508 , XXREAL_2:def 8;
L511: ( D96 | D101 ) = C150 by L468 , L479 , TREES_4:def 4;
thus L512: thesis by L511 , L433 , L510 , L506 , XREAL_1:8;
end;
suppose L513: C147 <> ( 0 );

L514: ( C147 + 1 ) <= ( len C139 ) by L474 , FINSEQ_3:25;
L515: C147 < ( len C139 ) by L514 , NAT_1:13;
set D103 = ( ( the_arity_of ( action_at C137 ) ) /. ( C147 + 1 ) );
L516: ((not ( C147 + 1 ) in ( Seg C147 )) & ( dom ( C145 | ( Seg C147 ) ) ) = ( ( dom C145 ) /\ ( Seg C147 ) )) by FINSEQ_3:8 , RELAT_1:61;
L517: (not ( C147 + 1 ) in ( dom ( C145 | ( Seg C147 ) ) )) by L516 , XBOOLE_0:def 4;
L518: ( C147 + 1 ) >= 1 by NAT_1:11;
L519: ( C147 + 1 ) in ( dom ( the_arity_of ( action_at C137 ) ) ) by L518 , L466 , L514 , FINSEQ_3:25;
L520: ( C139 . ( C147 + 1 ) ) in ( (the Sorts of ( FreeEnv C136 )) . ( ( the_arity_of ( action_at C137 ) ) . ( C147 + 1 ) ) ) by L519 , L433 , L458 , MSAFREE2:11;
reconsider D104 = ( C139 . ( C147 + 1 ) ) as (Element of ( (the Sorts of ( FreeEnv C136 )) . D103 )) by L520 , L519 , PARTFUN1:def 6;
L521: ( C147 + 1 ) in ( Seg ( C147 + 1 ) ) by FINSEQ_1:3;
L522: ( C147 + 1 ) in ( dom ( C145 | ( Seg ( C147 + 1 ) ) ) ) by L521 , L469 , L474 , RELAT_1:57;
L523: C147 >= 1 by L513 , NAT_1:14;
L524: C147 in ( dom C139 ) by L523 , L515 , FINSEQ_3:25;
L525: ( C146 . C147 ) = ( C139 +* ( C145 | ( Seg C147 ) ) ) by L524 , L456 , L457;
reconsider D105 = ( C146 . C147 ) as Function by L525;
L526: ( dom D105 ) = ( dom ( C139 +* ( C145 | ( Seg C147 ) ) ) ) by L456 , L457 , L524
.= ( ( dom C139 ) \/ ( dom ( C145 | ( Seg C147 ) ) ) ) by FUNCT_4:def 1
.= ( ( dom C139 ) \/ ( ( dom C145 ) /\ ( Seg C147 ) ) ) by RELAT_1:61
.= ( dom C139 ) by L469 , XBOOLE_1:22;
L527: ( dom D105 ) = ( Seg ( len C139 ) ) by L526 , FINSEQ_1:def 3;
reconsider D106 = D105 as FinSequence by L527 , FINSEQ_1:def 2;
L528: (for B176 being set holds (B176 in ( dom D106 ) implies ( D106 . B176 ) is  finite  finite  finite  finite DecoratedTree))
proof
let C154 being set;
assume L529: C154 in ( dom D106 );
reconsider D107 = C154 as (Element of ( NAT )) by L529;
set D108 = ( ( the_arity_of ( action_at C137 ) ) /. D107 );
L530: (( D106 . D107 ) = ( C145 . D107 ) or ( D106 . D107 ) = ( C139 . D107 ))
proof
per cases ;
suppose L531: D107 <= C147;

L532: D107 >= 1 by L529 , FINSEQ_3:25;
L533: D107 in ( Seg C147 ) by L532 , L531 , FINSEQ_1:1;
L534: ( dom ( C145 | ( Seg C147 ) ) ) = ( ( dom C145 ) /\ ( Seg C147 ) ) by RELAT_1:61;
L535: D107 in ( dom ( C145 | ( Seg C147 ) ) ) by L534 , L469 , L526 , L529 , L533 , XBOOLE_0:def 4;
L536: ( D106 . D107 ) = ( ( C139 +* ( C145 | ( Seg C147 ) ) ) . D107 ) by L456 , L457 , L524
.= ( ( C145 | ( Seg C147 ) ) . D107 ) by L535 , FUNCT_4:13
.= ( C145 . D107 ) by L535 , FUNCT_1:47;
thus L537: thesis by L536;
end;
suppose L538: D107 > C147;

L539: ( dom ( C145 | ( Seg C147 ) ) ) = ( ( dom C145 ) /\ ( Seg C147 ) ) by RELAT_1:61;
L540: (not D107 in ( Seg C147 )) by L538 , FINSEQ_1:1;
L541: (not D107 in ( dom ( C145 | ( Seg C147 ) ) )) by L540 , L539 , XBOOLE_0:def 4;
L542: ( D106 . D107 ) = ( ( C139 +* ( C145 | ( Seg C147 ) ) ) . D107 ) by L456 , L457 , L524
.= ( C139 . D107 ) by L541 , FUNCT_4:11;
thus L543: thesis by L542;
end;
end;
L545: ( D106 . D107 ) in ( (the Sorts of ( FreeEnv C136 )) . ( ( the_arity_of ( action_at C137 ) ) . D107 ) ) by L530 , L433 , L454 , L458 , L470 , L526 , L529 , MSAFREE2:11;
reconsider D109 = ( D106 . D107 ) as (Element of ( (the Sorts of ( FreeEnv C136 )) . D108 )) by L545 , L470 , L526 , L529 , PARTFUN1:def 6;
L546: D109 in ( (the Sorts of ( FreeEnv C136 )) . D108 );
thus L547: thesis by L546;
end;
L548: (for B177 being set holds (B177 in ( dom D106 ) implies ( D106 . B177 ) is DecoratedTree)) by L528;
reconsider D110 = D106 as  DTree-yielding FinSequence by L548 , TREES_3:24;
L549: ( len D110 ) = ( len C139 ) by L526 , FINSEQ_3:29;
L550: ( D110 . ( C147 + 1 ) ) = ( ( C139 +* ( C145 | ( Seg C147 ) ) ) . ( C147 + 1 ) ) by L456 , L457 , L524
.= ( C139 . ( C147 + 1 ) ) by L517 , FUNCT_4:11;
L551:
now
let C155 being set;
assume L552: C155 in ( dom ( doms D110 ) );
L553: C155 in ( dom D110 ) by L552 , TREES_3:37;
reconsider D111 = ( D110 . C155 ) as  finite DecoratedTree by L553 , L528;
L554: ( dom D111 ) is  finite  finite  finite  finite Tree;
thus L555: ( ( doms D110 ) . C155 ) is  finite  finite  finite  finite Tree by L554 , L553 , FUNCT_6:22;
end;
reconsider D112 = ( doms D110 ) as  FinTree-yielding FinSequence by L551 , TREES_3:23;
L556: (( tree D112 ) is  finite & (ex B178 being  DTree-yielding FinSequence st (D110 = B178 & ( dom ( [ ( action_at C137 ) , (the carrier of R2) ] -tree D110 ) ) = ( tree ( doms B178 ) )))) by TREES_4:def 4;
reconsider D113 = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree D110 ) as  finite DecoratedTree by L556 , FINSET_1:10;
consider C156 being (Element of ( (the Sorts of ( FreeEnv C136 )) . D103 )) such that L557: C156 = ( C139 . ( C147 + 1 ) ) and L558: ( card C156 ) = ( size (D103 , C136) ) by L434 , L474;
L559: D104 in ( (the Sorts of ( FreeEnv C136 )) . D103 );
reconsider D114 = ( D110 . ( C147 + 1 ) ) as  finite DecoratedTree by L559 , L550;
L560: D103 = ( ( the_arity_of ( action_at C137 ) ) . ( C147 + 1 ) ) by L519 , PARTFUN1:def 6;
reconsider D115 = ( C145 . ( C147 + 1 ) ) as (Element of ( (the Sorts of ( FreeEnv C136 )) . D103 )) by L560 , L454 , L458 , L519 , MSAFREE2:11;
L561: (( {} ) is (Element of ( dom D114 )) & <* C147 *> = ( <* C147 *> ^ ( {} ) )) by FINSEQ_1:34 , TREES_1:22;
L562: <* C147 *> in ( dom D113 ) by L561 , L515 , L549 , TREES_4:11;
consider C157 being  DTree-yielding FinSequence such that L563: ( D113 with-replacement (<* C147 *> , D115) ) = ( [ ( action_at C137 ) , (the carrier of R2) ] -tree C157 ) and L564: ( len C157 ) = ( len D110 ) and L565: ( C157 . ( C147 + 1 ) ) = D115 and L566: (for B179 being (Element of ( NAT )) holds ((B179 in ( dom D110 ) & B179 <> ( C147 + 1 )) implies ( C157 . B179 ) = ( D110 . B179 ))) by L562 , PRE_CIRC:15;
L567: ( C148 . ( C147 + 1 ) ) = ( ( C139 +* ( C145 | ( Seg ( C147 + 1 ) ) ) ) . ( C147 + 1 ) ) by L456 , L457 , L474 , L475
.= ( ( C145 | ( Seg ( C147 + 1 ) ) ) . ( C147 + 1 ) ) by L522 , FUNCT_4:13
.= ( C145 . ( C147 + 1 ) ) by FINSEQ_1:3 , FUNCT_1:49;
L568:
now
let C158 being Nat;
assume that
L569: 1 <= C158
and
L570: C158 <= ( len C157 );
L571: C158 in ( dom D110 ) by L564 , L569 , L570 , FINSEQ_3:25;
per cases  by XXREAL_0:1;
suppose L572: C158 = ( C147 + 1 );

thus L573: ( C157 . C158 ) = ( C148 . C158 ) by L572 , L567 , L565;
end;
suppose L574: C158 > ( C147 + 1 );

L575: ( C147 + 1 ) >= C147 by NAT_1:11;
L576: C158 > C147 by L575 , L574 , XXREAL_0:2;
L577: (not C158 in ( Seg C147 )) by L576 , FINSEQ_1:1;
L578: ( dom ( C145 | ( Seg C147 ) ) ) = ( ( dom C145 ) /\ ( Seg C147 ) ) by RELAT_1:61;
L579: (not C158 in ( dom ( C145 | ( Seg C147 ) ) )) by L578 , L577 , XBOOLE_0:def 4;
L580: ( dom ( C145 | ( Seg ( C147 + 1 ) ) ) ) = ( ( dom C145 ) /\ ( Seg ( C147 + 1 ) ) ) by RELAT_1:61;
L581: (not C158 in ( Seg ( C147 + 1 ) )) by L574 , FINSEQ_1:1;
L582: (not C158 in ( dom ( C145 | ( Seg ( C147 + 1 ) ) ) )) by L581 , L580 , XBOOLE_0:def 4;
thus L583: ( C148 . C158 ) = ( ( C139 +* ( C145 | ( Seg ( C147 + 1 ) ) ) ) . C158 ) by L456 , L457 , L474 , L475
.= ( C139 . C158 ) by L582 , FUNCT_4:11
.= ( ( C139 +* ( C145 | ( Seg C147 ) ) ) . C158 ) by L579 , FUNCT_4:11
.= ( D110 . C158 ) by L456 , L457 , L524
.= ( C157 . C158 ) by L566 , L571 , L574;
end;
suppose L584: C158 < ( C147 + 1 );

L585: C158 in ( dom C145 ) by L467 , L549 , L564 , L569 , L570 , FINSEQ_3:25;
L586: C158 <= C147 by L584 , NAT_1:13;
L587: C158 in ( Seg C147 ) by L586 , L569 , FINSEQ_1:1;
L588: ( dom ( C145 | ( Seg C147 ) ) ) = ( ( dom C145 ) /\ ( Seg C147 ) ) by RELAT_1:61;
L589: C158 in ( dom ( C145 | ( Seg C147 ) ) ) by L588 , L585 , L587 , XBOOLE_0:def 4;
L590: ( dom ( C145 | ( Seg ( C147 + 1 ) ) ) ) = ( ( dom C145 ) /\ ( Seg ( C147 + 1 ) ) ) by RELAT_1:61;
L591: C158 in ( Seg ( C147 + 1 ) ) by L569 , L584 , FINSEQ_1:1;
L592: C158 in ( dom ( C145 | ( Seg ( C147 + 1 ) ) ) ) by L591 , L585 , L590 , XBOOLE_0:def 4;
thus L593: ( C148 . C158 ) = ( ( C139 +* ( C145 | ( Seg ( C147 + 1 ) ) ) ) . C158 ) by L456 , L457 , L474 , L475
.= ( ( C145 | ( Seg ( C147 + 1 ) ) ) . C158 ) by L592 , FUNCT_4:13
.= ( C145 . C158 ) by L592 , FUNCT_1:47
.= ( ( C145 | ( Seg C147 ) ) . C158 ) by L589 , FUNCT_1:47
.= ( ( C139 +* ( C145 | ( Seg C147 ) ) ) . C158 ) by L589 , FUNCT_4:13
.= ( D110 . C158 ) by L456 , L457 , L524
.= ( C157 . C158 ) by L566 , L571 , L584;
end;
end;
L595: C147 < ( len D110 ) by L515 , L526 , FINSEQ_3:29;
reconsider D116 = <* C147 *> as (Element of ( dom D113 )) by L595 , L561 , TREES_4:11;
L596: ( dom C148 ) = ( dom ( C139 +* ( C145 | ( Seg ( C147 + 1 ) ) ) ) ) by L456 , L457 , L474 , L475
.= ( ( dom C139 ) \/ ( dom ( C145 | ( Seg ( C147 + 1 ) ) ) ) ) by FUNCT_4:def 1
.= ( ( dom C139 ) \/ ( ( dom C145 ) /\ ( Seg ( C147 + 1 ) ) ) ) by RELAT_1:61
.= ( dom C139 ) by L469 , XBOOLE_1:22;
L597: ( len C148 ) = ( len C139 ) by L596 , FINSEQ_3:29;
L598: D97 = ( D113 with-replacement (D116 , D115) ) by L597 , L476 , L549 , L563 , L564 , L568 , FINSEQ_1:14;
L599: ( ( card D97 ) + ( card ( D113 | D116 ) ) ) = ( ( card D113 ) + ( card D115 ) ) by L598 , PRE_CIRC:18;
consider C159 being  finite non  empty (Subset of ( NAT )) such that L600: C159 = { ( card B180 ) where B180 is (Element of ( (the Sorts of ( FreeEnv C136 )) . D103 )) : (not contradiction) } and L601: ( card C156 ) = ( max C159 ) by L558 , L216;
reconsider D117 = C159 as  finite non  empty  real-membered set;
L602: ( card D115 ) in D117 by L600;
L603: ( card D115 ) <= ( card C156 ) by L602 , L601 , XXREAL_2:def 8;
L604: ( D113 | D116 ) = C156 by L515 , L557 , L550 , L549 , TREES_4:def 4;
L605: ( card C149 ) <= ( card D113 ) by L604 , L603 , L599 , XREAL_1:8;
L606: ( card D113 ) <= ( card C138 ) by L472 , L523 , L515 , FINSEQ_3:25;
thus L607: thesis by L606 , L605 , XXREAL_0:2;
end;
end;

end;
L474: S3[ ( 0 ) ] by FINSEQ_3:25;
L475: (for B181 being (Element of ( NAT )) holds S3[ B181 ]) from NAT_1:sch 1(L474 , L471);
L476: ( dom C139 ) = ( Seg ( len C139 ) ) by FINSEQ_1:def 3;
L477: ( dom C139 ) = ( dom C145 ) by L476 , L467 , FINSEQ_1:def 3;
L478: ( len C139 ) in ( dom C139 ) by L468 , FINSEQ_3:25;
L479: ( C146 . ( len C139 ) ) = ( C139 +* ( C145 | ( dom C139 ) ) ) by L478 , L456 , L457 , L459
.= ( C139 +* C145 ) by L477 , RELAT_1:69
.= C145 by L469 , FUNCT_4:19;
thus L480: C141 <= ( card C138 ) by L479 , L440 , L454 , L475 , L478;
end;
end;
thus L482: C141 <= ( card C138 ) by L460;
end;
end;
L484: ( card C138 ) in D94 by L435;
thus L485: thesis by L484 , L436 , L437 , XXREAL_2:def 8;
end;
begin
definition
let C160 being  monotonic non  void non  empty ManySortedSign;
let C161 being  finite-yielding  non-empty MSAlgebra over C160;
let C162 being (SortSymbol of C160);
func depth (C162 , C161) -> Nat means 
:L486: (ex B182 being  finite non  empty (Subset of ( NAT )) st (B182 = { ( depth B183 ) where B183 is (Element of ( (the Sorts of ( FreeEnv C161 )) . C162 )) : (not contradiction) } & it = ( max B182 )));
existence
proof
deffunc H3((Element of ( (the Sorts of ( FreeEnv C161 )) . C162 ))) = ( depth $1 );
set D118 = { H3(B184) where B184 is (Element of ( (the Sorts of ( FreeEnv C161 )) . C162 )) : S2[ B184 ] };
set D119 = the (Element of ( (the Sorts of ( FreeEnv C161 )) . C162 ));
L487: ( depth D119 ) in D118;
L488: D118 is (Subset of ( NAT )) from DOMAIN_1:sch 8;
L489: D118 is  finite from PRE_CIRC:sch 1;
reconsider D120 = D118 as  finite non  empty (Subset of ( NAT )) by L489 , L487 , L488;
take ( max D120 );
take D120;
thus L490: thesis;
end;
correctness;
end;
definition
let C163 being  finite  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C164 being  non-empty (Circuit of C163);
func depth C164 -> Nat means 
:L492: (ex B185 being  finite non  empty (Subset of ( NAT )) st (B185 = { ( depth (B186 , C164) ) where B186 is (Element of C163) : B186 in (the carrier of C163) } & it = ( max B185 )));
existence
proof
deffunc H4((Element of C163)) = ( depth ($1 , C164) );
set D121 = { H4(B187) where B187 is (Element of C163) : B187 in (the carrier of C163) };
L493: D121 is  natural-membered
proof
let C165 being number;
assume L494: C165 in D121;
L495: (ex B188 being (Element of C163) st (C165 = ( depth (B188 , C164) ) & B188 in (the carrier of C163))) by L494;
thus L496: thesis by L495;
end;
set D122 = the (Element of C163);
L497: ( depth (D122 , C164) ) in D121;
L498: (the carrier of C163) is  finite;
L499: D121 is  finite from FRAENKEL:sch 21(L498);
reconsider D123 = D121 as  finite non  empty (Subset of ( NAT )) by L499 , L493 , L497 , MEMBERED:6;
take ( max D123 );
take D123;
thus L500: thesis;
end;
uniqueness;
end;
theorem
L502: (for B189 being  finite  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B190 being  non-empty (Circuit of B189) holds (for B191 being (Vertex of B189) holds ( depth (B191 , B190) ) <= ( depth B190 ))))
proof
let C166 being  finite  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C167 being  non-empty (Circuit of C166);
let C168 being (Vertex of C166);
consider C169 being  finite non  empty (Subset of ( NAT )) such that L503: C169 = { ( depth (B192 , C167) ) where B192 is (Element of C166) : B192 in (the carrier of C166) } and L504: ( depth C167 ) = ( max C169 ) by L492;
reconsider D124 = C169 as  finite non  empty  real-membered set;
L505: ( depth (C168 , C167) ) in D124 by L503;
thus L506: thesis by L505 , L504 , XXREAL_2:def 8;
end;
theorem
L507: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B193 being  non-empty (Circuit of R2) holds (for B194 being (Vertex of R2) holds (( depth (B194 , B193) ) = ( 0 ) iff (B194 in ( InputVertices R2 ) or B194 in ( SortsWithConstants R2 ))))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C170 being  non-empty (Circuit of R2);
let C171 being (Vertex of R2);
consider C172 being  finite non  empty (Subset of ( NAT )) such that L508: C172 = { ( depth B195 ) where B195 is (Element of ( (the Sorts of ( FreeEnv C170 )) . C171 )) : (not contradiction) } and L509: ( depth (C171 , C170) ) = ( max C172 ) by L486;
reconsider D125 = C172 as  finite non  empty  real-membered set;
L510: ( max D125 ) in { ( depth B196 ) where B196 is (Element of ( (the Sorts of ( FreeEnv C170 )) . C171 )) : (not contradiction) } by L508 , XXREAL_2:def 8;
consider C173 being  finite non  empty (Subset of ( NAT )) such that L511: C173 = { ( card B197 ) where B197 is (Element of ( (the Sorts of ( FreeEnv C170 )) . C171 )) : (not contradiction) } and L512: ( size (C171 , C170) ) = ( max C173 ) by L216;
reconsider D126 = C173 as  finite non  empty  real-membered set;
consider C174 being (Element of ( (the Sorts of ( FreeEnv C170 )) . C171 )) such that L513: ( depth C174 ) = ( max D125 ) by L510;
reconsider D127 = C174 as Function;
consider C175 being (Element of ( (the Sorts of ( FreeMSA (the Sorts of C170) )) . C171 )) such that L514: C174 = C175 and L515: ( depth C174 ) = ( depth C175 ) by L380;
consider C176 being  finite DecoratedTree, C177 being  finite Tree such that L516: (C176 = C175 & C177 = ( dom C176 )) and L517: ( depth C175 ) = ( height C177 ) by MSAFREE2:def 14;
consider C178 being (FinSequence of ( NAT )) such that L518: C178 in C177 and L519: ( len C178 ) = ( height C177 ) by TREES_1:def 12;
consider C179 being set such that L520: [ C178 , C179 ] in D127 by L514 , L516 , L518 , XTUPLE_0:def 12;
thus L521: (( depth (C171 , C170) ) = ( 0 ) implies (C171 in ( InputVertices R2 ) or C171 in ( SortsWithConstants R2 )))
proof
assume L522: ( depth (C171 , C170) ) = ( 0 );
L523: (for B198 being  ext-real number holds (B198 in D126 implies B198 <= 1))
proof
let C180 being  ext-real number;
assume L524: C180 in D126;
consider C181 being (Element of ( (the Sorts of ( FreeEnv C170 )) . C171 )) such that L525: ( card C181 ) = C180 by L524 , L511;
consider C182 being (Element of ( (the Sorts of ( FreeMSA (the Sorts of C170) )) . C171 )) such that L526: (C181 = C182 & ( depth C181 ) = ( depth C182 )) by L380;
L527: ( depth C181 ) in D125 by L508;
L528: ( depth C181 ) = ( 0 ) by L527 , L509 , L522 , XXREAL_2:def 8;
L529: (ex B199 being  finite DecoratedTree st (ex B200 being  finite Tree st (B199 = C182 & B200 = ( dom B199 ) & ( depth C182 ) = ( height B200 )))) by MSAFREE2:def 14;
L530: ( rng C181 ) = { ( C181 . ( {} ) ) } by L529 , L528 , L526 , FUNCT_1:4 , TREES_1:29 , TREES_1:43;
L531: C181 = { [ ( {} ) , ( C181 . ( {} ) ) ] } by L530 , L528 , L526 , L529 , PRE_CIRC:1 , TREES_1:29 , TREES_1:43;
thus L532: thesis by L531 , L525 , CARD_1:30;
end;
L533: ( rng D127 ) = { ( C174 . ( {} ) ) } by L509 , L513 , L514 , L515 , L516 , L517 , L522 , FUNCT_1:4 , TREES_1:29 , TREES_1:43;
L534: D127 = { [ ( {} ) , ( C174 . ( {} ) ) ] } by L533 , L509 , L513 , L514 , L515 , L516 , L517 , L522 , PRE_CIRC:1 , TREES_1:29 , TREES_1:43;
L535: ( card C174 ) = 1 by L534 , CARD_1:30;
L536: 1 in D126 by L535 , L511;
L537: ( size (C171 , C170) ) = 1 by L536 , L512 , L523 , XXREAL_2:def 8;
L538: C171 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) ) by L537 , L222;
thus L539: thesis by L538 , XBOOLE_0:def 3;
end;

L540: ( card C174 ) in ( NAT );
reconsider D128 = ( card C174 ) as Real by L540;
L541: ( {} ) in ( dom C174 ) by TREES_1:22;
consider C183 being set such that L542: [ ( {} ) , C183 ] in D127 by L541 , XTUPLE_0:def 12;
L543: ( card C174 ) in C173 by L511;
assume L544: (C171 in ( InputVertices R2 ) or C171 in ( SortsWithConstants R2 ));
L545: C171 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) ) by L544 , XBOOLE_0:def 3;
L546: ( size (C171 , C170) ) = 1 by L545 , L222;
L547: D128 <= 1 by L546 , L512 , L543 , XXREAL_2:def 8;
L548: (( card C174 ) <= ( 0 ) or ( card C174 ) = ( ( 0 ) + 1 )) by L547 , NAT_1:8;
consider C184 being set such that L549: C174 = { C184 } by L548 , CARD_2:42;
L550: C184 = [ ( {} ) , C183 ] by L549 , L542 , TARSKI:def 1;
L551: [ C178 , C179 ] = [ ( {} ) , C183 ] by L550 , L549 , L520 , TARSKI:def 1;
L552: C178 = ( {} ) by L551 , XTUPLE_0:1;
thus L553: thesis by L552 , L509 , L513 , L515 , L517 , L519;
end;
theorem
L554: (for R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign holds (for B201 being  finite-yielding  non-empty MSAlgebra over R2 holds (for B202 , B203 being (SortSymbol of R2) holds ((B202 in ( InnerVertices R2 ) & B203 in ( rng ( the_arity_of ( action_at B202 ) ) )) implies ( depth (B203 , B201) ) < ( depth (B202 , B201) )))))
proof
let R2 being  monotonic  Circuit-like non  void non  empty ManySortedSign;
let C185 being  finite-yielding  non-empty MSAlgebra over R2;
let C186 , C187 being (SortSymbol of R2);
assume that
L555: C186 in ( InnerVertices R2 )
and
L556: C187 in ( rng ( the_arity_of ( action_at C186 ) ) );
L557: ( size (C187 , C185) ) > ( 0 ) by L425;
L558: ( ( 0 ) + 1 ) <= ( size (C187 , C185) ) by L557 , NAT_1:13;
L559: ( size (C187 , C185) ) < ( size (C186 , C185) ) by L555 , L556 , L383;
L560: (not C186 in ( ( InputVertices R2 ) \/ ( SortsWithConstants R2 ) )) by L559 , L558 , L222;
L561: (not C186 in ( SortsWithConstants R2 )) by L560 , XBOOLE_0:def 3;
L562: C186 in ( ( InnerVertices R2 ) \ ( SortsWithConstants R2 ) ) by L561 , L555 , XBOOLE_0:def 5;
consider C188 being  finite non  empty (Subset of ( NAT )) such that L563: C188 = { ( depth B204 ) where B204 is (Element of ( (the Sorts of ( FreeEnv C185 )) . C187 )) : (not contradiction) } and L564: ( depth (C187 , C185) ) = ( max C188 ) by L486;
reconsider D129 = C188 as  finite non  empty  real-membered set;
L565: ( max D129 ) in { ( depth B205 ) where B205 is (Element of ( (the Sorts of ( FreeEnv C185 )) . C187 )) : (not contradiction) } by L563 , XXREAL_2:def 8;
consider C189 being (Element of ( (the Sorts of ( FreeEnv C185 )) . C187 )) such that L566: ( depth C189 ) = ( max D129 ) by L565;
reconsider D130 = ( action_at C186 ) as (OperSymbol of R2);
consider C190 being  finite non  empty (Subset of ( NAT )) such that L567: C190 = { ( depth B206 ) where B206 is (Element of ( (the Sorts of ( FreeEnv C185 )) . C186 )) : (not contradiction) } and L568: ( depth (C186 , C185) ) = ( max C190 ) by L486;
consider C191 being set such that L569: C191 in ( dom ( the_arity_of D130 ) ) and L570: C187 = ( ( the_arity_of D130 ) . C191 ) by L556 , FUNCT_1:def 3;
reconsider D131 = C190 as  finite non  empty  real-membered set;
L571: ( max D131 ) in { ( depth B207 ) where B207 is (Element of ( (the Sorts of ( FreeEnv C185 )) . C186 )) : (not contradiction) } by L567 , XXREAL_2:def 8;
consider C192 being (Element of ( (the Sorts of ( FreeEnv C185 )) . C186 )) such that L572: ( depth C192 ) = ( max D131 ) by L571;
L573: ( FreeEnv C185 ) = MSAlgebra (# ( FreeSort (the Sorts of C185) ) , ( FreeOper (the Sorts of C185) ) #) by MSAFREE:def 14;
L574: ( (the Sorts of ( FreeEnv C185 )) . C186 ) = ( FreeSort ((the Sorts of C185) , C186) ) by L573 , MSAFREE:def 11;
L575: C192 in ( FreeSort ((the Sorts of C185) , C186) ) by L574;
L576: C192 in { B208 where B208 is (Element of ( TS ( DTConMSA (the Sorts of C185) ) )) : ((ex B209 being set st (B209 in ( (the Sorts of C185) . C186 ) & B208 = ( root-tree [ B209 , C186 ] ))) or (ex B210 being (OperSymbol of R2) st ([ B210 , (the carrier of R2) ] = ( B208 . ( {} ) ) & ( the_result_sort_of B210 ) = C186))) } by L575 , MSAFREE:def 10;
reconsider D132 = C191 as (Element of ( NAT )) by L569;
reconsider D133 = ( D132 - 1 ) as (Element of ( NAT )) by L569 , FINSEQ_3:26;
reconsider D134 = <* D133 *> as (FinSequence of ( NAT ));
L577: ( D133 + 1 ) = D132;
reconsider D135 = ( C192 with-replacement (D134 , C189) ) as DecoratedTree;
consider C193 being (Element of ( (the Sorts of ( FreeMSA (the Sorts of C185) )) . C187 )) such that L578: C189 = C193 and L579: ( depth C189 ) = ( depth C193 ) by L380;
consider C194 being  finite DecoratedTree, C195 being  finite Tree such that L580: (C194 = C193 & C195 = ( dom C194 )) and L581: ( depth C193 ) = ( height C195 ) by MSAFREE2:def 14;
consider C196 being (Element of ( TS ( DTConMSA (the Sorts of C185) ) )) such that L582: C196 = C192 and L583: ((ex B211 being set st (B211 in ( (the Sorts of C185) . C186 ) & C196 = ( root-tree [ B211 , C186 ] ))) or (ex B212 being (OperSymbol of R2) st ([ B212 , (the carrier of R2) ] = ( C196 . ( {} ) ) & ( the_result_sort_of B212 ) = C186))) by L576;
L584: (not C186 in ( InputVertices R2 )) by L560 , XBOOLE_0:def 3;
L585:
now
given C197 being set such that
L586: C197 in ( (the Sorts of C185) . C186 )
and
L587: C196 = ( root-tree [ C197 , C186 ] );

consider C198 being (Element of ( (the Sorts of ( FreeMSA (the Sorts of C185) )) . C186 )) such that L588: (C192 = C198 & ( depth C192 ) = ( depth C198 )) by L380;
L589: (ex B213 being  finite DecoratedTree st (ex B214 being  finite Tree st (B213 = C198 & B214 = ( dom B213 ) & ( depth C198 ) = ( height B214 )))) by MSAFREE2:def 14;
L590: ( depth C192 ) = ( 0 ) by L589 , L582 , L587 , L588 , TREES_1:42 , TREES_4:3;
thus L591: contradiction by L590 , L568 , L572 , L584 , L561 , L507;
end;
consider C199 being (OperSymbol of R2) such that L592: [ C199 , (the carrier of R2) ] = ( C196 . ( {} ) ) and L593: ( the_result_sort_of C199 ) = C186 by L585 , L583;
L594: (( NonTerminals ( DTConMSA (the Sorts of C185) ) ) = [: (the carrier' of R2) , { (the carrier of R2) } :] & (the carrier of R2) in { (the carrier of R2) }) by MSAFREE:6 , TARSKI:def 1;
reconsider D136 = [ C199 , (the carrier of R2) ] as (NonTerminal of ( DTConMSA (the Sorts of C185) )) by L594 , ZFMISC_1:87;
consider C200 being (FinSequence of ( TS ( DTConMSA (the Sorts of C185) ) )) such that L595: C196 = ( D136 -tree C200 ) and L596: D136 ==> ( roots C200 ) by L592 , DTCONSTR:10;
consider C201 being  DTree-yielding FinSequence such that L597: C200 = C201 and L598: ( dom C196 ) = ( tree ( doms C201 ) ) by L595 , TREES_4:def 4;
L599: C192 = ( [ D130 , (the carrier of R2) ] -tree C201 ) by L555 , L582 , L593 , L595 , L597 , MSAFREE2:def 7;
L600: C199 = D130 by L555 , L593 , MSAFREE2:def 7;
L601: ( len C201 ) = ( len ( the_arity_of D130 ) ) by L600 , L582 , L593 , L595 , L597 , MSAFREE2:10;
L602: D132 in ( dom C201 ) by L601 , L569 , FINSEQ_3:29;
L603: ( dom C201 ) = ( dom ( the_arity_of D130 ) ) by L601 , FINSEQ_3:29;
consider C202 being  DTree-yielding FinSequence such that L604: ( C192 with-replacement (D134 , C189) ) = ( D136 -tree C202 ) and L605: ( len C202 ) = ( len C201 ) and L606: ( C202 . ( D133 + 1 ) ) = C189 and L607: (for B215 being (Element of ( NAT )) holds ((B215 in ( dom C201 ) & B215 <> ( D133 + 1 )) implies ( C202 . B215 ) = ( C201 . B215 ))) by L603 , L582 , L595 , L597 , L598 , L569 , PRE_CIRC:13 , PRE_CIRC:15;
L608: D132 in ( dom C202 ) by L569 , L601 , L605 , FINSEQ_3:29;
L609: ( C201 . D132 ) in ( (the Sorts of ( FreeEnv C185 )) . C187 ) by L582 , L593 , L595 , L597 , L569 , L570 , L600 , MSAFREE2:11;
reconsider D137 = D135 as (Element of ( (the Sorts of ( FreeEnv C185 )) . C186 )) by L609 , L562 , L602 , L577 , L599 , L102;
reconsider D138 = ( depth D137 ) as Real;
L610: D138 in D131 by L567;
L611: D138 <= ( depth C192 ) by L610 , L572 , XXREAL_2:def 8;
consider C203 being (Element of ( (the Sorts of ( FreeMSA (the Sorts of C185) )) . C186 )) such that L612: D137 = C203 and L613: ( depth D137 ) = ( depth C203 ) by L380;
consider C204 being  finite DecoratedTree, C205 being  finite Tree such that L614: (C204 = C203 & C205 = ( dom C204 )) and L615: ( depth C203 ) = ( height C205 ) by MSAFREE2:def 14;
L616: (ex B216 being  DTree-yielding FinSequence st (C202 = B216 & ( dom D137 ) = ( tree ( doms B216 ) ))) by L604 , TREES_4:def 4;
reconsider D139 = D134 as (Element of C205) by L616 , L577 , L612 , L614 , L608 , PRE_CIRC:13;
L617: <* D133 *> in ( tree ( doms C201 ) ) by L569 , L603 , L577 , PRE_CIRC:13;
L618: ( dom D137 ) = ( ( dom C192 ) with-replacement (D134 , ( dom C189 )) ) by L617 , L582 , L598 , TREES_2:def 11;
L619: (D139 <> ( {} ) & ( C205 | D134 ) = C195) by L618 , L578 , L580 , L582 , L598 , L602 , L577 , L612 , L614 , PRE_CIRC:13 , TREES_1:33;
thus L620: thesis by L619 , L568 , L572 , L564 , L566 , L579 , L581 , L611 , L613 , L615 , TREES_1:48 , XXREAL_0:2;
end;
